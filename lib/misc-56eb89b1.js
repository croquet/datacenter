(globalThis["webpackChunk_croquet_microverse"] = globalThis["webpackChunk_croquet_microverse"] || []).push([["vendors-node_modules_croquet_croquet_cjs_croquet-croquet_js"],{

/***/ "./node_modules/@croquet/croquet/cjs/croquet-croquet.js":
/*!**************************************************************!*\
  !*** ./node_modules/@croquet/croquet/cjs/croquet-croquet.js ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";
/**
 * Copyright Croquet Labs 2025
 * Bundle of @croquet/croquet
 * Date: 2025-06-05
 * Version: 2.0.3
 */

var e=__webpack_require__(/*! toastify-js */ "./node_modules/toastify-js/src/toastify.js"),t=__webpack_require__(/*! fast-json-stable-stringify */ "./node_modules/fast-json-stable-stringify/index.js"),s=__webpack_require__(/*! fastpriorityqueue */ "./node_modules/fastpriorityqueue/FastPriorityQueue.js"),n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof __webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o,r={exports:{}};o||(o=1,function(e){var t=function(e){var t,s=Object.prototype,n=s.hasOwnProperty,i=Object.defineProperty||function(e,t,s){e[t]=s.value},o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,s){return Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,s){return e[t]=s}}function d(e,t,s,n){var o=t&&t.prototype instanceof y?t:y,r=Object.create(o.prototype),a=new k(n||[]);return i(r,"_invoke",{value:G(e,s,a)}),r}function h(e,t,s){try{return{type:"normal",arg:e.call(t,s)}}catch(e){return{type:"throw",arg:e}}}e.wrap=d;var u="suspendedStart",m="suspendedYield",p="executing",f="completed",b={};function y(){}function g(){}function w(){}var Z={};c(Z,r,(function(){return this}));var v=Object.getPrototypeOf,X=v&&v(v(P([])));X&&X!==s&&n.call(X,r)&&(Z=X);var x=w.prototype=y.prototype=Object.create(Z);function L(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function s(i,o,r,a){var l=h(e[i],e,o);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){s("next",e,r,a)}),(function(e){s("throw",e,r,a)})):t.resolve(d).then((function(e){c.value=e,r(c)}),(function(e){return s("throw",e,r,a)}))}a(l.arg)}var o;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){s(e,n,t,i)}))}return o=o?o.then(i,i):i()}})}function G(e,s,n){var i=u;return function(o,r){if(i===p)throw new Error("Generator is already running");if(i===f){if("throw"===o)throw r;return{value:t,done:!0}}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var l=W(a,n);if(l){if(l===b)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===u)throw i=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var c=h(e,s,n);if("normal"===c.type){if(i=n.done?f:m,c.arg===b)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=f,n.method="throw",n.arg=c.arg)}}}function W(e,s){var n=s.method,i=e.iterator[n];if(i===t)return s.delegate=null,"throw"===n&&e.iterator.return&&(s.method="return",s.arg=t,W(e,s),"throw"===s.method)||"return"!==n&&(s.method="throw",s.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var o=h(i,e.iterator,s.arg);if("throw"===o.type)return s.method="throw",s.arg=o.arg,s.delegate=null,b;var r=o.arg;return r?r.done?(s[e.resultName]=r.value,s.next=e.nextLoc,"return"!==s.method&&(s.method="next",s.arg=t),s.delegate=null,b):r:(s.method="throw",s.arg=new TypeError("iterator result is not an object"),s.delegate=null,b)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function P(e){if(null!=e){var s=e[r];if(s)return s.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function s(){for(;++i<e.length;)if(n.call(e,i))return s.value=e[i],s.done=!1,s;return s.value=t,s.done=!0,s};return o.next=o}}throw new TypeError(typeof e+" is not iterable")}return g.prototype=w,i(x,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:g,configurable:!0}),g.displayName=c(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,l,"GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},L(S.prototype),c(S.prototype,a,(function(){return this})),e.AsyncIterator=S,e.async=function(t,s,n,i,o){void 0===o&&(o=Promise);var r=new S(d(t,s,n,i),o);return e.isGeneratorFunction(s)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},L(x),c(x,l,"Generator"),c(x,r,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),s=[];for(var n in t)s.push(n);return s.reverse(),function e(){for(;s.length;){var n=s.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=P,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var s in this)"t"===s.charAt(0)&&n.call(this,s)&&!isNaN(+s.slice(1))&&(this[s]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var s=this;function i(n,i){return a.type="throw",a.arg=e,s.next=n,i&&(s.method="next",s.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var l=n.call(r,"catchLoc"),c=n.call(r,"finallyLoc");if(l&&c){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=e,r.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.finallyLoc===e)return this.complete(s.completion,s.afterLoc),C(s),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.tryLoc===e){var n=s.completion;if("throw"===n.type){var i=n.arg;C(s)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,s,n){return this.delegate={iterator:P(e),resultName:s,nextLoc:n},"next"===this.method&&(this.arg=t),b}},e}(e.exports);try{globalThis.regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(r));const a={CROQUET_VERSION:"2.0.3"},l=window&&window.location.hostname.endsWith("croquet.studio");let c="",d="";function h(e,t){if(t)for(const s of t.split("&")){const t=s.split("="),n=t[0];let i=!0;if(t.length>1&&(i=decodeURIComponent(t.slice(1).join("=")),i.match(/^(true|false|null|[0-9.]*|["[{].*)$/)))try{i=JSON.parse(i)}catch(e){"["===i[0]&&(i=i.slice(1,-1).split(","))}e[n]=i}}const u=new class{constructor(){this.getSession(),h(this,window.location.search.slice(1)),h(this,l?window.location.hash.slice(1):d),window.location.pathname.indexOf("/ar.html")>=0&&(this.ar=!0)}has(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"string"==typeof s&&(s=this.isHost(s));const n=this[e];if("string"!=typeof n)return s;const i=n.split(",");return!0===s&&(t=`no${t}`),t.endsWith("s")&&(t=t.slice(0,-1)),i.includes(t)||i.includes(`${t}s`)?!s:s}getSession(){if(l){const e=/^\/([^/]+)\/(.*)$/,t=window.location.pathname.match(e);if(t)return c=t[1],t[2]}else{const e=/^#([^&]+)&?(.*)$/,t=window.location.hash.match(e);if(t)return t[1].includes("=")?(d=`${t[1]}&${t[2]}`,""):(d=t[2],t[1])}return"string"==typeof this.session?(d=window.location.hash.slice(1),this.session):""}setSession(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null==l&&this.getSession();const{search:s,hash:n}=window.location,i=l?`/${c}/${e}${s}${n}`:`#${e}${d?"&"+d:""}`;t?window.history.replaceState({},"",i):window.history.pushState({},"",i)}isHost(e){const t=window.location.hostname;if(t===e)return!0;if("localhost"!==e)return!1;if(t.endsWith(".ngrok.io"))return!0;if("croquet.io"===t){if(window.location.pathname.match(/^\/(dev|files)\//))return!0}return"file:"===window.location.protocol||["127.0.0.1","[::1]"].includes(t)}isLocalhost(){return this.isHost("localhost")}};var m,p={exports:{}};var f,b,y=(m||(m=1,f=p,function(e,t,s){var n,i=256,o="random",r=s.pow(i,6),a=s.pow(2,52),l=2*a,c=255;function d(c,d,f){var y=[],g=p(m((d=1==d?{entropy:!0}:d||{}).entropy?[c,b(t)]:null==c?function(){try{var s;return n&&(s=n.randomBytes)?s=s(i):(s=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(s)),b(s)}catch(s){var o=e.navigator,r=o&&o.plugins;return[+new Date,e,r,e.screen,b(t)]}}():c,3),y),w=new h(y),Z=function(){for(var e=w.g(6),t=r,s=0;e<a;)e=(e+s)*i,t*=i,s=w.g(1);for(;e>=l;)e/=2,t/=2,s>>>=1;return(e+s)/t};return Z.int32=function(){return 0|w.g(4)},Z.quick=function(){return w.g(4)/4294967296},Z.double=Z,p(b(w.S),t),(d.pass||f||function(e,t,n,i){return i&&(i.S&&u(i,w),e.state=function(){return u(w,{})}),n?(s[o]=e,t):e})(Z,g,"global"in d?d.global:this==s,d.state)}function h(e){var t,s=e.length,n=this,o=0,r=n.i=n.j=0,a=n.S=[];for(s||(e=[s++]);o<i;)a[o]=o++;for(o=0;o<i;o++)a[o]=a[r=c&r+e[o%s]+(t=a[o])],a[r]=t;(n.g=function(e){for(var t,s=0,o=n.i,r=n.j,a=n.S;e--;)t=a[o=c&o+1],s=s*i+a[c&(a[o]=a[r=c&r+t])+(a[r]=t)];return n.i=o,n.j=r,s})(i)}function u(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var s,n=[],i=typeof e;if(t&&"object"==i)for(s in e)try{n.push(m(e[s],t-1))}catch(e){}return n.length?n:"string"==i?e:e+"\0"}function p(e,t){for(var s,n=e+"",i=0;i<n.length;)t[c&i]=c&(s^=19*t[c&i])+n.charCodeAt(i++);return b(t)}function b(e){return String.fromCharCode.apply(0,e)}if(p(s.random(),t),f.exports){f.exports=d;try{n=undefined}catch(e){}}else s["seed"+o]=d}("undefined"!=typeof self?self:p.exports,[],Math)),p.exports),g=i(y);!function(){function e(e){this.mode=s.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=0,n=this.data.length;t<n;t++){var i=[],o=this.data.charCodeAt(t);o>65536?(i[0]=240|(1835008&o)>>>18,i[1]=128|(258048&o)>>>12,i[2]=128|(4032&o)>>>6,i[3]=128|63&o):o>2048?(i[0]=224|(61440&o)>>>12,i[1]=128|(4032&o)>>>6,i[2]=128|63&o):o>128?(i[0]=192|(1984&o)>>>6,i[1]=128|63&o):i[0]=o,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function t(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}e.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,s=this.parsedData.length;t<s;t++)e.put(this.parsedData[t],8)}},t.prototype={addData:function(t){var s=new e(t);this.dataList.push(s),this.dataCache=null},isDark:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,s){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[n][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,s),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,s)},setupPositionProbePattern:function(e,t){for(var s=-1;s<=7;s++)if(!(e+s<=-1||this.moduleCount<=e+s))for(var n=-1;n<=7;n++)t+n<=-1||this.moduleCount<=t+n||(this.modules[e+s][t+n]=0<=s&&s<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==s||6==s)||2<=s&&s<=4&&2<=n&&n<=4)},getBestMaskPattern:function(){for(var e=0,t=0,s=0;s<8;s++){this.makeImpl(!0,s);var n=u.getLostPoint(this);(0==s||e>n)&&(e=n,t=s)}return t},createMovieClip:function(e,t,s){var n=e.createEmptyMovieClip(t,s);this.make();for(var i=0;i<this.modules.length;i++)for(var o=1*i,r=0;r<this.modules[i].length;r++){var a=1*r;this.modules[i][r]&&(n.beginFill(0,100),n.moveTo(a,o),n.lineTo(a+1,o),n.lineTo(a+1,o+1),n.lineTo(a,o+1),n.endFill())}return n},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupPositionAdjustPattern:function(){for(var e=u.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var s=0;s<e.length;s++){var n=e[t],i=e[s];if(null==this.modules[n][i])for(var o=-2;o<=2;o++)for(var r=-2;r<=2;r++)this.modules[n+o][i+r]=-2==o||2==o||-2==r||2==r||0==o&&0==r}},setupTypeNumber:function(e){for(var t=u.getBCHTypeNumber(this.typeNumber),s=0;s<18;s++){var n=!e&&1==(t>>s&1);this.modules[Math.floor(s/3)][s%3+this.moduleCount-8-3]=n}for(s=0;s<18;s++){n=!e&&1==(t>>s&1);this.modules[s%3+this.moduleCount-8-3][Math.floor(s/3)]=n}},setupTypeInfo:function(e,t){for(var s=this.errorCorrectLevel<<3|t,n=u.getBCHTypeInfo(s),i=0;i<15;i++){var o=!e&&1==(n>>i&1);i<6?this.modules[i][8]=o:i<8?this.modules[i+1][8]=o:this.modules[this.moduleCount-15+i][8]=o}for(i=0;i<15;i++){o=!e&&1==(n>>i&1);i<8?this.modules[8][this.moduleCount-i-1]=o:i<9?this.modules[8][15-i-1+1]=o:this.modules[8][15-i-1]=o}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var s=-1,n=this.moduleCount-1,i=7,o=0,r=this.moduleCount-1;r>0;r-=2)for(6==r&&r--;;){for(var a=0;a<2;a++)if(null==this.modules[n][r-a]){var l=!1;o<e.length&&(l=1==(e[o]>>>i&1)),u.getMask(t,n,r-a)&&(l=!l),this.modules[n][r-a]=l,-1==--i&&(o++,i=7)}if((n+=s)<0||this.moduleCount<=n){n-=s,s=-s;break}}}},t.PAD0=236,t.PAD1=17,t.createData=function(e,s,n){for(var i=y.getRSBlocks(e,s),o=new g,r=0;r<n.length;r++){var a=n[r];o.put(a.mode,4),o.put(a.getLength(),u.getLengthInBits(a.mode,e)),a.write(o)}var l=0;for(r=0;r<i.length;r++)l+=i[r].dataCount;if(o.getLengthInBits()>8*l)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*l+")");for(o.getLengthInBits()+4<=8*l&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(!1);for(;!(o.getLengthInBits()>=8*l||(o.put(t.PAD0,8),o.getLengthInBits()>=8*l));)o.put(t.PAD1,8);return t.createBytes(o,i)},t.createBytes=function(e,t){for(var s=0,n=0,i=0,o=new Array(t.length),r=new Array(t.length),a=0;a<t.length;a++){var l=t[a].dataCount,c=t[a].totalCount-l;n=Math.max(n,l),i=Math.max(i,c),o[a]=new Array(l);for(var d=0;d<o[a].length;d++)o[a][d]=255&e.buffer[d+s];s+=l;var h=u.getErrorCorrectPolynomial(c),m=new f(o[a],h.getLength()-1).mod(h);r[a]=new Array(h.getLength()-1);for(d=0;d<r[a].length;d++){var p=d+m.getLength()-r[a].length;r[a][d]=p>=0?m.get(p):0}}var b=0;for(d=0;d<t.length;d++)b+=t[d].totalCount;var y=new Array(b),g=0;for(d=0;d<n;d++)for(a=0;a<t.length;a++)d<o[a].length&&(y[g++]=o[a][d]);for(d=0;d<i;d++)for(a=0;a<t.length;a++)d<r[a].length&&(y[g++]=r[a][d]);return y};for(var s={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},n={L:1,M:0,Q:3,H:2},i=0,o=1,r=2,a=3,l=4,c=5,d=6,h=7,u={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;u.getBCHDigit(t)-u.getBCHDigit(u.G15)>=0;)t^=u.G15<<u.getBCHDigit(t)-u.getBCHDigit(u.G15);return(e<<10|t)^u.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;u.getBCHDigit(t)-u.getBCHDigit(u.G18)>=0;)t^=u.G18<<u.getBCHDigit(t)-u.getBCHDigit(u.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return u.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,s){switch(e){case i:return(t+s)%2==0;case o:return t%2==0;case r:return s%3==0;case a:return(t+s)%3==0;case l:return(Math.floor(t/2)+Math.floor(s/3))%2==0;case c:return t*s%2+t*s%3==0;case d:return(t*s%2+t*s%3)%2==0;case h:return(t*s%3+(t+s)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new f([1],0),s=0;s<e;s++)t=t.multiply(new f([1,m.gexp(s)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case s.MODE_NUMBER:return 10;case s.MODE_ALPHA_NUM:return 9;case s.MODE_8BIT_BYTE:case s.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case s.MODE_NUMBER:return 12;case s.MODE_ALPHA_NUM:return 11;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case s.MODE_NUMBER:return 14;case s.MODE_ALPHA_NUM:return 13;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),s=0,n=0;n<t;n++)for(var i=0;i<t;i++){for(var o=0,r=e.isDark(n,i),a=-1;a<=1;a++)if(!(n+a<0||t<=n+a))for(var l=-1;l<=1;l++)i+l<0||t<=i+l||0==a&&0==l||r==e.isDark(n+a,i+l)&&o++;o>5&&(s+=3+o-5)}for(n=0;n<t-1;n++)for(i=0;i<t-1;i++){var c=0;e.isDark(n,i)&&c++,e.isDark(n+1,i)&&c++,e.isDark(n,i+1)&&c++,e.isDark(n+1,i+1)&&c++,0!=c&&4!=c||(s+=3)}for(n=0;n<t;n++)for(i=0;i<t-6;i++)e.isDark(n,i)&&!e.isDark(n,i+1)&&e.isDark(n,i+2)&&e.isDark(n,i+3)&&e.isDark(n,i+4)&&!e.isDark(n,i+5)&&e.isDark(n,i+6)&&(s+=40);for(i=0;i<t;i++)for(n=0;n<t-6;n++)e.isDark(n,i)&&!e.isDark(n+1,i)&&e.isDark(n+2,i)&&e.isDark(n+3,i)&&e.isDark(n+4,i)&&!e.isDark(n+5,i)&&e.isDark(n+6,i)&&(s+=40);var d=0;for(i=0;i<t;i++)for(n=0;n<t;n++)e.isDark(n,i)&&d++;return s+=10*(Math.abs(100*d/t/t-50)/5)}},m={glog:function(e){if(e<1)throw new Error("glog("+e+")");return m.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return m.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},p=0;p<8;p++)m.EXP_TABLE[p]=1<<p;for(p=8;p<256;p++)m.EXP_TABLE[p]=m.EXP_TABLE[p-4]^m.EXP_TABLE[p-5]^m.EXP_TABLE[p-6]^m.EXP_TABLE[p-8];for(p=0;p<255;p++)m.LOG_TABLE[m.EXP_TABLE[p]]=p;function f(e,t){if(null==e.length)throw new Error(e.length+"/"+t);for(var s=0;s<e.length&&0==e[s];)s++;this.num=new Array(e.length-s+t);for(var n=0;n<e.length-s;n++)this.num[n]=e[n+s]}function y(e,t){this.totalCount=e,this.dataCount=t}function g(){this.buffer=[],this.length=0}f.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),s=0;s<this.getLength();s++)for(var n=0;n<e.getLength();n++)t[s+n]^=m.gexp(m.glog(this.get(s))+m.glog(e.get(n)));return new f(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=m.glog(this.get(0))-m.glog(e.get(0)),s=new Array(this.getLength()),n=0;n<this.getLength();n++)s[n]=this.get(n);for(n=0;n<e.getLength();n++)s[n]^=m.gexp(m.glog(e.get(n))+t);return new f(s,0).mod(e)}},y.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],y.getRSBlocks=function(e,t){var s=y.getRsBlockTable(e,t);if(null==s)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var n=s.length/3,i=[],o=0;o<n;o++)for(var r=s[3*o+0],a=s[3*o+1],l=s[3*o+2],c=0;c<r;c++)i.push(new y(a,l));return i},y.getRsBlockTable=function(e,t){switch(t){case n.L:return y.RS_BLOCK_TABLE[4*(e-1)+0];case n.M:return y.RS_BLOCK_TABLE[4*(e-1)+1];case n.Q:return y.RS_BLOCK_TABLE[4*(e-1)+2];case n.H:return y.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},g.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var s=0;s<t;s++)this.putBit(1==(e>>>t-s-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var w=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],Z=function(){var e=function(e,t){this._bIsPainted=!1,this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};return e.prototype.draw=function(e){var t=this._oContext,s=this._htOption,n=e.getModuleCount(),i=s.width/n,o=s.height/n,r=Math.round(i),a=Math.round(o);this.clear();for(var l=0;l<n;l++)for(var c=0;c<n;c++){var d=e.isDark(l,c),h=c*i,u=l*o;t.strokeStyle=d?s.colorDark:s.colorLight,t.lineWidth=1,t.fillStyle=d?s.colorDark:s.colorLight,t.fillRect(h,u,i,o),t.strokeRect(Math.floor(h)+.5,Math.floor(u)+.5,r,a),t.strokeRect(Math.ceil(h)-.5,Math.ceil(u)-.5,r,a)}this._bIsPainted=!0},e.prototype.isPainted=function(){return this._bIsPainted},e.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},e.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},e}();function v(e,t){for(var s=1,i=function(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}(e),o=0,r=w.length;o<=r;o++){var a=0;switch(t){case n.L:a=w[o][0];break;case n.M:a=w[o][1];break;case n.Q:a=w[o][2];break;case n.H:a=w[o][3]}if(i<=a)break;s++}if(s>w.length)throw new Error("Too long data");return s}b=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:n.H},"string"==typeof t&&(t={text:t}),t)for(var s in t)this._htOption[s]=t[s];"string"==typeof e&&(e=document.getElementById(e)),this._htOption.useSVG&&(Z=svgDrawer),this._el=e,this._oQRCode=null,this._oDrawing=new Z(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},b.prototype.makeCode=function(e){this._oQRCode=new t(v(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._oDrawing.draw(this._oQRCode)},b.prototype.clear=function(){this._oDrawing.clear()},b.prototype.getCanvas=function(){for(let e=0;e<this._el.children.length;e++){const t=this._el.children[e];if("CANVAS"===t.tagName)return t}return null},b.CorrectLevel=n}();var w=b,Z={exports:{}};var v,X={exports:{}};function x(){return v||(v=1,X.exports=(e=e||function(e,t){var s;if("undefined"!=typeof window&&window.crypto&&(s=window.crypto),"undefined"!=typeof self&&self.crypto&&(s=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(s=globalThis.crypto),!s&&"undefined"!=typeof window&&window.msCrypto&&(s=window.msCrypto),!s&&void 0!==n&&n.crypto&&(s=n.crypto),!s)try{s=__webpack_require__(/*! crypto */ "?985c")}catch(e){}var i=function(){if(s){if("function"==typeof s.getRandomValues)try{return s.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof s.randomBytes)try{return s.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var s;return e.prototype=t,s=new e,e.prototype=null,s}}(),r={},a=r.lib={},l=a.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=l.extend({init:function(e,s){e=this.words=e||[],this.sigBytes=s!=t?s:4*e.length},toString:function(e){return(e||h).stringify(this)},concat:function(e){var t=this.words,s=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var r=s[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=r<<24-(n+o)%4*8}else for(var a=0;a<i;a+=4)t[n+a>>>2]=s[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,s=this.sigBytes;t[s>>>2]&=4294967295<<32-s%4*8,t.length=e.ceil(s/4)},clone:function(){var e=l.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],s=0;s<e;s+=4)t.push(i());return new c.init(t,e)}}),d=r.enc={},h=d.Hex={stringify:function(e){for(var t=e.words,s=e.sigBytes,n=[],i=0;i<s;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,s=[],n=0;n<t;n+=2)s[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new c.init(s,t/2)}},u=d.Latin1={stringify:function(e){for(var t=e.words,s=e.sigBytes,n=[],i=0;i<s;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,s=[],n=0;n<t;n++)s[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c.init(s,t)}},m=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},p=a.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=m.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var s,n=this._data,i=n.words,o=n.sigBytes,r=this.blockSize,a=o/(4*r),l=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*r,d=e.min(4*l,o);if(l){for(var h=0;h<l;h+=r)this._doProcessBlock(i,h);s=i.splice(0,l),n.sigBytes-=d}return new c.init(s,d)},clone:function(){var e=l.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=p.extend({cfg:l.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,s){return new e.init(s).finalize(t)}},_createHmacHelper:function(e){return function(t,s){return new f.HMAC.init(e,s).finalize(t)}}});var f=r.algo={};return r}(Math),e)),X.exports;var e}var L;var S,G,W=(L||(L=1,Z.exports=(S=x(),function(){if("function"==typeof ArrayBuffer){var e=S.lib.WordArray,t=e.init,s=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var s=e.byteLength,n=[],i=0;i<s;i++)n[i>>>2]|=e[i]<<24-i%4*8;t.call(this,n,s)}else t.apply(this,arguments)};s.prototype=e}}(),S.lib.WordArray)),Z.exports),T=i(W),C={exports:{}};function k(){return G||(G=1,C.exports=function(e){return function(t){var s=e,n=s.lib,i=n.WordArray,o=n.Hasher,r=s.algo,a=[],l=[];!function(){function e(e){for(var s=t.sqrt(e),n=2;n<=s;n++)if(!(e%n))return!1;return!0}function s(e){return 4294967296*(e-(0|e))|0}for(var n=2,i=0;i<64;)e(n)&&(i<8&&(a[i]=s(t.pow(n,.5))),l[i]=s(t.pow(n,1/3)),i++),n++}();var c=[],d=r.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var s=this._hash.words,n=s[0],i=s[1],o=s[2],r=s[3],a=s[4],d=s[5],h=s[6],u=s[7],m=0;m<64;m++){if(m<16)c[m]=0|e[t+m];else{var p=c[m-15],f=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,b=c[m-2],y=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;c[m]=f+c[m-7]+y+c[m-16]}var g=n&i^n&o^i&o,w=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),Z=u+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&d^~a&h)+l[m]+c[m];u=h,h=d,d=a,a=r+Z|0,r=o,o=i,i=n,n=Z+(w+g)|0}s[0]=s[0]+n|0,s[1]=s[1]+i|0,s[2]=s[2]+o|0,s[3]=s[3]+r|0,s[4]=s[4]+a|0,s[5]=s[5]+d|0,s[6]=s[6]+h|0,s[7]=s[7]+u|0},_doFinalize:function(){var e=this._data,s=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return s[i>>>5]|=128<<24-i%32,s[14+(i+64>>>9<<4)]=t.floor(n/4294967296),s[15+(i+64>>>9<<4)]=n,e.sigBytes=4*s.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});s.SHA256=o._createHelper(d),s.HmacSHA256=o._createHmacHelper(d)}(Math),e.SHA256}(x())),C.exports}var P=i(k());const R="node"===a.CROQUET_PLATFORM;let I;function M(e){const t=e.sigBytes,s=e.words,n=new Uint8Array(t);let i=0,o=0;for(;i<t;){const e=s[o++];if(n[i++]=(4278190080&e)>>>24,i===t)break;if(n[i++]=(16711680&e)>>>16,i===t)break;if(n[i++]=(65280&e)>>>8,i===t)break;n[i++]=255&e}return n}function V(e){function t(e){const t=e.indexOf("{"),s=e.lastIndexOf("}");if(-1===t||-1===s||s<t)return e;const n=e.slice(0,t).replace(/\s+/g," ").replace(/\s\(/,"("),i=e.slice(t+1,s);return`${n.trim()}{${i.trim()}}`}let s=t(""+e);if(!s.startsWith("class")){const n=e.prototype;n&&(s+=Object.getOwnPropertyNames(n).map((e=>`${e}:${t(""+n[e])}`)).join(""))}return s}function Y(e){return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function H(){return u.has("debug","hashing",!1)}I=globalThis.crypto&&globalThis.crypto.subtle&&"function"==typeof globalThis.crypto.subtle.digest?globalThis.crypto.subtle.digest.bind(globalThis.crypto.subtle):(e,t)=>{if("SHA-256"!==e)throw Error(`${ze.libName}: only SHA-256 available`);const s=T.create(t);return M(P(s)).buffer};let K={};const N=new TextEncoder;async function z(e){const t=N.encode(e),s=await async function(e){return 0===e.length?"47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU":Y(await I("SHA-256",e))}(t);return K[s]={string:e,buffer:t},s}const _=[],F={};const E=new Set;const J=Date.now();"undefined"==typeof performance&&(window.performance={now:()=>Date.now()-J});const j=["simulate","update","render","snapshot"],Q={total:"black",update:"blue",render:"magenta",simulate:"yellow",snapshot:"green",backlog:"red",network:"lightgray"};let U,D,O=null,B=null,A=null,$=0,q=null,ee=null;function te(e){for(O=e;e.firstChild;)e.removeChild(e.firstChild);e.style.background="#faf0dc",q=document.createElement("canvas"),ee=q.getContext("2d"),q.id="text_stats",q.width=Math.min(140,window.innerWidth),q.height=36,q.style.width=q.width,q.style.height=q.height,ee.font="9.5pt sans-serif",e.appendChild(q),e.title=Object.entries(Q).map((e=>{let[t,s]=e;return`${s}: ${t}`})).join("\n"),B=document.createElement("canvas"),B.width=Math.min(125,window.innerWidth),B.height=125,B.style.width="100%";const t=document.createElement("div");t.id="innerDiv",e.appendChild(t),t.appendChild(B),A=B.getContext("2d")}const se=[];let ne=0,ie=!1,oe=ce(0);const re=1e3/60;function ae(e){return 20*(1-e/re)+60}function le(e){U=function(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.style.width="100%",t.style.position="absolute",t.style.left="0px",O.querySelector("#innerDiv").appendChild(t),t}(e),D=U.getContext("2d"),D.strokeStyle="rgba(255, 255, 255, 0.5)";for(let e=0;e<60;e+=re){const t=ae(e);D.moveTo(0,t),D.lineTo(U.width,t),D.stroke()}}function ce(e){return{start:e,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:ie}}function de(e){oe.total=e-oe.start;const t=Math.min(120,window.innerWidth);if(se.length>=t&&se.splice(0,se.length-t+1),se.push(oe),se.length<=1)return;if(!O)return;if(0===O.offsetHeight)return;const s=se.slice(1).filter((e=>e.total)),n=s.map((e=>e.total)).reduce(((e,t)=>e+t),0)/s.length,i=Math.max(...s.map((e=>e.total)));Math.max(...s.map((e=>Math.max(e.backlog,e.network)))),ne=1e3,function(e,t){ee.globalCompositeOperation="copy",ee.fillStyle="rgb(255, 255, 255, 0)",ee.fillRect(0,0,q.width,q.height),ee.fillStyle="rgb(0, 0, 0, 1)",ee.globalCompositeOperation="source-over";let s=`${oe.users} users, ${Math.round(1e3/e)} fps`;t>70&&(s+=` ${Math.ceil(t).toLocaleString()}ms`),ee.fillText(s,2,15),s=oe.backlog<100&&oe.activity<1e3?`latency: ${oe.latency} ms`:`backlog: ${oe.backlog<100?"0.0":(oe.backlog/1e3).toFixed(1)} s`,ee.fillText(s,2,33)}(n,i),U||le(B),$===B.width?(A.globalCompositeOperation="copy",A.drawImage(B,1,0,B.width-1,B.height,0,0,B.width-1,B.height),A.globalCompositeOperation="source-over",A.fillStyle="transparent",A.fillRect(B.width-1,0,1,B.height)):$++;const o=e=>ae(e/ne*-2*re)+5;{const e=se[se.length-1],t=$-.5;let s=ae(0);A.beginPath(),A.moveTo(t,s),A.lineTo(t,ae(e.total)),A.strokeStyle=Q[e.connected?"total":"network"],A.stroke(),A.beginPath(),A.moveTo(t,s),s=ae(e.total);let n=0;for(const i of j)e.items[i]&&(n+=e.items[i],s=ae(n),A.lineTo(t,s),A.strokeStyle=Q[i],A.stroke(),A.beginPath(),A.moveTo(t,s));e.network&&(A.beginPath(),A.moveTo(t,o(0)),A.lineTo(t,o(e.network)),A.strokeStyle=Q.network,A.stroke())}}const he=[],ue={};let me={};const pe={frames:se,animationFrame(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};de(e),oe=ce(e);for(const[e,s]of Object.entries(t))this[e](s)},begin(e){const t=performance.now();oe.items[e]=(oe.items[e]||0)-t;const s=he[he.length-1];return s&&(oe.items[s]+=t),he.push(e),t},end(e){const t=performance.now();oe.items[e]+=t;const s=he.pop();if(s!==e)throw Error(`Unmatched stats calls: expected end("${s}"), got end("${e}")`);const n=he[he.length-1];return n&&(oe.items[n]-=t),t},backlog(e){oe.backlog=Math.max(e,oe.backlog)},starvation(e){oe.network=e},latency(e){oe.latency=e},activity(e){oe.activity=e},users(e){oe.users=e},connected(e){const t=ie;oe.connected=ie=e,t&&!ie&&U&&(U.remove(),D=null)},networkTraffic:ue,addNetworkTraffic(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];ue[e]=(ue[e]||0)+t,s&&(ue[`audit_${e}`]=(ue[`audit_${e}`]||0)+t)},resetAuditStats(){for(const e in ue)e.startsWith("audit_")&&(ue[e]=0)},perSecondTally(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(window.logMessageStats)for(const[t,s]of Object.entries(e))me[t]=(me[t]||0)+s},stepSession(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=Math.floor(Date.now()/1e3);if(!window.logMessageStats)return me={second:s},null;let n=null;if(s!==me.second){if(me.second&&t&&(me.requestedMessages||me.sentMessagesTotal)){n={...me};const e=s-me.second;1!==e&&(n.sampleSeconds=e),n.sentBundles&&(n.averageDelay=Math.round(10*n.sendDelay/n.sentMessagesTotal)/10,n.averageBundlePayload=Math.round(n.sentBundlePayload/n.sentBundles)),delete n.second,delete n.sendDelay,delete n.sentBundlePayload}me={second:s}}return n}};globalThis.CROQUETSTATS=pe;const fe="ontouchstart"in document.documentElement,be=window&&window.parent!==window,ye=fe?20:12,ge=fe?0:15;let we=!1;let Ze=!1;let ve,Xe=!1;function xe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e&&ze.showMessage(e,{...t,level:"warning"})}function Le(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e&&ze.showMessage(e,{...t,level:"status"})}function Se(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"error";console.error(`Error during ${e}`,t);const n=(t.stack||"").split("\n").filter((e=>!e.match(/croquet-.*\.min.js/))).join("\n");ze.showMessage(`Error during ${e}: ${t.message}\n\n${n}`,{level:s,duration:"error"===s?1e4:void 0,stopOnFocus:!0})}try{if(ve=window.localStorage,ve["croquet-debug-persist-allowed"]="true","true"!==ve["croquet-debug-persist-allowed"])throw Error("localStorage not persisted");delete ve["croquet-debug-persist-allowed"]}catch(Vr){console.warn("localStorage not allowed"),ve={}}const Ge={get pinned(){return"true"===ve[window.location.pathname+"/croquet-debug-ui-pinned"]},set pinned(e){ve[window.location.pathname+"/croquet-debug-ui-pinned"]=!!e},get activePage(){return ve[window.location.pathname+"/croquet-debug-ui-activePage"]},set activePage(e){ve[window.location.pathname+"/croquet-debug-ui-activePage"]=e}},We=e=>{e.preventDefault(),e.stopPropagation()};function Te(e,t,s){const n=document.createElement("canvas"),i=n.width=40*ye/12,o=n.height=60,r=n.getContext("2d");r.font="36px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="black",r.fillText(e,i/2,.55*o);const a=document.createElement("button");a.id=t,a.className="croquet_dock_button";const l=e=>{e.preventDefault(),e.stopPropagation(),s()};return fe?(a.ontouchstart=l,a.ontouchend=We,a.onpointerdown=We,a.onpointerup=We):(a.onclick=l,a.onpointerdown=We,a.onpointerup=We),a.appendChild(n),a}function Ce(e,t){if(!1===ze.badge)return;const s=function(e){const t=new g(e),s=["bcdfghjklmnpqrstvwxyz","aeiou"];let n="";for(let e=0;e<5;e++)n+=s[e%2][t.quick()*s[e%2].length|0];return n}(t);for(document.title=document.title.replace(/:.*/,""),document.title+=":"+s;e.firstChild;)e.removeChild(e.firstChild);const n=document.createElement("canvas"),i=n.width=120,o=n.height=40;n.style.width="100%",e.appendChild(n);const r=n.getContext("2d"),a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const s=new g(e),n=[];for(let e=0;e<t;e++)n.push(`hsl(${360*s.quick()}, 50%, 70%)`);return n}(t,2);r.fillStyle=a[0],r.beginPath(),r.moveTo(0,0),r.lineTo(0,o),r.lineTo(i,0),r.closePath(),r.fill(),r.fillStyle=a[1],r.beginPath(),r.moveTo(i,o),r.lineTo(i,0),r.lineTo(0,o),r.closePath(),r.fill(),r.font="30px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="black",r.fillText(s,i/2,o/2)}function ke(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(;e.firstChild;)e.removeChild(e.firstChild);return new w(e,{text:t,width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:w.CorrectLevel.L,...s})}function Pe(){if(!1===ze.root||!1===ze.qrcode)return;if(u.noqr)return;const e=ze.sessionURL;if(!e)return void console.warn("App.sessionURL is not set");const t=Ye(ze.qrcode);if(!t)return;fe||(t.onclick=t=>{t.preventDefault(),t.stopPropagation(),t.shiftKey?function(){const e=document.getElementById("croquet_dock");e&&e.classList.toggle("debug")}():window.open(e)});ke(t,e).getCanvas().style.width="100%"}let Re,Ie,Me=0;function Ve(){!function(){if(Ze)return;Ze=!0;const e=`\n        ${be?"body { min-height: 100vh }":""}\n        #croquet_spinnerOverlay {\n            z-index: 1000;\n            position: fixed;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            background-color:#333;\n            opacity:0.9;\n            display:flex;\n            align-items:center;\n            justify-content:center;\n            transition: opacity 1.0s ease-out;\n        }\n        /* https://github.com/lukehaas/css-loaders */\n        @keyframes croquet_dots {\n            0%, 80%, 100% { box-shadow: 0 2.5em 0 -1.3em; }\n            40% { box-shadow: 0 2.5em 0 0; }\n        }\n        #croquet_loader,\n        #croquet_loader::before,\n        #croquet_loader::after {\n          border-radius: 50%;\n          width: 2.5em;\n          height: 2.5em;\n          animation: croquet_dots 1.8s infinite ease-in-out;\n        }\n        #croquet_loader {\n          color: #fff;\n          font-size: 10px;\n          margin: 80px auto;\n          position: relative;\n          text-indent: -9999em;\n          animation-delay: -0.16s;\n        }\n        #croquet_loader::before,\n        #croquet_loader::after {\n          content: '';\n          position: absolute;\n          top: 0;\n        }\n        #croquet_loader::before { left: -3.5em; animation-delay: -0.32s; }\n        #croquet_loader::after { left: 3.5em; }\n        #croquet_spinnerOverlay.croquet_error>*,\n        #croquet_spinnerOverlay.croquet_error>*::before,\n        #croquet_spinnerOverlay.croquet_error>*::after {\n            color: #f00;\n        }\n        #croquet_spinnerOverlay.croquet_fatal>*,\n        #croquet_spinnerOverlay.croquet_fatal>*::before,\n        #croquet_spinnerOverlay.croquet_fatal>*::after {\n            color: #f00;\n            box-shadow: 0 2.5em 0 0 !important;\n            animation: none !important;\n        }\n`,t=document.createElement("style");t.innerHTML=e,document.head.insertBefore(t,document.head.querySelector("style,link[rel=stylesheet]"))}();const e=document.createElement("div");e.id="croquet_spinnerOverlay";const t=document.createElement("div");return t.id="croquet_loader",t.innerText="Catching up...",e.appendChild(t),e}function Ye(e,t){if(!1===e)return!1;if(e instanceof Element)return e;if("string"==typeof e){const t=document.getElementById(e);if(t)return t}return t?t():null}function He(){const e=new Uint8Array(arguments.length>0&&void 0!==arguments[0]?arguments[0]:16);return window.crypto.getRandomValues(e),Y(e.buffer)}const Ke=new Set;let Ne=function(){let e=null;const t=document.getElementsByTagName("link");for(const s of t)if("canonical"===s.getAttribute("rel")){e=s.getAttribute("href");break}return e||window.location.href}();const ze={get libName(){return globalThis.__MULTISYNQ__?"Multisynq":"Croquet"},get sessionURL(){return Ne},set sessionURL(e){Ne=e,Pe()},root:null,sync:!0,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(u.nodock)return;const t=e.debug||u.debug,s=document.getElementById("croquet_dock");s&&s.parentElement.removeChild(s);const n=Ye(ze.root,(()=>document.body));if(!n)return;!function(){if(we)return;we=!0;const e=`\n        #croquet_dock { position: fixed; z-index: 2; border: 3px solid white; bottom: 6px; left: 6px; width: 36px; height: 36px; box-sizing: border-box; background: white; opacity: 0.4; transition: all 0.3s ease; }\n        #croquet_dock.active { opacity: 0.95; border-radius: 12px; }\n        #croquet_dock.debug { width: 84px; }\n        #croquet_dock_bar { position: absolute; border: 3px solid white; width: 100%; height: 30px; box-sizing: border-box; background: white; }\n\n        #croquet_badge { position: absolute; width: 72px; height: 24px; top: 50%; transform: translate(0px, -50%); cursor: none; }\n        #croquet_dock.active #croquet_badge { left: 2%; }\n        #croquet_dock:not(.debug) #croquet_badge { display: none; }\n\n        .croquet_dock_button { position: absolute; width: ${ye}%; height: 90%; top: 50%; transform: translate(0px, -50%); border-radius: 20%; }\n        .croquet_dock_button:focus { outline: 0; }\n        .croquet_dock_button canvas { position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; }\n        #croquet_dock:not(.active) .croquet_dock_button { display: none; }\n        #croquet_dock_left { right: ${2+ge+ye+2}% }\n        #croquet_dock:not(.debug) #croquet_dock_left { display: none; }\n        #croquet_dock_right { right: ${2+ge}%; }\n        #croquet_dock:not(.debug) #croquet_dock_right { display: none; }\n        #croquet_dock_pin { right: 2%; }\n        #croquet_dock_pin.pinned { background: #cce6ff; }\n\n        #croquet_dock_content { position: absolute; left: 2px; top: 2px; right: 2px; bottom: 2px; background: white; overflow: hidden; }\n        #croquet_dock.debug:not(.active) #croquet_dock_content { display: none; }\n        #croquet_dock.debug:not(.active) #croquet_dock_content div { display: none; }\n\n        #croquet_qrcode { position: absolute; width: 100%; height: 100%;box-sizing: border-box; cursor: crosshair; }\n        #croquet_dock.active #croquet_qrcode { border: 6px solid white; }\n        #croquet_dock.debug #croquet_qrcode:not(.active) { display: none; }\n        #croquet_qrcode canvas { image-rendering: pixelated; }\n\n        #croquet_stats { position: absolute; width: 70%; height: 90%; left: 15%; top: 5%; opacity: 0.8; font-family: sans-serif; }\n        #croquet_stats:not(.active) { display: none; }\n`,t=document.createElement("style");t.innerHTML=e,document.head.insertBefore(t,document.head.querySelector("style,link[rel=stylesheet]"))}();const i=document.createElement("div");i.id="croquet_dock",t&&i.classList.add("debug"),be&&!1===e.iframe&&(i.style.display="none"),n.appendChild(i);const o=document.createElement("div");let r;o.id="croquet_dock_bar",i.appendChild(o),!1!==e.badge&&(r=document.createElement("div"),r.id="croquet_badge",o.appendChild(r),ze.badge=r);const a=document.createElement("div");a.id="croquet_dock_content",i.appendChild(a);const l=[];let c,d;if(!1!==e.qrcode){ze.sessionURL&&(c=document.createElement("div"),c.id="croquet_qrcode",a.appendChild(c),l.push(c.id),ze.qrcode=c,t||(Ge.activePage=c.id))}if(!1!==e.stats&&(d=document.createElement("div"),d.id="croquet_stats",a.appendChild(d),l.push(d.id),ze.stats=d),l.length){function b(e){const t=l.length;let s,n=0;if(Ge.activePage){const e=l.indexOf(Ge.activePage);e>=0?(n=e,s=document.getElementById(Ge.activePage)):Ge.activePage=null}const i=l[(n+t+e)%t];let o;i===Ge.activePage?o=s:(s&&s.classList.remove("active"),o=document.getElementById(i)),o&&o.classList.add("active"),Ge.activePage=i}l.length>1&&(o.appendChild(Te("<","croquet_dock_left",(()=>b(-1)))),o.appendChild(Te(">","croquet_dock_right",(()=>b(1))))),b(0)}if(!fe&&!e.alwaysPinned){const y=Te("📌","croquet_dock_pin",(()=>{Ge.pinned=!Ge.pinned,g()})),g=()=>{Ge.pinned?y.classList.add("pinned"):y.classList.remove("pinned")};g(),o.appendChild(y)}const h=e=>{i.style.width=`${e}px`;const t=1.18*e;i.style.height=`${t}px`;const s=18*e/100;o.style.height=`${s}px`,a.style.top=`${s+2}px`,r&&(r.style.height=.9*s+"px",r.style.width=.9*s*3+"px"),c&&(c.style.border=8*e/200+"px solid white")};let m=e.fixedSize||200;const p=()=>{i.classList.add("active"),h(m),setTimeout((()=>i.style.transition="none"),300)},f=()=>{i.style.transition="",i.classList.remove("active"),i.style.width=i.style.height="",o.style.height="",a.style.top="",r&&(r.style.height=r.style.width=""),c&&(c.style.border="")};if(fe)f(),i.ontouchstart=e=>{e.preventDefault(),e.stopPropagation(),i.classList.contains("active")?f():p()},i.ontouchend=We,i.onpointerdown=We,i.onpointerup=We;else if(e.alwaysPinned?p():(Ge.pinned?p():f(),i.onmouseenter=p,i.onmouseleave=()=>{Ge.pinned||f()}),!e.fixedSize){let w=0;i.addEventListener("wheel",(e=>{e.stopPropagation();const t=Date.now();if(t-w<100)return;w=t;let{deltaY:s}=e;s=Math.sign(s)*Math.min(5,Math.abs(s));const n=.8*Math.min(window.innerWidth,window.innerHeight);m=Math.max(166,Math.min(n,i.offsetWidth/1.05**s)),h(m)}),{passive:!0})}},makeSessionWidgets:function(e){!function(e){if(!e||!1===ze.root)return;const t=Ye(ze.badge);t&&Ce(t,e)}(e),Pe(),function(){if(!1===ze.root)return;if(u.nostats)return;const e=Ye(ze.stats);e&&te(e)}()},makeQRCanvas(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!ze.sessionURL)return null;const t=ke(document.createElement("div"),ze.sessionURL,e);return t&&t.getCanvas()},clearSessionMoniker:function(){!1!==ze.badge&&(document.title=document.title.replace(/:.*/,""))},showSyncWait(e){!1===ze.root?e=!1:Re||(Re=Ve()),function(e){if(Ie!==e&&("string"!=typeof Ie||!0!==e))if(!1===ze.sync&&(e=!1),Ie=e,e)clearTimeout(Me),Me=setTimeout((()=>{Ie&&(Ye(ze.root,(()=>document.body)).appendChild(Re),Re.style.opacity=.9,Re.className="error"===Ie?"croquet_error":"fatal"===Ie?"croquet_fatal":"")}),500);else{if(!Re)return;clearTimeout(Me),Re.style.opacity=0,Re.className="",Me=setTimeout((()=>{Ie||Re.parentElement&&Re.parentElement.removeChild(Re)}),500)}}(e)},messageFunction:function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=s.level;let i;return"error"===n?(i="orangered,red",console.error(t)):"warning"===n?(i="gold,orange",console.warn(t)):i="silver,gray",function(t,s){const n=Ye(ze.root,(()=>document.body));if(!1===n)return null;!function(){if(Xe)return;Xe=!0;let e="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n";e+="\n        .toastify {\n            font-family: sans-serif;\n            border-radius: 8px;\n        }\n\n        .toastify-center {\n            margin-left: auto;\n            margin-right: auto;\n            left: 0;\n            right: 0;\n            max-width: fit-content;\n            max-width: -moz-fit-content;\n        }\n";const t=document.createElement("style");t.innerHTML="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n\n        .toastify {\n            font-family: sans-serif;\n            border-radius: 8px;\n        }\n\n        .toastify-center {\n            margin-left: auto;\n            margin-right: auto;\n            left: 0;\n            right: 0;\n            max-width: fit-content;\n            max-width: -moz-fit-content;\n        }\n",document.head.insertBefore(t,document.head.querySelector("style,link[rel=stylesheet]"))}();const i={text:t,duration:3e3,gravity:"bottom",position:"right",stopOnFocus:!0,...s};let o;n instanceof Element&&n!==document.body?(o=n.id,o||(n.id=o="_croquetToastParent")):"string"==typeof n&&(o=n);o&&(i.selector=o);return e(i).showToast()}(t,{style:{background:`linear-gradient(90deg,${i})`},...s})},showMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("once"===t.only){if(Ke.has(e))return null;Ke.add(e)}return"fatal"===t.level&&(t.level="error",t.showSyncWait="fatal"),t.showSyncWait&&("fatal"!==t.showSyncWait||t.duration||(t.duration=-1),ze.showSyncWait(t.showSyncWait)),u.nomessages||!1===ze.root||!1===ze.messages||!ze.messageFunction?("warning"===t.level&&console.warn(e),"error"===t.level&&console.error(e),null):ze.messageFunction(e,t)},isCroquetHost:e=>e.endsWith("croquet.io")||["localhost","127.0.0.1","[::1]"].includes(e)||e.endsWith("ngrok.io"),referrerURL(){const e=new URL(ze.sessionURL),t=this.isCroquetHost(e.hostname);return`${e.protocol}//${e.host}${e.pathname}${t?e.search:""}`},autoSession(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{key:"q",force:!1,default:"",keyless:!1};"string"==typeof e&&(e={key:e}),e||(e={});const t=e.key||"q",s=new URL(ze.sessionURL);let n="";if(!e.force){const i=s.search.slice(1).split("&"),o=i.find((e=>e.split("=")[0]===t));o?n=o.replace(/[^=]*=/,""):e.keyless&&(n=i.find((e=>!e.includes("="))),n||(n=s.hash.slice(1),n&&(s.hash="",s.search?s.searchParams.set(t,n):s.search=n)))}if(n)try{n=decodeURIComponent(n)}catch(e){}else n=e.default?e.default:this.randomSession(),s.searchParams.set(t,n);if(ze.sessionURL=s.href,window.location.href!==s.href)try{window.history.replaceState({},"",s.href)}catch(e){ze.showMessage(`Setting address bar to ${s.href}`,{only:"once"}),ze.showMessage(`Failed to change address bar: ${e.message}`,{level:"warning",only:"once"})}u.has("debug","session")&&console.log(`${ze.libName}.App.autoSession: "${n}"`);const i=Promise.resolve(n);return i[Symbol.toPrimitive]=()=>(console.warn(`Deprecated: ${ze.libName}.App.autoSession() return value used directly. It returns a promise now!`),n),i},autoPassword(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{key:"pw",default:"",force:!1,scrub:!1,keyless:!1};"string"==typeof e&&(e={key:e});const t=e.key||"pw",s=e.scrub&&!u.has("debug","password"),n=e.keyless,i=new URL(ze.sessionURL);let o="";const r=e.force?"":i.hash.slice(1);if(r){const e=r.split("&"),a=e.find((e=>e.split("=")[0]===t));a?(o=a.replace(/[^=]*=/,""),o&&s&&(i.hash=e.filter((e=>e.split("=")[0]!==t)).join("&"))):n&&(o=e.find((e=>!e.includes("="))),o&&s&&(i.hash=e.filter((e=>e!==o)).join("&")))}if(o||(o=e.default?e.default:this.randomPassword(),i.hash=r?`${r}&${t}=${o}`:n?o:`${t}=${o}`,ze.sessionURL=i.href,s&&(i.hash=n?"":r)),u.has("debug","session")&&console.log(`${ze.libName}.App.sessionUrl: ${ze.sessionURL}`),window.location.href!==i.href)try{window.history.replaceState({},"",i.href)}catch(e){ze.showMessage(`Setting address bar to ${i.href}`,{only:"once"}),ze.showMessage(`Failed to change address bar: ${e.message}`,{level:"warning",only:"once"})}if(o)try{o=decodeURIComponent(o)}catch(e){}u.has("debug","session")&&console.log(`${ze.libName}.App.autoPassword: "${o}"`);const a=Promise.resolve(o);return a[Symbol.toPrimitive]=()=>(console.warn(`Deprecated: ${ze.libName}.App.autoPassword() return value used directly. It returns a promise now!`),o),a},randomSession(){return He(arguments.length>0&&void 0!==arguments[0]?arguments[0]:10)},randomPassword(){return He(arguments.length>0&&void 0!==arguments[0]?arguments[0]:16)}},_e="#__vote";function Fe(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="none";for(const i of["immediate","queued","oncePerFrame","oncePerFrameWhileSynced"])for(const o of e[i])o.for===t?null===s||o.unbound===s?e[i].delete(o):n="subscriber":"none"===n&&(n="others");return n}const Ee=globalThis.CROQUETVD=new class{constructor(){this.subscriptions={},this.subscribers=new Map,this.genericSubscriptions=!1,this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.subscriberIds=0,this.currentEvent=void 0,this.currentEventFromModel=!1}register(e){return"V"+ ++this.subscriberIds}deregister(e){}addSubscription(e,t,s,n,i){if(e.includes(":"))throw Error(`Invalid subscription scope "${e}" (must not contain ':')`);if("vote"===i)return void this.addSubscription(e,t+_e,s,n,"immediate");"*"!==e&&"*"!==t||(this.genericSubscriptions=!0);const o=e+":"+t,r=n;r.for=s;let a=this.subscriptions[o];if(a||(a=this.subscriptions[o]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!a[i])throw Error(`Unknown subscribe() option: handling="${i}"`);a[i].add(r);let l=this.subscribers.get(s);l||this.subscribers.set(s,l=new Set),l.add(o)}removeSubscription(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=e+":"+t,o=this.subscriptions[i];if(o){const e=Fe(o,s,n);if("none"===e&&delete this.subscriptions[i],"subscriber"!==e){const e=this.subscribers.get(s);e&&(e.delete(i),0===e.size&&this.subscribers.delete(s))}}t.endsWith(_e)||this.removeSubscription(e,t+_e,s)}removeAllSubscriptionsFor(e){const t=this.subscribers.get(e);if(t){for(const s of t){const t=this.subscriptions[s];if(t){"none"===Fe(t,e)&&delete this.subscriptions[s]}else console.error(`${ze.libName}: topic ${s} not found in subscriptions table for ${e} during removeAllSubscriptionsFor()`)}this.subscribers.delete(e)}}subscriptionsFor(e){const t=this.subscriptions[e];if(!t&&!this.genericSubscriptions)return null;const s=[];let n=!!t;if(this.genericSubscriptions){const[t,i]=e.split(":");if(!(t.startsWith("__")&&t.endsWith("__")||i.startsWith("__")&&i.endsWith("__")))for(const e of["*:*",t+":*","*:"+i]){const t=this.subscriptions[e];t&&(s.push([t,e]),!n&&this.hasUserSubcription(t)&&(n=!0))}const o=!n;if(o)for(const e of s)e.push(o)}return t&&s.push([t,e]),0===s.length?null:s}hasUserSubcription(e){for(const t of["immediate","queued","oncePerFrame","oncePerFrameWhileSynced"])for(const s of e[t])if(!s.unbound.__CROQUET__)return!0;return!1}handleEvent(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=this.subscriptionsFor(e);if(!n)return;const i=!!s;let o=0,r=0,a=0;for(const[l,c,d]of n)o+=l.queued.size,r+=l.oncePerFrame.size,a+=l.oncePerFrameWhileSynced.size,l.immediate.size>0&&(s||(s=e=>e()),s((()=>{for(const s of l.immediate){const n=this.currentEvent,o=this.currentEventFromModel,r=this.currentEventOnlyGeneric;this.currentEvent=e,this.currentEventFromModel=i,this.currentEventOnlyGeneric=d;try{s(t)}catch(e){console.error(e),console.warn(`${ze.libName}: error "${e.message}" in "immediate" subscription ${c}`)}this.currentEvent=n,this.currentEventFromModel=o,this.currentEventOnlyGeneric=r}})));o>0&&this.queuedEvents.push({topic:e,data:t,fromModel:i}),r>0&&this.perFrameEvents.set(e,{data:t,fromModel:i}),a>0&&this.perSyncedFrameEvents.set(e,{data:t,fromModel:i})}processFrameEvents(e,t){let s=0;const n=(e,t,n,i)=>{const o=this.subscriptionsFor(t);if(!o)return;const r=this.currentEvent,a=this.currentEventFromModel;this.currentEvent=t,this.currentEventFromModel=i;for(const[i,r,a]of o){const o=this.currentEventOnlyGeneric;this.currentEventOnlyGeneric=a;for(const o of i[e]){try{o(n)}catch(s){console.error(s),console.warn(`${ze.libName}: error "${s.message}" in "${e}" subscription ${t}`)}s++}this.currentEventOnlyGeneric=o}this.currentEvent=r,this.currentEventFromModel=a};for(const{topic:e,data:t,fromModel:s}of this.queuedEvents)n("queued",e,t,s);if(this.queuedEvents.length=0,e){for(const[e,{data:t,fromModel:s}]of this.perFrameEvents)n("oncePerFrame",e,t,s);if(this.perFrameEvents.clear(),t){for(const[e,{data:t,fromModel:s}]of this.perSyncedFrameEvents)n("oncePerFrameWhileSynced",e,t,s);this.perSyncedFrameEvents.clear()}for(const{topic:e,data:t,fromModel:s}of this.queuedEvents)n("queued",e,t,s);this.queuedEvents.length=0}return s}};let Je={get subscribe(){return Je={subscribe:u.has("debug","subscribe",!1)},Je.subscribe}};class je{constructor(e){this.vm=e}register(e){return this.vm.registerModel(e)}deregister(e){this.vm.deregisterModel(e.id)}publish(e,t,s){this.vm.publishFromModel(s,e,t)}subscribe(e,t,s,n){return Je.subscribe&&console.log(`Model.subscribe("${t}:${s}", ${e} ${(""+n).replace(/\([\s\S]*/,"")})`),this.vm.addSubscription(e,t,s,n)}unsubscribe(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"*";Je.subscribe&&console.log(`Model.unsubscribe(${t}:${s}", ${e} ${(""+n).replace(/\([\s\S]*/,"")})`),this.vm.removeSubscription(e,t,s,n)}unsubscribeAll(e){Je.subscribe&&console.log(`Model.unsubscribeAll(${e} ${e.id})`),this.vm.removeAllSubscriptionsFor(e)}future(e,t,s,n){if(Ue&&Ue.equal(this))return this.vm.future(e,t,s,n);throw Error(`Model.future() called from outside: ${e}`)}cancelFuture(e,t){if(Ue&&Ue.equal(this))return this.vm.cancelFuture(e,t);throw Error(`Model.cancelFuture() called from outside: ${e}`)}random(){return this.vm.random()}now(){return this.vm.time}equal(e){return e instanceof je&&e.vm===this.vm}isViewRealm(){return!1}}class Qe{constructor(e){this.vd=Ee,this.vm=e,this.controller=e.controller}valid(){return this.vm===this.controller.vm}register(e){return Ee.register(e)}deregister(e){Ee.deregister(e)}publish(e,t,s){this.vm.publishFromView(s,e,t)}subscribe(e,t,s,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"queued";Je.subscribe&&console.log(`View[${t}].subscribe("${n}:${e}" ${s?s.name||(""+s).replace(/\([\s\S]*/,""):""+s} [${i}])`),Ee.addSubscription(n,e,t,s,i)}unsubscribe(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0;Je.subscribe&&console.log(`View[${t}].unsubscribe("${n}:${e}" ${s?s.name||(""+s).replace(/\([\s\S]*/,""):"*"})`),Ee.removeSubscription(n,e,t,s)}unsubscribeAll(e){Je.subscribe&&console.log(`View[${e}].unsubscribeAll()`),Ee.removeAllSubscriptionsFor(e)}future(e,t){const s=this.vm;return new Proxy(e,{get(n,i){if("function"==typeof e[i]){return new Proxy(e[i],{apply(n,o,r){setTimeout((()=>{e.id&&Be(s,(()=>e[i](...r)),!0)}),t)}})}throw Error("Tried to call "+i+"() on future of "+Object.getPrototypeOf(e).constructor.name+" which is not a function")}})}random(){return Math.random()}now(){return this.vm.time}externalNow(){return this.controller.reflectorTime}extrapolatedNow(){return this.controller.extrapolatedTime}isSynced(){return!!this.controller.synced}equal(e){return e instanceof Qe&&e.vm===this.vm}isViewRealm(){return!0}}let Ue=null;function De(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Tried to execute code that requires realm outside of realm.";if(!Ue&&e)throw Error(e);return Ue}function Oe(e,t){if(null!==Ue)throw Error("Can't switch realms from inside realm");try{return Ue=new je(e),t()}finally{Ue=null}}function Be(e,t){if(null!==Ue&&!(arguments.length>2&&void 0!==arguments[2]&&arguments[2]))throw Error("Can't switch realms from inside realm");const s=Ue;try{return Ue=new Qe(e),t()}finally{Ue=s}}var Ae=function(e){return e!=e},$e=Math.sqrt,qe=.7853981633974483;var et=function(e){var t,s;return 0===e?.16666666666666713:((e<0?-e:e)<=1?(t=e*(19.562619833175948+e*(e*(5.444622390564711+e*(.004253011369004428*e-.6019598008014124))-16.262479672107002))-8.198089802484825,s=e*(139.51056146574857+e*(e*(70.49610280856842+e*(1*e-14.740913729888538))-147.1791292232726))-49.18853881490881):(t=.004253011369004428+(e=1/e)*(e*(5.444622390564711+e*(e*(19.562619833175948+-8.198089802484825*e)-16.262479672107002))-.6019598008014124),s=1+e*(e*(70.49610280856842+e*(e*(139.51056146574857+-49.18853881490881*e)-147.1791292232726))-14.740913729888538)),t/s)};var tt=function(e){var t,s;return 0===e?.08333333333333809:((e<0?-e:e)<=1?(t=28.536655482610616+e*(e*(6.968710824104713+e*(.002967721961301243*e-.5634242780008963))-25.56901049652825),s=342.43986579130785+e*(e*(147.0656354026815+e*(1*e-21.947795316429207))-383.8770957603691)):(t=.002967721961301243+(e=1/e)*(e*(6.968710824104713+e*(28.536655482610616*e-25.56901049652825))-.5634242780008963),s=1+e*(e*(147.0656354026815+e*(342.43986579130785*e-383.8770957603691))-21.947795316429207)),t/s)};var st=function(e){var t,s,n,i,o;if(Ae(e))return NaN;if(e>0?n=e:(t=!0,n=-e),n>1)return NaN;if(n>.625)i=(s=1-n)*tt(s),s=$e(s+s),o=qe-s,o-=s=s*i-6123233995736766e-32,o+=qe;else{if(n<1e-8)return e;o=n*(o=(s=n*n)*et(s))+n}return t?-o:o};var nt=function(e){var t;return Ae(e)||e<-1||e>1?NaN:e>.5?2*st($e(.5-.5*e)):(t=qe-st(e),t+=6123233995736766e-32,t+=qe)};var it=function(){return"function"==typeof Symbol&&"symbol"==typeof Symbol("foo")}();var ot=function(){return it&&"symbol"==typeof Symbol.toStringTag},rt=Object.prototype.toString;var at=function(e){return rt.call(e)},lt=Object.prototype.hasOwnProperty;var ct=function(e,t){return null!=e&&lt.call(e,t)},dt="function"==typeof Symbol?Symbol.toStringTag:"";var ht=function(e){var t,s,n;if(null==e)return rt.call(e);s=e[dt],t=ct(e,dt);try{e[dt]=void 0}catch(t){return rt.call(e)}return n=rt.call(e),t?e[dt]=s:delete e[dt],n},ut=ot()?ht:at,mt="function"==typeof Uint32Array;var pt=function(e){return mt&&e instanceof Uint32Array||"[object Uint32Array]"===ut(e)},ft=4294967295,bt="function"==typeof Uint32Array?Uint32Array:null;var yt=function(){var e,t;if("function"!=typeof bt)return!1;try{t=new bt(t=[1,3.14,-3.14,ft+1,ft+2]),e=pt(t)&&1===t[0]&&3===t[1]&&t[2]===ft-2&&0===t[3]&&1===t[4]}catch(t){e=!1}return e},gt="function"==typeof Uint32Array?Uint32Array:null;var wt=function(){throw new Error("not implemented")},Zt=yt()?gt:wt,vt="function"==typeof Float64Array;var Xt=function(e){return vt&&e instanceof Float64Array||"[object Float64Array]"===ut(e)},xt="function"==typeof Float64Array?Float64Array:null;var Lt=function(){var e,t;if("function"!=typeof xt)return!1;try{t=new xt([1,3.14,-3.14,NaN]),e=Xt(t)&&1===t[0]&&3.14===t[1]&&-3.14===t[2]&&t[3]!=t[3]}catch(t){e=!1}return e},St="function"==typeof Float64Array?Float64Array:null;var Gt=function(){throw new Error("not implemented")},Wt=Lt()?St:Gt,Tt="function"==typeof Uint8Array;var Ct=function(e){return Tt&&e instanceof Uint8Array||"[object Uint8Array]"===ut(e)},kt="function"==typeof Uint8Array?Uint8Array:null;var Pt=function(){var e,t;if("function"!=typeof kt)return!1;try{t=new kt(t=[1,3.14,-3.14,256,257]),e=Ct(t)&&1===t[0]&&3===t[1]&&253===t[2]&&0===t[3]&&1===t[4]}catch(t){e=!1}return e},Rt="function"==typeof Uint8Array?Uint8Array:null;var It=function(){throw new Error("not implemented")},Mt=Pt()?Rt:It,Vt="function"==typeof Uint16Array;var Yt=function(e){return Vt&&e instanceof Uint16Array||"[object Uint16Array]"===ut(e)},Ht="function"==typeof Uint16Array?Uint16Array:null;var Kt=function(){var e,t;if("function"!=typeof Ht)return!1;try{t=new Ht(t=[1,3.14,-3.14,65536,65537]),e=Yt(t)&&1===t[0]&&3===t[1]&&65533===t[2]&&0===t[3]&&1===t[4]}catch(t){e=!1}return e},Nt="function"==typeof Uint16Array?Uint16Array:null;var zt,_t=function(){throw new Error("not implemented")},Ft={uint16:Kt()?Nt:_t,uint8:Mt};(zt=new Ft.uint16(1))[0]=4660;var Et=52===new Ft.uint8(zt.buffer)[0],Jt=!0===Et?1:0,jt=new Wt(1),Qt=new Zt(jt.buffer);var Ut=function(e){return jt[0]=e,Qt[Jt]},Dt=!0===Et?1:0,Ot=new Wt(1),Bt=new Zt(Ot.buffer);var At=function(e,t){return Ot[0]=e,Bt[Dt]=t>>>0,Ot[0]},$t=At,qt=Number.POSITIVE_INFINITY,es=Number.NEGATIVE_INFINITY,ts=1023;var ss=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.3999999999940942+e*(.2857142874366239+e*(.22222198432149784+e*(.1818357216161805+e*(.15313837699209373+.14798198605116586*e)))))},ns=.6931471803691238,is=1.9082149292705877e-10;var os=function(e){var t,s,n,i,o,r,a,l,c,d;if(e<-1||Ae(e))return NaN;if(-1===e)return es;if(e===qt)return e;if(0===e)return e;if(d=1,(n=e<0?-e:e)<.41421356237309503){if(n<1.862645149230957e-9)return n<5551115123125783e-32?e:e-e*e*.5;e>-.2928932188134525&&(d=0,i=e,s=1)}return 0!==d&&(n<9007199254740992?(o=(d=((s=Ut(c=1+e))>>20)-ts)>0?1-(c-e):e-(c-1),o/=c):(d=((s=Ut(c=e))>>20)-ts,o=0),(s&=1048575)<434334?c=$t(c,1072693248|s):(d+=1,c=$t(c,1071644672|s),s=1048576-s>>2),i=c-1),t=.5*i*i,0===s?0===i?d*ns+(o+=d*is):d*ns-((l=t*(1-.6666666666666666*i))-(d*is+o)-i):(l=(a=(r=i/(2+i))*r)*ss(a),0===d?i-(t-r*(t+l)):d*ns-(t-(r*(t+l)+(d*is+o))-i))},rs=.6931471805599453;var as=function(e){return 0===e?.3999999999940942:.3999999999940942+e*(.22222198432149784+.15313837699209373*e)};var ls=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.2857142874366239+e*(.1818357216161805+.14798198605116586*e))},cs=.6931471803691238,ds=1.9082149292705877e-10,hs=1048575;var us=function(e){var t,s,n,i,o,r,a,l,c,d,h;return 0===e?es:Ae(e)||e<0?NaN:(i=0,(s=Ut(e))<1048576&&(i-=54,s=Ut(e*=0x40000000000000)),s>=2146435072?e+e:(i+=(s>>20)-ts|0,i+=(a=(s&=hs)+614244&1048576)>>20,r=(e=$t(e,s|1072693248^a))-1,(hs&2+s)<3?0===r?0===i?0:i*cs+i*ds:(o=r*r*(.5-.3333333333333333*r),0===i?r-o:i*cs-(o-i*ds-r)):(a=s-398458|0,l=440401-s|0,n=(d=(h=(c=r/(2+r))*c)*h)*as(d),o=h*ls(d)+n,(a|=l)>0?(t=.5*r*r,0===i?r-(t-c*(t+o)):i*cs-(t-(c*(t+o)+i*ds)-r)):0===i?r-c*(r-o):i*cs-(c*(r-o)-i*ds-r))))};var ms=function(e){var t;return Ae(e)||e<1?NaN:1===e?0:e>=268435456?us(e)+rs:e>2?us(2*e-1/(e+$e(e*e-1))):os((t=e-1)+$e(2*t+t*t))};var ps=function(e){return e===qt||e===es},fs=1/(1<<28);var bs=function(e){var t,s,n;return Ae(e)||ps(e)?e:(e<0&&(e=-e,t=!0),n=e<fs?e:e>268435456?us(e)+rs:e>2?us(2*e+1/($e(e*e+1)+e)):os(e+(s=e*e)/(1+$e(1+s))),t?-n:n)},ys=1.5707963267948966;var gs=function(e){return 0===e?-64.85021904942025:e*(e*(e*(-.8750608600031904*e-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025};var ws=function(e){return 0===e?194.5506571482614:194.5506571482614+e*(485.3903996359137+e*(432.88106049129027+e*(165.02700983169885+e*(24.858464901423062+1*e))))},Zs=6123233995736766e-32;var vs=function(e){var t,s,n,i;return Ae(e)||0===e?e:e===qt?ys:e===es?-1.5707963267948966:(e<0&&(s=!0,e=-e),t=0,e>2.414213562373095?(n=ys,t=1,e=-1/e):e<=.66?n=0:(n=qe,t=2,e=(e-1)/(e+1)),i=e*(i=(i=e*e)*gs(i)/ws(i))+e,2===t?i+=.5*Zs:1===t&&(i+=Zs),n+=i,s?-n:n)},Xs=1/(1<<28);var xs,Ls,Ss=function(e){var t,s;return Ae(e)||e<-1||e>1?NaN:1===e?qt:-1===e?es:(e<0&&(t=!0,e=-e),e<Xs?t?-e:e:(s=e<.5?.5*os((s=e+e)+s*e/(1-e)):.5*os((e+e)/(1-e)),t?-s:s))};!0===Et?(xs=1,Ls=0):(xs=0,Ls=1);var Gs={HIGH:xs,LOW:Ls},Ws=new Wt(1),Ts=new Zt(Ws.buffer),Cs=Gs.HIGH,ks=Gs.LOW;var Ps=function(e,t){return Ws[0]=t,e[0]=Ts[Cs],e[1]=Ts[ks],e};var Rs,Is,Ms=function(e,t){return 1===arguments.length?Ps([0,0],e):Ps(e,t)};!0===Et?(Rs=1,Is=0):(Rs=0,Is=1);var Vs={HIGH:Rs,LOW:Is},Ys=new Wt(1),Hs=new Zt(Ys.buffer),Ks=Vs.HIGH,Ns=Vs.LOW;var zs=function(e,t){return Hs[Ks]=e,Hs[Ns]=t,Ys[0]},_s=zs,Fs=[0,0];var Es=function(e,t){var s,n;return Ms(Fs,e),s=Fs[0],s&=2147483647,n=Ut(t),_s(s|=n&=2147483648,Fs[1])};var Js=function(e){return!!(Ut(e)>>>31)},js=3.141592653589793;var Qs=function(e,t){var s;return Ae(t)||Ae(e)?NaN:ps(t)?t===qt?ps(e)?Es(js/4,e):Es(0,e):ps(e)?Es(3*js/4,e):Es(js,e):ps(e)?Es(js/2,e):0===e?t>=0&&!Js(t)?Es(0,e):Es(js,e):0===t?Es(js/2,e):(s=vs(e/t),t<0?s<=0?s+js:s-js:s)},Us=22250738585072014e-324;var Ds=function(e){return 0===e?1.87595182427177:1.87595182427177+e*(e*(1.6214297201053545+e*(.14599619288661245*e-.758397934778766))-1.8849797954337717)},Os=2147483647;var Bs=function(e){var t,s,n,i,o;return Ae(e)||ps(e)||0===e?e:(s=-2147483648&(n=Ut(e)),n&=Os,o=0,e<Us?(o=0x40000000000000,t=Ut(o*=e),o=_s(s|(t=(t&Os)/3+696219795),0)):o=$t(o,s|(t=n/3+715094163)),o*=Ds(i=o*o*(o/e)),t=Ut(o),o=_s(t+1,0),o+=o*(i=((i=e/(o*o))-o)/(o+o+i)))},As=Bs;var $s=function(e){return 0===e?.0416666666666666:.0416666666666666+e*(2480158728947673e-20*e-.001388888888887411)};var qs=function(e){return 0===e?-2.7557314351390663e-7:e*(2.087572321298175e-9+-11359647557788195e-27*e)-2.7557314351390663e-7};var en=function(e,t){var s,n,i,o;return i=(o=e*e)*o,n=o*$s(o),n+=i*i*qs(o),(i=1-(s=.5*o))+(1-i-s+(o*n-e*t))},tn=-.16666666666666632;var sn=function(e,t){var s,n,i;return s=.00833333333332249+(i=e*e)*(27557313707070068e-22*i-.0001984126982985795)+i*(i*i)*(1.58969099521155e-10*i-2.5050760253406863e-8),n=i*e,0===t?e+n*(tn+i*s):e-(i*(.5*t-n*s)-t-n*tn)},nn=!0===Et?0:1,on=new Wt(1),rn=new Zt(on.buffer);var an=function(e){return on[0]=e,rn[nn]},ln=Math.floor;var cn=function(e){return e<0?-e:0===e?0:e};var dn=function(e,t){return Ae(t)||ps(t)?(e[0]=t,e[1]=0,e):0!==t&&cn(t)<Us?(e[0]=4503599627370496*t,e[1]=-52,e):(e[0]=t,e[1]=0,e)};var hn=function(e,t){return 1===arguments.length?dn([0,0],e):dn(e,t)};var un=function(e){var t=Ut(e);return(t=(2146435072&t)>>>20)-ts|0},mn=un,pn=[0,0],fn=[0,0];var bn=function(e,t){var s,n;return 0===e||Ae(e)||ps(e)?e:(hn(pn,e),t+=pn[1],(t+=mn(e=pn[0]))<-1074?Es(0,e):t>1023?e<0?es:qt:(t<=-1023?(t+=52,n=2220446049250313e-31):n=1,Ms(fn,e),s=fn[0],s&=2148532223,n*_s(s|=t+ts<<20,fn[1])))},yn=bn,gn=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],wn=[1.570796251296997,7.549789415861596e-8,5390302529957765e-30,3282003415807913e-37,1270655753080676e-44,12293330898111133e-52,27337005381646456e-60,21674168387780482e-67],Zn=16777216,vn=5.960464477539063e-8,Xn=Gn(new Array(20)),xn=Gn(new Array(20)),Ln=Gn(new Array(20)),Sn=Gn(new Array(20));function Gn(e){var t,s=e.length;for(t=0;t<s;t++)e[t]=0;return e}function Wn(e,t,s,n,i,o,r,a,l){var c,d,h,u,m,p,f,b,y;for(u=o,y=n[s],b=s,m=0;b>0;m++)d=vn*y|0,Sn[m]=y-Zn*d|0,y=n[b-1]+d,b-=1;if(y=yn(y,i),y-=8*ln(.125*y),y-=f=0|y,h=0,i>0?(f+=m=Sn[s-1]>>24-i,Sn[s-1]-=m<<24-i,h=Sn[s-1]>>23-i):0===i?h=Sn[s-1]>>23:y>=.5&&(h=2),h>0){for(f+=1,c=0,m=0;m<s;m++)b=Sn[m],0===c?0!==b&&(c=1,Sn[m]=16777216-b):Sn[m]=16777215-b;if(i>0)switch(i){case 1:Sn[s-1]&=8388607;break;case 2:Sn[s-1]&=4194303}2===h&&(y=1-y,0!==c&&(y-=yn(1,i)))}if(0===y){for(b=0,m=s-1;m>=o;m--)b|=Sn[m];if(0===b){for(p=1;0===Sn[o-p];p++);for(m=s+1;m<=s+p;m++){for(l[a+m]=gn[r+m],d=0,b=0;b<=a;b++)d+=e[b]*l[a+(m-b)];n[m]=d}return Wn(e,t,s+=p,n,i,o,r,a,l)}}if(0===y)for(s-=1,i-=24;0===Sn[s];)s-=1,i-=24;else(y=yn(y,-i))>=Zn?(d=vn*y|0,Sn[s]=y-Zn*d|0,i+=24,Sn[s+=1]=d):Sn[s]=0|y;for(d=yn(1,i),m=s;m>=0;m--)n[m]=d*Sn[m],d*=vn;for(m=s;m>=0;m--){for(d=0,p=0;p<=u&&p<=s-m;p++)d+=wn[p]*n[m+p];Ln[s-m]=d}for(d=0,m=s;m>=0;m--)d+=Ln[m];for(t[0]=0===h?d:-d,d=Ln[0]-d,m=1;m<=s;m++)d+=Ln[m];return t[1]=0===h?d:-d,7&f}var Tn=function(e,t,s,n){var i,o,r,a,l,c,d;for((o=(s-3)/24|0)<0&&(o=0),a=s-24*(o+1),c=o-(r=n-1),d=r+4,l=0;l<=d;l++)Xn[l]=c<0?0:gn[c],c+=1;for(l=0;l<=4;l++){for(i=0,c=0;c<=r;c++)i+=e[c]*Xn[r+(l-c)];xn[l]=i}return Wn(e,t,4,xn,a,4,o,r,Xn)},Cn=Math.round;var kn=function(e,t,s){var n,i,o,r,a;return o=e-1.5707963267341256*(n=Cn(.6366197723675814*e)),r=6077100506506192e-26*n,a=t>>20,s[0]=o-r,a-(Ut(s[0])>>20&2047)>16&&(r=20222662487959506e-37*n-((i=o)-(o=i-(r=6077100506303966e-26*n))-r),s[0]=o-r,a-(Ut(s[0])>>20&2047)>49&&(r=84784276603689e-45*n-((i=o)-(o=i-(r=20222662487111665e-37*n))-r),s[0]=o-r)),s[1]=o-s[0]-r,n},Pn=1.5707963267341256,Rn=6077100506506192e-26,In=2*Rn,Mn=3*Rn,Vn=4*Rn,Yn=new Array(3),Hn=new Array(2);var Kn=function(e,t){var s,n,i,o,r,a,l;if((i=2147483647&Ut(e))<=1072243195)return t[0]=e,t[1]=0,0;if(i<=1074752122)return 598523==(1048575&i)?kn(e,i,t):i<=1073928572?e>0?(l=e-Pn,t[0]=l-Rn,t[1]=l-t[0]-Rn,1):(l=e+Pn,t[0]=l+Rn,t[1]=l-t[0]+Rn,-1):e>0?(l=e-2*Pn,t[0]=l-In,t[1]=l-t[0]-In,2):(l=e+2*Pn,t[0]=l+In,t[1]=l-t[0]+In,-2);if(i<=1075594811)return i<=1075183036?1074977148===i?kn(e,i,t):e>0?(l=e-3*Pn,t[0]=l-Mn,t[1]=l-t[0]-Mn,3):(l=e+3*Pn,t[0]=l+Mn,t[1]=l-t[0]+Mn,-3):1075388923===i?kn(e,i,t):e>0?(l=e-4*Pn,t[0]=l-Vn,t[1]=l-t[0]-Vn,4):(l=e+4*Pn,t[0]=l+Vn,t[1]=l-t[0]+Vn,-4);if(i<1094263291)return kn(e,i,t);if(i>=2146435072)return t[0]=NaN,t[1]=NaN,0;for(s=an(e),l=_s(i-((n=(i>>20)-1046)<<20),s),r=0;r<2;r++)Yn[r]=0|l,l=16777216*(l-Yn[r]);for(Yn[2]=l,o=3;0===Yn[o-1];)o-=1;return a=Tn(Yn,Hn,n,o),e<0?(t[0]=-Hn[0],t[1]=-Hn[1],-a):(t[0]=Hn[0],t[1]=Hn[1],a)},Nn=Kn,zn=[0,0];var _n=function(e){var t;if(t=Ut(e),(t&=2147483647)<=1072243195)return t<1044381696?1:en(e,0);if(t>=2146435072)return NaN;switch(3&Nn(e,zn)){case 0:return en(zn[0],zn[1]);case 1:return-sn(zn[0],zn[1]);case 2:return-en(zn[0],zn[1]);default:return sn(zn[0],zn[1])}},Fn=Math.ceil;var En=function(e){return e<0?Fn(e):ln(e)};var Jn=function(e){return 0===e?.16666666666666602:.16666666666666602+e*(e*(6613756321437934e-20+e*(4.1381367970572385e-8*e-16533902205465252e-22))-.0027777777777015593)};var jn=function(e,t,s){var n,i,o;return o=(n=e-t)-(i=n*n)*Jn(i),yn(1-(t-n*o/(2-o)-e),s)},Qn=1.4426950408889634,Un=1/(1<<28);var Dn=function(e){var t;return Ae(e)||e===qt?e:e===es?0:e>709.782712893384?qt:e<-745.1332191019411?0:e>-3.725290298461914e-9&&e<Un?1+e:(t=En(e<0?Qn*e-.5:Qn*e+.5),jn(e-.6931471803691238*t,1.9082149292705877e-10*t,t))};var On=function(e){return Ae(e)?e:(e<0&&(e=-e),e>21?Dn(e)/2:(Dn(e)+Dn(-e))/2)};var Bn=function(e){return 0===e?-.03333333333333313:e*(.0015873015872548146+e*(e*(4008217827329362e-21+-2.0109921818362437e-7*e)-793650757867488e-19))-.03333333333333313},An=.6931471803691238,$n=1.9082149292705877e-10,qn=1.4426950408889634;var ei=function(e){var t,s,n,i,o,r,a,l,c,d,h,u;if(e===qt||Ae(e))return e;if(e===es)return-1;if(0===e)return e;if(e<0?(s=!0,a=-e):(s=!1,a=e),a>=38.816242111356935){if(s)return-1;if(a>=709.782712893384)return qt}if(o=0|Ut(a),a>.34657359027997264)a<1.0397207708399179?s?(n=e+An,i=-1.9082149292705877e-10,u=-1):(n=e-An,i=$n,u=1):(u=s?qn*e-.5:qn*e+.5,n=e-(d=u|=0)*An,i=d*$n),c=n-(e=n-i)-i;else{if(o<1016070144)return e;u=0}return h=(l=e*(t=.5*e))*(((r=1+l*Bn(l))-(d=3-r*t))/(6-e*d)),0===u?e-(e*h-l):(h=e*(h-c)-c,h-=l,-1===u?.5*(e-h)-.5:1===u?e<-.25?-2*(h-(e+.5)):1+2*(e-h):u<=-2||u>56?(n=Ut(a=1-(h-e))+(u<<20)|0,(a=$t(a,n))-1):(d=1,u<20?a=(d=$t(d,n=1072693248-(2097152>>u)|0))-(h-e):(a=e-(h+(d=$t(d,n=ts-u<<20))),a+=1),n=Ut(a)+(u<<20)|0,$t(a,n)))},ti=!0===Et?0:1,si=new Wt(1),ni=new Zt(si.buffer);var ii=function(e,t){return si[0]=e,ni[ti]=t>>>0,si[0]},oi=ii;var ri=function(e){return 0===e?.3999999999940942:.3999999999940942+e*(.22222198432149784+.15313837699209373*e)};var ai=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.2857142874366239+e*(.1818357216161805+.14798198605116586*e))},li=1048575;var ci=function(e){var t,s,n,i,o,r,a,l,c,d;return n=Ut(e),i=e-1,(li&2+n)<3?0===i?0:i*i*(.3333333333333333*i-.5):(c=(n&=li)-398458|0,d=440401-n|0,s=(l=(r=(o=i/(2+i))*o)*r)*ri(l),a=r*ai(l)+s,(c|=d)>0?o*((t=.5*i*i)+a)-t:o*(a-i))},di=.4342944818781689;var hi=function(e){var t,s,n,i,o,r,a;return Ae(e)||e<0?NaN:0===e?es:(o=0,(s=Ut(e))<1048576&&(o-=54,s=Ut(e*=0x40000000000000)),s>=2146435072?e+e:(o+=(s>>20)-ts|0,e=$t(e,(s&=1048575)|1072693248^(i=s+614244&1048576)),r=o+=i>>20,n=ci(e),a=3694239077158931e-28*r+25082946711645275e-27*((e-=1)+n),(a+=(e-(t=oi(e,0))+n)*di+t*di)+.30102999566361177*r))};var ui=function(e){return 0===e?.3999999999940942:.3999999999940942+e*(.22222198432149784+.15313837699209373*e)};var mi=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.2857142874366239+e*(.1818357216161805+.14798198605116586*e))},pi=1048575;var fi=function(e){var t,s,n,i,o,r,a,l,c,d;return n=Ut(e),i=e-1,(pi&2+n)<3?0===i?0:i*i*(.3333333333333333*i-.5):(c=(n&=pi)-398458|0,d=440401-n|0,s=(l=(r=(o=i/(2+i))*o)*r)*ui(l),a=r*mi(l)+s,(c|=d)>0?o*((t=.5*i*i)+a)-t:o*(a-i))},bi=1.4426950407214463,yi=[0,0];var gi=function(e){var t,s,n,i,o;if(Ae(e)||e<0)return NaN;if(Ms(yi,e),o=0,(s=yi[0])<1048576){if(!(2147483647&s|yi[1]))return es;o-=54,s=Ut(e*=0x40000000000000)}return s>=2146435072?e+e:(o+=(s>>20)-ts|0,e=$t(e,(s&=1048575)|1072693248^(i=s+614244&1048576)),o+=i>>20,n=fi(e),1.6751713164886512e-10*((e-=1)+n)+(e-(t=oi(e,0))+n)*bi+t*bi+o)},wi=[0,0];var Zi=function(e){var t;if(t=Ut(e),(t&=2147483647)<=1072243195)return t<1045430272?e:sn(e,0);if(t>=2146435072)return NaN;switch(3&Nn(e,wi)){case 0:return sn(wi[0],wi[1]);case 1:return en(wi[0],wi[1]);case 2:return-sn(wi[0],wi[1]);default:return-en(wi[0],wi[1])}};var vi=function(e){var t,s;return 0===e?.16666666666666666:((e<0?-e:e)<=1?(t=e*(e*(-.789474443963537*e-163.72585752598383)-11561.443576500522)-351754.9648081514,s=e*(36157.827983443196+e*(1*e-277.7110814206028))-2110529.7888489086):(t=(e=1/e)*(e*(-351754.9648081514*e-11561.443576500522)-163.72585752598383)-.789474443963537,s=1+e*(e*(36157.827983443196+-2110529.7888489086*e)-277.7110814206028)),t/s)},Xi=709.782712893384,xi=Xi+rs,Li=Xi-rs;var Si=function(e){var t;return 0===e?e:(t=cn(e),e>xi||e<-709.089565712824?e>0?qt:es:t>1?t>=Li?(t=Dn(.5*t),t*=.5*t,e<0&&(t=-t),t):(t=.5*(t=Dn(t))-.5/t,e<0&&(t=-t),t):e+e*(t*=t)*vi(t))};var Gi=function(e){return 0===e?.13333333333320124:.13333333333320124+e*(.021869488294859542+e*(.0035920791075913124+e*(.0005880412408202641+e*(7817944429395571e-20+-18558637485527546e-21*e))))};var Wi=function(e){return 0===e?.05396825397622605:.05396825397622605+e*(.0088632398235993+e*(.0014562094543252903+e*(.0002464631348184699+e*(7140724913826082e-20+2590730518636337e-20*e))))};var Ti=function(e,t,s){var n,i,o,r,a,l,c,d,h;return(i=2147483647&(n=Ut(e)))>=1072010280&&(e<0&&(e=-e,t=-t),e=(h=.7853981633974483-e)+(d=3061616997868383e-32-t),t=0),r=t+(h=e*e)*((a=h*e)*((r=Gi(d=h*h))+(c=h*Wi(d)))+t),d=e+(r+=.3333333333333341*a),i>=1072010280?(1-(n>>30&2))*((c=s)-2*(e-(d*d/(d+c)-r))):1===s?d:(oi(h=d,0),c=r-(h-e),oi(l=o=-1/d,0),l+o*((a=1+l*h)+l*c))},Ci=[0,0];var ki=function(e){var t,s;return t=Ut(e),(t&=2147483647)<=1072243195?t<1044381696?e:Ti(e,0,1):t>=2146435072?NaN:(s=Nn(e,Ci),Ti(Ci[0],Ci[1],1-((1&s)<<1)))};var Pi=function(e){var t,s;return 0===e?-.3333333333333332:((e<0?-e:e)<=1?(t=e*(e*(0*e-.9643991794250523)-99.28772310019185)-1614.6876844170845,s=4844.063053251255+e*(2235.4883906010045+e*(112.81167849163293+1*e))):(t=0+(e=1/e)*(e*(-1614.6876844170845*e-99.28772310019185)-.9643991794250523),s=1+e*(112.81167849163293+e*(2235.4883906010045+4844.063053251255*e))),t/s)};var Ri=function(e){var t,s;if((s=cn(e))>44.014845965556525)return e<0?-1:1;if(s>=.625)s=1-2/((t=Dn(2*s))+1),e<0&&(s=-s);else{if(0===e)return e;s=e+e*(t=e*e)*Pi(t)}return s};void 0===globalThis.CroquetMath&&(globalThis.CroquetMath={}),Object.assign(globalThis.CroquetMath,{acos:nt,acosh:ms,asin:st,asinh:bs,atan:vs,atanh:Ss,atan2:Qs,cbrt:As,cos:_n,cosh:On,exp:Dn,expm1:ei,log:us,log1p:os,log10:hi,log2:gi,sin:Zi,sinh:Si,tan:ki,tanh:Ri});const Ii=Math.pow;function Mi(e){return e===1/0||e===-1/0}globalThis.CroquetMath.pow=(e,t)=>{if(isNaN(e)||isNaN(t))return NaN;if(Mi(e)||Mi(t))return Ii(e,t);if(0===e||0===t)return Ii(e,t);if(e<0&&!function(e){return Number.isInteger(e)}(t))return NaN;if(1===t)return e;if(2===t)return e*e;if(3===t)return e*e*e;if(4===t)return e*e*e*e;let s=1;e<0&&(e*=-1,s=Ii(-1,t));return globalThis.CroquetMath.exp(globalThis.CroquetMath.log(e)*t)*s};class Vi extends s{poll(){const e=super.poll();return this.array[this.size]=null,e}asArray(){const e=[];return this.forEach((t=>e.push(t))),e}asUnsortedArray(){return this.array.slice(0,this.size)}}var Yi,Hi={exports:{}};function Ki(){return Yi||(Yi=1,Hi.exports=function(e){return function(){var t=e,s=t.lib.WordArray;function n(e,t,n){for(var i=[],o=0,r=0;r<t;r++)if(r%4){var a=n[e.charCodeAt(r-1)]<<r%4*2|n[e.charCodeAt(r)]>>>6-r%4*2;i[o>>>2]|=a<<24-o%4*8,o++}return s.create(i,o)}t.enc.Base64={stringify:function(e){var t=e.words,s=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<s;o+=3)for(var r=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<s;a++)i.push(n.charAt(r>>>6*(3-a)&63));var l=n.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(e){var t=e.length,s=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<s.length;o++)i[s.charCodeAt(o)]=o}var r=s.charAt(64);if(r){var a=e.indexOf(r);-1!==a&&(t=a)}return n(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64}(x())),Hi.exports}var Ni,zi=i(Ki()),_i=x(),Fi={exports:{}};var Ei,Ji=(Ni||(Ni=1,Fi.exports=function(e){return e.enc.Utf8}(x())),Fi.exports),ji=i(Ji),Qi={exports:{}},Ui={exports:{}};function Di(){return Ei||(Ei=1,Ui.exports=function(e){!function(){var t=e,s=t.lib.Base,n=t.enc.Utf8;t.algo.HMAC=s.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var s=e.blockSize,i=4*s;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),r=this._iKey=t.clone(),a=o.words,l=r.words,c=0;c<s;c++)a[c]^=1549556828,l[c]^=909522486;o.sigBytes=r.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,s=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(s))}})}()}(x())),Ui.exports}var Oi;var Bi,Ai=(Oi||(Oi=1,Qi.exports=function(e){return function(){var t=e,s=t.lib,n=s.Base,i=s.WordArray,o=t.algo,r=o.SHA256,a=o.HMAC,l=o.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:r,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var s=this.cfg,n=a.create(s.hasher,e),o=i.create(),r=i.create([1]),l=o.words,c=r.words,d=s.keySize,h=s.iterations;l.length<d;){var u=n.update(t).finalize(r);n.reset();for(var m=u.words,p=m.length,f=u,b=1;b<h;b++){f=n.finalize(f),n.reset();for(var y=f.words,g=0;g<p;g++)m[g]^=y[g]}o.concat(u),c[0]++}return o.sigBytes=4*d,o}});t.PBKDF2=function(e,t,s){return l.create(s).compute(e,t)}}(),e.PBKDF2}(x(),k(),Di())),Qi.exports),$i=i(Ai),qi={exports:{}},eo={exports:{}};function to(){return Bi||(Bi=1,eo.exports=function(e){return function(t){var s=e,n=s.lib,i=n.WordArray,o=n.Hasher,r=s.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var l=r.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var s=0;s<16;s++){var n=t+s,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,r=e[t+0],l=e[t+1],m=e[t+2],p=e[t+3],f=e[t+4],b=e[t+5],y=e[t+6],g=e[t+7],w=e[t+8],Z=e[t+9],v=e[t+10],X=e[t+11],x=e[t+12],L=e[t+13],S=e[t+14],G=e[t+15],W=o[0],T=o[1],C=o[2],k=o[3];W=c(W,T,C,k,r,7,a[0]),k=c(k,W,T,C,l,12,a[1]),C=c(C,k,W,T,m,17,a[2]),T=c(T,C,k,W,p,22,a[3]),W=c(W,T,C,k,f,7,a[4]),k=c(k,W,T,C,b,12,a[5]),C=c(C,k,W,T,y,17,a[6]),T=c(T,C,k,W,g,22,a[7]),W=c(W,T,C,k,w,7,a[8]),k=c(k,W,T,C,Z,12,a[9]),C=c(C,k,W,T,v,17,a[10]),T=c(T,C,k,W,X,22,a[11]),W=c(W,T,C,k,x,7,a[12]),k=c(k,W,T,C,L,12,a[13]),C=c(C,k,W,T,S,17,a[14]),W=d(W,T=c(T,C,k,W,G,22,a[15]),C,k,l,5,a[16]),k=d(k,W,T,C,y,9,a[17]),C=d(C,k,W,T,X,14,a[18]),T=d(T,C,k,W,r,20,a[19]),W=d(W,T,C,k,b,5,a[20]),k=d(k,W,T,C,v,9,a[21]),C=d(C,k,W,T,G,14,a[22]),T=d(T,C,k,W,f,20,a[23]),W=d(W,T,C,k,Z,5,a[24]),k=d(k,W,T,C,S,9,a[25]),C=d(C,k,W,T,p,14,a[26]),T=d(T,C,k,W,w,20,a[27]),W=d(W,T,C,k,L,5,a[28]),k=d(k,W,T,C,m,9,a[29]),C=d(C,k,W,T,g,14,a[30]),W=h(W,T=d(T,C,k,W,x,20,a[31]),C,k,b,4,a[32]),k=h(k,W,T,C,w,11,a[33]),C=h(C,k,W,T,X,16,a[34]),T=h(T,C,k,W,S,23,a[35]),W=h(W,T,C,k,l,4,a[36]),k=h(k,W,T,C,f,11,a[37]),C=h(C,k,W,T,g,16,a[38]),T=h(T,C,k,W,v,23,a[39]),W=h(W,T,C,k,L,4,a[40]),k=h(k,W,T,C,r,11,a[41]),C=h(C,k,W,T,p,16,a[42]),T=h(T,C,k,W,y,23,a[43]),W=h(W,T,C,k,Z,4,a[44]),k=h(k,W,T,C,x,11,a[45]),C=h(C,k,W,T,G,16,a[46]),W=u(W,T=h(T,C,k,W,m,23,a[47]),C,k,r,6,a[48]),k=u(k,W,T,C,g,10,a[49]),C=u(C,k,W,T,S,15,a[50]),T=u(T,C,k,W,b,21,a[51]),W=u(W,T,C,k,x,6,a[52]),k=u(k,W,T,C,p,10,a[53]),C=u(C,k,W,T,v,15,a[54]),T=u(T,C,k,W,l,21,a[55]),W=u(W,T,C,k,w,6,a[56]),k=u(k,W,T,C,G,10,a[57]),C=u(C,k,W,T,y,15,a[58]),T=u(T,C,k,W,L,21,a[59]),W=u(W,T,C,k,f,6,a[60]),k=u(k,W,T,C,X,10,a[61]),C=u(C,k,W,T,m,15,a[62]),T=u(T,C,k,W,Z,21,a[63]),o[0]=o[0]+W|0,o[1]=o[1]+T|0,o[2]=o[2]+C|0,o[3]=o[3]+k|0},_doFinalize:function(){var e=this._data,s=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;s[i>>>5]|=128<<24-i%32;var o=t.floor(n/4294967296),r=n;s[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),s[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(s.length+1),this._process();for(var a=this._hash,l=a.words,c=0;c<4;c++){var d=l[c];l[c]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return a},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,s,n,i,o,r){var a=e+(t&s|~t&n)+i+r;return(a<<o|a>>>32-o)+t}function d(e,t,s,n,i,o,r){var a=e+(t&n|s&~n)+i+r;return(a<<o|a>>>32-o)+t}function h(e,t,s,n,i,o,r){var a=e+(t^s^n)+i+r;return(a<<o|a>>>32-o)+t}function u(e,t,s,n,i,o,r){var a=e+(s^(t|~n))+i+r;return(a<<o|a>>>32-o)+t}s.MD5=o._createHelper(l),s.HmacMD5=o._createHmacHelper(l)}(Math),e.MD5}(x())),eo.exports}var so,no={exports:{}},io={exports:{}};function oo(){return so||(so=1,io.exports=function(e){return function(){var t=e,s=t.lib,n=s.WordArray,i=s.Hasher,o=t.algo,r=[],a=o.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var s=this._hash.words,n=s[0],i=s[1],o=s[2],a=s[3],l=s[4],c=0;c<80;c++){if(c<16)r[c]=0|e[t+c];else{var d=r[c-3]^r[c-8]^r[c-14]^r[c-16];r[c]=d<<1|d>>>31}var h=(n<<5|n>>>27)+l+r[c];h+=c<20?1518500249+(i&o|~i&a):c<40?1859775393+(i^o^a):c<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,l=a,a=o,o=i<<30|i>>>2,i=n,n=h}s[0]=s[0]+n|0,s[1]=s[1]+i|0,s[2]=s[2]+o|0,s[3]=s[3]+a|0,s[4]=s[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,s=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(s/4294967296),t[15+(n+64>>>9<<4)]=s,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA1=i._createHelper(a),t.HmacSHA1=i._createHmacHelper(a)}(),e.SHA1}(x())),io.exports}var ro;function ao(){return ro||(ro=1,no.exports=function(e){return function(){var t=e,s=t.lib,n=s.Base,i=s.WordArray,o=t.algo,r=o.MD5,a=o.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:r,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var s,n=this.cfg,o=n.hasher.create(),r=i.create(),a=r.words,l=n.keySize,c=n.iterations;a.length<l;){s&&o.update(s),s=o.update(e).finalize(t),o.reset();for(var d=1;d<c;d++)s=o.finalize(s),o.reset();r.concat(s)}return r.sigBytes=4*l,r}});t.EvpKDF=function(e,t,s){return a.create(s).compute(e,t)}}(),e.EvpKDF}(x(),oo(),Di())),no.exports}var lo,co={exports:{}};var ho;var uo,mo=(ho||(ho=1,qi.exports=function(e){return function(){var t=e,s=t.lib.BlockCipher,n=t.algo,i=[],o=[],r=[],a=[],l=[],c=[],d=[],h=[],u=[],m=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var s=0,n=0;for(t=0;t<256;t++){var p=n^n<<1^n<<2^n<<3^n<<4;p=p>>>8^255&p^99,i[s]=p,o[p]=s;var f=e[s],b=e[f],y=e[b],g=257*e[p]^16843008*p;r[s]=g<<24|g>>>8,a[s]=g<<16|g>>>16,l[s]=g<<8|g>>>24,c[s]=g,g=16843009*y^65537*b^257*f^16843008*s,d[p]=g<<24|g>>>8,h[p]=g<<16|g>>>16,u[p]=g<<8|g>>>24,m[p]=g,s?(s=f^e[e[e[y^f]]],n^=e[e[n]]):s=n=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],f=n.AES=s.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,s=e.sigBytes/4,n=4*((this._nRounds=s+6)+1),o=this._keySchedule=[],r=0;r<n;r++)r<s?o[r]=t[r]:(c=o[r-1],r%s?s>6&&r%s==4&&(c=i[c>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c]):(c=i[(c=c<<8|c>>>24)>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c],c^=p[r/s|0]<<24),o[r]=o[r-s]^c);for(var a=this._invKeySchedule=[],l=0;l<n;l++){if(r=n-l,l%4)var c=o[r];else c=o[r-4];a[l]=l<4||r<=4?c:d[i[c>>>24]]^h[i[c>>>16&255]]^u[i[c>>>8&255]]^m[i[255&c]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,r,a,l,c,i)},decryptBlock:function(e,t){var s=e[t+1];e[t+1]=e[t+3],e[t+3]=s,this._doCryptBlock(e,t,this._invKeySchedule,d,h,u,m,o),s=e[t+1],e[t+1]=e[t+3],e[t+3]=s},_doCryptBlock:function(e,t,s,n,i,o,r,a){for(var l=this._nRounds,c=e[t]^s[0],d=e[t+1]^s[1],h=e[t+2]^s[2],u=e[t+3]^s[3],m=4,p=1;p<l;p++){var f=n[c>>>24]^i[d>>>16&255]^o[h>>>8&255]^r[255&u]^s[m++],b=n[d>>>24]^i[h>>>16&255]^o[u>>>8&255]^r[255&c]^s[m++],y=n[h>>>24]^i[u>>>16&255]^o[c>>>8&255]^r[255&d]^s[m++],g=n[u>>>24]^i[c>>>16&255]^o[d>>>8&255]^r[255&h]^s[m++];c=f,d=b,h=y,u=g}f=(a[c>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^s[m++],b=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&c])^s[m++],y=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[c>>>8&255]<<8|a[255&d])^s[m++],g=(a[u>>>24]<<24|a[c>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^s[m++],e[t]=f,e[t+1]=b,e[t+2]=y,e[t+3]=g},keySize:8});t.AES=s._createHelper(f)}(),e.AES}(x(),Ki(),to(),ao(),lo||(lo=1,co.exports=function(e){e.lib.Cipher||function(t){var s=e,n=s.lib,i=n.Base,o=n.WordArray,r=n.BufferedBlockAlgorithm,a=s.enc;a.Utf8;var l=a.Base64,c=s.algo.EvpKDF,d=n.Cipher=r.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,s){this.cfg=this.cfg.extend(s),this._xformMode=e,this._key=t,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?w:y}return function(t){return{encrypt:function(s,n,i){return e(n).encrypt(t,s,n,i)},decrypt:function(s,n,i){return e(n).decrypt(t,s,n,i)}}}}()});n.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var h=s.mode={},u=n.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),m=h.CBC=function(){var e=u.extend();function s(e,s,n){var i,o=this._iv;o?(i=o,this._iv=t):i=this._prevBlock;for(var r=0;r<n;r++)e[s+r]^=i[r]}return e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;s.call(this,e,t,i),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),e.Decryptor=e.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,o=e.slice(t,t+i);n.decryptBlock(e,t),s.call(this,e,t,i),this._prevBlock=o}}),e}(),p=(s.pad={}).Pkcs7={pad:function(e,t){for(var s=4*t,n=s-e.sigBytes%s,i=n<<24|n<<16|n<<8|n,r=[],a=0;a<n;a+=4)r.push(i);var l=o.create(r,n);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};n.BlockCipher=d.extend({cfg:d.cfg.extend({mode:m,padding:p}),reset:function(){var e;d.reset.call(this);var t=this.cfg,s=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,s&&s.words):(this._mode=e.call(n,this,s&&s.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var f=n.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),b=(s.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,s=e.salt;return(s?o.create([1398893684,1701076831]).concat(s).concat(t):t).toString(l)},parse:function(e){var t,s=l.parse(e),n=s.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=o.create(n.slice(2,4)),n.splice(0,4),s.sigBytes-=16),f.create({ciphertext:s,salt:t})}},y=n.SerializableCipher=i.extend({cfg:i.extend({format:b}),encrypt:function(e,t,s,n){n=this.cfg.extend(n);var i=e.createEncryptor(s,n),o=i.finalize(t),r=i.cfg;return f.create({ciphertext:o,key:s,iv:r.iv,algorithm:e,mode:r.mode,padding:r.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,s,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(s,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),g=(s.kdf={}).OpenSSL={execute:function(e,t,s,n,i){if(n||(n=o.random(8)),i)r=c.create({keySize:t+s,hasher:i}).compute(e,n);else var r=c.create({keySize:t+s}).compute(e,n);var a=o.create(r.words.slice(t),4*s);return r.sigBytes=4*t,f.create({key:r,iv:a,salt:n})}},w=n.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:g}),encrypt:function(e,t,s,n){var i=(n=this.cfg.extend(n)).kdf.execute(s,e.keySize,e.ivSize,n.salt,n.hasher);n.iv=i.iv;var o=y.encrypt.call(this,e,t,i.key,n);return o.mixIn(i),o},decrypt:function(e,t,s,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(s,e.keySize,e.ivSize,t.salt,n.hasher);return n.iv=i.iv,y.decrypt.call(this,e,t,i.key,n)}})}()}(x(),ao())))),qi.exports),po=i(mo),fo={exports:{}};var bo=(uo||(uo=1,fo.exports=function(e){return e.HmacSHA256}(x(),k(),Di())),fo.exports),yo=i(bo);function go(e){let t=e.length;for(;--t>=0;)e[t]=0}const wo=256,Zo=286,vo=30,Xo=15,xo=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Lo=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),So=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Go=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Wo=new Array(576);go(Wo);const To=new Array(60);go(To);const Co=new Array(512);go(Co);const ko=new Array(256);go(ko);const Po=new Array(29);go(Po);const Ro=new Array(vo);function Io(e,t,s,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}let Mo,Vo,Yo;function Ho(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}go(Ro);const Ko=e=>e<256?Co[e]:Co[256+(e>>>7)],No=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},zo=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,No(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},_o=(e,t,s)=>{zo(e,s[2*t],s[2*t+1])},Fo=(e,t)=>{let s=0;do{s|=1&e,e>>>=1,s<<=1}while(--t>0);return s>>>1},Eo=(e,t,s)=>{const n=new Array(16);let i,o,r=0;for(i=1;i<=Xo;i++)r=r+s[i-1]<<1,n[i]=r;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=Fo(n[t]++,t))}},Jo=e=>{let t;for(t=0;t<Zo;t++)e.dyn_ltree[2*t]=0;for(t=0;t<vo;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},jo=e=>{e.bi_valid>8?No(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Qo=(e,t,s,n)=>{const i=2*t,o=2*s;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[s]},Uo=(e,t,s)=>{const n=e.heap[s];let i=s<<1;for(;i<=e.heap_len&&(i<e.heap_len&&Qo(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Qo(t,n,e.heap[i],e.depth));)e.heap[s]=e.heap[i],s=i,i<<=1;e.heap[s]=n},Do=(e,t,s)=>{let n,i,o,r,a=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+a++],n+=(255&e.pending_buf[e.sym_buf+a++])<<8,i=e.pending_buf[e.sym_buf+a++],0===n?_o(e,i,t):(o=ko[i],_o(e,o+wo+1,t),r=xo[o],0!==r&&(i-=Po[o],zo(e,i,r)),n--,o=Ko(n),_o(e,o,s),r=Lo[o],0!==r&&(n-=Ro[o],zo(e,n,r)))}while(a<e.sym_next);_o(e,256,t)},Oo=(e,t)=>{const s=t.dyn_tree,n=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let r,a,l,c=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<o;r++)0!==s[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):s[2*r+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,s[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=n[2*l+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)Uo(e,s,r);l=o;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Uo(e,s,1),a=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=a,s[2*l]=s[2*r]+s[2*a],e.depth[l]=(e.depth[r]>=e.depth[a]?e.depth[r]:e.depth[a])+1,s[2*r+1]=s[2*a+1]=l,e.heap[1]=l++,Uo(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const s=t.dyn_tree,n=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,r=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,d,h,u,m,p,f=0;for(u=0;u<=Xo;u++)e.bl_count[u]=0;for(s[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)d=e.heap[c],u=s[2*s[2*d+1]+1]+1,u>l&&(u=l,f++),s[2*d+1]=u,d>n||(e.bl_count[u]++,m=0,d>=a&&(m=r[d-a]),p=s[2*d],e.opt_len+=p*(u+m),o&&(e.static_len+=p*(i[2*d+1]+m)));if(0!==f){do{for(u=l-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[l]--,f-=2}while(f>0);for(u=l;0!==u;u--)for(d=e.bl_count[u];0!==d;)h=e.heap[--c],h>n||(s[2*h+1]!==u&&(e.opt_len+=(u-s[2*h+1])*s[2*h],s[2*h+1]=u),d--)}})(e,t),Eo(s,c,e.bl_count)},Bo=(e,t,s)=>{let n,i,o=-1,r=t[1],a=0,l=7,c=4;for(0===r&&(l=138,c=3),t[2*(s+1)+1]=65535,n=0;n<=s;n++)i=r,r=t[2*(n+1)+1],++a<l&&i===r||(a<c?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,o=i,0===r?(l=138,c=3):i===r?(l=6,c=3):(l=7,c=4))},Ao=(e,t,s)=>{let n,i,o=-1,r=t[1],a=0,l=7,c=4;for(0===r&&(l=138,c=3),n=0;n<=s;n++)if(i=r,r=t[2*(n+1)+1],!(++a<l&&i===r)){if(a<c)do{_o(e,i,e.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&(_o(e,i,e.bl_tree),a--),_o(e,16,e.bl_tree),zo(e,a-3,2)):a<=10?(_o(e,17,e.bl_tree),zo(e,a-3,3)):(_o(e,18,e.bl_tree),zo(e,a-11,7));a=0,o=i,0===r?(l=138,c=3):i===r?(l=6,c=3):(l=7,c=4)}};let $o=!1;const qo=(e,t,s,n)=>{zo(e,0+(n?1:0),3),jo(e),No(e,s),No(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var er=(e,t,s,n)=>{let i,o,r=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,s=4093624447;for(t=0;t<=31;t++,s>>>=1)if(1&s&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<wo;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Oo(e,e.l_desc),Oo(e,e.d_desc),r=(e=>{let t;for(Bo(e,e.dyn_ltree,e.l_desc.max_code),Bo(e,e.dyn_dtree,e.d_desc.max_code),Oo(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Go[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=s+5,s+4<=i&&-1!==t?qo(e,t,s,n):4===e.strategy||o===i?(zo(e,2+(n?1:0),3),Do(e,Wo,To)):(zo(e,4+(n?1:0),3),((e,t,s,n)=>{let i;for(zo(e,t-257,5),zo(e,s-1,5),zo(e,n-4,4),i=0;i<n;i++)zo(e,e.bl_tree[2*Go[i]+1],3);Ao(e,e.dyn_ltree,t-1),Ao(e,e.dyn_dtree,s-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),Do(e,e.dyn_ltree,e.dyn_dtree)),Jo(e),n&&jo(e)},tr={_tr_init:e=>{$o||((()=>{let e,t,s,n,i;const o=new Array(16);for(s=0,n=0;n<28;n++)for(Po[n]=s,e=0;e<1<<xo[n];e++)ko[s++]=n;for(ko[s-1]=n,i=0,n=0;n<16;n++)for(Ro[n]=i,e=0;e<1<<Lo[n];e++)Co[i++]=n;for(i>>=7;n<vo;n++)for(Ro[n]=i<<7,e=0;e<1<<Lo[n]-7;e++)Co[256+i++]=n;for(t=0;t<=Xo;t++)o[t]=0;for(e=0;e<=143;)Wo[2*e+1]=8,e++,o[8]++;for(;e<=255;)Wo[2*e+1]=9,e++,o[9]++;for(;e<=279;)Wo[2*e+1]=7,e++,o[7]++;for(;e<=287;)Wo[2*e+1]=8,e++,o[8]++;for(Eo(Wo,287,o),e=0;e<vo;e++)To[2*e+1]=5,To[2*e]=Fo(e,5);Mo=new Io(Wo,xo,257,Zo,Xo),Vo=new Io(To,Lo,0,vo,Xo),Yo=new Io(new Array(0),So,0,19,7)})(),$o=!0),e.l_desc=new Ho(e.dyn_ltree,Mo),e.d_desc=new Ho(e.dyn_dtree,Vo),e.bl_desc=new Ho(e.bl_tree,Yo),e.bi_buf=0,e.bi_valid=0,Jo(e)},_tr_stored_block:qo,_tr_flush_block:er,_tr_tally:(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,0===t?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(ko[s]+wo+1)]++,e.dyn_dtree[2*Ko(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{zo(e,2,3),_o(e,256,Wo),(e=>{16===e.bi_valid?(No(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var sr=(e,t,s,n)=>{let i=65535&e,o=e>>>16&65535,r=0;for(;0!==s;){r=s>2e3?2e3:s,s-=r;do{i=i+t[n++]|0,o=o+i|0}while(--r);i%=65521,o%=65521}return i|o<<16};const nr=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var ir=(e,t,s,n)=>{const i=nr,o=n+s;e^=-1;for(let s=n;s<o;s++)e=e>>>8^i[255&(e^t[s])];return~e},or={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},rr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ar,_tr_stored_block:lr,_tr_flush_block:cr,_tr_tally:dr,_tr_align:hr}=tr,{Z_NO_FLUSH:ur,Z_PARTIAL_FLUSH:mr,Z_FULL_FLUSH:pr,Z_FINISH:fr,Z_BLOCK:br,Z_OK:yr,Z_STREAM_END:gr,Z_STREAM_ERROR:wr,Z_DATA_ERROR:Zr,Z_BUF_ERROR:vr,Z_DEFAULT_COMPRESSION:Xr,Z_FILTERED:xr,Z_HUFFMAN_ONLY:Lr,Z_RLE:Sr,Z_FIXED:Gr,Z_DEFAULT_STRATEGY:Wr,Z_UNKNOWN:Tr,Z_DEFLATED:Cr}=rr,kr=258,Pr=262,Rr=42,Ir=113,Mr=666,Vr=(e,t)=>(e.msg=or[t],t),Yr=e=>2*e-(e>4?9:0),Hr=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Kr=e=>{let t,s,n,i=e.w_size;t=e.hash_size,n=t;do{s=e.head[--n],e.head[n]=s>=i?s-i:0}while(--t);t=i,n=t;do{s=e.prev[--n],e.prev[n]=s>=i?s-i:0}while(--t)};let Nr=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask;const zr=e=>{const t=e.state;let s=t.pending;s>e.avail_out&&(s=e.avail_out),0!==s&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,0===t.pending&&(t.pending_out=0))},_r=(e,t)=>{cr(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,zr(e.strm)},Fr=(e,t)=>{e.pending_buf[e.pending++]=t},Er=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Jr=(e,t,s,n)=>{let i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),s),1===e.state.wrap?e.adler=sr(e.adler,t,i,s):2===e.state.wrap&&(e.adler=ir(e.adler,t,i,s)),e.next_in+=i,e.total_in+=i,i)},jr=(e,t)=>{let s,n,i=e.max_chain_length,o=e.strstart,r=e.prev_length,a=e.nice_match;const l=e.strstart>e.w_size-Pr?e.strstart-(e.w_size-Pr):0,c=e.window,d=e.w_mask,h=e.prev,u=e.strstart+kr;let m=c[o+r-1],p=c[o+r];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(s=t,c[s+r]===p&&c[s+r-1]===m&&c[s]===c[o]&&c[++s]===c[o+1]){o+=2,s++;do{}while(c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&o<u);if(n=kr-(u-o),o=u-kr,n>r){if(e.match_start=t,r=n,n>=a)break;m=c[o+r-1],p=c[o+r]}}}while((t=h[t&d])>l&&0!=--i);return r<=e.lookahead?r:e.lookahead},Qr=e=>{const t=e.w_size;let s,n,i;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Pr)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Kr(e),n+=t),0===e.strm.avail_in)break;if(s=Jr(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=s,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Nr(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Nr(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Pr&&0!==e.strm.avail_in)},Ur=(e,t)=>{let s,n,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,r=0,a=e.strm.avail_in;do{if(s=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,n=e.strstart-e.block_start,s>n+e.strm.avail_in&&(s=n+e.strm.avail_in),s>i&&(s=i),s<o&&(0===s&&t!==fr||t===ur||s!==n+e.strm.avail_in))break;r=t===fr&&s===n+e.strm.avail_in?1:0,lr(e,0,0,r),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,zr(e.strm),n&&(n>s&&(n=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,s-=n),s&&(Jr(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(0===r);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),r?4:t!==ur&&t!==fr&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Jr(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,o=i>e.w_size?e.w_size:i,n=e.strstart-e.block_start,(n>=o||(n||t===fr)&&t!==ur&&0===e.strm.avail_in&&n<=i)&&(s=n>i?i:n,r=t===fr&&0===e.strm.avail_in&&s===n?1:0,lr(e,e.block_start,s,r),e.block_start+=s,zr(e.strm)),r?3:1)},Dr=(e,t)=>{let s,n;for(;;){if(e.lookahead<Pr){if(Qr(e),e.lookahead<Pr&&t===ur)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=Nr(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==s&&e.strstart-s<=e.w_size-Pr&&(e.match_length=jr(e,s)),e.match_length>=3)if(n=dr(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Nr(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Nr(e,e.ins_h,e.window[e.strstart+1]);else n=dr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(_r(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===fr?(_r(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(_r(e,!1),0===e.strm.avail_out)?1:2},Or=(e,t)=>{let s,n,i;for(;;){if(e.lookahead<Pr){if(Qr(e),e.lookahead<Pr&&t===ur)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=Nr(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==s&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-Pr&&(e.match_length=jr(e,s),e.match_length<=5&&(e.strategy===xr||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=dr(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=Nr(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(_r(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=dr(e,0,e.window[e.strstart-1]),n&&_r(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=dr(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===fr?(_r(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(_r(e,!1),0===e.strm.avail_out)?1:2};function Br(e,t,s,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=n,this.func=i}const Ar=[new Br(0,0,0,0,Ur),new Br(4,4,8,4,Dr),new Br(4,5,16,8,Dr),new Br(4,6,32,32,Dr),new Br(4,4,16,16,Or),new Br(8,16,32,32,Or),new Br(8,16,128,128,Or),new Br(8,32,128,256,Or),new Br(32,128,258,1024,Or),new Br(32,258,258,4096,Or)];function $r(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Cr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Hr(this.dyn_ltree),Hr(this.dyn_dtree),Hr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Hr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Hr(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const qr=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Rr&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Ir&&t.status!==Mr?1:0},ea=e=>{if(qr(e))return Vr(e,wr);e.total_in=e.total_out=0,e.data_type=Tr;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Rr:Ir,e.adler=2===t.wrap?0:1,t.last_flush=-2,ar(t),yr},ta=e=>{const t=ea(e);var s;return t===yr&&((s=e.state).window_size=2*s.w_size,Hr(s.head),s.max_lazy_match=Ar[s.level].max_lazy,s.good_match=Ar[s.level].good_length,s.nice_match=Ar[s.level].nice_length,s.max_chain_length=Ar[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),t},sa=(e,t,s,n,i,o)=>{if(!e)return wr;let r=1;if(t===Xr&&(t=6),n<0?(r=0,n=-n):n>15&&(r=2,n-=16),i<1||i>9||s!==Cr||n<8||n>15||t<0||t>9||o<0||o>Gr||8===n&&1!==r)return Vr(e,wr);8===n&&(n=9);const a=new $r;return e.state=a,a.strm=e,a.status=Rr,a.wrap=r,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=o,a.method=s,ta(e)};var na={deflateInit:(e,t)=>sa(e,t,Cr,15,8,Wr),deflateInit2:sa,deflateReset:ta,deflateResetKeep:ea,deflateSetHeader:(e,t)=>qr(e)||2!==e.state.wrap?wr:(e.state.gzhead=t,yr),deflate:(e,t)=>{if(qr(e)||t>br||t<0)return e?Vr(e,wr):wr;const s=e.state;if(!e.output||0!==e.avail_in&&!e.input||s.status===Mr&&t!==fr)return Vr(e,0===e.avail_out?vr:wr);const n=s.last_flush;if(s.last_flush=t,0!==s.pending){if(zr(e),0===e.avail_out)return s.last_flush=-1,yr}else if(0===e.avail_in&&Yr(t)<=Yr(n)&&t!==fr)return Vr(e,vr);if(s.status===Mr&&0!==e.avail_in)return Vr(e,vr);if(s.status===Rr&&0===s.wrap&&(s.status=Ir),s.status===Rr){let t=Cr+(s.w_bits-8<<4)<<8,n=-1;if(n=s.strategy>=Lr||s.level<2?0:s.level<6?1:6===s.level?2:3,t|=n<<6,0!==s.strstart&&(t|=32),t+=31-t%31,Er(s,t),0!==s.strstart&&(Er(s,e.adler>>>16),Er(s,65535&e.adler)),e.adler=1,s.status=Ir,zr(e),0!==s.pending)return s.last_flush=-1,yr}if(57===s.status)if(e.adler=0,Fr(s,31),Fr(s,139),Fr(s,8),s.gzhead)Fr(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),Fr(s,255&s.gzhead.time),Fr(s,s.gzhead.time>>8&255),Fr(s,s.gzhead.time>>16&255),Fr(s,s.gzhead.time>>24&255),Fr(s,9===s.level?2:s.strategy>=Lr||s.level<2?4:0),Fr(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(Fr(s,255&s.gzhead.extra.length),Fr(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=ir(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(Fr(s,0),Fr(s,0),Fr(s,0),Fr(s,0),Fr(s,0),Fr(s,9===s.level?2:s.strategy>=Lr||s.level<2?4:0),Fr(s,3),s.status=Ir,zr(e),0!==s.pending)return s.last_flush=-1,yr;if(69===s.status){if(s.gzhead.extra){let t=s.pending,n=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+n>s.pending_buf_size;){let i=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+i),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>t&&(e.adler=ir(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex+=i,zr(e),0!==s.pending)return s.last_flush=-1,yr;t=0,n-=i}let i=new Uint8Array(s.gzhead.extra);s.pending_buf.set(i.subarray(s.gzindex,s.gzindex+n),s.pending),s.pending+=n,s.gzhead.hcrc&&s.pending>t&&(e.adler=ir(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let t,n=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>n&&(e.adler=ir(e.adler,s.pending_buf,s.pending-n,n)),zr(e),0!==s.pending)return s.last_flush=-1,yr;n=0}t=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,Fr(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>n&&(e.adler=ir(e.adler,s.pending_buf,s.pending-n,n)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let t,n=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>n&&(e.adler=ir(e.adler,s.pending_buf,s.pending-n,n)),zr(e),0!==s.pending)return s.last_flush=-1,yr;n=0}t=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,Fr(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>n&&(e.adler=ir(e.adler,s.pending_buf,s.pending-n,n))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(zr(e),0!==s.pending))return s.last_flush=-1,yr;Fr(s,255&e.adler),Fr(s,e.adler>>8&255),e.adler=0}if(s.status=Ir,zr(e),0!==s.pending)return s.last_flush=-1,yr}if(0!==e.avail_in||0!==s.lookahead||t!==ur&&s.status!==Mr){let n=0===s.level?Ur(s,t):s.strategy===Lr?((e,t)=>{let s;for(;;){if(0===e.lookahead&&(Qr(e),0===e.lookahead)){if(t===ur)return 1;break}if(e.match_length=0,s=dr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,s&&(_r(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===fr?(_r(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(_r(e,!1),0===e.strm.avail_out)?1:2})(s,t):s.strategy===Sr?((e,t)=>{let s,n,i,o;const r=e.window;for(;;){if(e.lookahead<=kr){if(Qr(e),e.lookahead<=kr&&t===ur)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,n=r[i],n===r[++i]&&n===r[++i]&&n===r[++i])){o=e.strstart+kr;do{}while(n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&i<o);e.match_length=kr-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(s=dr(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(s=dr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),s&&(_r(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===fr?(_r(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(_r(e,!1),0===e.strm.avail_out)?1:2})(s,t):Ar[s.level].func(s,t);if(3!==n&&4!==n||(s.status=Mr),1===n||3===n)return 0===e.avail_out&&(s.last_flush=-1),yr;if(2===n&&(t===mr?hr(s):t!==br&&(lr(s,0,0,!1),t===pr&&(Hr(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),zr(e),0===e.avail_out))return s.last_flush=-1,yr}return t!==fr?yr:s.wrap<=0?gr:(2===s.wrap?(Fr(s,255&e.adler),Fr(s,e.adler>>8&255),Fr(s,e.adler>>16&255),Fr(s,e.adler>>24&255),Fr(s,255&e.total_in),Fr(s,e.total_in>>8&255),Fr(s,e.total_in>>16&255),Fr(s,e.total_in>>24&255)):(Er(s,e.adler>>>16),Er(s,65535&e.adler)),zr(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?yr:gr)},deflateEnd:e=>{if(qr(e))return wr;const t=e.state.status;return e.state=null,t===Ir?Vr(e,Zr):yr},deflateSetDictionary:(e,t)=>{let s=t.length;if(qr(e))return wr;const n=e.state,i=n.wrap;if(2===i||1===i&&n.status!==Rr||n.lookahead)return wr;if(1===i&&(e.adler=sr(e.adler,t,s,0)),n.wrap=0,s>=n.w_size){0===i&&(Hr(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(s-n.w_size,s),0),t=e,s=n.w_size}const o=e.avail_in,r=e.next_in,a=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,Qr(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=Nr(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,Qr(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=r,e.input=a,e.avail_in=o,n.wrap=i,yr},deflateInfo:"pako deflate (from Nodeca project)"};const ia=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var oa=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const t in s)ia(s,t)&&(e[t]=s[t])}}return e},ra=e=>{let t=0;for(let s=0,n=e.length;s<n;s++)t+=e[s].length;const s=new Uint8Array(t);for(let t=0,n=0,i=e.length;t<i;t++){let i=e[t];s.set(i,n),n+=i.length}return s};let aa=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){aa=!1}const la=new Uint8Array(256);for(let e=0;e<256;e++)la[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;la[254]=la[254]=1;var ca=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,s,n,i,o,r=e.length,a=0;for(i=0;i<r;i++)s=e.charCodeAt(i),55296==(64512&s)&&i+1<r&&(n=e.charCodeAt(i+1),56320==(64512&n)&&(s=65536+(s-55296<<10)+(n-56320),i++)),a+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(a),o=0,i=0;o<a;i++)s=e.charCodeAt(i),55296==(64512&s)&&i+1<r&&(n=e.charCodeAt(i+1),56320==(64512&n)&&(s=65536+(s-55296<<10)+(n-56320),i++)),s<128?t[o++]=s:s<2048?(t[o++]=192|s>>>6,t[o++]=128|63&s):s<65536?(t[o++]=224|s>>>12,t[o++]=128|s>>>6&63,t[o++]=128|63&s):(t[o++]=240|s>>>18,t[o++]=128|s>>>12&63,t[o++]=128|s>>>6&63,t[o++]=128|63&s);return t},da=(e,t)=>{const s=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,i;const o=new Array(2*s);for(i=0,n=0;n<s;){let t=e[n++];if(t<128){o[i++]=t;continue}let r=la[t];if(r>4)o[i++]=65533,n+=r-1;else{for(t&=2===r?31:3===r?15:7;r>1&&n<s;)t=t<<6|63&e[n++],r--;r>1?o[i++]=65533:t<65536?o[i++]=t:(t-=65536,o[i++]=55296|t>>10&1023,o[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&aa)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let s="";for(let n=0;n<t;n++)s+=String.fromCharCode(e[n]);return s})(o,i)},ha=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&128==(192&e[s]);)s--;return s<0||0===s?t:s+la[e[s]]>t?s:t};var ua=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const ma=Object.prototype.toString,{Z_NO_FLUSH:pa,Z_SYNC_FLUSH:fa,Z_FULL_FLUSH:ba,Z_FINISH:ya,Z_OK:ga,Z_STREAM_END:wa,Z_DEFAULT_COMPRESSION:Za,Z_DEFAULT_STRATEGY:va,Z_DEFLATED:Xa}=rr;function xa(e){this.options=oa({level:Za,method:Xa,chunkSize:16384,windowBits:15,memLevel:8,strategy:va},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ua,this.strm.avail_out=0;let s=na.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==ga)throw new Error(or[s]);if(t.header&&na.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?ca(t.dictionary):"[object ArrayBuffer]"===ma.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,s=na.deflateSetDictionary(this.strm,e),s!==ga)throw new Error(or[s]);this._dict_set=!0}}function La(e,t){const s=new xa(t);if(s.push(e,!0),s.err)throw s.msg||or[s.err];return s.result}xa.prototype.push=function(e,t){const s=this.strm,n=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?ya:pa,"string"==typeof e?s.input=ca(e):"[object ArrayBuffer]"===ma.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(n),s.next_out=0,s.avail_out=n),(o===fa||o===ba)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(i=na.deflate(s,o),i===wa)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),i=na.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===ga;if(0!==s.avail_out){if(o>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},xa.prototype.onData=function(e){this.chunks.push(e)},xa.prototype.onEnd=function(e){e===ga&&(this.result=ra(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Sa={Deflate:xa,deflate:La,deflateRaw:function(e,t){return(t=t||{}).raw=!0,La(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,La(e,t)}};const Ga=16209;var Wa=function(e,t){let s,n,i,o,r,a,l,c,d,h,u,m,p,f,b,y,g,w,Z,v,X,x,L,S;const G=e.state;s=e.next_in,L=e.input,n=s+(e.avail_in-5),i=e.next_out,S=e.output,o=i-(t-e.avail_out),r=i+(e.avail_out-257),a=G.dmax,l=G.wsize,c=G.whave,d=G.wnext,h=G.window,u=G.hold,m=G.bits,p=G.lencode,f=G.distcode,b=(1<<G.lenbits)-1,y=(1<<G.distbits)-1;e:do{m<15&&(u+=L[s++]<<m,m+=8,u+=L[s++]<<m,m+=8),g=p[u&b];t:for(;;){if(w=g>>>24,u>>>=w,m-=w,w=g>>>16&255,0===w)S[i++]=65535&g;else{if(!(16&w)){if(64&w){if(32&w){G.mode=16191;break e}e.msg="invalid literal/length code",G.mode=Ga;break e}g=p[(65535&g)+(u&(1<<w)-1)];continue t}for(Z=65535&g,w&=15,w&&(m<w&&(u+=L[s++]<<m,m+=8),Z+=u&(1<<w)-1,u>>>=w,m-=w),m<15&&(u+=L[s++]<<m,m+=8,u+=L[s++]<<m,m+=8),g=f[u&y];;){if(w=g>>>24,u>>>=w,m-=w,w=g>>>16&255,16&w){if(v=65535&g,w&=15,m<w&&(u+=L[s++]<<m,m+=8,m<w&&(u+=L[s++]<<m,m+=8)),v+=u&(1<<w)-1,v>a){e.msg="invalid distance too far back",G.mode=Ga;break e}if(u>>>=w,m-=w,w=i-o,v>w){if(w=v-w,w>c&&G.sane){e.msg="invalid distance too far back",G.mode=Ga;break e}if(X=0,x=h,0===d){if(X+=l-w,w<Z){Z-=w;do{S[i++]=h[X++]}while(--w);X=i-v,x=S}}else if(d<w){if(X+=l+d-w,w-=d,w<Z){Z-=w;do{S[i++]=h[X++]}while(--w);if(X=0,d<Z){w=d,Z-=w;do{S[i++]=h[X++]}while(--w);X=i-v,x=S}}}else if(X+=d-w,w<Z){Z-=w;do{S[i++]=h[X++]}while(--w);X=i-v,x=S}for(;Z>2;)S[i++]=x[X++],S[i++]=x[X++],S[i++]=x[X++],Z-=3;Z&&(S[i++]=x[X++],Z>1&&(S[i++]=x[X++]))}else{X=i-v;do{S[i++]=S[X++],S[i++]=S[X++],S[i++]=S[X++],Z-=3}while(Z>2);Z&&(S[i++]=S[X++],Z>1&&(S[i++]=S[X++]))}break}if(64&w){e.msg="invalid distance code",G.mode=Ga;break e}g=f[(65535&g)+(u&(1<<w)-1)]}}break}}while(s<n&&i<r);Z=m>>3,s-=Z,m-=Z<<3,u&=(1<<m)-1,e.next_in=s,e.next_out=i,e.avail_in=s<n?n-s+5:5-(s-n),e.avail_out=i<r?r-i+257:257-(i-r),G.hold=u,G.bits=m};const Ta=15,Ca=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ka=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Pa=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ra=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ia=(e,t,s,n,i,o,r,a)=>{const l=a.bits;let c,d,h,u,m,p,f=0,b=0,y=0,g=0,w=0,Z=0,v=0,X=0,x=0,L=0,S=null;const G=new Uint16Array(16),W=new Uint16Array(16);let T,C,k,P=null;for(f=0;f<=Ta;f++)G[f]=0;for(b=0;b<n;b++)G[t[s+b]]++;for(w=l,g=Ta;g>=1&&0===G[g];g--);if(w>g&&(w=g),0===g)return i[o++]=20971520,i[o++]=20971520,a.bits=1,0;for(y=1;y<g&&0===G[y];y++);for(w<y&&(w=y),X=1,f=1;f<=Ta;f++)if(X<<=1,X-=G[f],X<0)return-1;if(X>0&&(0===e||1!==g))return-1;for(W[1]=0,f=1;f<Ta;f++)W[f+1]=W[f]+G[f];for(b=0;b<n;b++)0!==t[s+b]&&(r[W[t[s+b]]++]=b);if(0===e?(S=P=r,p=20):1===e?(S=Ca,P=ka,p=257):(S=Pa,P=Ra,p=0),L=0,b=0,f=y,m=o,Z=w,v=0,h=-1,x=1<<w,u=x-1,1===e&&x>852||2===e&&x>592)return 1;for(;;){T=f-v,r[b]+1<p?(C=0,k=r[b]):r[b]>=p?(C=P[r[b]-p],k=S[r[b]-p]):(C=96,k=0),c=1<<f-v,d=1<<Z,y=d;do{d-=c,i[m+(L>>v)+d]=T<<24|C<<16|k}while(0!==d);for(c=1<<f-1;L&c;)c>>=1;if(0!==c?(L&=c-1,L+=c):L=0,b++,0==--G[f]){if(f===g)break;f=t[s+r[b]]}if(f>w&&(L&u)!==h){for(0===v&&(v=w),m+=y,Z=f-v,X=1<<Z;Z+v<g&&(X-=G[Z+v],!(X<=0));)Z++,X<<=1;if(x+=1<<Z,1===e&&x>852||2===e&&x>592)return 1;h=L&u,i[h]=w<<24|Z<<16|m-o}}return 0!==L&&(i[m+L]=f-v<<24|64<<16),a.bits=w,0};const{Z_FINISH:Ma,Z_BLOCK:Va,Z_TREES:Ya,Z_OK:Ha,Z_STREAM_END:Ka,Z_NEED_DICT:Na,Z_STREAM_ERROR:za,Z_DATA_ERROR:_a,Z_MEM_ERROR:Fa,Z_BUF_ERROR:Ea,Z_DEFLATED:Ja}=rr,ja=16180,Qa=16190,Ua=16191,Da=16192,Oa=16194,Ba=16199,Aa=16200,$a=16206,qa=16209,el=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function tl(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const sl=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<ja||t.mode>16211?1:0},nl=e=>{if(sl(e))return za;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=ja,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Ha},il=e=>{if(sl(e))return za;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,nl(e)},ol=(e,t)=>{let s;if(sl(e))return za;const n=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?za:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=s,n.wbits=t,il(e))},rl=(e,t)=>{if(!e)return za;const s=new tl;e.state=s,s.strm=e,s.window=null,s.mode=ja;const n=ol(e,t);return n!==Ha&&(e.state=null),n};let al,ll,cl=!0;const dl=e=>{if(cl){al=new Int32Array(512),ll=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Ia(1,e.lens,0,288,al,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Ia(2,e.lens,0,32,ll,0,e.work,{bits:5}),cl=!1}e.lencode=al,e.lenbits=9,e.distcode=ll,e.distbits=5},hl=(e,t,s,n)=>{let i;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(t.subarray(s-o.wsize,s),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(t.subarray(s-n,s-n+i),o.wnext),(n-=i)?(o.window.set(t.subarray(s-n,s),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var ul=(e,t)=>{let s,n,i,o,r,a,l,c,d,h,u,m,p,f,b,y,g,w,Z,v,X,x,L=0;const S=new Uint8Array(4);let G,W;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(sl(e)||!e.output||!e.input&&0!==e.avail_in)return za;s=e.state,s.mode===Ua&&(s.mode=Da),r=e.next_out,i=e.output,l=e.avail_out,o=e.next_in,n=e.input,a=e.avail_in,c=s.hold,d=s.bits,h=a,u=l,x=Ha;e:for(;;)switch(s.mode){case ja:if(0===s.wrap){s.mode=Da;break}for(;d<16;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}if(2&s.wrap&&35615===c){0===s.wbits&&(s.wbits=15),s.check=0,S[0]=255&c,S[1]=c>>>8&255,s.check=ir(s.check,S,2,0),c=0,d=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",s.mode=qa;break}if((15&c)!==Ja){e.msg="unknown compression method",s.mode=qa;break}if(c>>>=4,d-=4,X=8+(15&c),0===s.wbits&&(s.wbits=X),X>15||X>s.wbits){e.msg="invalid window size",s.mode=qa;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&c?16189:Ua,c=0,d=0;break;case 16181:for(;d<16;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}if(s.flags=c,(255&s.flags)!==Ja){e.msg="unknown compression method",s.mode=qa;break}if(57344&s.flags){e.msg="unknown header flags set",s.mode=qa;break}s.head&&(s.head.text=c>>8&1),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,s.check=ir(s.check,S,2,0)),c=0,d=0,s.mode=16182;case 16182:for(;d<32;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}s.head&&(s.head.time=c),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,S[2]=c>>>16&255,S[3]=c>>>24&255,s.check=ir(s.check,S,4,0)),c=0,d=0,s.mode=16183;case 16183:for(;d<16;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}s.head&&(s.head.xflags=255&c,s.head.os=c>>8),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,s.check=ir(s.check,S,2,0)),c=0,d=0,s.mode=16184;case 16184:if(1024&s.flags){for(;d<16;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}s.length=c,s.head&&(s.head.extra_len=c),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,s.check=ir(s.check,S,2,0)),c=0,d=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&s.flags&&(m=s.length,m>a&&(m=a),m&&(s.head&&(X=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(n.subarray(o,o+m),X)),512&s.flags&&4&s.wrap&&(s.check=ir(s.check,n,m,o)),a-=m,o+=m,s.length-=m),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&s.flags){if(0===a)break e;m=0;do{X=n[o+m++],s.head&&X&&s.length<65536&&(s.head.name+=String.fromCharCode(X))}while(X&&m<a);if(512&s.flags&&4&s.wrap&&(s.check=ir(s.check,n,m,o)),a-=m,o+=m,X)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&s.flags){if(0===a)break e;m=0;do{X=n[o+m++],s.head&&X&&s.length<65536&&(s.head.comment+=String.fromCharCode(X))}while(X&&m<a);if(512&s.flags&&4&s.wrap&&(s.check=ir(s.check,n,m,o)),a-=m,o+=m,X)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&s.flags){for(;d<16;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}if(4&s.wrap&&c!==(65535&s.check)){e.msg="header crc mismatch",s.mode=qa;break}c=0,d=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=Ua;break;case 16189:for(;d<32;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}e.adler=s.check=el(c),c=0,d=0,s.mode=Qa;case Qa:if(0===s.havedict)return e.next_out=r,e.avail_out=l,e.next_in=o,e.avail_in=a,s.hold=c,s.bits=d,Na;e.adler=s.check=1,s.mode=Ua;case Ua:if(t===Va||t===Ya)break e;case Da:if(s.last){c>>>=7&d,d-=7&d,s.mode=$a;break}for(;d<3;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}switch(s.last=1&c,c>>>=1,d-=1,3&c){case 0:s.mode=16193;break;case 1:if(dl(s),s.mode=Ba,t===Ya){c>>>=2,d-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=qa}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",s.mode=qa;break}if(s.length=65535&c,c=0,d=0,s.mode=Oa,t===Ya)break e;case Oa:s.mode=16195;case 16195:if(m=s.length,m){if(m>a&&(m=a),m>l&&(m=l),0===m)break e;i.set(n.subarray(o,o+m),r),a-=m,o+=m,l-=m,r+=m,s.length-=m;break}s.mode=Ua;break;case 16196:for(;d<14;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}if(s.nlen=257+(31&c),c>>>=5,d-=5,s.ndist=1+(31&c),c>>>=5,d-=5,s.ncode=4+(15&c),c>>>=4,d-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=qa;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;d<3;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}s.lens[T[s.have++]]=7&c,c>>>=3,d-=3}for(;s.have<19;)s.lens[T[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,G={bits:s.lenbits},x=Ia(0,s.lens,0,19,s.lencode,0,s.work,G),s.lenbits=G.bits,x){e.msg="invalid code lengths set",s.mode=qa;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;L=s.lencode[c&(1<<s.lenbits)-1],b=L>>>24,y=L>>>16&255,g=65535&L,!(b<=d);){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}if(g<16)c>>>=b,d-=b,s.lens[s.have++]=g;else{if(16===g){for(W=b+2;d<W;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}if(c>>>=b,d-=b,0===s.have){e.msg="invalid bit length repeat",s.mode=qa;break}X=s.lens[s.have-1],m=3+(3&c),c>>>=2,d-=2}else if(17===g){for(W=b+3;d<W;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}c>>>=b,d-=b,X=0,m=3+(7&c),c>>>=3,d-=3}else{for(W=b+7;d<W;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}c>>>=b,d-=b,X=0,m=11+(127&c),c>>>=7,d-=7}if(s.have+m>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=qa;break}for(;m--;)s.lens[s.have++]=X}}if(s.mode===qa)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=qa;break}if(s.lenbits=9,G={bits:s.lenbits},x=Ia(1,s.lens,0,s.nlen,s.lencode,0,s.work,G),s.lenbits=G.bits,x){e.msg="invalid literal/lengths set",s.mode=qa;break}if(s.distbits=6,s.distcode=s.distdyn,G={bits:s.distbits},x=Ia(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,G),s.distbits=G.bits,x){e.msg="invalid distances set",s.mode=qa;break}if(s.mode=Ba,t===Ya)break e;case Ba:s.mode=Aa;case Aa:if(a>=6&&l>=258){e.next_out=r,e.avail_out=l,e.next_in=o,e.avail_in=a,s.hold=c,s.bits=d,Wa(e,u),r=e.next_out,i=e.output,l=e.avail_out,o=e.next_in,n=e.input,a=e.avail_in,c=s.hold,d=s.bits,s.mode===Ua&&(s.back=-1);break}for(s.back=0;L=s.lencode[c&(1<<s.lenbits)-1],b=L>>>24,y=L>>>16&255,g=65535&L,!(b<=d);){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}if(y&&!(240&y)){for(w=b,Z=y,v=g;L=s.lencode[v+((c&(1<<w+Z)-1)>>w)],b=L>>>24,y=L>>>16&255,g=65535&L,!(w+b<=d);){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}c>>>=w,d-=w,s.back+=w}if(c>>>=b,d-=b,s.back+=b,s.length=g,0===y){s.mode=16205;break}if(32&y){s.back=-1,s.mode=Ua;break}if(64&y){e.msg="invalid literal/length code",s.mode=qa;break}s.extra=15&y,s.mode=16201;case 16201:if(s.extra){for(W=s.extra;d<W;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}s.length+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;L=s.distcode[c&(1<<s.distbits)-1],b=L>>>24,y=L>>>16&255,g=65535&L,!(b<=d);){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}if(!(240&y)){for(w=b,Z=y,v=g;L=s.distcode[v+((c&(1<<w+Z)-1)>>w)],b=L>>>24,y=L>>>16&255,g=65535&L,!(w+b<=d);){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}c>>>=w,d-=w,s.back+=w}if(c>>>=b,d-=b,s.back+=b,64&y){e.msg="invalid distance code",s.mode=qa;break}s.offset=g,s.extra=15&y,s.mode=16203;case 16203:if(s.extra){for(W=s.extra;d<W;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}s.offset+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=qa;break}s.mode=16204;case 16204:if(0===l)break e;if(m=u-l,s.offset>m){if(m=s.offset-m,m>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=qa;break}m>s.wnext?(m-=s.wnext,p=s.wsize-m):p=s.wnext-m,m>s.length&&(m=s.length),f=s.window}else f=i,p=r-s.offset,m=s.length;m>l&&(m=l),l-=m,s.length-=m;do{i[r++]=f[p++]}while(--m);0===s.length&&(s.mode=Aa);break;case 16205:if(0===l)break e;i[r++]=s.length,l--,s.mode=Aa;break;case $a:if(s.wrap){for(;d<32;){if(0===a)break e;a--,c|=n[o++]<<d,d+=8}if(u-=l,e.total_out+=u,s.total+=u,4&s.wrap&&u&&(e.adler=s.check=s.flags?ir(s.check,i,u,r-u):sr(s.check,i,u,r-u)),u=l,4&s.wrap&&(s.flags?c:el(c))!==s.check){e.msg="incorrect data check",s.mode=qa;break}c=0,d=0}s.mode=16207;case 16207:if(s.wrap&&s.flags){for(;d<32;){if(0===a)break e;a--,c+=n[o++]<<d,d+=8}if(4&s.wrap&&c!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=qa;break}c=0,d=0}s.mode=16208;case 16208:x=Ka;break e;case qa:x=_a;break e;case 16210:return Fa;default:return za}return e.next_out=r,e.avail_out=l,e.next_in=o,e.avail_in=a,s.hold=c,s.bits=d,(s.wsize||u!==e.avail_out&&s.mode<qa&&(s.mode<$a||t!==Ma))&&hl(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,s.total+=u,4&s.wrap&&u&&(e.adler=s.check=s.flags?ir(s.check,i,u,e.next_out-u):sr(s.check,i,u,e.next_out-u)),e.data_type=s.bits+(s.last?64:0)+(s.mode===Ua?128:0)+(s.mode===Ba||s.mode===Oa?256:0),(0===h&&0===u||t===Ma)&&x===Ha&&(x=Ea),x},ml={inflateReset:il,inflateReset2:ol,inflateResetKeep:nl,inflateInit:e=>rl(e,15),inflateInit2:rl,inflate:ul,inflateEnd:e=>{if(sl(e))return za;let t=e.state;return t.window&&(t.window=null),e.state=null,Ha},inflateGetHeader:(e,t)=>{if(sl(e))return za;const s=e.state;return 2&s.wrap?(s.head=t,t.done=!1,Ha):za},inflateSetDictionary:(e,t)=>{const s=t.length;let n,i,o;return sl(e)?za:(n=e.state,0!==n.wrap&&n.mode!==Qa?za:n.mode===Qa&&(i=1,i=sr(i,t,s,0),i!==n.check)?_a:(o=hl(e,t,s,s),o?(n.mode=16210,Fa):(n.havedict=1,Ha)))},inflateInfo:"pako inflate (from Nodeca project)"};var pl=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const fl=Object.prototype.toString,{Z_NO_FLUSH:bl,Z_FINISH:yl,Z_OK:gl,Z_STREAM_END:wl,Z_NEED_DICT:Zl,Z_STREAM_ERROR:vl,Z_DATA_ERROR:Xl,Z_MEM_ERROR:xl}=rr;function Ll(e){this.options=oa({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ua,this.strm.avail_out=0;let s=ml.inflateInit2(this.strm,t.windowBits);if(s!==gl)throw new Error(or[s]);if(this.header=new pl,ml.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=ca(t.dictionary):"[object ArrayBuffer]"===fl.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=ml.inflateSetDictionary(this.strm,t.dictionary),s!==gl)))throw new Error(or[s])}function Sl(e,t){const s=new Ll(t);if(s.push(e),s.err)throw s.msg||or[s.err];return s.result}Ll.prototype.push=function(e,t){const s=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let o,r,a;if(this.ended)return!1;for(r=t===~~t?t:!0===t?yl:bl,"[object ArrayBuffer]"===fl.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(n),s.next_out=0,s.avail_out=n),o=ml.inflate(s,r),o===Zl&&i&&(o=ml.inflateSetDictionary(s,i),o===gl?o=ml.inflate(s,r):o===Xl&&(o=Zl));s.avail_in>0&&o===wl&&s.state.wrap>0&&0!==e[s.next_in];)ml.inflateReset(s),o=ml.inflate(s,r);switch(o){case vl:case Xl:case Zl:case xl:return this.onEnd(o),this.ended=!0,!1}if(a=s.avail_out,s.next_out&&(0===s.avail_out||o===wl))if("string"===this.options.to){let e=ha(s.output,s.next_out),t=s.next_out-e,i=da(s.output,e);s.next_out=t,s.avail_out=n-t,t&&s.output.set(s.output.subarray(e,e+t),0),this.onData(i)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(o!==gl||0!==a){if(o===wl)return o=ml.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},Ll.prototype.onData=function(e){this.chunks.push(e)},Ll.prototype.onEnd=function(e){e===gl&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ra(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Gl={Inflate:Ll,inflate:Sl,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Sl(e,t)},ungzip:Sl};const{Deflate:Wl,deflate:Tl,deflateRaw:Cl,gzip:kl}=Sa,{Inflate:Pl,inflate:Rl,inflateRaw:Il,ungzip:Ml}=Gl;var Vl={Deflate:Wl,deflate:Tl,deflateRaw:Cl,gzip:kl,Inflate:Pl,inflate:Rl,inflateRaw:Il,ungzip:Ml,constants:rr};class Yl{constructor(){this.url="(offline)",this.readyState=WebSocket.CONNECTING,this.bufferedAmount=0,setTimeout((()=>{this.readyState=WebSocket.OPEN,this.onopen&&this.onopen()}),50),this.start=Date.now()}send(e){const{id:t,action:s,args:n}=JSON.parse(e);switch(s){case"JOIN":return this.id=t,this.ticks=n.ticks.tick,this.seq=-16>>>0,this.reply("SYNC",{messages:[],time:this.time,seq:this.seq,tove:n.tove,reflector:"offline"}),this.reply("RECV",[this.time,++this.seq,{what:"users",joined:[n.user],active:1,total:1}]),void this.tick();case"SEND":{const e=[...n];return e[0]=this.time,e[1]=++this.seq,void this.reply("RECV",e)}case"PULSE":return;default:throw Error("Offline unhandled "+s)}}close(e,t){this.readyState=WebSocket.CLOSING,setTimeout((()=>{this.readyState=WebSocket.CLOSED,this.onclose&&this.onclose({code:e,reason:t})}),50)}get time(){return Date.now()-this.start}tick(){clearInterval(this.ticker),this.ticker=setInterval((()=>{this.reply("TICK",{time:this.time})}),this.ticks)}reply(e,t){setTimeout((()=>{this.onmessage&&this.onmessage({data:JSON.stringify({id:this.id,action:e,args:t})})}),50)}}const Hl=!!globalThis.navigator?.userAgent.toLowerCase().includes("firefox");let Kl={get connection(){return Kl={connection:u.has("debug","connection",!1)},Kl.connection}};class Nl{static get name(){return`${ze.libName}WebRTCConnection`}constructor(e){var t;this.clientId=(t=4,Math.random().toString(36).substring(2,2+t)),Kl.connection&&console.log(`${this.clientId} WebRTCConnection created`),this.pc=null,this.dataChannel=null,this.signaling=null,this.connectionTypes={},this.onopen=null,this.onmessage=null,this.onerror=null,this.onclose=null,this.onconnected=null,this.twoStageConnection=!0,this.url="synchronizer",this.bufferedAmount=0,this.openConnection(e)}isConnecting(){return this.signaling?.readyState===WebSocket.OPEN}async openConnection(e){try{await this.openSignalingChannel(e),Kl.connection&&console.log(`${this.clientId} signaling ready`),this.onopen&&this.onopen(),await this.createPeerConnection(),Kl.connection&&console.log(`${this.clientId} peer connection created`),this.dataChannel=this.pc.createDataChannel(`client-${this.clientId}`),Kl.connection&&console.log(`${this.clientId} data channel created`),this.dataChannel.onopen=e=>this.onDataChannelOpen(e),this.dataChannel.onmessage=e=>this.onDataChannelMessage(e),this.dataChannel.onclosing=e=>this.onDataChannelClosing(e),this.dataChannel.onclose=e=>this.onDataChannelClose(e),this.dataChannel.onerror=e=>this.onDataChannelError(e);const t=await this.pc.createOffer();if(this.signaling?.readyState!==WebSocket.OPEN)return;if(this.negotiationTimeout=setTimeout((()=>{delete this.negotiationTimeout,this.dataChannelFlowing?this.signalingCloseScheduled||(Kl.connection&&console.log(`${this.clientId} ICE negotiation timed out but appears to have succeeded`),this.scheduleSignalingClose()):this.synchronizerDisconnected(4003,"ICE negotiation timed out")}),15e3),this.signalToSessionRunner({type:"offer",sdp:t.sdp}),await this.pc.setLocalDescription(t),!this.pc.sctp)return;const s=this.pc.sctp.transport.iceTransport;s.onselectedcandidatepairchange=e=>{Kl.connection&&console.log(`${this.clientId} ICE candidate pair changed`);const t=s.getSelectedCandidatePair();this.connectionTypes.local=t.local.type,this.connectionTypes.remote=t.remote.type,this.logConnectionState()}}catch(e){this.synchronizerDisconnected(e.code||4003,e.message)}}openSignalingChannel(e){return this.signaling?(console.warn(`${this.clientId} signaling channel already open`),Promise.resolve()):(this.synchronizerGatheringComplete=!1,this.localGatheringComplete=!1,this.dataChannelFlowing=!1,this.signalingCloseScheduled=!1,this.signalingKey=Math.random(),new Promise((t=>{this.signaling=new WebSocket(e),this.signaling.onopen=()=>{Kl.connection&&console.log(`${this.clientId} signaling socket opened`)},this.signaling.onmessage=e=>{const s=JSON.parse(e.data);if("READY"===s.what)return this.clientId+=`_${s.id}`,this.iceServers=s.iceServers,void t();if("ERROR"!==s.what)if(s.type)switch(Kl.connection&&console.log(`${this.clientId} received signal of type "${s.type}"`),s.type){case"answer":this.handleAnswer(s);break;case"candidate":this.handleCandidate(s);break;case"gathering-complete":this.synchronizerGatheringComplete=!0;break;default:Kl.connection&&console.log(`${this.clientId} unhandled: ${s.type}`)}else console.error(`${this.clientId} unexpected message: ${e.data}`);else console.error(`${this.clientId} registry error: ${s.reason}`)},this.signaling.onclose=e=>{Kl.connection&&console.log(`${this.clientId} signaling socket closed unexpectedly (${e.code})`),this.synchronizerDisconnected(e.code,e.reason)},this.signaling.onerror=e=>{Kl.connection&&console.log(`${this.clientId} signaling socket error`,e),this.synchronizerError()}})))}clearNegotiationTimeout(){this.negotiationTimeout&&(clearTimeout(this.negotiationTimeout),delete this.negotiationTimeout)}signalToSessionRunner(e){const t=JSON.stringify(e);try{this.signaling.send(t)}catch(e){console.error(`${this.clientId} WebRTC signaling send error`,e)}}async logConnectionState(){if(Hl&&this.pc)try{const e=await this.pc.getStats();if(e){let t=null;for(const s of e.values())if("transport"===s.type){t=s.selectedCandidatePairId;break}let s=e.get(t);if(!s)for(const t of e.values())if("candidate-pair"===t.type&&t.selected){s=t;break}s&&(this.connectionTypes.local=e.get(s.localCandidateId).candidateType,this.connectionTypes.remote=e.get(s.remoteCandidateId).candidateType)}}catch(e){}const e=this.connectionTypes.local||"",t=this.connectionTypes.remote||"";if(Kl.connection&&console.log(`${this.clientId} RTCDataChannel connection state: "${this.dataChannel.readyState}" (client connection="${e}"; synchronizer connection="${t}")`),this.signaling?.readyState===WebSocket.OPEN){const s={type:"selectedCandidatePair",clientType:e,syncType:t};this.signalToSessionRunner(s)}}close(e,t){this.cleanUpConnection()}synchronizerDisconnected(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1006,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"connection to synchronizer lost";this.synchronizerCloseReason&&(e=this.synchronizerCloseReason[0],t=this.synchronizerCloseReason[1]),this.cleanUpConnection(),this.onclose&&this.onclose({code:e,reason:t})}synchronizerError(e){this.onerror&&this.onerror(),this.synchronizerDisconnected(void 0,e)}cleanUpConnection(){this.closeSignalingChannel();const{pc:e}=this;e&&(this.pc=null,e.close(),clearInterval(this.peerConnectionStatsInterval)),this.dataChannel=null}closeSignalingChannel(){this.clearNegotiationTimeout(),this.signaling&&(this.signaling.onclose=null,this.signaling.onerror=null,this.signaling.close(),this.signaling=null)}async createPeerConnection(){const{iceServers:e}=this,t=new Set,s=this.pc=new globalThis.RTCPeerConnection({iceServers:e});s.onnegotiationneeded=e=>{s===this.pc&&Kl.connection&&console.log(`${this.clientId} negotiationneeded event fired`)},s.onsignalingstatechange=e=>{s===this.pc&&Kl.connection&&console.log(`${this.clientId} signaling state: "${s.signalingState}"`)},s.onconnectionstatechange=e=>{if(s!==this.pc)return;const{connectionState:t,iceConnectionState:n}=s;Kl.connection&&console.log(`${this.clientId} connection state: "${t}" (cf. ICE connection state: "${n}")`),"disconnected"!==t&&"failed"!==t||this.synchronizerDisconnected()},s.oniceconnectionstatechange=e=>{if(s!==this.pc)return;const t=s.iceConnectionState,n=this.dataChannel.readyState;Kl.connection&&console.log(`${this.clientId} ICE connection state: "${t}"; data channel: "${n}"`),"failed"===t&&this.synchronizerDisconnected(4003,"ICE negotiation failed")},s.onicegatheringstatechange=e=>{if(s!==this.pc)return;const t=s.iceGatheringState;Kl.connection&&console.log(`${this.clientId} ICE gathering state: "${t}"`),"complete"===t&&(this.localGatheringComplete=!0)},s.onicecandidate=e=>{if(s===this.pc)if(e.candidate){if(this.signaling?.readyState===WebSocket.OPEN){const t={type:"candidate",candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};this.signalToSessionRunner(t)}}else this.localGatheringComplete=!0},s.onicecandidateerror=e=>{if(s===this.pc&&Kl.connection){const s=`${e.errorCode}|${e.url}`;t.has(s)||(701===e.errorCode?console.log(`${this.clientId} ICE 701 warning on ${e.url}`):console.log(`${this.clientId} ICE error from ${e.url}: ${e.errorCode} ${e.errorText}`),t.add(s))}}}async handleAnswer(e){this.pc?await this.pc.setRemoteDescription(e):console.error("no peerconnection")}async handleCandidate(e){this.pc?e.candidate?await this.pc.addIceCandidate(e):await this.pc.addIceCandidate(null):console.error("no peerconnection")}send(e){this.dataChannel?this.dataChannel.send(e):console.warn(`${this.clientId} no data channel to send: ${e}`)}onDataChannelOpen(e){Kl.connection&&console.log(`${this.clientId} RTCDataChannel open`),this.onconnected&&this.onconnected(),this.logConnectionState()}onDataChannelMessage(e){if(!this.onmessage)return;this.dataChannelFlowing=!0,!this.signalingCloseScheduled&&this.synchronizerGatheringComplete&&this.localGatheringComplete&&(this.clearNegotiationTimeout(),this.scheduleSignalingClose());const t=e.data;if(t.startsWith("!ping"))this.send(t.replace("ping","pong"));else if(t.startsWith("!close")){const e=t.split("|");this.synchronizerCloseReason=[Number(e[1]),e[2]]}else this.onmessage(e)}onDataChannelError(e){console.error(`${this.clientId} RTCDataChannel error`,e),this.synchronizerError(e.errorDetail)}onDataChannelClosing(e){this.pc&&(Kl.connection&&console.log(`${this.clientId} data channel closing`),this.synchronizerDisconnected())}onDataChannelClose(e){this.pc&&(Kl.connection&&console.log(`${this.clientId} data channel closed`),this.synchronizerDisconnected())}scheduleSignalingClose(){this.signalingCloseScheduled=!0,Kl.connection&&console.log(`${this.clientId} signaling channel closure scheduled`);const{signalingKey:e}=this;setTimeout((()=>{e===this.signalingKey&&(Kl.connection&&console.log(`${this.clientId} closing signaling channel`),this.closeSignalingChannel())}),1e3)}async defunct_readConnectionType(){const e=await this.pc.getStats();if(e){let t=null;for(const[s,n]of e)if("transport"===n.type){t=n.selectedCandidatePairId;break}let s=e.get(t);if(!s)for(const[t,n]of e)if("candidate-pair"===n.type&&n.selected){s=n;break}if(s)for(const[t,n]of e)if(t===s.remoteCandidateId)return n.candidateType}return""}}function zl(e,t,s){var n=function(e){return atob(e)}(e),i=n.indexOf("\n",10)+1,o=n.substring(i)+"",r=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(r)}function _l(e,t,s){var n;return function(t){return n=n||zl(e),new Worker(n,t)}}var Fl=_l("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwovKioKICogQ29weXJpZ2h0IENyb3F1ZXQgTGFicyAyMDI1CiAqIEJ1bmRsZSBvZiBAY3JvcXVldC9jcm9xdWV0CiAqIERhdGU6IDIwMjUtMDYtMDUKICogVmVyc2lvbjogMi4wLjMKICovCgohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7dmFyIHQ9InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjp7fTtmdW5jdGlvbiBlKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGUmJk9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCJkZWZhdWx0Iik/dC5kZWZhdWx0OnR9dmFyIHIsbj17ZXhwb3J0czp7fX07cnx8KHI9MSxmdW5jdGlvbih0KXt2YXIgZT1mdW5jdGlvbih0KXt2YXIgZSxyPU9iamVjdC5wcm90b3R5cGUsbj1yLmhhc093blByb3BlcnR5LGk9T2JqZWN0LmRlZmluZVByb3BlcnR5fHxmdW5jdGlvbih0LGUscil7dFtlXT1yLnZhbHVlfSxhPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2w/U3ltYm9sOnt9LHM9YS5pdGVyYXRvcnx8IkBAaXRlcmF0b3IiLG89YS5hc3luY0l0ZXJhdG9yfHwiQEBhc3luY0l0ZXJhdG9yIixsPWEudG9TdHJpbmdUYWd8fCJAQHRvU3RyaW5nVGFnIjtmdW5jdGlvbiBoKHQsZSxyKXtyZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsZSx7dmFsdWU6cixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pLHRbZV19dHJ5e2goe30sIiIpfWNhdGNoKHQpe2g9ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0W2VdPXJ9fWZ1bmN0aW9uIGModCxlLHIsbil7dmFyIGE9ZSYmZS5wcm90b3R5cGUgaW5zdGFuY2VvZiB5P2U6eSxzPU9iamVjdC5jcmVhdGUoYS5wcm90b3R5cGUpLG89bmV3IE8obnx8W10pO3JldHVybiBpKHMsIl9pbnZva2UiLHt2YWx1ZTpFKHQscixvKX0pLHN9ZnVuY3Rpb24gdSh0LGUscil7dHJ5e3JldHVybnt0eXBlOiJub3JtYWwiLGFyZzp0LmNhbGwoZSxyKX19Y2F0Y2godCl7cmV0dXJue3R5cGU6InRocm93Iixhcmc6dH19fXQud3JhcD1jO3ZhciBfPSJzdXNwZW5kZWRTdGFydCIsZD0ic3VzcGVuZGVkWWllbGQiLGY9ImV4ZWN1dGluZyIscD0iY29tcGxldGVkIixnPXt9O2Z1bmN0aW9uIHkoKXt9ZnVuY3Rpb24gdygpe31mdW5jdGlvbiB2KCl7fXZhciBtPXt9O2gobSxzLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpO3ZhciBiPU9iamVjdC5nZXRQcm90b3R5cGVPZix4PWImJmIoYihSKFtdKSkpO3gmJnghPT1yJiZuLmNhbGwoeCxzKSYmKG09eCk7dmFyIGs9di5wcm90b3R5cGU9eS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShtKTtmdW5jdGlvbiB6KHQpe1sibmV4dCIsInRocm93IiwicmV0dXJuIl0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7aCh0LGUsKGZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9pbnZva2UoZSx0KX0pKX0pKX1mdW5jdGlvbiBBKHQsZSl7ZnVuY3Rpb24gcihpLGEscyxvKXt2YXIgbD11KHRbaV0sdCxhKTtpZigidGhyb3ciIT09bC50eXBlKXt2YXIgaD1sLmFyZyxjPWgudmFsdWU7cmV0dXJuIGMmJiJvYmplY3QiPT10eXBlb2YgYyYmbi5jYWxsKGMsIl9fYXdhaXQiKT9lLnJlc29sdmUoYy5fX2F3YWl0KS50aGVuKChmdW5jdGlvbih0KXtyKCJuZXh0Iix0LHMsbyl9KSwoZnVuY3Rpb24odCl7cigidGhyb3ciLHQscyxvKX0pKTplLnJlc29sdmUoYykudGhlbigoZnVuY3Rpb24odCl7aC52YWx1ZT10LHMoaCl9KSwoZnVuY3Rpb24odCl7cmV0dXJuIHIoInRocm93Iix0LHMsbyl9KSl9byhsLmFyZyl9dmFyIGE7aSh0aGlzLCJfaW52b2tlIix7dmFsdWU6ZnVuY3Rpb24odCxuKXtmdW5jdGlvbiBpKCl7cmV0dXJuIG5ldyBlKChmdW5jdGlvbihlLGkpe3IodCxuLGUsaSl9KSl9cmV0dXJuIGE9YT9hLnRoZW4oaSxpKTppKCl9fSl9ZnVuY3Rpb24gRSh0LHIsbil7dmFyIGk9XztyZXR1cm4gZnVuY3Rpb24oYSxzKXtpZihpPT09Zil0aHJvdyBuZXcgRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmciKTtpZihpPT09cCl7aWYoInRocm93Ij09PWEpdGhyb3cgcztyZXR1cm57dmFsdWU6ZSxkb25lOiEwfX1mb3Iobi5tZXRob2Q9YSxuLmFyZz1zOzspe3ZhciBvPW4uZGVsZWdhdGU7aWYobyl7dmFyIGw9UyhvLG4pO2lmKGwpe2lmKGw9PT1nKWNvbnRpbnVlO3JldHVybiBsfX1pZigibmV4dCI9PT1uLm1ldGhvZCluLnNlbnQ9bi5fc2VudD1uLmFyZztlbHNlIGlmKCJ0aHJvdyI9PT1uLm1ldGhvZCl7aWYoaT09PV8pdGhyb3cgaT1wLG4uYXJnO24uZGlzcGF0Y2hFeGNlcHRpb24obi5hcmcpfWVsc2UicmV0dXJuIj09PW4ubWV0aG9kJiZuLmFicnVwdCgicmV0dXJuIixuLmFyZyk7aT1mO3ZhciBoPXUodCxyLG4pO2lmKCJub3JtYWwiPT09aC50eXBlKXtpZihpPW4uZG9uZT9wOmQsaC5hcmc9PT1nKWNvbnRpbnVlO3JldHVybnt2YWx1ZTpoLmFyZyxkb25lOm4uZG9uZX19InRocm93Ij09PWgudHlwZSYmKGk9cCxuLm1ldGhvZD0idGhyb3ciLG4uYXJnPWguYXJnKX19fWZ1bmN0aW9uIFModCxyKXt2YXIgbj1yLm1ldGhvZCxpPXQuaXRlcmF0b3Jbbl07aWYoaT09PWUpcmV0dXJuIHIuZGVsZWdhdGU9bnVsbCwidGhyb3ciPT09biYmdC5pdGVyYXRvci5yZXR1cm4mJihyLm1ldGhvZD0icmV0dXJuIixyLmFyZz1lLFModCxyKSwidGhyb3ciPT09ci5tZXRob2QpfHwicmV0dXJuIiE9PW4mJihyLm1ldGhvZD0idGhyb3ciLHIuYXJnPW5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIrbisiJyBtZXRob2QiKSksZzt2YXIgYT11KGksdC5pdGVyYXRvcixyLmFyZyk7aWYoInRocm93Ij09PWEudHlwZSlyZXR1cm4gci5tZXRob2Q9InRocm93IixyLmFyZz1hLmFyZyxyLmRlbGVnYXRlPW51bGwsZzt2YXIgcz1hLmFyZztyZXR1cm4gcz9zLmRvbmU/KHJbdC5yZXN1bHROYW1lXT1zLnZhbHVlLHIubmV4dD10Lm5leHRMb2MsInJldHVybiIhPT1yLm1ldGhvZCYmKHIubWV0aG9kPSJuZXh0IixyLmFyZz1lKSxyLmRlbGVnYXRlPW51bGwsZyk6czooci5tZXRob2Q9InRocm93IixyLmFyZz1uZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLHIuZGVsZWdhdGU9bnVsbCxnKX1mdW5jdGlvbiBCKHQpe3ZhciBlPXt0cnlMb2M6dFswXX07MSBpbiB0JiYoZS5jYXRjaExvYz10WzFdKSwyIGluIHQmJihlLmZpbmFsbHlMb2M9dFsyXSxlLmFmdGVyTG9jPXRbM10pLHRoaXMudHJ5RW50cmllcy5wdXNoKGUpfWZ1bmN0aW9uIEwodCl7dmFyIGU9dC5jb21wbGV0aW9ufHx7fTtlLnR5cGU9Im5vcm1hbCIsZGVsZXRlIGUuYXJnLHQuY29tcGxldGlvbj1lfWZ1bmN0aW9uIE8odCl7dGhpcy50cnlFbnRyaWVzPVt7dHJ5TG9jOiJyb290In1dLHQuZm9yRWFjaChCLHRoaXMpLHRoaXMucmVzZXQoITApfWZ1bmN0aW9uIFIodCl7aWYobnVsbCE9dCl7dmFyIHI9dFtzXTtpZihyKXJldHVybiByLmNhbGwodCk7aWYoImZ1bmN0aW9uIj09dHlwZW9mIHQubmV4dClyZXR1cm4gdDtpZighaXNOYU4odC5sZW5ndGgpKXt2YXIgaT0tMSxhPWZ1bmN0aW9uIHIoKXtmb3IoOysraTx0Lmxlbmd0aDspaWYobi5jYWxsKHQsaSkpcmV0dXJuIHIudmFsdWU9dFtpXSxyLmRvbmU9ITEscjtyZXR1cm4gci52YWx1ZT1lLHIuZG9uZT0hMCxyfTtyZXR1cm4gYS5uZXh0PWF9fXRocm93IG5ldyBUeXBlRXJyb3IodHlwZW9mIHQrIiBpcyBub3QgaXRlcmFibGUiKX1yZXR1cm4gdy5wcm90b3R5cGU9dixpKGssImNvbnN0cnVjdG9yIix7dmFsdWU6dixjb25maWd1cmFibGU6ITB9KSxpKHYsImNvbnN0cnVjdG9yIix7dmFsdWU6dyxjb25maWd1cmFibGU6ITB9KSx3LmRpc3BsYXlOYW1lPWgodixsLCJHZW5lcmF0b3JGdW5jdGlvbiIpLHQuaXNHZW5lcmF0b3JGdW5jdGlvbj1mdW5jdGlvbih0KXt2YXIgZT0iZnVuY3Rpb24iPT10eXBlb2YgdCYmdC5jb25zdHJ1Y3RvcjtyZXR1cm4hIWUmJihlPT09d3x8IkdlbmVyYXRvckZ1bmN0aW9uIj09PShlLmRpc3BsYXlOYW1lfHxlLm5hbWUpKX0sdC5tYXJrPWZ1bmN0aW9uKHQpe3JldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsdik6KHQuX19wcm90b19fPXYsaCh0LGwsIkdlbmVyYXRvckZ1bmN0aW9uIikpLHQucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoayksdH0sdC5hd3JhcD1mdW5jdGlvbih0KXtyZXR1cm57X19hd2FpdDp0fX0seihBLnByb3RvdHlwZSksaChBLnByb3RvdHlwZSxvLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpLHQuQXN5bmNJdGVyYXRvcj1BLHQuYXN5bmM9ZnVuY3Rpb24oZSxyLG4saSxhKXt2b2lkIDA9PT1hJiYoYT1Qcm9taXNlKTt2YXIgcz1uZXcgQShjKGUscixuLGkpLGEpO3JldHVybiB0LmlzR2VuZXJhdG9yRnVuY3Rpb24ocik/czpzLm5leHQoKS50aGVuKChmdW5jdGlvbih0KXtyZXR1cm4gdC5kb25lP3QudmFsdWU6cy5uZXh0KCl9KSl9LHooayksaChrLGwsIkdlbmVyYXRvciIpLGgoayxzLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpLGgoaywidG9TdHJpbmciLChmdW5jdGlvbigpe3JldHVybiJbb2JqZWN0IEdlbmVyYXRvcl0ifSkpLHQua2V5cz1mdW5jdGlvbih0KXt2YXIgZT1PYmplY3QodCkscj1bXTtmb3IodmFyIG4gaW4gZSlyLnB1c2gobik7cmV0dXJuIHIucmV2ZXJzZSgpLGZ1bmN0aW9uIHQoKXtmb3IoO3IubGVuZ3RoOyl7dmFyIG49ci5wb3AoKTtpZihuIGluIGUpcmV0dXJuIHQudmFsdWU9bix0LmRvbmU9ITEsdH1yZXR1cm4gdC5kb25lPSEwLHR9fSx0LnZhbHVlcz1SLE8ucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjpPLHJlc2V0OmZ1bmN0aW9uKHQpe2lmKHRoaXMucHJldj0wLHRoaXMubmV4dD0wLHRoaXMuc2VudD10aGlzLl9zZW50PWUsdGhpcy5kb25lPSExLHRoaXMuZGVsZWdhdGU9bnVsbCx0aGlzLm1ldGhvZD0ibmV4dCIsdGhpcy5hcmc9ZSx0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChMKSwhdClmb3IodmFyIHIgaW4gdGhpcykidCI9PT1yLmNoYXJBdCgwKSYmbi5jYWxsKHRoaXMscikmJiFpc05hTigrci5zbGljZSgxKSkmJih0aGlzW3JdPWUpfSxzdG9wOmZ1bmN0aW9uKCl7dGhpcy5kb25lPSEwO3ZhciB0PXRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmKCJ0aHJvdyI9PT10LnR5cGUpdGhyb3cgdC5hcmc7cmV0dXJuIHRoaXMucnZhbH0sZGlzcGF0Y2hFeGNlcHRpb246ZnVuY3Rpb24odCl7aWYodGhpcy5kb25lKXRocm93IHQ7dmFyIHI9dGhpcztmdW5jdGlvbiBpKG4saSl7cmV0dXJuIG8udHlwZT0idGhyb3ciLG8uYXJnPXQsci5uZXh0PW4saSYmKHIubWV0aG9kPSJuZXh0IixyLmFyZz1lKSwhIWl9Zm9yKHZhciBhPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTthPj0wOy0tYSl7dmFyIHM9dGhpcy50cnlFbnRyaWVzW2FdLG89cy5jb21wbGV0aW9uO2lmKCJyb290Ij09PXMudHJ5TG9jKXJldHVybiBpKCJlbmQiKTtpZihzLnRyeUxvYzw9dGhpcy5wcmV2KXt2YXIgbD1uLmNhbGwocywiY2F0Y2hMb2MiKSxoPW4uY2FsbChzLCJmaW5hbGx5TG9jIik7aWYobCYmaCl7aWYodGhpcy5wcmV2PHMuY2F0Y2hMb2MpcmV0dXJuIGkocy5jYXRjaExvYywhMCk7aWYodGhpcy5wcmV2PHMuZmluYWxseUxvYylyZXR1cm4gaShzLmZpbmFsbHlMb2MpfWVsc2UgaWYobCl7aWYodGhpcy5wcmV2PHMuY2F0Y2hMb2MpcmV0dXJuIGkocy5jYXRjaExvYywhMCl9ZWxzZXtpZighaCl0aHJvdyBuZXcgRXJyb3IoInRyeSBzdGF0ZW1lbnQgd2l0aG91dCBjYXRjaCBvciBmaW5hbGx5Iik7aWYodGhpcy5wcmV2PHMuZmluYWxseUxvYylyZXR1cm4gaShzLmZpbmFsbHlMb2MpfX19fSxhYnJ1cHQ6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO3I+PTA7LS1yKXt2YXIgaT10aGlzLnRyeUVudHJpZXNbcl07aWYoaS50cnlMb2M8PXRoaXMucHJldiYmbi5jYWxsKGksImZpbmFsbHlMb2MiKSYmdGhpcy5wcmV2PGkuZmluYWxseUxvYyl7dmFyIGE9aTticmVha319YSYmKCJicmVhayI9PT10fHwiY29udGludWUiPT09dCkmJmEudHJ5TG9jPD1lJiZlPD1hLmZpbmFsbHlMb2MmJihhPW51bGwpO3ZhciBzPWE/YS5jb21wbGV0aW9uOnt9O3JldHVybiBzLnR5cGU9dCxzLmFyZz1lLGE/KHRoaXMubWV0aG9kPSJuZXh0Iix0aGlzLm5leHQ9YS5maW5hbGx5TG9jLGcpOnRoaXMuY29tcGxldGUocyl9LGNvbXBsZXRlOmZ1bmN0aW9uKHQsZSl7aWYoInRocm93Ij09PXQudHlwZSl0aHJvdyB0LmFyZztyZXR1cm4iYnJlYWsiPT09dC50eXBlfHwiY29udGludWUiPT09dC50eXBlP3RoaXMubmV4dD10LmFyZzoicmV0dXJuIj09PXQudHlwZT8odGhpcy5ydmFsPXRoaXMuYXJnPXQuYXJnLHRoaXMubWV0aG9kPSJyZXR1cm4iLHRoaXMubmV4dD0iZW5kIik6Im5vcm1hbCI9PT10LnR5cGUmJmUmJih0aGlzLm5leHQ9ZSksZ30sZmluaXNoOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10aGlzLnRyeUVudHJpZXMubGVuZ3RoLTE7ZT49MDstLWUpe3ZhciByPXRoaXMudHJ5RW50cmllc1tlXTtpZihyLmZpbmFsbHlMb2M9PT10KXJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbixyLmFmdGVyTG9jKSxMKHIpLGd9fSxjYXRjaDpmdW5jdGlvbih0KXtmb3IodmFyIGU9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO2U+PTA7LS1lKXt2YXIgcj10aGlzLnRyeUVudHJpZXNbZV07aWYoci50cnlMb2M9PT10KXt2YXIgbj1yLmNvbXBsZXRpb247aWYoInRocm93Ij09PW4udHlwZSl7dmFyIGk9bi5hcmc7TChyKX1yZXR1cm4gaX19dGhyb3cgbmV3IEVycm9yKCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHQiKX0sZGVsZWdhdGVZaWVsZDpmdW5jdGlvbih0LHIsbil7cmV0dXJuIHRoaXMuZGVsZWdhdGU9e2l0ZXJhdG9yOlIodCkscmVzdWx0TmFtZTpyLG5leHRMb2M6bn0sIm5leHQiPT09dGhpcy5tZXRob2QmJih0aGlzLmFyZz1lKSxnfX0sdH0odC5leHBvcnRzKTt0cnl7Z2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWU9ZX1jYXRjaCh0KXsib2JqZWN0Ij09dHlwZW9mIGdsb2JhbFRoaXM/Z2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWU9ZTpGdW5jdGlvbigiciIsInJlZ2VuZXJhdG9yUnVudGltZSA9IHIiKShlKX19KG4pKTt2YXIgaSxhPXtleHBvcnRzOnt9fTt2YXIgcz0oaXx8KGk9MSxmdW5jdGlvbih0KXtjb25zdCBlPTQscj0wLG49MSxpPTI7ZnVuY3Rpb24gYSh0KXtsZXQgZT10Lmxlbmd0aDtmb3IoOy0tZT49MDspdFtlXT0wfWNvbnN0IHM9MCxvPTEsbD0yLGg9MyxjPTI1OCx1PTI5LF89MjU2LGQ9XysxK3UsZj0zMCxwPTE5LGc9MipkKzEseT0xNSx3PTE2LHY9NyxtPTI1NixiPTE2LHg9MTcsaz0xOCx6PW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMSwxLDEsMSwyLDIsMiwyLDMsMywzLDMsNCw0LDQsNCw1LDUsNSw1LDBdKSxBPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDEsMSwyLDIsMywzLDQsNCw1LDUsNiw2LDcsNyw4LDgsOSw5LDEwLDEwLDExLDExLDEyLDEyLDEzLDEzXSksRT1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyLDMsN10pLFM9bmV3IFVpbnQ4QXJyYXkoWzE2LDE3LDE4LDAsOCw3LDksNiwxMCw1LDExLDQsMTIsMywxMywyLDE0LDEsMTVdKSxCPTUxMixMPW5ldyBBcnJheSgyKihkKzIpKTthKEwpO2NvbnN0IE89bmV3IEFycmF5KDIqZik7YShPKTtjb25zdCBSPW5ldyBBcnJheShCKTthKFIpO2NvbnN0IEQ9bmV3IEFycmF5KGMtaCsxKTthKEQpO2NvbnN0IFU9bmV3IEFycmF5KHUpO2EoVSk7Y29uc3QgQz1uZXcgQXJyYXkoZik7ZnVuY3Rpb24gVCh0LGUscixuLGkpe3RoaXMuc3RhdGljX3RyZWU9dCx0aGlzLmV4dHJhX2JpdHM9ZSx0aGlzLmV4dHJhX2Jhc2U9cix0aGlzLmVsZW1zPW4sdGhpcy5tYXhfbGVuZ3RoPWksdGhpcy5oYXNfc3RyZWU9dCYmdC5sZW5ndGh9bGV0IEYsSCxaO2Z1bmN0aW9uIE0odCxlKXt0aGlzLmR5bl90cmVlPXQsdGhpcy5tYXhfY29kZT0wLHRoaXMuc3RhdF9kZXNjPWV9YShDKTtjb25zdCBOPXQ9PnQ8MjU2P1JbdF06UlsyNTYrKHQ+Pj43KV0sST0odCxlKT0+e3QucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPTI1NSZlLHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPWU+Pj44JjI1NX0sUD0odCxlLHIpPT57dC5iaV92YWxpZD53LXI/KHQuYmlfYnVmfD1lPDx0LmJpX3ZhbGlkJjY1NTM1LEkodCx0LmJpX2J1ZiksdC5iaV9idWY9ZT4+dy10LmJpX3ZhbGlkLHQuYmlfdmFsaWQrPXItdyk6KHQuYmlfYnVmfD1lPDx0LmJpX3ZhbGlkJjY1NTM1LHQuYmlfdmFsaWQrPXIpfSxqPSh0LGUscik9PntQKHQsclsyKmVdLHJbMiplKzFdKX0sJD0odCxlKT0+e2xldCByPTA7ZG97cnw9MSZ0LHQ+Pj49MSxyPDw9MX13aGlsZSgtLWU+MCk7cmV0dXJuIHI+Pj4xfSxLPXQ9PnsxNj09PXQuYmlfdmFsaWQ/KEkodCx0LmJpX2J1ZiksdC5iaV9idWY9MCx0LmJpX3ZhbGlkPTApOnQuYmlfdmFsaWQ+PTgmJih0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmdC5iaV9idWYsdC5iaV9idWY+Pj04LHQuYmlfdmFsaWQtPTgpfSxYPSh0LGUpPT57Y29uc3Qgcj1lLmR5bl90cmVlLG49ZS5tYXhfY29kZSxpPWUuc3RhdF9kZXNjLnN0YXRpY190cmVlLGE9ZS5zdGF0X2Rlc2MuaGFzX3N0cmVlLHM9ZS5zdGF0X2Rlc2MuZXh0cmFfYml0cyxvPWUuc3RhdF9kZXNjLmV4dHJhX2Jhc2UsbD1lLnN0YXRfZGVzYy5tYXhfbGVuZ3RoO2xldCBoLGMsdSxfLGQsZixwPTA7Zm9yKF89MDtfPD15O18rKyl0LmJsX2NvdW50W19dPTA7Zm9yKHJbMip0LmhlYXBbdC5oZWFwX21heF0rMV09MCxoPXQuaGVhcF9tYXgrMTtoPGc7aCsrKWM9dC5oZWFwW2hdLF89clsyKnJbMipjKzFdKzFdKzEsXz5sJiYoXz1sLHArKyksclsyKmMrMV09XyxjPm58fCh0LmJsX2NvdW50W19dKyssZD0wLGM+PW8mJihkPXNbYy1vXSksZj1yWzIqY10sdC5vcHRfbGVuKz1mKihfK2QpLGEmJih0LnN0YXRpY19sZW4rPWYqKGlbMipjKzFdK2QpKSk7aWYoMCE9PXApe2Rve2ZvcihfPWwtMTswPT09dC5ibF9jb3VudFtfXTspXy0tO3QuYmxfY291bnRbX10tLSx0LmJsX2NvdW50W18rMV0rPTIsdC5ibF9jb3VudFtsXS0tLHAtPTJ9d2hpbGUocD4wKTtmb3IoXz1sOzAhPT1fO18tLSlmb3IoYz10LmJsX2NvdW50W19dOzAhPT1jOyl1PXQuaGVhcFstLWhdLHU+bnx8KHJbMip1KzFdIT09XyYmKHQub3B0X2xlbis9KF8tclsyKnUrMV0pKnJbMip1XSxyWzIqdSsxXT1fKSxjLS0pfX0sRz0odCxlLHIpPT57Y29uc3Qgbj1uZXcgQXJyYXkoeSsxKTtsZXQgaSxhLHM9MDtmb3IoaT0xO2k8PXk7aSsrKXM9cytyW2ktMV08PDEsbltpXT1zO2ZvcihhPTA7YTw9ZTthKyspe2xldCBlPXRbMiphKzFdOzAhPT1lJiYodFsyKmFdPSQobltlXSsrLGUpKX19LFc9KCk9PntsZXQgdCxlLHIsbixpO2NvbnN0IGE9bmV3IEFycmF5KHkrMSk7Zm9yKHI9MCxuPTA7bjx1LTE7bisrKWZvcihVW25dPXIsdD0wO3Q8MTw8eltuXTt0KyspRFtyKytdPW47Zm9yKERbci0xXT1uLGk9MCxuPTA7bjwxNjtuKyspZm9yKENbbl09aSx0PTA7dDwxPDxBW25dO3QrKylSW2krK109bjtmb3IoaT4+PTc7bjxmO24rKylmb3IoQ1tuXT1pPDw3LHQ9MDt0PDE8PEFbbl0tNzt0KyspUlsyNTYraSsrXT1uO2ZvcihlPTA7ZTw9eTtlKyspYVtlXT0wO2Zvcih0PTA7dDw9MTQzOylMWzIqdCsxXT04LHQrKyxhWzhdKys7Zm9yKDt0PD0yNTU7KUxbMip0KzFdPTksdCsrLGFbOV0rKztmb3IoO3Q8PTI3OTspTFsyKnQrMV09Nyx0KyssYVs3XSsrO2Zvcig7dDw9Mjg3OylMWzIqdCsxXT04LHQrKyxhWzhdKys7Zm9yKEcoTCxkKzEsYSksdD0wO3Q8Zjt0KyspT1syKnQrMV09NSxPWzIqdF09JCh0LDUpO0Y9bmV3IFQoTCx6LF8rMSxkLHkpLEg9bmV3IFQoTyxBLDAsZix5KSxaPW5ldyBUKG5ldyBBcnJheSgwKSxFLDAscCx2KX0sWT10PT57bGV0IGU7Zm9yKGU9MDtlPGQ7ZSsrKXQuZHluX2x0cmVlWzIqZV09MDtmb3IoZT0wO2U8ZjtlKyspdC5keW5fZHRyZWVbMiplXT0wO2ZvcihlPTA7ZTxwO2UrKyl0LmJsX3RyZWVbMiplXT0wO3QuZHluX2x0cmVlWzIqbV09MSx0Lm9wdF9sZW49dC5zdGF0aWNfbGVuPTAsdC5zeW1fbmV4dD10Lm1hdGNoZXM9MH0scT10PT57dC5iaV92YWxpZD44P0kodCx0LmJpX2J1Zik6dC5iaV92YWxpZD4wJiYodC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109dC5iaV9idWYpLHQuYmlfYnVmPTAsdC5iaV92YWxpZD0wfSxWPSh0LGUscixuKT0+e2NvbnN0IGk9MiplLGE9MipyO3JldHVybiB0W2ldPHRbYV18fHRbaV09PT10W2FdJiZuW2VdPD1uW3JdfSxRPSh0LGUscik9Pntjb25zdCBuPXQuaGVhcFtyXTtsZXQgaT1yPDwxO2Zvcig7aTw9dC5oZWFwX2xlbiYmKGk8dC5oZWFwX2xlbiYmVihlLHQuaGVhcFtpKzFdLHQuaGVhcFtpXSx0LmRlcHRoKSYmaSsrLCFWKGUsbix0LmhlYXBbaV0sdC5kZXB0aCkpOyl0LmhlYXBbcl09dC5oZWFwW2ldLHI9aSxpPDw9MTt0LmhlYXBbcl09bn0sSj0odCxlLHIpPT57bGV0IG4saSxhLHMsbz0wO2lmKDAhPT10LnN5bV9uZXh0KWRve249MjU1JnQucGVuZGluZ19idWZbdC5zeW1fYnVmK28rK10sbis9KDI1NSZ0LnBlbmRpbmdfYnVmW3Quc3ltX2J1ZitvKytdKTw8OCxpPXQucGVuZGluZ19idWZbdC5zeW1fYnVmK28rK10sMD09PW4/aih0LGksZSk6KGE9RFtpXSxqKHQsYStfKzEsZSkscz16W2FdLDAhPT1zJiYoaS09VVthXSxQKHQsaSxzKSksbi0tLGE9TihuKSxqKHQsYSxyKSxzPUFbYV0sMCE9PXMmJihuLT1DW2FdLFAodCxuLHMpKSl9d2hpbGUobzx0LnN5bV9uZXh0KTtqKHQsbSxlKX0sdHQ9KHQsZSk9Pntjb25zdCByPWUuZHluX3RyZWUsbj1lLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSxpPWUuc3RhdF9kZXNjLmhhc19zdHJlZSxhPWUuc3RhdF9kZXNjLmVsZW1zO2xldCBzLG8sbCxoPS0xO2Zvcih0LmhlYXBfbGVuPTAsdC5oZWFwX21heD1nLHM9MDtzPGE7cysrKTAhPT1yWzIqc10/KHQuaGVhcFsrK3QuaGVhcF9sZW5dPWg9cyx0LmRlcHRoW3NdPTApOnJbMipzKzFdPTA7Zm9yKDt0LmhlYXBfbGVuPDI7KWw9dC5oZWFwWysrdC5oZWFwX2xlbl09aDwyPysraDowLHJbMipsXT0xLHQuZGVwdGhbbF09MCx0Lm9wdF9sZW4tLSxpJiYodC5zdGF0aWNfbGVuLT1uWzIqbCsxXSk7Zm9yKGUubWF4X2NvZGU9aCxzPXQuaGVhcF9sZW4+PjE7cz49MTtzLS0pUSh0LHIscyk7bD1hO2Rve3M9dC5oZWFwWzFdLHQuaGVhcFsxXT10LmhlYXBbdC5oZWFwX2xlbi0tXSxRKHQsciwxKSxvPXQuaGVhcFsxXSx0LmhlYXBbLS10LmhlYXBfbWF4XT1zLHQuaGVhcFstLXQuaGVhcF9tYXhdPW8sclsyKmxdPXJbMipzXStyWzIqb10sdC5kZXB0aFtsXT0odC5kZXB0aFtzXT49dC5kZXB0aFtvXT90LmRlcHRoW3NdOnQuZGVwdGhbb10pKzEsclsyKnMrMV09clsyKm8rMV09bCx0LmhlYXBbMV09bCsrLFEodCxyLDEpfXdoaWxlKHQuaGVhcF9sZW4+PTIpO3QuaGVhcFstLXQuaGVhcF9tYXhdPXQuaGVhcFsxXSxYKHQsZSksRyhyLGgsdC5ibF9jb3VudCl9LGV0PSh0LGUscik9PntsZXQgbixpLGE9LTEscz1lWzFdLG89MCxsPTcsaD00O2ZvcigwPT09cyYmKGw9MTM4LGg9MyksZVsyKihyKzEpKzFdPTY1NTM1LG49MDtuPD1yO24rKylpPXMscz1lWzIqKG4rMSkrMV0sKytvPGwmJmk9PT1zfHwobzxoP3QuYmxfdHJlZVsyKmldKz1vOjAhPT1pPyhpIT09YSYmdC5ibF90cmVlWzIqaV0rKyx0LmJsX3RyZWVbMipiXSsrKTpvPD0xMD90LmJsX3RyZWVbMip4XSsrOnQuYmxfdHJlZVsyKmtdKyssbz0wLGE9aSwwPT09cz8obD0xMzgsaD0zKTppPT09cz8obD02LGg9Myk6KGw9NyxoPTQpKX0scnQ9KHQsZSxyKT0+e2xldCBuLGksYT0tMSxzPWVbMV0sbz0wLGw9NyxoPTQ7Zm9yKDA9PT1zJiYobD0xMzgsaD0zKSxuPTA7bjw9cjtuKyspaWYoaT1zLHM9ZVsyKihuKzEpKzFdLCEoKytvPGwmJmk9PT1zKSl7aWYobzxoKWRve2oodCxpLHQuYmxfdHJlZSl9d2hpbGUoMCE9LS1vKTtlbHNlIDAhPT1pPyhpIT09YSYmKGoodCxpLHQuYmxfdHJlZSksby0tKSxqKHQsYix0LmJsX3RyZWUpLFAodCxvLTMsMikpOm88PTEwPyhqKHQseCx0LmJsX3RyZWUpLFAodCxvLTMsMykpOihqKHQsayx0LmJsX3RyZWUpLFAodCxvLTExLDcpKTtvPTAsYT1pLDA9PT1zPyhsPTEzOCxoPTMpOmk9PT1zPyhsPTYsaD0zKToobD03LGg9NCl9fSxudD10PT57bGV0IGU7Zm9yKGV0KHQsdC5keW5fbHRyZWUsdC5sX2Rlc2MubWF4X2NvZGUpLGV0KHQsdC5keW5fZHRyZWUsdC5kX2Rlc2MubWF4X2NvZGUpLHR0KHQsdC5ibF9kZXNjKSxlPXAtMTtlPj0zJiYwPT09dC5ibF90cmVlWzIqU1tlXSsxXTtlLS0pO3JldHVybiB0Lm9wdF9sZW4rPTMqKGUrMSkrNSs1KzQsZX0saXQ9KHQsZSxyLG4pPT57bGV0IGk7Zm9yKFAodCxlLTI1Nyw1KSxQKHQsci0xLDUpLFAodCxuLTQsNCksaT0wO2k8bjtpKyspUCh0LHQuYmxfdHJlZVsyKlNbaV0rMV0sMyk7cnQodCx0LmR5bl9sdHJlZSxlLTEpLHJ0KHQsdC5keW5fZHRyZWUsci0xKX0sYXQ9dD0+e2xldCBlLGk9NDA5MzYyNDQ0Nztmb3IoZT0wO2U8PTMxO2UrKyxpPj4+PTEpaWYoMSZpJiYwIT09dC5keW5fbHRyZWVbMiplXSlyZXR1cm4gcjtpZigwIT09dC5keW5fbHRyZWVbMThdfHwwIT09dC5keW5fbHRyZWVbMjBdfHwwIT09dC5keW5fbHRyZWVbMjZdKXJldHVybiBuO2ZvcihlPTMyO2U8XztlKyspaWYoMCE9PXQuZHluX2x0cmVlWzIqZV0pcmV0dXJuIG47cmV0dXJuIHJ9O2xldCBzdD0hMTtjb25zdCBvdD0odCxlLHIsbik9PntQKHQsKHM8PDEpKyhuPzE6MCksMykscSh0KSxJKHQsciksSSh0LH5yKSxyJiZ0LnBlbmRpbmdfYnVmLnNldCh0LndpbmRvdy5zdWJhcnJheShlLGUrciksdC5wZW5kaW5nKSx0LnBlbmRpbmcrPXJ9LGx0PSh0LHIsbixhKT0+e2xldCBzLGgsYz0wO3QubGV2ZWw+MD8odC5zdHJtLmRhdGFfdHlwZT09PWkmJih0LnN0cm0uZGF0YV90eXBlPWF0KHQpKSx0dCh0LHQubF9kZXNjKSx0dCh0LHQuZF9kZXNjKSxjPW50KHQpLHM9dC5vcHRfbGVuKzMrNz4+PjMsaD10LnN0YXRpY19sZW4rMys3Pj4+MyxoPD1zJiYocz1oKSk6cz1oPW4rNSxuKzQ8PXMmJi0xIT09cj9vdCh0LHIsbixhKTp0LnN0cmF0ZWd5PT09ZXx8aD09PXM/KFAodCwobzw8MSkrKGE/MTowKSwzKSxKKHQsTCxPKSk6KFAodCwobDw8MSkrKGE/MTowKSwzKSxpdCh0LHQubF9kZXNjLm1heF9jb2RlKzEsdC5kX2Rlc2MubWF4X2NvZGUrMSxjKzEpLEoodCx0LmR5bl9sdHJlZSx0LmR5bl9kdHJlZSkpLFkodCksYSYmcSh0KX07dmFyIGh0PXtfdHJfaW5pdDp0PT57c3R8fChXKCksc3Q9ITApLHQubF9kZXNjPW5ldyBNKHQuZHluX2x0cmVlLEYpLHQuZF9kZXNjPW5ldyBNKHQuZHluX2R0cmVlLEgpLHQuYmxfZGVzYz1uZXcgTSh0LmJsX3RyZWUsWiksdC5iaV9idWY9MCx0LmJpX3ZhbGlkPTAsWSh0KX0sX3RyX3N0b3JlZF9ibG9jazpvdCxfdHJfZmx1c2hfYmxvY2s6bHQsX3RyX3RhbGx5Oih0LGUscik9Pih0LnBlbmRpbmdfYnVmW3Quc3ltX2J1Zit0LnN5bV9uZXh0KytdPWUsdC5wZW5kaW5nX2J1Zlt0LnN5bV9idWYrdC5zeW1fbmV4dCsrXT1lPj44LHQucGVuZGluZ19idWZbdC5zeW1fYnVmK3Quc3ltX25leHQrK109ciwwPT09ZT90LmR5bl9sdHJlZVsyKnJdKys6KHQubWF0Y2hlcysrLGUtLSx0LmR5bl9sdHJlZVsyKihEW3JdK18rMSldKyssdC5keW5fZHRyZWVbMipOKGUpXSsrKSx0LnN5bV9uZXh0PT09dC5zeW1fZW5kKSxfdHJfYWxpZ246dD0+e1AodCxvPDwxLDMpLGoodCxtLEwpLEsodCl9fSxjdD0odCxlLHIsbik9PntsZXQgaT02NTUzNSZ0LGE9dD4+PjE2JjY1NTM1LHM9MDtmb3IoOzAhPT1yOyl7cz1yPjJlMz8yZTM6cixyLT1zO2Rve2k9aStlW24rK118MCxhPWEraXwwfXdoaWxlKC0tcyk7aSU9NjU1MjEsYSU9NjU1MjF9cmV0dXJuIGl8YTw8MTZ9O2NvbnN0IHV0PW5ldyBVaW50MzJBcnJheSgoKCk9PntsZXQgdCxlPVtdO2Zvcih2YXIgcj0wO3I8MjU2O3IrKyl7dD1yO2Zvcih2YXIgbj0wO248ODtuKyspdD0xJnQ/Mzk4ODI5MjM4NF50Pj4+MTp0Pj4+MTtlW3JdPXR9cmV0dXJuIGV9KSgpKTt2YXIgX3Q9KHQsZSxyLG4pPT57Y29uc3QgaT11dCxhPW4rcjt0Xj0tMTtmb3IobGV0IHI9bjtyPGE7cisrKXQ9dD4+PjheaVsyNTUmKHReZVtyXSldO3JldHVybn50fSxkdD17MjoibmVlZCBkaWN0aW9uYXJ5IiwxOiJzdHJlYW0gZW5kIiwwOiIiLCItMSI6ImZpbGUgZXJyb3IiLCItMiI6InN0cmVhbSBlcnJvciIsIi0zIjoiZGF0YSBlcnJvciIsIi00IjoiaW5zdWZmaWNpZW50IG1lbW9yeSIsIi01IjoiYnVmZmVyIGVycm9yIiwiLTYiOiJpbmNvbXBhdGlibGUgdmVyc2lvbiJ9LGZ0PXtaX05PX0ZMVVNIOjAsWl9QQVJUSUFMX0ZMVVNIOjEsWl9TWU5DX0ZMVVNIOjIsWl9GVUxMX0ZMVVNIOjMsWl9GSU5JU0g6NCxaX0JMT0NLOjUsWl9UUkVFUzo2LFpfT0s6MCxaX1NUUkVBTV9FTkQ6MSxaX05FRURfRElDVDoyLFpfRVJSTk86LTEsWl9TVFJFQU1fRVJST1I6LTIsWl9EQVRBX0VSUk9SOi0zLFpfTUVNX0VSUk9SOi00LFpfQlVGX0VSUk9SOi01LFpfTk9fQ09NUFJFU1NJT046MCxaX0JFU1RfU1BFRUQ6MSxaX0JFU1RfQ09NUFJFU1NJT046OSxaX0RFRkFVTFRfQ09NUFJFU1NJT046LTEsWl9GSUxURVJFRDoxLFpfSFVGRk1BTl9PTkxZOjIsWl9STEU6MyxaX0ZJWEVEOjQsWl9ERUZBVUxUX1NUUkFURUdZOjAsWl9CSU5BUlk6MCxaX1RFWFQ6MSxaX1VOS05PV046MixaX0RFRkxBVEVEOjh9O2NvbnN0e190cl9pbml0OnB0LF90cl9zdG9yZWRfYmxvY2s6Z3QsX3RyX2ZsdXNoX2Jsb2NrOnl0LF90cl90YWxseTp3dCxfdHJfYWxpZ246dnR9PWh0LHtaX05PX0ZMVVNIOm10LFpfUEFSVElBTF9GTFVTSDpidCxaX0ZVTExfRkxVU0g6eHQsWl9GSU5JU0g6a3QsWl9CTE9DSzp6dCxaX09LOkF0LFpfU1RSRUFNX0VORDpFdCxaX1NUUkVBTV9FUlJPUjpTdCxaX0RBVEFfRVJST1I6QnQsWl9CVUZfRVJST1I6THQsWl9ERUZBVUxUX0NPTVBSRVNTSU9OOk90LFpfRklMVEVSRUQ6UnQsWl9IVUZGTUFOX09OTFk6RHQsWl9STEU6VXQsWl9GSVhFRDpDdCxaX0RFRkFVTFRfU1RSQVRFR1k6VHQsWl9VTktOT1dOOkZ0LFpfREVGTEFURUQ6SHR9PWZ0LFp0PTksTXQ9MTUsTnQ9OCxJdD0yODYsUHQ9MzAsanQ9MTksJHQ9MipJdCsxLEt0PTE1LFh0PTMsR3Q9MjU4LFd0PUd0K1h0KzEsWXQ9MzIscXQ9NDIsVnQ9NTcsUXQ9NjksSnQ9NzMsdGU9OTEsZWU9MTAzLHJlPTExMyxuZT02NjYsaWU9MSxhZT0yLHNlPTMsb2U9NCxsZT0zLGhlPSh0LGUpPT4odC5tc2c9ZHRbZV0sZSksY2U9dD0+Mip0LSh0PjQ/OTowKSx1ZT10PT57bGV0IGU9dC5sZW5ndGg7Zm9yKDstLWU+PTA7KXRbZV09MH0sX2U9dD0+e2xldCBlLHIsbixpPXQud19zaXplO2U9dC5oYXNoX3NpemUsbj1lO2Rve3I9dC5oZWFkWy0tbl0sdC5oZWFkW25dPXI+PWk/ci1pOjB9d2hpbGUoLS1lKTtlPWksbj1lO2Rve3I9dC5wcmV2Wy0tbl0sdC5wcmV2W25dPXI+PWk/ci1pOjB9d2hpbGUoLS1lKX07bGV0IGRlPSh0LGUscik9PihlPDx0Lmhhc2hfc2hpZnRecikmdC5oYXNoX21hc2s7Y29uc3QgZmU9dD0+e2NvbnN0IGU9dC5zdGF0ZTtsZXQgcj1lLnBlbmRpbmc7cj50LmF2YWlsX291dCYmKHI9dC5hdmFpbF9vdXQpLDAhPT1yJiYodC5vdXRwdXQuc2V0KGUucGVuZGluZ19idWYuc3ViYXJyYXkoZS5wZW5kaW5nX291dCxlLnBlbmRpbmdfb3V0K3IpLHQubmV4dF9vdXQpLHQubmV4dF9vdXQrPXIsZS5wZW5kaW5nX291dCs9cix0LnRvdGFsX291dCs9cix0LmF2YWlsX291dC09cixlLnBlbmRpbmctPXIsMD09PWUucGVuZGluZyYmKGUucGVuZGluZ19vdXQ9MCkpfSxwZT0odCxlKT0+e3l0KHQsdC5ibG9ja19zdGFydD49MD90LmJsb2NrX3N0YXJ0Oi0xLHQuc3Ryc3RhcnQtdC5ibG9ja19zdGFydCxlKSx0LmJsb2NrX3N0YXJ0PXQuc3Ryc3RhcnQsZmUodC5zdHJtKX0sZ2U9KHQsZSk9Pnt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lfSx5ZT0odCxlKT0+e3QucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPWU+Pj44JjI1NSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmZX0sd2U9KHQsZSxyLG4pPT57bGV0IGk9dC5hdmFpbF9pbjtyZXR1cm4gaT5uJiYoaT1uKSwwPT09aT8wOih0LmF2YWlsX2luLT1pLGUuc2V0KHQuaW5wdXQuc3ViYXJyYXkodC5uZXh0X2luLHQubmV4dF9pbitpKSxyKSwxPT09dC5zdGF0ZS53cmFwP3QuYWRsZXI9Y3QodC5hZGxlcixlLGkscik6Mj09PXQuc3RhdGUud3JhcCYmKHQuYWRsZXI9X3QodC5hZGxlcixlLGkscikpLHQubmV4dF9pbis9aSx0LnRvdGFsX2luKz1pLGkpfSx2ZT0odCxlKT0+e2xldCByLG4saT10Lm1heF9jaGFpbl9sZW5ndGgsYT10LnN0cnN0YXJ0LHM9dC5wcmV2X2xlbmd0aCxvPXQubmljZV9tYXRjaDtjb25zdCBsPXQuc3Ryc3RhcnQ+dC53X3NpemUtV3Q/dC5zdHJzdGFydC0odC53X3NpemUtV3QpOjAsaD10LndpbmRvdyxjPXQud19tYXNrLHU9dC5wcmV2LF89dC5zdHJzdGFydCtHdDtsZXQgZD1oW2Ercy0xXSxmPWhbYStzXTt0LnByZXZfbGVuZ3RoPj10Lmdvb2RfbWF0Y2gmJihpPj49Miksbz50Lmxvb2thaGVhZCYmKG89dC5sb29rYWhlYWQpO2Rve2lmKHI9ZSxoW3Irc109PT1mJiZoW3Ircy0xXT09PWQmJmhbcl09PT1oW2FdJiZoWysrcl09PT1oW2ErMV0pe2ErPTIscisrO2Rve313aGlsZShoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmYTxfKTtpZihuPUd0LShfLWEpLGE9Xy1HdCxuPnMpe2lmKHQubWF0Y2hfc3RhcnQ9ZSxzPW4sbj49bylicmVhaztkPWhbYStzLTFdLGY9aFthK3NdfX19d2hpbGUoKGU9dVtlJmNdKT5sJiYwIT0tLWkpO3JldHVybiBzPD10Lmxvb2thaGVhZD9zOnQubG9va2FoZWFkfSxtZT10PT57Y29uc3QgZT10Lndfc2l6ZTtsZXQgcixuLGk7ZG97aWYobj10LndpbmRvd19zaXplLXQubG9va2FoZWFkLXQuc3Ryc3RhcnQsdC5zdHJzdGFydD49ZSsoZS1XdCkmJih0LndpbmRvdy5zZXQodC53aW5kb3cuc3ViYXJyYXkoZSxlK2UtbiksMCksdC5tYXRjaF9zdGFydC09ZSx0LnN0cnN0YXJ0LT1lLHQuYmxvY2tfc3RhcnQtPWUsdC5pbnNlcnQ+dC5zdHJzdGFydCYmKHQuaW5zZXJ0PXQuc3Ryc3RhcnQpLF9lKHQpLG4rPWUpLDA9PT10LnN0cm0uYXZhaWxfaW4pYnJlYWs7aWYocj13ZSh0LnN0cm0sdC53aW5kb3csdC5zdHJzdGFydCt0Lmxvb2thaGVhZCxuKSx0Lmxvb2thaGVhZCs9cix0Lmxvb2thaGVhZCt0Lmluc2VydD49WHQpZm9yKGk9dC5zdHJzdGFydC10Lmluc2VydCx0Lmluc19oPXQud2luZG93W2ldLHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W2krMV0pO3QuaW5zZXJ0JiYodC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbaStYdC0xXSksdC5wcmV2W2kmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09aSxpKyssdC5pbnNlcnQtLSwhKHQubG9va2FoZWFkK3QuaW5zZXJ0PFh0KSk7KTt9d2hpbGUodC5sb29rYWhlYWQ8V3QmJjAhPT10LnN0cm0uYXZhaWxfaW4pfSxiZT0odCxlKT0+e2xldCByLG4saSxhPXQucGVuZGluZ19idWZfc2l6ZS01PnQud19zaXplP3Qud19zaXplOnQucGVuZGluZ19idWZfc2l6ZS01LHM9MCxvPXQuc3RybS5hdmFpbF9pbjtkb3tpZihyPTY1NTM1LGk9dC5iaV92YWxpZCs0Mj4+Myx0LnN0cm0uYXZhaWxfb3V0PGkpYnJlYWs7aWYoaT10LnN0cm0uYXZhaWxfb3V0LWksbj10LnN0cnN0YXJ0LXQuYmxvY2tfc3RhcnQscj5uK3Quc3RybS5hdmFpbF9pbiYmKHI9bit0LnN0cm0uYXZhaWxfaW4pLHI+aSYmKHI9aSkscjxhJiYoMD09PXImJmUhPT1rdHx8ZT09PW10fHxyIT09bit0LnN0cm0uYXZhaWxfaW4pKWJyZWFrO3M9ZT09PWt0JiZyPT09bit0LnN0cm0uYXZhaWxfaW4/MTowLGd0KHQsMCwwLHMpLHQucGVuZGluZ19idWZbdC5wZW5kaW5nLTRdPXIsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmctM109cj4+OCx0LnBlbmRpbmdfYnVmW3QucGVuZGluZy0yXT1+cix0LnBlbmRpbmdfYnVmW3QucGVuZGluZy0xXT1+cj4+OCxmZSh0LnN0cm0pLG4mJihuPnImJihuPXIpLHQuc3RybS5vdXRwdXQuc2V0KHQud2luZG93LnN1YmFycmF5KHQuYmxvY2tfc3RhcnQsdC5ibG9ja19zdGFydCtuKSx0LnN0cm0ubmV4dF9vdXQpLHQuc3RybS5uZXh0X291dCs9bix0LnN0cm0uYXZhaWxfb3V0LT1uLHQuc3RybS50b3RhbF9vdXQrPW4sdC5ibG9ja19zdGFydCs9bixyLT1uKSxyJiYod2UodC5zdHJtLHQuc3RybS5vdXRwdXQsdC5zdHJtLm5leHRfb3V0LHIpLHQuc3RybS5uZXh0X291dCs9cix0LnN0cm0uYXZhaWxfb3V0LT1yLHQuc3RybS50b3RhbF9vdXQrPXIpfXdoaWxlKDA9PT1zKTtyZXR1cm4gby09dC5zdHJtLmF2YWlsX2luLG8mJihvPj10Lndfc2l6ZT8odC5tYXRjaGVzPTIsdC53aW5kb3cuc2V0KHQuc3RybS5pbnB1dC5zdWJhcnJheSh0LnN0cm0ubmV4dF9pbi10Lndfc2l6ZSx0LnN0cm0ubmV4dF9pbiksMCksdC5zdHJzdGFydD10Lndfc2l6ZSx0Lmluc2VydD10LnN0cnN0YXJ0KToodC53aW5kb3dfc2l6ZS10LnN0cnN0YXJ0PD1vJiYodC5zdHJzdGFydC09dC53X3NpemUsdC53aW5kb3cuc2V0KHQud2luZG93LnN1YmFycmF5KHQud19zaXplLHQud19zaXplK3Quc3Ryc3RhcnQpLDApLHQubWF0Y2hlczwyJiZ0Lm1hdGNoZXMrKyx0Lmluc2VydD50LnN0cnN0YXJ0JiYodC5pbnNlcnQ9dC5zdHJzdGFydCkpLHQud2luZG93LnNldCh0LnN0cm0uaW5wdXQuc3ViYXJyYXkodC5zdHJtLm5leHRfaW4tbyx0LnN0cm0ubmV4dF9pbiksdC5zdHJzdGFydCksdC5zdHJzdGFydCs9byx0Lmluc2VydCs9bz50Lndfc2l6ZS10Lmluc2VydD90Lndfc2l6ZS10Lmluc2VydDpvKSx0LmJsb2NrX3N0YXJ0PXQuc3Ryc3RhcnQpLHQuaGlnaF93YXRlcjx0LnN0cnN0YXJ0JiYodC5oaWdoX3dhdGVyPXQuc3Ryc3RhcnQpLHM/b2U6ZSE9PW10JiZlIT09a3QmJjA9PT10LnN0cm0uYXZhaWxfaW4mJnQuc3Ryc3RhcnQ9PT10LmJsb2NrX3N0YXJ0P2FlOihpPXQud2luZG93X3NpemUtdC5zdHJzdGFydCx0LnN0cm0uYXZhaWxfaW4+aSYmdC5ibG9ja19zdGFydD49dC53X3NpemUmJih0LmJsb2NrX3N0YXJ0LT10Lndfc2l6ZSx0LnN0cnN0YXJ0LT10Lndfc2l6ZSx0LndpbmRvdy5zZXQodC53aW5kb3cuc3ViYXJyYXkodC53X3NpemUsdC53X3NpemUrdC5zdHJzdGFydCksMCksdC5tYXRjaGVzPDImJnQubWF0Y2hlcysrLGkrPXQud19zaXplLHQuaW5zZXJ0PnQuc3Ryc3RhcnQmJih0Lmluc2VydD10LnN0cnN0YXJ0KSksaT50LnN0cm0uYXZhaWxfaW4mJihpPXQuc3RybS5hdmFpbF9pbiksaSYmKHdlKHQuc3RybSx0LndpbmRvdyx0LnN0cnN0YXJ0LGkpLHQuc3Ryc3RhcnQrPWksdC5pbnNlcnQrPWk+dC53X3NpemUtdC5pbnNlcnQ/dC53X3NpemUtdC5pbnNlcnQ6aSksdC5oaWdoX3dhdGVyPHQuc3Ryc3RhcnQmJih0LmhpZ2hfd2F0ZXI9dC5zdHJzdGFydCksaT10LmJpX3ZhbGlkKzQyPj4zLGk9dC5wZW5kaW5nX2J1Zl9zaXplLWk+NjU1MzU/NjU1MzU6dC5wZW5kaW5nX2J1Zl9zaXplLWksYT1pPnQud19zaXplP3Qud19zaXplOmksbj10LnN0cnN0YXJ0LXQuYmxvY2tfc3RhcnQsKG4+PWF8fChufHxlPT09a3QpJiZlIT09bXQmJjA9PT10LnN0cm0uYXZhaWxfaW4mJm48PWkpJiYocj1uPmk/aTpuLHM9ZT09PWt0JiYwPT09dC5zdHJtLmF2YWlsX2luJiZyPT09bj8xOjAsZ3QodCx0LmJsb2NrX3N0YXJ0LHIscyksdC5ibG9ja19zdGFydCs9cixmZSh0LnN0cm0pKSxzP3NlOmllKX0seGU9KHQsZSk9PntsZXQgcixuO2Zvcig7Oyl7aWYodC5sb29rYWhlYWQ8V3Qpe2lmKG1lKHQpLHQubG9va2FoZWFkPFd0JiZlPT09bXQpcmV0dXJuIGllO2lmKDA9PT10Lmxvb2thaGVhZClicmVha31pZihyPTAsdC5sb29rYWhlYWQ+PVh0JiYodC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCtYdC0xXSkscj10LnByZXZbdC5zdHJzdGFydCZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT10LnN0cnN0YXJ0KSwwIT09ciYmdC5zdHJzdGFydC1yPD10Lndfc2l6ZS1XdCYmKHQubWF0Y2hfbGVuZ3RoPXZlKHQscikpLHQubWF0Y2hfbGVuZ3RoPj1YdClpZihuPXd0KHQsdC5zdHJzdGFydC10Lm1hdGNoX3N0YXJ0LHQubWF0Y2hfbGVuZ3RoLVh0KSx0Lmxvb2thaGVhZC09dC5tYXRjaF9sZW5ndGgsdC5tYXRjaF9sZW5ndGg8PXQubWF4X2xhenlfbWF0Y2gmJnQubG9va2FoZWFkPj1YdCl7dC5tYXRjaF9sZW5ndGgtLTtkb3t0LnN0cnN0YXJ0KyssdC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCtYdC0xXSkscj10LnByZXZbdC5zdHJzdGFydCZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT10LnN0cnN0YXJ0fXdoaWxlKDAhPS0tdC5tYXRjaF9sZW5ndGgpO3Quc3Ryc3RhcnQrK31lbHNlIHQuc3Ryc3RhcnQrPXQubWF0Y2hfbGVuZ3RoLHQubWF0Y2hfbGVuZ3RoPTAsdC5pbnNfaD10LndpbmRvd1t0LnN0cnN0YXJ0XSx0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1t0LnN0cnN0YXJ0KzFdKTtlbHNlIG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKztpZihuJiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9dC5zdHJzdGFydDxYdC0xP3Quc3Ryc3RhcnQ6WHQtMSxlPT09a3Q/KHBlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0LnN5bV9uZXh0JiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSxrZT0odCxlKT0+e2xldCByLG4saTtmb3IoOzspe2lmKHQubG9va2FoZWFkPFd0KXtpZihtZSh0KSx0Lmxvb2thaGVhZDxXdCYmZT09PW10KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYocj0wLHQubG9va2FoZWFkPj1YdCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrWHQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCksdC5wcmV2X2xlbmd0aD10Lm1hdGNoX2xlbmd0aCx0LnByZXZfbWF0Y2g9dC5tYXRjaF9zdGFydCx0Lm1hdGNoX2xlbmd0aD1YdC0xLDAhPT1yJiZ0LnByZXZfbGVuZ3RoPHQubWF4X2xhenlfbWF0Y2gmJnQuc3Ryc3RhcnQtcjw9dC53X3NpemUtV3QmJih0Lm1hdGNoX2xlbmd0aD12ZSh0LHIpLHQubWF0Y2hfbGVuZ3RoPD01JiYodC5zdHJhdGVneT09PVJ0fHx0Lm1hdGNoX2xlbmd0aD09PVh0JiZ0LnN0cnN0YXJ0LXQubWF0Y2hfc3RhcnQ+NDA5NikmJih0Lm1hdGNoX2xlbmd0aD1YdC0xKSksdC5wcmV2X2xlbmd0aD49WHQmJnQubWF0Y2hfbGVuZ3RoPD10LnByZXZfbGVuZ3RoKXtpPXQuc3Ryc3RhcnQrdC5sb29rYWhlYWQtWHQsbj13dCh0LHQuc3Ryc3RhcnQtMS10LnByZXZfbWF0Y2gsdC5wcmV2X2xlbmd0aC1YdCksdC5sb29rYWhlYWQtPXQucHJldl9sZW5ndGgtMSx0LnByZXZfbGVuZ3RoLT0yO2RveysrdC5zdHJzdGFydDw9aSYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrWHQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCl9d2hpbGUoMCE9LS10LnByZXZfbGVuZ3RoKTtpZih0Lm1hdGNoX2F2YWlsYWJsZT0wLHQubWF0Y2hfbGVuZ3RoPVh0LTEsdC5zdHJzdGFydCsrLG4mJihwZSh0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCkpcmV0dXJuIGllfWVsc2UgaWYodC5tYXRjaF9hdmFpbGFibGUpe2lmKG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnQtMV0pLG4mJnBlKHQsITEpLHQuc3Ryc3RhcnQrKyx0Lmxvb2thaGVhZC0tLDA9PT10LnN0cm0uYXZhaWxfb3V0KXJldHVybiBpZX1lbHNlIHQubWF0Y2hfYXZhaWxhYmxlPTEsdC5zdHJzdGFydCsrLHQubG9va2FoZWFkLS19cmV0dXJuIHQubWF0Y2hfYXZhaWxhYmxlJiYobj13dCh0LDAsdC53aW5kb3dbdC5zdHJzdGFydC0xXSksdC5tYXRjaF9hdmFpbGFibGU9MCksdC5pbnNlcnQ9dC5zdHJzdGFydDxYdC0xP3Quc3Ryc3RhcnQ6WHQtMSxlPT09a3Q/KHBlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0LnN5bV9uZXh0JiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSx6ZT0odCxlKT0+e2xldCByLG4saSxhO2NvbnN0IHM9dC53aW5kb3c7Zm9yKDs7KXtpZih0Lmxvb2thaGVhZDw9R3Qpe2lmKG1lKHQpLHQubG9va2FoZWFkPD1HdCYmZT09PW10KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYodC5tYXRjaF9sZW5ndGg9MCx0Lmxvb2thaGVhZD49WHQmJnQuc3Ryc3RhcnQ+MCYmKGk9dC5zdHJzdGFydC0xLG49c1tpXSxuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldKSl7YT10LnN0cnN0YXJ0K0d0O2Rve313aGlsZShuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZpPGEpO3QubWF0Y2hfbGVuZ3RoPUd0LShhLWkpLHQubWF0Y2hfbGVuZ3RoPnQubG9va2FoZWFkJiYodC5tYXRjaF9sZW5ndGg9dC5sb29rYWhlYWQpfWlmKHQubWF0Y2hfbGVuZ3RoPj1YdD8ocj13dCh0LDEsdC5tYXRjaF9sZW5ndGgtWHQpLHQubG9va2FoZWFkLT10Lm1hdGNoX2xlbmd0aCx0LnN0cnN0YXJ0Kz10Lm1hdGNoX2xlbmd0aCx0Lm1hdGNoX2xlbmd0aD0wKToocj13dCh0LDAsdC53aW5kb3dbdC5zdHJzdGFydF0pLHQubG9va2FoZWFkLS0sdC5zdHJzdGFydCsrKSxyJiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9MCxlPT09a3Q/KHBlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0LnN5bV9uZXh0JiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSxBZT0odCxlKT0+e2xldCByO2Zvcig7Oyl7aWYoMD09PXQubG9va2FoZWFkJiYobWUodCksMD09PXQubG9va2FoZWFkKSl7aWYoZT09PW10KXJldHVybiBpZTticmVha31pZih0Lm1hdGNoX2xlbmd0aD0wLHI9d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKyxyJiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9MCxlPT09a3Q/KHBlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0LnN5bV9uZXh0JiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfTtmdW5jdGlvbiBFZSh0LGUscixuLGkpe3RoaXMuZ29vZF9sZW5ndGg9dCx0aGlzLm1heF9sYXp5PWUsdGhpcy5uaWNlX2xlbmd0aD1yLHRoaXMubWF4X2NoYWluPW4sdGhpcy5mdW5jPWl9Y29uc3QgU2U9W25ldyBFZSgwLDAsMCwwLGJlKSxuZXcgRWUoNCw0LDgsNCx4ZSksbmV3IEVlKDQsNSwxNiw4LHhlKSxuZXcgRWUoNCw2LDMyLDMyLHhlKSxuZXcgRWUoNCw0LDE2LDE2LGtlKSxuZXcgRWUoOCwxNiwzMiwzMixrZSksbmV3IEVlKDgsMTYsMTI4LDEyOCxrZSksbmV3IEVlKDgsMzIsMTI4LDI1NixrZSksbmV3IEVlKDMyLDEyOCwyNTgsMTAyNCxrZSksbmV3IEVlKDMyLDI1OCwyNTgsNDA5NixrZSldLEJlPXQ9Pnt0LndpbmRvd19zaXplPTIqdC53X3NpemUsdWUodC5oZWFkKSx0Lm1heF9sYXp5X21hdGNoPVNlW3QubGV2ZWxdLm1heF9sYXp5LHQuZ29vZF9tYXRjaD1TZVt0LmxldmVsXS5nb29kX2xlbmd0aCx0Lm5pY2VfbWF0Y2g9U2VbdC5sZXZlbF0ubmljZV9sZW5ndGgsdC5tYXhfY2hhaW5fbGVuZ3RoPVNlW3QubGV2ZWxdLm1heF9jaGFpbix0LnN0cnN0YXJ0PTAsdC5ibG9ja19zdGFydD0wLHQubG9va2FoZWFkPTAsdC5pbnNlcnQ9MCx0Lm1hdGNoX2xlbmd0aD10LnByZXZfbGVuZ3RoPVh0LTEsdC5tYXRjaF9hdmFpbGFibGU9MCx0Lmluc19oPTB9O2Z1bmN0aW9uIExlKCl7dGhpcy5zdHJtPW51bGwsdGhpcy5zdGF0dXM9MCx0aGlzLnBlbmRpbmdfYnVmPW51bGwsdGhpcy5wZW5kaW5nX2J1Zl9zaXplPTAsdGhpcy5wZW5kaW5nX291dD0wLHRoaXMucGVuZGluZz0wLHRoaXMud3JhcD0wLHRoaXMuZ3poZWFkPW51bGwsdGhpcy5nemluZGV4PTAsdGhpcy5tZXRob2Q9SHQsdGhpcy5sYXN0X2ZsdXNoPS0xLHRoaXMud19zaXplPTAsdGhpcy53X2JpdHM9MCx0aGlzLndfbWFzaz0wLHRoaXMud2luZG93PW51bGwsdGhpcy53aW5kb3dfc2l6ZT0wLHRoaXMucHJldj1udWxsLHRoaXMuaGVhZD1udWxsLHRoaXMuaW5zX2g9MCx0aGlzLmhhc2hfc2l6ZT0wLHRoaXMuaGFzaF9iaXRzPTAsdGhpcy5oYXNoX21hc2s9MCx0aGlzLmhhc2hfc2hpZnQ9MCx0aGlzLmJsb2NrX3N0YXJ0PTAsdGhpcy5tYXRjaF9sZW5ndGg9MCx0aGlzLnByZXZfbWF0Y2g9MCx0aGlzLm1hdGNoX2F2YWlsYWJsZT0wLHRoaXMuc3Ryc3RhcnQ9MCx0aGlzLm1hdGNoX3N0YXJ0PTAsdGhpcy5sb29rYWhlYWQ9MCx0aGlzLnByZXZfbGVuZ3RoPTAsdGhpcy5tYXhfY2hhaW5fbGVuZ3RoPTAsdGhpcy5tYXhfbGF6eV9tYXRjaD0wLHRoaXMubGV2ZWw9MCx0aGlzLnN0cmF0ZWd5PTAsdGhpcy5nb29kX21hdGNoPTAsdGhpcy5uaWNlX21hdGNoPTAsdGhpcy5keW5fbHRyZWU9bmV3IFVpbnQxNkFycmF5KDIqJHQpLHRoaXMuZHluX2R0cmVlPW5ldyBVaW50MTZBcnJheSgyKigyKlB0KzEpKSx0aGlzLmJsX3RyZWU9bmV3IFVpbnQxNkFycmF5KDIqKDIqanQrMSkpLHVlKHRoaXMuZHluX2x0cmVlKSx1ZSh0aGlzLmR5bl9kdHJlZSksdWUodGhpcy5ibF90cmVlKSx0aGlzLmxfZGVzYz1udWxsLHRoaXMuZF9kZXNjPW51bGwsdGhpcy5ibF9kZXNjPW51bGwsdGhpcy5ibF9jb3VudD1uZXcgVWludDE2QXJyYXkoS3QrMSksdGhpcy5oZWFwPW5ldyBVaW50MTZBcnJheSgyKkl0KzEpLHVlKHRoaXMuaGVhcCksdGhpcy5oZWFwX2xlbj0wLHRoaXMuaGVhcF9tYXg9MCx0aGlzLmRlcHRoPW5ldyBVaW50MTZBcnJheSgyKkl0KzEpLHVlKHRoaXMuZGVwdGgpLHRoaXMuc3ltX2J1Zj0wLHRoaXMubGl0X2J1ZnNpemU9MCx0aGlzLnN5bV9uZXh0PTAsdGhpcy5zeW1fZW5kPTAsdGhpcy5vcHRfbGVuPTAsdGhpcy5zdGF0aWNfbGVuPTAsdGhpcy5tYXRjaGVzPTAsdGhpcy5pbnNlcnQ9MCx0aGlzLmJpX2J1Zj0wLHRoaXMuYmlfdmFsaWQ9MH1jb25zdCBPZT10PT57aWYoIXQpcmV0dXJuIDE7Y29uc3QgZT10LnN0YXRlO3JldHVybiFlfHxlLnN0cm0hPT10fHxlLnN0YXR1cyE9PXF0JiZlLnN0YXR1cyE9PVZ0JiZlLnN0YXR1cyE9PVF0JiZlLnN0YXR1cyE9PUp0JiZlLnN0YXR1cyE9PXRlJiZlLnN0YXR1cyE9PWVlJiZlLnN0YXR1cyE9PXJlJiZlLnN0YXR1cyE9PW5lPzE6MH0sUmU9dD0+e2lmKE9lKHQpKXJldHVybiBoZSh0LFN0KTt0LnRvdGFsX2luPXQudG90YWxfb3V0PTAsdC5kYXRhX3R5cGU9RnQ7Y29uc3QgZT10LnN0YXRlO3JldHVybiBlLnBlbmRpbmc9MCxlLnBlbmRpbmdfb3V0PTAsZS53cmFwPDAmJihlLndyYXA9LWUud3JhcCksZS5zdGF0dXM9Mj09PWUud3JhcD9WdDplLndyYXA/cXQ6cmUsdC5hZGxlcj0yPT09ZS53cmFwPzA6MSxlLmxhc3RfZmx1c2g9LTIscHQoZSksQXR9LERlPXQ9Pntjb25zdCBlPVJlKHQpO3JldHVybiBlPT09QXQmJkJlKHQuc3RhdGUpLGV9LFVlPSh0LGUscixuLGksYSk9PntpZighdClyZXR1cm4gU3Q7bGV0IHM9MTtpZihlPT09T3QmJihlPTYpLG48MD8ocz0wLG49LW4pOm4+MTUmJihzPTIsbi09MTYpLGk8MXx8aT5adHx8ciE9PUh0fHxuPDh8fG4+MTV8fGU8MHx8ZT45fHxhPDB8fGE+Q3R8fDg9PT1uJiYxIT09cylyZXR1cm4gaGUodCxTdCk7OD09PW4mJihuPTkpO2NvbnN0IG89bmV3IExlO3JldHVybiB0LnN0YXRlPW8sby5zdHJtPXQsby5zdGF0dXM9cXQsby53cmFwPXMsby5nemhlYWQ9bnVsbCxvLndfYml0cz1uLG8ud19zaXplPTE8PG8ud19iaXRzLG8ud19tYXNrPW8ud19zaXplLTEsby5oYXNoX2JpdHM9aSs3LG8uaGFzaF9zaXplPTE8PG8uaGFzaF9iaXRzLG8uaGFzaF9tYXNrPW8uaGFzaF9zaXplLTEsby5oYXNoX3NoaWZ0PX5+KChvLmhhc2hfYml0cytYdC0xKS9YdCksby53aW5kb3c9bmV3IFVpbnQ4QXJyYXkoMipvLndfc2l6ZSksby5oZWFkPW5ldyBVaW50MTZBcnJheShvLmhhc2hfc2l6ZSksby5wcmV2PW5ldyBVaW50MTZBcnJheShvLndfc2l6ZSksby5saXRfYnVmc2l6ZT0xPDxpKzYsby5wZW5kaW5nX2J1Zl9zaXplPTQqby5saXRfYnVmc2l6ZSxvLnBlbmRpbmdfYnVmPW5ldyBVaW50OEFycmF5KG8ucGVuZGluZ19idWZfc2l6ZSksby5zeW1fYnVmPW8ubGl0X2J1ZnNpemUsby5zeW1fZW5kPTMqKG8ubGl0X2J1ZnNpemUtMSksby5sZXZlbD1lLG8uc3RyYXRlZ3k9YSxvLm1ldGhvZD1yLERlKHQpfTt2YXIgQ2U9e2RlZmxhdGVJbml0Oih0LGUpPT5VZSh0LGUsSHQsTXQsTnQsVHQpLGRlZmxhdGVJbml0MjpVZSxkZWZsYXRlUmVzZXQ6RGUsZGVmbGF0ZVJlc2V0S2VlcDpSZSxkZWZsYXRlU2V0SGVhZGVyOih0LGUpPT5PZSh0KXx8MiE9PXQuc3RhdGUud3JhcD9TdDoodC5zdGF0ZS5nemhlYWQ9ZSxBdCksZGVmbGF0ZToodCxlKT0+e2lmKE9lKHQpfHxlPnp0fHxlPDApcmV0dXJuIHQ/aGUodCxTdCk6U3Q7Y29uc3Qgcj10LnN0YXRlO2lmKCF0Lm91dHB1dHx8MCE9PXQuYXZhaWxfaW4mJiF0LmlucHV0fHxyLnN0YXR1cz09PW5lJiZlIT09a3QpcmV0dXJuIGhlKHQsMD09PXQuYXZhaWxfb3V0P0x0OlN0KTtjb25zdCBuPXIubGFzdF9mbHVzaDtpZihyLmxhc3RfZmx1c2g9ZSwwIT09ci5wZW5kaW5nKXtpZihmZSh0KSwwPT09dC5hdmFpbF9vdXQpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdH1lbHNlIGlmKDA9PT10LmF2YWlsX2luJiZjZShlKTw9Y2UobikmJmUhPT1rdClyZXR1cm4gaGUodCxMdCk7aWYoci5zdGF0dXM9PT1uZSYmMCE9PXQuYXZhaWxfaW4pcmV0dXJuIGhlKHQsTHQpO2lmKHIuc3RhdHVzPT09cXQmJjA9PT1yLndyYXAmJihyLnN0YXR1cz1yZSksci5zdGF0dXM9PT1xdCl7bGV0IGU9SHQrKHIud19iaXRzLTg8PDQpPDw4LG49LTE7aWYobj1yLnN0cmF0ZWd5Pj1EdHx8ci5sZXZlbDwyPzA6ci5sZXZlbDw2PzE6Nj09PXIubGV2ZWw/MjozLGV8PW48PDYsMCE9PXIuc3Ryc3RhcnQmJihlfD1ZdCksZSs9MzEtZSUzMSx5ZShyLGUpLDAhPT1yLnN0cnN0YXJ0JiYoeWUocix0LmFkbGVyPj4+MTYpLHllKHIsNjU1MzUmdC5hZGxlcikpLHQuYWRsZXI9MSxyLnN0YXR1cz1yZSxmZSh0KSwwIT09ci5wZW5kaW5nKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXR9aWYoci5zdGF0dXM9PT1WdClpZih0LmFkbGVyPTAsZ2UociwzMSksZ2UociwxMzkpLGdlKHIsOCksci5nemhlYWQpZ2Uociwoci5nemhlYWQudGV4dD8xOjApKyhyLmd6aGVhZC5oY3JjPzI6MCkrKHIuZ3poZWFkLmV4dHJhPzQ6MCkrKHIuZ3poZWFkLm5hbWU/ODowKSsoci5nemhlYWQuY29tbWVudD8xNjowKSksZ2UociwyNTUmci5nemhlYWQudGltZSksZ2UocixyLmd6aGVhZC50aW1lPj44JjI1NSksZ2UocixyLmd6aGVhZC50aW1lPj4xNiYyNTUpLGdlKHIsci5nemhlYWQudGltZT4+MjQmMjU1KSxnZShyLDk9PT1yLmxldmVsPzI6ci5zdHJhdGVneT49RHR8fHIubGV2ZWw8Mj80OjApLGdlKHIsMjU1JnIuZ3poZWFkLm9zKSxyLmd6aGVhZC5leHRyYSYmci5nemhlYWQuZXh0cmEubGVuZ3RoJiYoZ2UociwyNTUmci5nemhlYWQuZXh0cmEubGVuZ3RoKSxnZShyLHIuZ3poZWFkLmV4dHJhLmxlbmd0aD4+OCYyNTUpKSxyLmd6aGVhZC5oY3JjJiYodC5hZGxlcj1fdCh0LmFkbGVyLHIucGVuZGluZ19idWYsci5wZW5kaW5nLDApKSxyLmd6aW5kZXg9MCxyLnN0YXR1cz1RdDtlbHNlIGlmKGdlKHIsMCksZ2UociwwKSxnZShyLDApLGdlKHIsMCksZ2UociwwKSxnZShyLDk9PT1yLmxldmVsPzI6ci5zdHJhdGVneT49RHR8fHIubGV2ZWw8Mj80OjApLGdlKHIsbGUpLHIuc3RhdHVzPXJlLGZlKHQpLDAhPT1yLnBlbmRpbmcpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdDtpZihyLnN0YXR1cz09PVF0KXtpZihyLmd6aGVhZC5leHRyYSl7bGV0IGU9ci5wZW5kaW5nLG49KDY1NTM1JnIuZ3poZWFkLmV4dHJhLmxlbmd0aCktci5nemluZGV4O2Zvcig7ci5wZW5kaW5nK24+ci5wZW5kaW5nX2J1Zl9zaXplOyl7bGV0IGk9ci5wZW5kaW5nX2J1Zl9zaXplLXIucGVuZGluZztpZihyLnBlbmRpbmdfYnVmLnNldChyLmd6aGVhZC5leHRyYS5zdWJhcnJheShyLmd6aW5kZXgsci5nemluZGV4K2kpLHIucGVuZGluZyksci5wZW5kaW5nPXIucGVuZGluZ19idWZfc2l6ZSxyLmd6aGVhZC5oY3JjJiZyLnBlbmRpbmc+ZSYmKHQuYWRsZXI9X3QodC5hZGxlcixyLnBlbmRpbmdfYnVmLHIucGVuZGluZy1lLGUpKSxyLmd6aW5kZXgrPWksZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0O2U9MCxuLT1pfWxldCBpPW5ldyBVaW50OEFycmF5KHIuZ3poZWFkLmV4dHJhKTtyLnBlbmRpbmdfYnVmLnNldChpLnN1YmFycmF5KHIuZ3ppbmRleCxyLmd6aW5kZXgrbiksci5wZW5kaW5nKSxyLnBlbmRpbmcrPW4sci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPmUmJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctZSxlKSksci5nemluZGV4PTB9ci5zdGF0dXM9SnR9aWYoci5zdGF0dXM9PT1KdCl7aWYoci5nemhlYWQubmFtZSl7bGV0IGUsbj1yLnBlbmRpbmc7ZG97aWYoci5wZW5kaW5nPT09ci5wZW5kaW5nX2J1Zl9zaXplKXtpZihyLmd6aGVhZC5oY3JjJiZyLnBlbmRpbmc+biYmKHQuYWRsZXI9X3QodC5hZGxlcixyLnBlbmRpbmdfYnVmLHIucGVuZGluZy1uLG4pKSxmZSh0KSwwIT09ci5wZW5kaW5nKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXQ7bj0wfWU9ci5nemluZGV4PHIuZ3poZWFkLm5hbWUubGVuZ3RoPzI1NSZyLmd6aGVhZC5uYW1lLmNoYXJDb2RlQXQoci5nemluZGV4KyspOjAsZ2UocixlKX13aGlsZSgwIT09ZSk7ci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPm4mJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctbixuKSksci5nemluZGV4PTB9ci5zdGF0dXM9dGV9aWYoci5zdGF0dXM9PT10ZSl7aWYoci5nemhlYWQuY29tbWVudCl7bGV0IGUsbj1yLnBlbmRpbmc7ZG97aWYoci5wZW5kaW5nPT09ci5wZW5kaW5nX2J1Zl9zaXplKXtpZihyLmd6aGVhZC5oY3JjJiZyLnBlbmRpbmc+biYmKHQuYWRsZXI9X3QodC5hZGxlcixyLnBlbmRpbmdfYnVmLHIucGVuZGluZy1uLG4pKSxmZSh0KSwwIT09ci5wZW5kaW5nKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXQ7bj0wfWU9ci5nemluZGV4PHIuZ3poZWFkLmNvbW1lbnQubGVuZ3RoPzI1NSZyLmd6aGVhZC5jb21tZW50LmNoYXJDb2RlQXQoci5nemluZGV4KyspOjAsZ2UocixlKX13aGlsZSgwIT09ZSk7ci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPm4mJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctbixuKSl9ci5zdGF0dXM9ZWV9aWYoci5zdGF0dXM9PT1lZSl7aWYoci5nemhlYWQuaGNyYyl7aWYoci5wZW5kaW5nKzI+ci5wZW5kaW5nX2J1Zl9zaXplJiYoZmUodCksMCE9PXIucGVuZGluZykpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdDtnZShyLDI1NSZ0LmFkbGVyKSxnZShyLHQuYWRsZXI+PjgmMjU1KSx0LmFkbGVyPTB9aWYoci5zdGF0dXM9cmUsZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0fWlmKDAhPT10LmF2YWlsX2lufHwwIT09ci5sb29rYWhlYWR8fGUhPT1tdCYmci5zdGF0dXMhPT1uZSl7bGV0IG49MD09PXIubGV2ZWw/YmUocixlKTpyLnN0cmF0ZWd5PT09RHQ/QWUocixlKTpyLnN0cmF0ZWd5PT09VXQ/emUocixlKTpTZVtyLmxldmVsXS5mdW5jKHIsZSk7aWYobiE9PXNlJiZuIT09b2V8fChyLnN0YXR1cz1uZSksbj09PWllfHxuPT09c2UpcmV0dXJuIDA9PT10LmF2YWlsX291dCYmKHIubGFzdF9mbHVzaD0tMSksQXQ7aWYobj09PWFlJiYoZT09PWJ0P3Z0KHIpOmUhPT16dCYmKGd0KHIsMCwwLCExKSxlPT09eHQmJih1ZShyLmhlYWQpLDA9PT1yLmxvb2thaGVhZCYmKHIuc3Ryc3RhcnQ9MCxyLmJsb2NrX3N0YXJ0PTAsci5pbnNlcnQ9MCkpKSxmZSh0KSwwPT09dC5hdmFpbF9vdXQpKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXR9cmV0dXJuIGUhPT1rdD9BdDpyLndyYXA8PTA/RXQ6KDI9PT1yLndyYXA/KGdlKHIsMjU1JnQuYWRsZXIpLGdlKHIsdC5hZGxlcj4+OCYyNTUpLGdlKHIsdC5hZGxlcj4+MTYmMjU1KSxnZShyLHQuYWRsZXI+PjI0JjI1NSksZ2UociwyNTUmdC50b3RhbF9pbiksZ2Uocix0LnRvdGFsX2luPj44JjI1NSksZ2Uocix0LnRvdGFsX2luPj4xNiYyNTUpLGdlKHIsdC50b3RhbF9pbj4+MjQmMjU1KSk6KHllKHIsdC5hZGxlcj4+PjE2KSx5ZShyLDY1NTM1JnQuYWRsZXIpKSxmZSh0KSxyLndyYXA+MCYmKHIud3JhcD0tci53cmFwKSwwIT09ci5wZW5kaW5nP0F0OkV0KX0sZGVmbGF0ZUVuZDp0PT57aWYoT2UodCkpcmV0dXJuIFN0O2NvbnN0IGU9dC5zdGF0ZS5zdGF0dXM7cmV0dXJuIHQuc3RhdGU9bnVsbCxlPT09cmU/aGUodCxCdCk6QXR9LGRlZmxhdGVTZXREaWN0aW9uYXJ5Oih0LGUpPT57bGV0IHI9ZS5sZW5ndGg7aWYoT2UodCkpcmV0dXJuIFN0O2NvbnN0IG49dC5zdGF0ZSxpPW4ud3JhcDtpZigyPT09aXx8MT09PWkmJm4uc3RhdHVzIT09cXR8fG4ubG9va2FoZWFkKXJldHVybiBTdDtpZigxPT09aSYmKHQuYWRsZXI9Y3QodC5hZGxlcixlLHIsMCkpLG4ud3JhcD0wLHI+PW4ud19zaXplKXswPT09aSYmKHVlKG4uaGVhZCksbi5zdHJzdGFydD0wLG4uYmxvY2tfc3RhcnQ9MCxuLmluc2VydD0wKTtsZXQgdD1uZXcgVWludDhBcnJheShuLndfc2l6ZSk7dC5zZXQoZS5zdWJhcnJheShyLW4ud19zaXplLHIpLDApLGU9dCxyPW4ud19zaXplfWNvbnN0IGE9dC5hdmFpbF9pbixzPXQubmV4dF9pbixvPXQuaW5wdXQ7Zm9yKHQuYXZhaWxfaW49cix0Lm5leHRfaW49MCx0LmlucHV0PWUsbWUobik7bi5sb29rYWhlYWQ+PVh0Oyl7bGV0IHQ9bi5zdHJzdGFydCxlPW4ubG9va2FoZWFkLShYdC0xKTtkb3tuLmluc19oPWRlKG4sbi5pbnNfaCxuLndpbmRvd1t0K1h0LTFdKSxuLnByZXZbdCZuLndfbWFza109bi5oZWFkW24uaW5zX2hdLG4uaGVhZFtuLmluc19oXT10LHQrK313aGlsZSgtLWUpO24uc3Ryc3RhcnQ9dCxuLmxvb2thaGVhZD1YdC0xLG1lKG4pfXJldHVybiBuLnN0cnN0YXJ0Kz1uLmxvb2thaGVhZCxuLmJsb2NrX3N0YXJ0PW4uc3Ryc3RhcnQsbi5pbnNlcnQ9bi5sb29rYWhlYWQsbi5sb29rYWhlYWQ9MCxuLm1hdGNoX2xlbmd0aD1uLnByZXZfbGVuZ3RoPVh0LTEsbi5tYXRjaF9hdmFpbGFibGU9MCx0Lm5leHRfaW49cyx0LmlucHV0PW8sdC5hdmFpbF9pbj1hLG4ud3JhcD1pLEF0fSxkZWZsYXRlSW5mbzoicGFrbyBkZWZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSJ9O2NvbnN0IFRlPSh0LGUpPT5PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCxlKTt2YXIgRmU9ZnVuY3Rpb24odCl7Y29uc3QgZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7Zm9yKDtlLmxlbmd0aDspe2NvbnN0IHI9ZS5zaGlmdCgpO2lmKHIpe2lmKCJvYmplY3QiIT10eXBlb2Ygcil0aHJvdyBuZXcgVHlwZUVycm9yKHIrIm11c3QgYmUgbm9uLW9iamVjdCIpO2Zvcihjb25zdCBlIGluIHIpVGUocixlKSYmKHRbZV09cltlXSl9fXJldHVybiB0fSxIZT17YXNzaWduOkZlLGZsYXR0ZW5DaHVua3M6dD0+e2xldCBlPTA7Zm9yKGxldCByPTAsbj10Lmxlbmd0aDtyPG47cisrKWUrPXRbcl0ubGVuZ3RoO2NvbnN0IHI9bmV3IFVpbnQ4QXJyYXkoZSk7Zm9yKGxldCBlPTAsbj0wLGk9dC5sZW5ndGg7ZTxpO2UrKyl7bGV0IGk9dFtlXTtyLnNldChpLG4pLG4rPWkubGVuZ3RofXJldHVybiByfX07bGV0IFplPSEwO3RyeXtTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsbmV3IFVpbnQ4QXJyYXkoMSkpfWNhdGNoKHQpe1plPSExfWNvbnN0IE1lPW5ldyBVaW50OEFycmF5KDI1Nik7Zm9yKGxldCB0PTA7dDwyNTY7dCsrKU1lW3RdPXQ+PTI1Mj82OnQ+PTI0OD81OnQ+PTI0MD80OnQ+PTIyND8zOnQ+PTE5Mj8yOjE7TWVbMjU0XT1NZVsyNTRdPTE7Y29uc3QgTmU9KHQsZSk9PntpZihlPDY1NTM0JiZ0LnN1YmFycmF5JiZaZSlyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLHQubGVuZ3RoPT09ZT90OnQuc3ViYXJyYXkoMCxlKSk7bGV0IHI9IiI7Zm9yKGxldCBuPTA7bjxlO24rKylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHRbbl0pO3JldHVybiByfTt2YXIgSWU9e3N0cmluZzJidWY6dD0+e2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBUZXh0RW5jb2RlciYmVGV4dEVuY29kZXIucHJvdG90eXBlLmVuY29kZSlyZXR1cm4obmV3IFRleHRFbmNvZGVyKS5lbmNvZGUodCk7bGV0IGUscixuLGksYSxzPXQubGVuZ3RoLG89MDtmb3IoaT0wO2k8cztpKyspcj10LmNoYXJDb2RlQXQoaSksNTUyOTY9PSg2NDUxMiZyKSYmaSsxPHMmJihuPXQuY2hhckNvZGVBdChpKzEpLDU2MzIwPT0oNjQ1MTImbikmJihyPTY1NTM2KyhyLTU1Mjk2PDwxMCkrKG4tNTYzMjApLGkrKykpLG8rPXI8MTI4PzE6cjwyMDQ4PzI6cjw2NTUzNj8zOjQ7Zm9yKGU9bmV3IFVpbnQ4QXJyYXkobyksYT0wLGk9MDthPG87aSsrKXI9dC5jaGFyQ29kZUF0KGkpLDU1Mjk2PT0oNjQ1MTImcikmJmkrMTxzJiYobj10LmNoYXJDb2RlQXQoaSsxKSw1NjMyMD09KDY0NTEyJm4pJiYocj02NTUzNisoci01NTI5Njw8MTApKyhuLTU2MzIwKSxpKyspKSxyPDEyOD9lW2ErK109cjpyPDIwNDg/KGVbYSsrXT0xOTJ8cj4+PjYsZVthKytdPTEyOHw2MyZyKTpyPDY1NTM2PyhlW2ErK109MjI0fHI+Pj4xMixlW2ErK109MTI4fHI+Pj42JjYzLGVbYSsrXT0xMjh8NjMmcik6KGVbYSsrXT0yNDB8cj4+PjE4LGVbYSsrXT0xMjh8cj4+PjEyJjYzLGVbYSsrXT0xMjh8cj4+PjYmNjMsZVthKytdPTEyOHw2MyZyKTtyZXR1cm4gZX0sYnVmMnN0cmluZzoodCxlKT0+e2NvbnN0IHI9ZXx8dC5sZW5ndGg7aWYoImZ1bmN0aW9uIj09dHlwZW9mIFRleHREZWNvZGVyJiZUZXh0RGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlKXJldHVybihuZXcgVGV4dERlY29kZXIpLmRlY29kZSh0LnN1YmFycmF5KDAsZSkpO2xldCBuLGk7Y29uc3QgYT1uZXcgQXJyYXkoMipyKTtmb3IoaT0wLG49MDtuPHI7KXtsZXQgZT10W24rK107aWYoZTwxMjgpe2FbaSsrXT1lO2NvbnRpbnVlfWxldCBzPU1lW2VdO2lmKHM+NClhW2krK109NjU1MzMsbis9cy0xO2Vsc2V7Zm9yKGUmPTI9PT1zPzMxOjM9PT1zPzE1Ojc7cz4xJiZuPHI7KWU9ZTw8Nnw2MyZ0W24rK10scy0tO3M+MT9hW2krK109NjU1MzM6ZTw2NTUzNj9hW2krK109ZTooZS09NjU1MzYsYVtpKytdPTU1Mjk2fGU+PjEwJjEwMjMsYVtpKytdPTU2MzIwfDEwMjMmZSl9fXJldHVybiBOZShhLGkpfSx1dGY4Ym9yZGVyOih0LGUpPT57KGU9ZXx8dC5sZW5ndGgpPnQubGVuZ3RoJiYoZT10Lmxlbmd0aCk7bGV0IHI9ZS0xO2Zvcig7cj49MCYmMTI4PT0oMTkyJnRbcl0pOylyLS07cmV0dXJuIHI8MHx8MD09PXI/ZTpyK01lW3Rbcl1dPmU/cjplfX07ZnVuY3Rpb24gUGUoKXt0aGlzLmlucHV0PW51bGwsdGhpcy5uZXh0X2luPTAsdGhpcy5hdmFpbF9pbj0wLHRoaXMudG90YWxfaW49MCx0aGlzLm91dHB1dD1udWxsLHRoaXMubmV4dF9vdXQ9MCx0aGlzLmF2YWlsX291dD0wLHRoaXMudG90YWxfb3V0PTAsdGhpcy5tc2c9IiIsdGhpcy5zdGF0ZT1udWxsLHRoaXMuZGF0YV90eXBlPTIsdGhpcy5hZGxlcj0wfXZhciBqZT1QZTtjb25zdCAkZT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLHtaX05PX0ZMVVNIOktlLFpfU1lOQ19GTFVTSDpYZSxaX0ZVTExfRkxVU0g6R2UsWl9GSU5JU0g6V2UsWl9PSzpZZSxaX1NUUkVBTV9FTkQ6cWUsWl9ERUZBVUxUX0NPTVBSRVNTSU9OOlZlLFpfREVGQVVMVF9TVFJBVEVHWTpRZSxaX0RFRkxBVEVEOkplfT1mdDtmdW5jdGlvbiB0cih0KXt0aGlzLm9wdGlvbnM9SGUuYXNzaWduKHtsZXZlbDpWZSxtZXRob2Q6SmUsY2h1bmtTaXplOjE2Mzg0LHdpbmRvd0JpdHM6MTUsbWVtTGV2ZWw6OCxzdHJhdGVneTpRZX0sdHx8e30pO2xldCBlPXRoaXMub3B0aW9ucztlLnJhdyYmZS53aW5kb3dCaXRzPjA/ZS53aW5kb3dCaXRzPS1lLndpbmRvd0JpdHM6ZS5nemlwJiZlLndpbmRvd0JpdHM+MCYmZS53aW5kb3dCaXRzPDE2JiYoZS53aW5kb3dCaXRzKz0xNiksdGhpcy5lcnI9MCx0aGlzLm1zZz0iIix0aGlzLmVuZGVkPSExLHRoaXMuY2h1bmtzPVtdLHRoaXMuc3RybT1uZXcgamUsdGhpcy5zdHJtLmF2YWlsX291dD0wO2xldCByPUNlLmRlZmxhdGVJbml0Mih0aGlzLnN0cm0sZS5sZXZlbCxlLm1ldGhvZCxlLndpbmRvd0JpdHMsZS5tZW1MZXZlbCxlLnN0cmF0ZWd5KTtpZihyIT09WWUpdGhyb3cgbmV3IEVycm9yKGR0W3JdKTtpZihlLmhlYWRlciYmQ2UuZGVmbGF0ZVNldEhlYWRlcih0aGlzLnN0cm0sZS5oZWFkZXIpLGUuZGljdGlvbmFyeSl7bGV0IHQ7aWYodD0ic3RyaW5nIj09dHlwZW9mIGUuZGljdGlvbmFyeT9JZS5zdHJpbmcyYnVmKGUuZGljdGlvbmFyeSk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PSRlLmNhbGwoZS5kaWN0aW9uYXJ5KT9uZXcgVWludDhBcnJheShlLmRpY3Rpb25hcnkpOmUuZGljdGlvbmFyeSxyPUNlLmRlZmxhdGVTZXREaWN0aW9uYXJ5KHRoaXMuc3RybSx0KSxyIT09WWUpdGhyb3cgbmV3IEVycm9yKGR0W3JdKTt0aGlzLl9kaWN0X3NldD0hMH19ZnVuY3Rpb24gZXIodCxlKXtjb25zdCByPW5ldyB0cihlKTtpZihyLnB1c2godCwhMCksci5lcnIpdGhyb3cgci5tc2d8fGR0W3IuZXJyXTtyZXR1cm4gci5yZXN1bHR9ZnVuY3Rpb24gcnIodCxlKXtyZXR1cm4oZT1lfHx7fSkucmF3PSEwLGVyKHQsZSl9ZnVuY3Rpb24gbnIodCxlKXtyZXR1cm4oZT1lfHx7fSkuZ3ppcD0hMCxlcih0LGUpfXRyLnByb3RvdHlwZS5wdXNoPWZ1bmN0aW9uKHQsZSl7Y29uc3Qgcj10aGlzLnN0cm0sbj10aGlzLm9wdGlvbnMuY2h1bmtTaXplO2xldCBpLGE7aWYodGhpcy5lbmRlZClyZXR1cm4hMTtmb3IoYT1lPT09fn5lP2U6ITA9PT1lP1dlOktlLCJzdHJpbmciPT10eXBlb2YgdD9yLmlucHV0PUllLnN0cmluZzJidWYodCk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PSRlLmNhbGwodCk/ci5pbnB1dD1uZXcgVWludDhBcnJheSh0KTpyLmlucHV0PXQsci5uZXh0X2luPTAsci5hdmFpbF9pbj1yLmlucHV0Lmxlbmd0aDs7KWlmKDA9PT1yLmF2YWlsX291dCYmKHIub3V0cHV0PW5ldyBVaW50OEFycmF5KG4pLHIubmV4dF9vdXQ9MCxyLmF2YWlsX291dD1uKSwoYT09PVhlfHxhPT09R2UpJiZyLmF2YWlsX291dDw9Nil0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxyLmF2YWlsX291dD0wO2Vsc2V7aWYoaT1DZS5kZWZsYXRlKHIsYSksaT09PXFlKXJldHVybiByLm5leHRfb3V0PjAmJnRoaXMub25EYXRhKHIub3V0cHV0LnN1YmFycmF5KDAsci5uZXh0X291dCkpLGk9Q2UuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pLHRoaXMub25FbmQoaSksdGhpcy5lbmRlZD0hMCxpPT09WWU7aWYoMCE9PXIuYXZhaWxfb3V0KXtpZihhPjAmJnIubmV4dF9vdXQ+MCl0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxyLmF2YWlsX291dD0wO2Vsc2UgaWYoMD09PXIuYXZhaWxfaW4pYnJlYWt9ZWxzZSB0aGlzLm9uRGF0YShyLm91dHB1dCl9cmV0dXJuITB9LHRyLnByb3RvdHlwZS5vbkRhdGE9ZnVuY3Rpb24odCl7dGhpcy5jaHVua3MucHVzaCh0KX0sdHIucHJvdG90eXBlLm9uRW5kPWZ1bmN0aW9uKHQpe3Q9PT1ZZSYmKHRoaXMucmVzdWx0PUhlLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpKSx0aGlzLmNodW5rcz1bXSx0aGlzLmVycj10LHRoaXMubXNnPXRoaXMuc3RybS5tc2d9O3ZhciBpcj10cixhcj1lcixzcj1ycixvcj1ucixscj1mdCxocj17RGVmbGF0ZTppcixkZWZsYXRlOmFyLGRlZmxhdGVSYXc6c3IsZ3ppcDpvcixjb25zdGFudHM6bHJ9O3QuRGVmbGF0ZT1pcix0LmNvbnN0YW50cz1scix0LmRlZmF1bHQ9aHIsdC5kZWZsYXRlPWFyLHQuZGVmbGF0ZVJhdz1zcix0Lmd6aXA9b3IsT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pfShhLmV4cG9ydHMpKSxhLmV4cG9ydHMpLG89e2V4cG9ydHM6e319O3ZhciBsLGg9e2V4cG9ydHM6e319O2Z1bmN0aW9uIGMoKXtyZXR1cm4gbHx8KGw9MSxoLmV4cG9ydHM9KGU9ZXx8ZnVuY3Rpb24oZSxyKXt2YXIgbjtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmd2luZG93LmNyeXB0byYmKG49d2luZG93LmNyeXB0byksInVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmJiZzZWxmLmNyeXB0byYmKG49c2VsZi5jcnlwdG8pLCJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcyYmZ2xvYmFsVGhpcy5jcnlwdG8mJihuPWdsb2JhbFRoaXMuY3J5cHRvKSwhbiYmInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJndpbmRvdy5tc0NyeXB0byYmKG49d2luZG93Lm1zQ3J5cHRvKSwhbiYmdm9pZCAwIT09dCYmdC5jcnlwdG8mJihuPXQuY3J5cHRvKSwhbil0cnl7bj11bmRlZmluZWR9Y2F0Y2godCl7fXZhciBpPWZ1bmN0aW9uKCl7aWYobil7aWYoImZ1bmN0aW9uIj09dHlwZW9mIG4uZ2V0UmFuZG9tVmFsdWVzKXRyeXtyZXR1cm4gbi5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQzMkFycmF5KDEpKVswXX1jYXRjaCh0KXt9aWYoImZ1bmN0aW9uIj09dHlwZW9mIG4ucmFuZG9tQnl0ZXMpdHJ5e3JldHVybiBuLnJhbmRvbUJ5dGVzKDQpLnJlYWRJbnQzMkxFKCl9Y2F0Y2godCl7fX10aHJvdyBuZXcgRXJyb3IoIk5hdGl2ZSBjcnlwdG8gbW9kdWxlIGNvdWxkIG5vdCBiZSB1c2VkIHRvIGdldCBzZWN1cmUgcmFuZG9tIG51bWJlci4iKX0sYT1PYmplY3QuY3JlYXRlfHxmdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXt9cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByO3JldHVybiB0LnByb3RvdHlwZT1lLHI9bmV3IHQsdC5wcm90b3R5cGU9bnVsbCxyfX0oKSxzPXt9LG89cy5saWI9e30sbD1vLkJhc2U9e2V4dGVuZDpmdW5jdGlvbih0KXt2YXIgZT1hKHRoaXMpO3JldHVybiB0JiZlLm1peEluKHQpLGUuaGFzT3duUHJvcGVydHkoImluaXQiKSYmdGhpcy5pbml0IT09ZS5pbml0fHwoZS5pbml0PWZ1bmN0aW9uKCl7ZS4kc3VwZXIuaW5pdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KSxlLmluaXQucHJvdG90eXBlPWUsZS4kc3VwZXI9dGhpcyxlfSxjcmVhdGU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmV4dGVuZCgpO3JldHVybiB0LmluaXQuYXBwbHkodCxhcmd1bWVudHMpLHR9LGluaXQ6ZnVuY3Rpb24oKXt9LG1peEluOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZSBpbiB0KXQuaGFzT3duUHJvcGVydHkoZSkmJih0aGlzW2VdPXRbZV0pO3QuaGFzT3duUHJvcGVydHkoInRvU3RyaW5nIikmJih0aGlzLnRvU3RyaW5nPXQudG9TdHJpbmcpfSxjbG9uZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmluaXQucHJvdG90eXBlLmV4dGVuZCh0aGlzKX19LGg9by5Xb3JkQXJyYXk9bC5leHRlbmQoe2luaXQ6ZnVuY3Rpb24odCxlKXt0PXRoaXMud29yZHM9dHx8W10sdGhpcy5zaWdCeXRlcz1lIT1yP2U6NCp0Lmxlbmd0aH0sdG9TdHJpbmc6ZnVuY3Rpb24odCl7cmV0dXJuKHR8fHUpLnN0cmluZ2lmeSh0aGlzKX0sY29uY2F0OmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMud29yZHMscj10LndvcmRzLG49dGhpcy5zaWdCeXRlcyxpPXQuc2lnQnl0ZXM7aWYodGhpcy5jbGFtcCgpLG4lNClmb3IodmFyIGE9MDthPGk7YSsrKXt2YXIgcz1yW2E+Pj4yXT4+PjI0LWElNCo4JjI1NTtlW24rYT4+PjJdfD1zPDwyNC0obithKSU0Kjh9ZWxzZSBmb3IodmFyIG89MDtvPGk7bys9NCllW24rbz4+PjJdPXJbbz4+PjJdO3JldHVybiB0aGlzLnNpZ0J5dGVzKz1pLHRoaXN9LGNsYW1wOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy53b3JkcyxyPXRoaXMuc2lnQnl0ZXM7dFtyPj4+Ml0mPTQyOTQ5NjcyOTU8PDMyLXIlNCo4LHQubGVuZ3RoPWUuY2VpbChyLzQpfSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWwuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC53b3Jkcz10aGlzLndvcmRzLnNsaWNlKDApLHR9LHJhbmRvbTpmdW5jdGlvbih0KXtmb3IodmFyIGU9W10scj0wO3I8dDtyKz00KWUucHVzaChpKCkpO3JldHVybiBuZXcgaC5pbml0KGUsdCl9fSksYz1zLmVuYz17fSx1PWMuSGV4PXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQud29yZHMscj10LnNpZ0J5dGVzLG49W10saT0wO2k8cjtpKyspe3ZhciBhPWVbaT4+PjJdPj4+MjQtaSU0KjgmMjU1O24ucHVzaCgoYT4+PjQpLnRvU3RyaW5nKDE2KSksbi5wdXNoKCgxNSZhKS50b1N0cmluZygxNikpfXJldHVybiBuLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC5sZW5ndGgscj1bXSxuPTA7bjxlO24rPTIpcltuPj4+M118PXBhcnNlSW50KHQuc3Vic3RyKG4sMiksMTYpPDwyNC1uJTgqNDtyZXR1cm4gbmV3IGguaW5pdChyLGUvMil9fSxfPWMuTGF0aW4xPXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQud29yZHMscj10LnNpZ0J5dGVzLG49W10saT0wO2k8cjtpKyspe3ZhciBhPWVbaT4+PjJdPj4+MjQtaSU0KjgmMjU1O24ucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGEpKX1yZXR1cm4gbi5qb2luKCIiKX0scGFyc2U6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQubGVuZ3RoLHI9W10sbj0wO248ZTtuKyspcltuPj4+Ml18PSgyNTUmdC5jaGFyQ29kZUF0KG4pKTw8MjQtbiU0Kjg7cmV0dXJuIG5ldyBoLmluaXQocixlKX19LGQ9Yy5VdGY4PXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7dHJ5e3JldHVybiBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKF8uc3RyaW5naWZ5KHQpKSl9Y2F0Y2godCl7dGhyb3cgbmV3IEVycm9yKCJNYWxmb3JtZWQgVVRGLTggZGF0YSIpfX0scGFyc2U6ZnVuY3Rpb24odCl7cmV0dXJuIF8ucGFyc2UodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHQpKSl9fSxmPW8uQnVmZmVyZWRCbG9ja0FsZ29yaXRobT1sLmV4dGVuZCh7cmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhPW5ldyBoLmluaXQsdGhpcy5fbkRhdGFCeXRlcz0wfSxfYXBwZW5kOmZ1bmN0aW9uKHQpeyJzdHJpbmciPT10eXBlb2YgdCYmKHQ9ZC5wYXJzZSh0KSksdGhpcy5fZGF0YS5jb25jYXQodCksdGhpcy5fbkRhdGFCeXRlcys9dC5zaWdCeXRlc30sX3Byb2Nlc3M6ZnVuY3Rpb24odCl7dmFyIHIsbj10aGlzLl9kYXRhLGk9bi53b3JkcyxhPW4uc2lnQnl0ZXMscz10aGlzLmJsb2NrU2l6ZSxvPWEvKDQqcyksbD0obz10P2UuY2VpbChvKTplLm1heCgoMHxvKS10aGlzLl9taW5CdWZmZXJTaXplLDApKSpzLGM9ZS5taW4oNCpsLGEpO2lmKGwpe2Zvcih2YXIgdT0wO3U8bDt1Kz1zKXRoaXMuX2RvUHJvY2Vzc0Jsb2NrKGksdSk7cj1pLnNwbGljZSgwLGwpLG4uc2lnQnl0ZXMtPWN9cmV0dXJuIG5ldyBoLmluaXQocixjKX0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1sLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2RhdGE9dGhpcy5fZGF0YS5jbG9uZSgpLHR9LF9taW5CdWZmZXJTaXplOjB9KTtvLkhhc2hlcj1mLmV4dGVuZCh7Y2ZnOmwuZXh0ZW5kKCksaW5pdDpmdW5jdGlvbih0KXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQodCksdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe2YucmVzZXQuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9LHVwZGF0ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fYXBwZW5kKHQpLHRoaXMuX3Byb2Nlc3MoKSx0aGlzfSxmaW5hbGl6ZTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmdGhpcy5fYXBwZW5kKHQpLHRoaXMuX2RvRmluYWxpemUoKX0sYmxvY2tTaXplOjE2LF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUscil7cmV0dXJuIG5ldyB0LmluaXQocikuZmluYWxpemUoZSl9fSxfY3JlYXRlSG1hY0hlbHBlcjpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyKXtyZXR1cm4gbmV3IHAuSE1BQy5pbml0KHQscikuZmluYWxpemUoZSl9fX0pO3ZhciBwPXMuYWxnbz17fTtyZXR1cm4gc30oTWF0aCksZSkpLGguZXhwb3J0czt2YXIgZX12YXIgdTtmdW5jdGlvbiBfKCl7cmV0dXJuIHV8fCh1PTEsby5leHBvcnRzPSh0PWMoKSxmdW5jdGlvbigpe3ZhciBlPXQscj1lLmxpYi5Xb3JkQXJyYXk7ZnVuY3Rpb24gbih0LGUsbil7Zm9yKHZhciBpPVtdLGE9MCxzPTA7czxlO3MrKylpZihzJTQpe3ZhciBvPW5bdC5jaGFyQ29kZUF0KHMtMSldPDxzJTQqMnxuW3QuY2hhckNvZGVBdChzKV0+Pj42LXMlNCoyO2lbYT4+PjJdfD1vPDwyNC1hJTQqOCxhKyt9cmV0dXJuIHIuY3JlYXRlKGksYSl9ZS5lbmMuQmFzZTY0PXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7dmFyIGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMsbj10aGlzLl9tYXA7dC5jbGFtcCgpO2Zvcih2YXIgaT1bXSxhPTA7YTxyO2ErPTMpZm9yKHZhciBzPShlW2E+Pj4yXT4+PjI0LWElNCo4JjI1NSk8PDE2fChlW2ErMT4+PjJdPj4+MjQtKGErMSklNCo4JjI1NSk8PDh8ZVthKzI+Pj4yXT4+PjI0LShhKzIpJTQqOCYyNTUsbz0wO288NCYmYSsuNzUqbzxyO28rKylpLnB1c2gobi5jaGFyQXQocz4+PjYqKDMtbykmNjMpKTt2YXIgbD1uLmNoYXJBdCg2NCk7aWYobClmb3IoO2kubGVuZ3RoJTQ7KWkucHVzaChsKTtyZXR1cm4gaS5qb2luKCIiKX0scGFyc2U6ZnVuY3Rpb24odCl7dmFyIGU9dC5sZW5ndGgscj10aGlzLl9tYXAsaT10aGlzLl9yZXZlcnNlTWFwO2lmKCFpKXtpPXRoaXMuX3JldmVyc2VNYXA9W107Zm9yKHZhciBhPTA7YTxyLmxlbmd0aDthKyspaVtyLmNoYXJDb2RlQXQoYSldPWF9dmFyIHM9ci5jaGFyQXQoNjQpO2lmKHMpe3ZhciBvPXQuaW5kZXhPZihzKTstMSE9PW8mJihlPW8pfXJldHVybiBuKHQsZSxpKX0sX21hcDoiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0ifX0oKSx0LmVuYy5CYXNlNjQpKSxvLmV4cG9ydHM7dmFyIHR9dmFyIGQsZj1lKF8oKSkscD17ZXhwb3J0czp7fX0sZz17ZXhwb3J0czp7fX07ZnVuY3Rpb24geSgpe3JldHVybiBkfHwoZD0xLGcuZXhwb3J0cz0odD1jKCksZnVuY3Rpb24oZSl7dmFyIHI9dCxuPXIubGliLGk9bi5Xb3JkQXJyYXksYT1uLkhhc2hlcixzPXIuYWxnbyxvPVtdOyFmdW5jdGlvbigpe2Zvcih2YXIgdD0wO3Q8NjQ7dCsrKW9bdF09NDI5NDk2NzI5NiplLmFicyhlLnNpbih0KzEpKXwwfSgpO3ZhciBsPXMuTUQ1PWEuZXh0ZW5kKHtfZG9SZXNldDpmdW5jdGlvbigpe3RoaXMuX2hhc2g9bmV3IGkuaW5pdChbMTczMjU4NDE5Myw0MDIzMjMzNDE3LDI1NjIzODMxMDIsMjcxNzMzODc4XSl9LF9kb1Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe2Zvcih2YXIgcj0wO3I8MTY7cisrKXt2YXIgbj1lK3IsaT10W25dO3Rbbl09MTY3MTE5MzUmKGk8PDh8aT4+PjI0KXw0Mjc4MjU1MzYwJihpPDwyNHxpPj4+OCl9dmFyIGE9dGhpcy5faGFzaC53b3JkcyxzPXRbZSswXSxsPXRbZSsxXSxkPXRbZSsyXSxmPXRbZSszXSxwPXRbZSs0XSxnPXRbZSs1XSx5PXRbZSs2XSx3PXRbZSs3XSx2PXRbZSs4XSxtPXRbZSs5XSxiPXRbZSsxMF0seD10W2UrMTFdLGs9dFtlKzEyXSx6PXRbZSsxM10sQT10W2UrMTRdLEU9dFtlKzE1XSxTPWFbMF0sQj1hWzFdLEw9YVsyXSxPPWFbM107Uz1oKFMsQixMLE8scyw3LG9bMF0pLE89aChPLFMsQixMLGwsMTIsb1sxXSksTD1oKEwsTyxTLEIsZCwxNyxvWzJdKSxCPWgoQixMLE8sUyxmLDIyLG9bM10pLFM9aChTLEIsTCxPLHAsNyxvWzRdKSxPPWgoTyxTLEIsTCxnLDEyLG9bNV0pLEw9aChMLE8sUyxCLHksMTcsb1s2XSksQj1oKEIsTCxPLFMsdywyMixvWzddKSxTPWgoUyxCLEwsTyx2LDcsb1s4XSksTz1oKE8sUyxCLEwsbSwxMixvWzldKSxMPWgoTCxPLFMsQixiLDE3LG9bMTBdKSxCPWgoQixMLE8sUyx4LDIyLG9bMTFdKSxTPWgoUyxCLEwsTyxrLDcsb1sxMl0pLE89aChPLFMsQixMLHosMTIsb1sxM10pLEw9aChMLE8sUyxCLEEsMTcsb1sxNF0pLFM9YyhTLEI9aChCLEwsTyxTLEUsMjIsb1sxNV0pLEwsTyxsLDUsb1sxNl0pLE89YyhPLFMsQixMLHksOSxvWzE3XSksTD1jKEwsTyxTLEIseCwxNCxvWzE4XSksQj1jKEIsTCxPLFMscywyMCxvWzE5XSksUz1jKFMsQixMLE8sZyw1LG9bMjBdKSxPPWMoTyxTLEIsTCxiLDksb1syMV0pLEw9YyhMLE8sUyxCLEUsMTQsb1syMl0pLEI9YyhCLEwsTyxTLHAsMjAsb1syM10pLFM9YyhTLEIsTCxPLG0sNSxvWzI0XSksTz1jKE8sUyxCLEwsQSw5LG9bMjVdKSxMPWMoTCxPLFMsQixmLDE0LG9bMjZdKSxCPWMoQixMLE8sUyx2LDIwLG9bMjddKSxTPWMoUyxCLEwsTyx6LDUsb1syOF0pLE89YyhPLFMsQixMLGQsOSxvWzI5XSksTD1jKEwsTyxTLEIsdywxNCxvWzMwXSksUz11KFMsQj1jKEIsTCxPLFMsaywyMCxvWzMxXSksTCxPLGcsNCxvWzMyXSksTz11KE8sUyxCLEwsdiwxMSxvWzMzXSksTD11KEwsTyxTLEIseCwxNixvWzM0XSksQj11KEIsTCxPLFMsQSwyMyxvWzM1XSksUz11KFMsQixMLE8sbCw0LG9bMzZdKSxPPXUoTyxTLEIsTCxwLDExLG9bMzddKSxMPXUoTCxPLFMsQix3LDE2LG9bMzhdKSxCPXUoQixMLE8sUyxiLDIzLG9bMzldKSxTPXUoUyxCLEwsTyx6LDQsb1s0MF0pLE89dShPLFMsQixMLHMsMTEsb1s0MV0pLEw9dShMLE8sUyxCLGYsMTYsb1s0Ml0pLEI9dShCLEwsTyxTLHksMjMsb1s0M10pLFM9dShTLEIsTCxPLG0sNCxvWzQ0XSksTz11KE8sUyxCLEwsaywxMSxvWzQ1XSksTD11KEwsTyxTLEIsRSwxNixvWzQ2XSksUz1fKFMsQj11KEIsTCxPLFMsZCwyMyxvWzQ3XSksTCxPLHMsNixvWzQ4XSksTz1fKE8sUyxCLEwsdywxMCxvWzQ5XSksTD1fKEwsTyxTLEIsQSwxNSxvWzUwXSksQj1fKEIsTCxPLFMsZywyMSxvWzUxXSksUz1fKFMsQixMLE8sayw2LG9bNTJdKSxPPV8oTyxTLEIsTCxmLDEwLG9bNTNdKSxMPV8oTCxPLFMsQixiLDE1LG9bNTRdKSxCPV8oQixMLE8sUyxsLDIxLG9bNTVdKSxTPV8oUyxCLEwsTyx2LDYsb1s1Nl0pLE89XyhPLFMsQixMLEUsMTAsb1s1N10pLEw9XyhMLE8sUyxCLHksMTUsb1s1OF0pLEI9XyhCLEwsTyxTLHosMjEsb1s1OV0pLFM9XyhTLEIsTCxPLHAsNixvWzYwXSksTz1fKE8sUyxCLEwseCwxMCxvWzYxXSksTD1fKEwsTyxTLEIsZCwxNSxvWzYyXSksQj1fKEIsTCxPLFMsbSwyMSxvWzYzXSksYVswXT1hWzBdK1N8MCxhWzFdPWFbMV0rQnwwLGFbMl09YVsyXStMfDAsYVszXT1hWzNdK098MH0sX2RvRmluYWxpemU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9kYXRhLHI9dC53b3JkcyxuPTgqdGhpcy5fbkRhdGFCeXRlcyxpPTgqdC5zaWdCeXRlcztyW2k+Pj41XXw9MTI4PDwyNC1pJTMyO3ZhciBhPWUuZmxvb3Iobi80Mjk0OTY3Mjk2KSxzPW47clsxNSsoaSs2ND4+Pjk8PDQpXT0xNjcxMTkzNSYoYTw8OHxhPj4+MjQpfDQyNzgyNTUzNjAmKGE8PDI0fGE+Pj44KSxyWzE0KyhpKzY0Pj4+OTw8NCldPTE2NzExOTM1JihzPDw4fHM+Pj4yNCl8NDI3ODI1NTM2MCYoczw8MjR8cz4+PjgpLHQuc2lnQnl0ZXM9NCooci5sZW5ndGgrMSksdGhpcy5fcHJvY2VzcygpO2Zvcih2YXIgbz10aGlzLl9oYXNoLGw9by53b3JkcyxoPTA7aDw0O2grKyl7dmFyIGM9bFtoXTtsW2hdPTE2NzExOTM1JihjPDw4fGM+Pj4yNCl8NDI3ODI1NTM2MCYoYzw8MjR8Yz4+PjgpfXJldHVybiBvfSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWEuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5faGFzaD10aGlzLl9oYXNoLmNsb25lKCksdH19KTtmdW5jdGlvbiBoKHQsZSxyLG4saSxhLHMpe3ZhciBvPXQrKGUmcnx+ZSZuKStpK3M7cmV0dXJuKG88PGF8bz4+PjMyLWEpK2V9ZnVuY3Rpb24gYyh0LGUscixuLGksYSxzKXt2YXIgbz10KyhlJm58ciZ+bikraStzO3JldHVybihvPDxhfG8+Pj4zMi1hKStlfWZ1bmN0aW9uIHUodCxlLHIsbixpLGEscyl7dmFyIG89dCsoZV5yXm4pK2krcztyZXR1cm4obzw8YXxvPj4+MzItYSkrZX1mdW5jdGlvbiBfKHQsZSxyLG4saSxhLHMpe3ZhciBvPXQrKHJeKGV8fm4pKStpK3M7cmV0dXJuKG88PGF8bz4+PjMyLWEpK2V9ci5NRDU9YS5fY3JlYXRlSGVscGVyKGwpLHIuSG1hY01ENT1hLl9jcmVhdGVIbWFjSGVscGVyKGwpfShNYXRoKSx0Lk1ENSkpLGcuZXhwb3J0czt2YXIgdH12YXIgdyx2PXtleHBvcnRzOnt9fSxtPXtleHBvcnRzOnt9fTtmdW5jdGlvbiBiKCl7cmV0dXJuIHd8fCh3PTEsbS5leHBvcnRzPSh0PWMoKSxmdW5jdGlvbigpe3ZhciBlPXQscj1lLmxpYixuPXIuV29yZEFycmF5LGk9ci5IYXNoZXIsYT1lLmFsZ28scz1bXSxvPWEuU0hBMT1pLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9oYXNoPW5ldyBuLmluaXQoWzE3MzI1ODQxOTMsNDAyMzIzMzQxNywyNTYyMzgzMTAyLDI3MTczMzg3OCwzMjg1Mzc3NTIwXSl9LF9kb1Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe2Zvcih2YXIgcj10aGlzLl9oYXNoLndvcmRzLG49clswXSxpPXJbMV0sYT1yWzJdLG89clszXSxsPXJbNF0saD0wO2g8ODA7aCsrKXtpZihoPDE2KXNbaF09MHx0W2UraF07ZWxzZXt2YXIgYz1zW2gtM11ec1toLThdXnNbaC0xNF1ec1toLTE2XTtzW2hdPWM8PDF8Yz4+PjMxfXZhciB1PShuPDw1fG4+Pj4yNykrbCtzW2hdO3UrPWg8MjA/MTUxODUwMDI0OSsoaSZhfH5pJm8pOmg8NDA/MTg1OTc3NTM5MysoaV5hXm8pOmg8NjA/KGkmYXxpJm98YSZvKS0xODk0MDA3NTg4OihpXmFebyktODk5NDk3NTE0LGw9byxvPWEsYT1pPDwzMHxpPj4+MixpPW4sbj11fXJbMF09clswXStufDAsclsxXT1yWzFdK2l8MCxyWzJdPXJbMl0rYXwwLHJbM109clszXStvfDAscls0XT1yWzRdK2x8MH0sX2RvRmluYWxpemU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9kYXRhLGU9dC53b3JkcyxyPTgqdGhpcy5fbkRhdGFCeXRlcyxuPTgqdC5zaWdCeXRlcztyZXR1cm4gZVtuPj4+NV18PTEyODw8MjQtbiUzMixlWzE0KyhuKzY0Pj4+OTw8NCldPU1hdGguZmxvb3Ioci80Mjk0OTY3Mjk2KSxlWzE1KyhuKzY0Pj4+OTw8NCldPXIsdC5zaWdCeXRlcz00KmUubGVuZ3RoLHRoaXMuX3Byb2Nlc3MoKSx0aGlzLl9oYXNofSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWkuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5faGFzaD10aGlzLl9oYXNoLmNsb25lKCksdH19KTtlLlNIQTE9aS5fY3JlYXRlSGVscGVyKG8pLGUuSG1hY1NIQTE9aS5fY3JlYXRlSG1hY0hlbHBlcihvKX0oKSx0LlNIQTEpKSxtLmV4cG9ydHM7dmFyIHR9dmFyIHgsaz17ZXhwb3J0czp7fX07ZnVuY3Rpb24geigpe3JldHVybiB4fHwoeD0xLGsuZXhwb3J0cz0odD1jKCkscj0oZT10KS5saWIuQmFzZSxuPWUuZW5jLlV0Zjgsdm9pZChlLmFsZ28uSE1BQz1yLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0LGUpe3Q9dGhpcy5faGFzaGVyPW5ldyB0LmluaXQsInN0cmluZyI9PXR5cGVvZiBlJiYoZT1uLnBhcnNlKGUpKTt2YXIgcj10LmJsb2NrU2l6ZSxpPTQqcjtlLnNpZ0J5dGVzPmkmJihlPXQuZmluYWxpemUoZSkpLGUuY2xhbXAoKTtmb3IodmFyIGE9dGhpcy5fb0tleT1lLmNsb25lKCkscz10aGlzLl9pS2V5PWUuY2xvbmUoKSxvPWEud29yZHMsbD1zLndvcmRzLGg9MDtoPHI7aCsrKW9baF1ePTE1NDk1NTY4MjgsbFtoXV49OTA5NTIyNDg2O2Euc2lnQnl0ZXM9cy5zaWdCeXRlcz1pLHRoaXMucmVzZXQoKX0scmVzZXQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9oYXNoZXI7dC5yZXNldCgpLHQudXBkYXRlKHRoaXMuX2lLZXkpfSx1cGRhdGU6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2hhc2hlci51cGRhdGUodCksdGhpc30sZmluYWxpemU6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5faGFzaGVyLHI9ZS5maW5hbGl6ZSh0KTtyZXR1cm4gZS5yZXNldCgpLGUuZmluYWxpemUodGhpcy5fb0tleS5jbG9uZSgpLmNvbmNhdChyKSl9fSkpKSksay5leHBvcnRzO3ZhciB0LGUscixufXZhciBBO2Z1bmN0aW9uIEUoKXtyZXR1cm4gQXx8KEE9MSx2LmV4cG9ydHM9KHQ9YygpLGIoKSx6KCksZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIsbj1yLkJhc2UsaT1yLldvcmRBcnJheSxhPWUuYWxnbyxzPWEuTUQ1LG89YS5FdnBLREY9bi5leHRlbmQoe2NmZzpuLmV4dGVuZCh7a2V5U2l6ZTo0LGhhc2hlcjpzLGl0ZXJhdGlvbnM6MX0pLGluaXQ6ZnVuY3Rpb24odCl7dGhpcy5jZmc9dGhpcy5jZmcuZXh0ZW5kKHQpfSxjb21wdXRlOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByLG49dGhpcy5jZmcsYT1uLmhhc2hlci5jcmVhdGUoKSxzPWkuY3JlYXRlKCksbz1zLndvcmRzLGw9bi5rZXlTaXplLGg9bi5pdGVyYXRpb25zO28ubGVuZ3RoPGw7KXtyJiZhLnVwZGF0ZShyKSxyPWEudXBkYXRlKHQpLmZpbmFsaXplKGUpLGEucmVzZXQoKTtmb3IodmFyIGM9MTtjPGg7YysrKXI9YS5maW5hbGl6ZShyKSxhLnJlc2V0KCk7cy5jb25jYXQocil9cmV0dXJuIHMuc2lnQnl0ZXM9NCpsLHN9fSk7ZS5FdnBLREY9ZnVuY3Rpb24odCxlLHIpe3JldHVybiBvLmNyZWF0ZShyKS5jb21wdXRlKHQsZSl9fSgpLHQuRXZwS0RGKSksdi5leHBvcnRzO3ZhciB0fXZhciBTLEI9e2V4cG9ydHM6e319O3ZhciBMO3ZhciBPLFIsRD0oTHx8KEw9MSxwLmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLkJsb2NrQ2lwaGVyLG49ZS5hbGdvLGk9W10sYT1bXSxzPVtdLG89W10sbD1bXSxoPVtdLGM9W10sdT1bXSxfPVtdLGQ9W107IWZ1bmN0aW9uKCl7Zm9yKHZhciB0PVtdLGU9MDtlPDI1NjtlKyspdFtlXT1lPDEyOD9lPDwxOmU8PDFeMjgzO3ZhciByPTAsbj0wO2ZvcihlPTA7ZTwyNTY7ZSsrKXt2YXIgZj1uXm48PDFebjw8Ml5uPDwzXm48PDQ7Zj1mPj4+OF4yNTUmZl45OSxpW3JdPWYsYVtmXT1yO3ZhciBwPXRbcl0sZz10W3BdLHk9dFtnXSx3PTI1Nyp0W2ZdXjE2ODQzMDA4KmY7c1tyXT13PDwyNHx3Pj4+OCxvW3JdPXc8PDE2fHc+Pj4xNixsW3JdPXc8PDh8dz4+PjI0LGhbcl09dyx3PTE2ODQzMDA5KnleNjU1MzcqZ14yNTcqcF4xNjg0MzAwOCpyLGNbZl09dzw8MjR8dz4+PjgsdVtmXT13PDwxNnx3Pj4+MTYsX1tmXT13PDw4fHc+Pj4yNCxkW2ZdPXcscj8ocj1wXnRbdFt0W3lecF1dXSxuXj10W3Rbbl1dKTpyPW49MX19KCk7dmFyIGY9WzAsMSwyLDQsOCwxNiwzMiw2NCwxMjgsMjcsNTRdLHA9bi5BRVM9ci5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7aWYoIXRoaXMuX25Sb3VuZHN8fHRoaXMuX2tleVByaW9yUmVzZXQhPT10aGlzLl9rZXkpe2Zvcih2YXIgdD10aGlzLl9rZXlQcmlvclJlc2V0PXRoaXMuX2tleSxlPXQud29yZHMscj10LnNpZ0J5dGVzLzQsbj00KigodGhpcy5fblJvdW5kcz1yKzYpKzEpLGE9dGhpcy5fa2V5U2NoZWR1bGU9W10scz0wO3M8bjtzKyspczxyP2Fbc109ZVtzXTooaD1hW3MtMV0scyVyP3I+NiYmcyVyPT00JiYoaD1pW2g+Pj4yNF08PDI0fGlbaD4+PjE2JjI1NV08PDE2fGlbaD4+PjgmMjU1XTw8OHxpWzI1NSZoXSk6KGg9aVsoaD1oPDw4fGg+Pj4yNCk+Pj4yNF08PDI0fGlbaD4+PjE2JjI1NV08PDE2fGlbaD4+PjgmMjU1XTw8OHxpWzI1NSZoXSxoXj1mW3MvcnwwXTw8MjQpLGFbc109YVtzLXJdXmgpO2Zvcih2YXIgbz10aGlzLl9pbnZLZXlTY2hlZHVsZT1bXSxsPTA7bDxuO2wrKyl7aWYocz1uLWwsbCU0KXZhciBoPWFbc107ZWxzZSBoPWFbcy00XTtvW2xdPWw8NHx8czw9ND9oOmNbaVtoPj4+MjRdXV51W2lbaD4+PjE2JjI1NV1dXl9baVtoPj4+OCYyNTVdXV5kW2lbMjU1JmhdXX19fSxlbmNyeXB0QmxvY2s6ZnVuY3Rpb24odCxlKXt0aGlzLl9kb0NyeXB0QmxvY2sodCxlLHRoaXMuX2tleVNjaGVkdWxlLHMsbyxsLGgsaSl9LGRlY3J5cHRCbG9jazpmdW5jdGlvbih0LGUpe3ZhciByPXRbZSsxXTt0W2UrMV09dFtlKzNdLHRbZSszXT1yLHRoaXMuX2RvQ3J5cHRCbG9jayh0LGUsdGhpcy5faW52S2V5U2NoZWR1bGUsYyx1LF8sZCxhKSxyPXRbZSsxXSx0W2UrMV09dFtlKzNdLHRbZSszXT1yfSxfZG9DcnlwdEJsb2NrOmZ1bmN0aW9uKHQsZSxyLG4saSxhLHMsbyl7Zm9yKHZhciBsPXRoaXMuX25Sb3VuZHMsaD10W2VdXnJbMF0sYz10W2UrMV1eclsxXSx1PXRbZSsyXV5yWzJdLF89dFtlKzNdXnJbM10sZD00LGY9MTtmPGw7ZisrKXt2YXIgcD1uW2g+Pj4yNF1eaVtjPj4+MTYmMjU1XV5hW3U+Pj44JjI1NV1ec1syNTUmX11ecltkKytdLGc9bltjPj4+MjRdXmlbdT4+PjE2JjI1NV1eYVtfPj4+OCYyNTVdXnNbMjU1JmhdXnJbZCsrXSx5PW5bdT4+PjI0XV5pW18+Pj4xNiYyNTVdXmFbaD4+PjgmMjU1XV5zWzI1NSZjXV5yW2QrK10sdz1uW18+Pj4yNF1eaVtoPj4+MTYmMjU1XV5hW2M+Pj44JjI1NV1ec1syNTUmdV1ecltkKytdO2g9cCxjPWcsdT15LF89d31wPShvW2g+Pj4yNF08PDI0fG9bYz4+PjE2JjI1NV08PDE2fG9bdT4+PjgmMjU1XTw8OHxvWzI1NSZfXSlecltkKytdLGc9KG9bYz4+PjI0XTw8MjR8b1t1Pj4+MTYmMjU1XTw8MTZ8b1tfPj4+OCYyNTVdPDw4fG9bMjU1JmhdKV5yW2QrK10seT0ob1t1Pj4+MjRdPDwyNHxvW18+Pj4xNiYyNTVdPDwxNnxvW2g+Pj44JjI1NV08PDh8b1syNTUmY10pXnJbZCsrXSx3PShvW18+Pj4yNF08PDI0fG9baD4+PjE2JjI1NV08PDE2fG9bYz4+PjgmMjU1XTw8OHxvWzI1NSZ1XSlecltkKytdLHRbZV09cCx0W2UrMV09Zyx0W2UrMl09eSx0W2UrM109d30sa2V5U2l6ZTo4fSk7ZS5BRVM9ci5fY3JlYXRlSGVscGVyKHApfSgpLHQuQUVTfShjKCksXygpLHkoKSxFKCksU3x8KFM9MSxCLmV4cG9ydHM9KE89YygpLEUoKSx2b2lkKE8ubGliLkNpcGhlcnx8ZnVuY3Rpb24odCl7dmFyIGU9TyxyPWUubGliLG49ci5CYXNlLGk9ci5Xb3JkQXJyYXksYT1yLkJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0scz1lLmVuYztzLlV0Zjg7dmFyIG89cy5CYXNlNjQsbD1lLmFsZ28uRXZwS0RGLGg9ci5DaXBoZXI9YS5leHRlbmQoe2NmZzpuLmV4dGVuZCgpLGNyZWF0ZUVuY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9FTkNfWEZPUk1fTU9ERSx0LGUpfSxjcmVhdGVEZWNyeXB0b3I6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5jcmVhdGUodGhpcy5fREVDX1hGT1JNX01PREUsdCxlKX0saW5pdDpmdW5jdGlvbih0LGUscil7dGhpcy5jZmc9dGhpcy5jZmcuZXh0ZW5kKHIpLHRoaXMuX3hmb3JtTW9kZT10LHRoaXMuX2tleT1lLHRoaXMucmVzZXQoKX0scmVzZXQ6ZnVuY3Rpb24oKXthLnJlc2V0LmNhbGwodGhpcyksdGhpcy5fZG9SZXNldCgpfSxwcm9jZXNzOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9hcHBlbmQodCksdGhpcy5fcHJvY2VzcygpfSxmaW5hbGl6ZTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmdGhpcy5fYXBwZW5kKHQpLHRoaXMuX2RvRmluYWxpemUoKX0sa2V5U2l6ZTo0LGl2U2l6ZTo0LF9FTkNfWEZPUk1fTU9ERToxLF9ERUNfWEZPUk1fTU9ERToyLF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQpe3JldHVybiJzdHJpbmciPT10eXBlb2YgdD93Omd9cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybntlbmNyeXB0OmZ1bmN0aW9uKHIsbixpKXtyZXR1cm4gdChuKS5lbmNyeXB0KGUscixuLGkpfSxkZWNyeXB0OmZ1bmN0aW9uKHIsbixpKXtyZXR1cm4gdChuKS5kZWNyeXB0KGUscixuLGkpfX19fSgpfSk7ci5TdHJlYW1DaXBoZXI9aC5leHRlbmQoe19kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3Byb2Nlc3MoITApfSxibG9ja1NpemU6MX0pO3ZhciBjPWUubW9kZT17fSx1PXIuQmxvY2tDaXBoZXJNb2RlPW4uZXh0ZW5kKHtjcmVhdGVFbmNyeXB0b3I6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5FbmNyeXB0b3IuY3JlYXRlKHQsZSl9LGNyZWF0ZURlY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLkRlY3J5cHRvci5jcmVhdGUodCxlKX0saW5pdDpmdW5jdGlvbih0LGUpe3RoaXMuX2NpcGhlcj10LHRoaXMuX2l2PWV9fSksXz1jLkNCQz1mdW5jdGlvbigpe3ZhciBlPXUuZXh0ZW5kKCk7ZnVuY3Rpb24gcihlLHIsbil7dmFyIGksYT10aGlzLl9pdjthPyhpPWEsdGhpcy5faXY9dCk6aT10aGlzLl9wcmV2QmxvY2s7Zm9yKHZhciBzPTA7czxuO3MrKyllW3Irc11ePWlbc119cmV0dXJuIGUuRW5jcnlwdG9yPWUuZXh0ZW5kKHtwcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXt2YXIgbj10aGlzLl9jaXBoZXIsaT1uLmJsb2NrU2l6ZTtyLmNhbGwodGhpcyx0LGUsaSksbi5lbmNyeXB0QmxvY2sodCxlKSx0aGlzLl9wcmV2QmxvY2s9dC5zbGljZShlLGUraSl9fSksZS5EZWNyeXB0b3I9ZS5leHRlbmQoe3Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMuX2NpcGhlcixpPW4uYmxvY2tTaXplLGE9dC5zbGljZShlLGUraSk7bi5kZWNyeXB0QmxvY2sodCxlKSxyLmNhbGwodGhpcyx0LGUsaSksdGhpcy5fcHJldkJsb2NrPWF9fSksZX0oKSxkPShlLnBhZD17fSkuUGtjczc9e3BhZDpmdW5jdGlvbih0LGUpe2Zvcih2YXIgcj00KmUsbj1yLXQuc2lnQnl0ZXMlcixhPW48PDI0fG48PDE2fG48PDh8bixzPVtdLG89MDtvPG47bys9NClzLnB1c2goYSk7dmFyIGw9aS5jcmVhdGUocyxuKTt0LmNvbmNhdChsKX0sdW5wYWQ6ZnVuY3Rpb24odCl7dmFyIGU9MjU1JnQud29yZHNbdC5zaWdCeXRlcy0xPj4+Ml07dC5zaWdCeXRlcy09ZX19O3IuQmxvY2tDaXBoZXI9aC5leHRlbmQoe2NmZzpoLmNmZy5leHRlbmQoe21vZGU6XyxwYWRkaW5nOmR9KSxyZXNldDpmdW5jdGlvbigpe3ZhciB0O2gucmVzZXQuY2FsbCh0aGlzKTt2YXIgZT10aGlzLmNmZyxyPWUuaXYsbj1lLm1vZGU7dGhpcy5feGZvcm1Nb2RlPT10aGlzLl9FTkNfWEZPUk1fTU9ERT90PW4uY3JlYXRlRW5jcnlwdG9yOih0PW4uY3JlYXRlRGVjcnlwdG9yLHRoaXMuX21pbkJ1ZmZlclNpemU9MSksdGhpcy5fbW9kZSYmdGhpcy5fbW9kZS5fX2NyZWF0b3I9PXQ/dGhpcy5fbW9kZS5pbml0KHRoaXMsciYmci53b3Jkcyk6KHRoaXMuX21vZGU9dC5jYWxsKG4sdGhpcyxyJiZyLndvcmRzKSx0aGlzLl9tb2RlLl9fY3JlYXRvcj10KX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7dGhpcy5fbW9kZS5wcm9jZXNzQmxvY2sodCxlKX0sX2RvRmluYWxpemU6ZnVuY3Rpb24oKXt2YXIgdCxlPXRoaXMuY2ZnLnBhZGRpbmc7cmV0dXJuIHRoaXMuX3hmb3JtTW9kZT09dGhpcy5fRU5DX1hGT1JNX01PREU/KGUucGFkKHRoaXMuX2RhdGEsdGhpcy5ibG9ja1NpemUpLHQ9dGhpcy5fcHJvY2VzcyghMCkpOih0PXRoaXMuX3Byb2Nlc3MoITApLGUudW5wYWQodCkpLHR9LGJsb2NrU2l6ZTo0fSk7dmFyIGY9ci5DaXBoZXJQYXJhbXM9bi5leHRlbmQoe2luaXQ6ZnVuY3Rpb24odCl7dGhpcy5taXhJbih0KX0sdG9TdHJpbmc6ZnVuY3Rpb24odCl7cmV0dXJuKHR8fHRoaXMuZm9ybWF0dGVyKS5zdHJpbmdpZnkodGhpcyl9fSkscD0oZS5mb3JtYXQ9e30pLk9wZW5TU0w9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt2YXIgZT10LmNpcGhlcnRleHQscj10LnNhbHQ7cmV0dXJuKHI/aS5jcmVhdGUoWzEzOTg4OTM2ODQsMTcwMTA3NjgzMV0pLmNvbmNhdChyKS5jb25jYXQoZSk6ZSkudG9TdHJpbmcobyl9LHBhcnNlOmZ1bmN0aW9uKHQpe3ZhciBlLHI9by5wYXJzZSh0KSxuPXIud29yZHM7cmV0dXJuIDEzOTg4OTM2ODQ9PW5bMF0mJjE3MDEwNzY4MzE9PW5bMV0mJihlPWkuY3JlYXRlKG4uc2xpY2UoMiw0KSksbi5zcGxpY2UoMCw0KSxyLnNpZ0J5dGVzLT0xNiksZi5jcmVhdGUoe2NpcGhlcnRleHQ6cixzYWx0OmV9KX19LGc9ci5TZXJpYWxpemFibGVDaXBoZXI9bi5leHRlbmQoe2NmZzpuLmV4dGVuZCh7Zm9ybWF0OnB9KSxlbmNyeXB0OmZ1bmN0aW9uKHQsZSxyLG4pe249dGhpcy5jZmcuZXh0ZW5kKG4pO3ZhciBpPXQuY3JlYXRlRW5jcnlwdG9yKHIsbiksYT1pLmZpbmFsaXplKGUpLHM9aS5jZmc7cmV0dXJuIGYuY3JlYXRlKHtjaXBoZXJ0ZXh0OmEsa2V5OnIsaXY6cy5pdixhbGdvcml0aG06dCxtb2RlOnMubW9kZSxwYWRkaW5nOnMucGFkZGluZyxibG9ja1NpemU6dC5ibG9ja1NpemUsZm9ybWF0dGVyOm4uZm9ybWF0fSl9LGRlY3J5cHQ6ZnVuY3Rpb24odCxlLHIsbil7cmV0dXJuIG49dGhpcy5jZmcuZXh0ZW5kKG4pLGU9dGhpcy5fcGFyc2UoZSxuLmZvcm1hdCksdC5jcmVhdGVEZWNyeXB0b3IocixuKS5maW5hbGl6ZShlLmNpcGhlcnRleHQpfSxfcGFyc2U6ZnVuY3Rpb24odCxlKXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIHQ/ZS5wYXJzZSh0LHRoaXMpOnR9fSkseT0oZS5rZGY9e30pLk9wZW5TU0w9e2V4ZWN1dGU6ZnVuY3Rpb24odCxlLHIsbixhKXtpZihufHwobj1pLnJhbmRvbSg4KSksYSlzPWwuY3JlYXRlKHtrZXlTaXplOmUrcixoYXNoZXI6YX0pLmNvbXB1dGUodCxuKTtlbHNlIHZhciBzPWwuY3JlYXRlKHtrZXlTaXplOmUrcn0pLmNvbXB1dGUodCxuKTt2YXIgbz1pLmNyZWF0ZShzLndvcmRzLnNsaWNlKGUpLDQqcik7cmV0dXJuIHMuc2lnQnl0ZXM9NCplLGYuY3JlYXRlKHtrZXk6cyxpdjpvLHNhbHQ6bn0pfX0sdz1yLlBhc3N3b3JkQmFzZWRDaXBoZXI9Zy5leHRlbmQoe2NmZzpnLmNmZy5leHRlbmQoe2tkZjp5fSksZW5jcnlwdDpmdW5jdGlvbih0LGUscixuKXt2YXIgaT0obj10aGlzLmNmZy5leHRlbmQobikpLmtkZi5leGVjdXRlKHIsdC5rZXlTaXplLHQuaXZTaXplLG4uc2FsdCxuLmhhc2hlcik7bi5pdj1pLml2O3ZhciBhPWcuZW5jcnlwdC5jYWxsKHRoaXMsdCxlLGkua2V5LG4pO3JldHVybiBhLm1peEluKGkpLGF9LGRlY3J5cHQ6ZnVuY3Rpb24odCxlLHIsbil7bj10aGlzLmNmZy5leHRlbmQobiksZT10aGlzLl9wYXJzZShlLG4uZm9ybWF0KTt2YXIgaT1uLmtkZi5leGVjdXRlKHIsdC5rZXlTaXplLHQuaXZTaXplLGUuc2FsdCxuLmhhc2hlcik7cmV0dXJuIG4uaXY9aS5pdixnLmRlY3J5cHQuY2FsbCh0aGlzLHQsZSxpLmtleSxuKX19KX0oKSkpKSkpLHAuZXhwb3J0cyksVT1lKEQpLEM9e2V4cG9ydHM6e319O2Z1bmN0aW9uIFQoKXtyZXR1cm4gUnx8KFI9MSxDLmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByPXQsbj1yLmxpYixpPW4uV29yZEFycmF5LGE9bi5IYXNoZXIscz1yLmFsZ28sbz1bXSxsPVtdOyFmdW5jdGlvbigpe2Z1bmN0aW9uIHQodCl7Zm9yKHZhciByPWUuc3FydCh0KSxuPTI7bjw9cjtuKyspaWYoISh0JW4pKXJldHVybiExO3JldHVybiEwfWZ1bmN0aW9uIHIodCl7cmV0dXJuIDQyOTQ5NjcyOTYqKHQtKDB8dCkpfDB9Zm9yKHZhciBuPTIsaT0wO2k8NjQ7KXQobikmJihpPDgmJihvW2ldPXIoZS5wb3cobiwuNSkpKSxsW2ldPXIoZS5wb3cobiwxLzMpKSxpKyspLG4rK30oKTt2YXIgaD1bXSxjPXMuU0hBMjU2PWEuZXh0ZW5kKHtfZG9SZXNldDpmdW5jdGlvbigpe3RoaXMuX2hhc2g9bmV3IGkuaW5pdChvLnNsaWNlKDApKX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPXRoaXMuX2hhc2gud29yZHMsbj1yWzBdLGk9clsxXSxhPXJbMl0scz1yWzNdLG89cls0XSxjPXJbNV0sdT1yWzZdLF89cls3XSxkPTA7ZDw2NDtkKyspe2lmKGQ8MTYpaFtkXT0wfHRbZStkXTtlbHNle3ZhciBmPWhbZC0xNV0scD0oZjw8MjV8Zj4+PjcpXihmPDwxNHxmPj4+MTgpXmY+Pj4zLGc9aFtkLTJdLHk9KGc8PDE1fGc+Pj4xNyleKGc8PDEzfGc+Pj4xOSleZz4+PjEwO2hbZF09cCtoW2QtN10reStoW2QtMTZdfXZhciB3PW4maV5uJmFeaSZhLHY9KG48PDMwfG4+Pj4yKV4objw8MTl8bj4+PjEzKV4objw8MTB8bj4+PjIyKSxtPV8rKChvPDwyNnxvPj4+NileKG88PDIxfG8+Pj4xMSleKG88PDd8bz4+PjI1KSkrKG8mY15+byZ1KStsW2RdK2hbZF07Xz11LHU9YyxjPW8sbz1zK218MCxzPWEsYT1pLGk9bixuPW0rKHYrdyl8MH1yWzBdPXJbMF0rbnwwLHJbMV09clsxXStpfDAsclsyXT1yWzJdK2F8MCxyWzNdPXJbM10rc3wwLHJbNF09cls0XStvfDAscls1XT1yWzVdK2N8MCxyWzZdPXJbNl0rdXwwLHJbN109cls3XStffDB9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fZGF0YSxyPXQud29yZHMsbj04KnRoaXMuX25EYXRhQnl0ZXMsaT04KnQuc2lnQnl0ZXM7cmV0dXJuIHJbaT4+PjVdfD0xMjg8PDI0LWklMzIsclsxNCsoaSs2ND4+Pjk8PDQpXT1lLmZsb29yKG4vNDI5NDk2NzI5NiksclsxNSsoaSs2ND4+Pjk8PDQpXT1uLHQuc2lnQnl0ZXM9NCpyLmxlbmd0aCx0aGlzLl9wcm9jZXNzKCksdGhpcy5faGFzaH0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1hLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLHR9fSk7ci5TSEEyNTY9YS5fY3JlYXRlSGVscGVyKGMpLHIuSG1hY1NIQTI1Nj1hLl9jcmVhdGVIbWFjSGVscGVyKGMpfShNYXRoKSx0LlNIQTI1Nn0oYygpKSksQy5leHBvcnRzfXZhciBGLEg9ZShUKCkpLFo9e2V4cG9ydHM6e319O3ZhciBNLE49KEZ8fChGPTEsWi5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbigpe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBBcnJheUJ1ZmZlcil7dmFyIGU9dC5saWIuV29yZEFycmF5LHI9ZS5pbml0LG49ZS5pbml0PWZ1bmN0aW9uKHQpe2lmKHQgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmKHQ9bmV3IFVpbnQ4QXJyYXkodCkpLCh0IGluc3RhbmNlb2YgSW50OEFycmF5fHwidW5kZWZpbmVkIiE9dHlwZW9mIFVpbnQ4Q2xhbXBlZEFycmF5JiZ0IGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQxNkFycmF5fHx0IGluc3RhbmNlb2YgVWludDE2QXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQzMkFycmF5fHx0IGluc3RhbmNlb2YgVWludDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBGbG9hdDY0QXJyYXkpJiYodD1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQsdC5ieXRlTGVuZ3RoKSksdCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpe2Zvcih2YXIgZT10LmJ5dGVMZW5ndGgsbj1bXSxpPTA7aTxlO2krKyluW2k+Pj4yXXw9dFtpXTw8MjQtaSU0Kjg7ci5jYWxsKHRoaXMsbixlKX1lbHNlIHIuYXBwbHkodGhpcyxhcmd1bWVudHMpfTtuLnByb3RvdHlwZT1lfX0oKSx0LmxpYi5Xb3JkQXJyYXl9KGMoKSkpLFouZXhwb3J0cyksST1lKE4pLFA9e2V4cG9ydHM6e319O3ZhciBqPShNfHwoTT0xLFAuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gdC5IbWFjU0hBMjU2fShjKCksVCgpLHooKSkpLFAuZXhwb3J0cyksJD1lKGopO2NvbnN0IEs9ITE7bGV0IFgsRz1mZXRjaDtvbm1lc3NhZ2U9ZnVuY3Rpb24odCl7Y29uc3R7am9iOmUsY21kOnIsc2VydmVyOm4scGF0aDppLGJ1ZmZlcjphLGtleUJhc2U2NDpvLGd6aXA6bCxyZWZlcnJlcjpoLGlkOmMsYXBwSWQ6dSxwZXJzaXN0ZW50SWQ6XyxDUk9RVUVUX1ZFUlNJT046ZCxkZWJ1ZzpwLHdoYXQ6ZyxvZmZsaW5lOnl9PXQuZGF0YTt5JiYoRz1rKTtzd2l0Y2gocil7Y2FzZSJ1cGxvYWRFbmNyeXB0ZWQiOngoaSk7YnJlYWs7Y2FzZSJnZXRPZmZsaW5lRmlsZSI6eih0LmRhdGEudXJsKTticmVhaztkZWZhdWx0OmNvbnNvbGUuZXJyb3IoIlVua25vd24gd29ya2VyIGNvbW1hbmQiLHIpfWZ1bmN0aW9uIHcodCl7Y29uc3QgZT1EYXRlLm5vdygpLHI9SS5jcmVhdGUodCksbj1mLnBhcnNlKG8pLGk9JChyLG4pLGE9SS5yYW5kb20oMTYpLHtjaXBoZXJ0ZXh0OnN9PVUuZW5jcnlwdChyLG4se2l2OmF9KSxsPW5ldyBBcnJheUJ1ZmZlcig0K2Euc2lnQnl0ZXMraS5zaWdCeXRlcytzLnNpZ0J5dGVzKSxoPW5ldyBEYXRhVmlldyhsKTtsZXQgdT0wO2guc2V0VWludDMyKHUsMTEyOTQ2ODIwOSwhMSksdSs9NDtmb3IoY29uc3QgdCBvZlthLGksc10pZm9yKGNvbnN0IGUgb2YgdC53b3JkcyloLnNldEludDMyKHUsZSwhMSksdSs9NDtyZXR1cm4gcCYmY29uc29sZS5sb2coYyxgJHtnfSBlbmNyeXB0ZWQgKCR7bC5ieXRlTGVuZ3RofSBieXRlcykgaW4gJHtEYXRlLm5vdygpLWV9bXNgKSxsfWZ1bmN0aW9uIHYodCl7Y29uc3QgZT1EYXRlLm5vdygpLHI9cy5kZWZsYXRlKHQse2d6aXA6ITAsbGV2ZWw6MX0pO3JldHVybiBwJiZjb25zb2xlLmxvZyhjLGAke2d9IGNvbXByZXNzZWQgKCR7ci5sZW5ndGh9IGJ5dGVzKSBpbiAke0RhdGUubm93KCktZX1tc2ApLHJ9ZnVuY3Rpb24gbSh0KXtjb25zdCBlPURhdGUubm93KCkscj1IKEkuY3JlYXRlKHQpKSxuPWYuc3RyaW5naWZ5KHIpLnJlcGxhY2UoLz0vZywiIikucmVwbGFjZSgvXCsvZywiLSIpLnJlcGxhY2UoL1wvL2csIl8iKTtyZXR1cm4gcCYmY29uc29sZS5sb2coYyxgJHtnfSBoYXNoZWQgKCR7dC5ieXRlTGVuZ3RofSBieXRlcykgaW4gJHtEYXRlLm5vdygpLWV9bXNgKSxufWFzeW5jIGZ1bmN0aW9uIGIodCl7aWYoeSl7Y29uc3QgZT1gb2ZmbGluZTovLy8ke3R9YDtyZXR1cm57dXJsOmUsdXBsb2FkVXJsOmV9fWNvbnN0IGU9RGF0ZS5ub3coKSxyPWAke24udXJsfS8ke3R9YDtpZighbi5hcGlLZXkpcmV0dXJue3VybDpyLHVwbG9hZFVybDpyfTtjb25zdCBpPWF3YWl0IEcocix7aGVhZGVyczp7IlgtQ3JvcXVldC1BdXRoIjpuLmFwaUtleSwiWC1Dcm9xdWV0LUFwcCI6dSwiWC1Dcm9xdWV0LUlkIjpfLCJYLUNyb3F1ZXQtU2Vzc2lvbiI6YywiWC1Dcm9xdWV0LVZlcnNpb24iOmQsIlgtQ3JvcXVldC1QYXRoIjpuZXcgVVJMKGgpLnBhdGhuYW1lfSxyZWZlcnJlcjpofSkse29rOmEsc3RhdHVzOnMsc3RhdHVzVGV4dDpvfT1pO2lmKCFhKXRocm93IEVycm9yKGBFcnJvciBpbiBzaWduaW5nIFVSTDogJHtzfSAtICR7b31gKTtjb25zdHtlcnJvcjpsLHJlYWQ6Zix3cml0ZTp3fT1hd2FpdCBpLmpzb24oKTtpZihsKXRocm93IEVycm9yKGwpO3JldHVybiBwJiZjb25zb2xlLmxvZyhjLGAke2d9IHVwbG9hZCBhdXRob3JpemVkIGluICR7RGF0ZS5ub3coKS1lfW1zYCkse3VybDpmLHVwbG9hZFVybDp3fX1hc3luYyBmdW5jdGlvbiB4KHQpe3RyeXtsZXQgcj13KGw/dihhKTphKTtLLHQuaW5jbHVkZXMoIiVIQVNIJSIpJiYodD10LnJlcGxhY2UoIiVIQVNIJSIsbShyKSkpO2NvbnN0e3VwbG9hZFVybDpuLHVybDppfT1hd2FpdCBiKHQpLHM9RGF0ZS5ub3coKSx7b2s6byxzdGF0dXM6dSxzdGF0dXNUZXh0Ol99PWF3YWl0IEcobix7bWV0aG9kOiJQVVQiLG1vZGU6ImNvcnMiLGhlYWRlcnM6eyJDb250ZW50LVR5cGUiOiJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0ifSxyZWZlcnJlcjpoLGJvZHk6cn0pO2lmKCFvKXRocm93IEVycm9yKGBzZXJ2ZXIgcmV0dXJuZWQgJHt1fSAke199IGZvciBQVVQgJHtufWApO3AmJmNvbnNvbGUubG9nKGMsYCR7Z30gdXBsb2FkZWQgKCR7dX0pIGluICR7RGF0ZS5ub3coKS1zfW1zICR7aX1gKSxYKHtqb2I6ZSx1cmw6aSxvazpvLHN0YXR1czp1LHN0YXR1c1RleHQ6XyxieXRlczpyLmJ5dGVMZW5ndGh9KX1jYXRjaCh0KXtwJiZjb25zb2xlLmVycm9yKGAke2N9IHVwbG9hZCBlcnJvciAke3QubWVzc2FnZX1gKSxYKHtqb2I6ZSxvazohMSxzdGF0dXM6LTEsc3RhdHVzVGV4dDp0Lm1lc3NhZ2V9KX19ZnVuY3Rpb24gayh0LGUpe3JldHVybiBwJiZjb25zb2xlLmxvZyhjLGBzdG9yaW5nICR7dH1gKSxXLnNldCh0LGUuYm9keSkse29rOiEwLHN0YXR1czoyMDEsc3RhdHVzVGV4dDoiT2ZmbGluZSBjcmVhdGVkIn19ZnVuY3Rpb24geih0KXtjb25zdCByPVcuZ2V0KHQpO2lmKCFyKXJldHVybiBwJiZjb25zb2xlLmVycm9yKGAke2N9IGZpbGUgbm90IGZvdW5kICR7dH1gKSx2b2lkIFgoe2pvYjplLG9rOiExLHN0YXR1czotMSxzdGF0dXNUZXh0OiJPZmZsaW5lIGZpbGUgbm90IGZvdW5kIn0pO3AmJmNvbnNvbGUubG9nKGMsYHJldHJpZXZlZCAke3R9YCksWCh7am9iOmUsb2s6ITAsc3RhdHVzOjIwMCxzdGF0dXNUZXh0OiJPZmZsaW5lIGZpbGUgZm91bmQiLGJvZHk6cixieXRlczpyLmJ5dGVMZW5ndGh9KX19LFg9cG9zdE1lc3NhZ2U7Y29uc3QgVz1uZXcgTWFwfSgpOwovLyMgc291cmNlTWFwcGluZ1VSTD11cGxvYWQuanMubWFwCgo=");const El=a.CROQUET_VERSION,Jl="node"===a.CROQUET_PLATFORM,jl="https://croquet.io/files/v1",Ql="https://files.croquet.io",Ul=Ql;let Dl=null;function Ol(){globalThis.__MULTISYNQ__||(Jl?console.log("Croquet "+El):console.log("%cCroquet%c %c"+El,"color:#F0493E","color:inherit","color:"+(El.includes("+")?"#909":"inherit")));const e=!Jl&&window.location.hostname.match(/^(.*\.)?croquet\.io$/i)&&window.location.pathname.startsWith("/dev/"),t=u.dev||!1!==u.dev&&e;if(Dl={messages:u.has("debug","messages",!1),sends:u.has("debug","sends",!1),publish:u.has("debug","publish",!1),events:u.has("debug","events",!1),ticks:u.has("debug","ticks",!1),pong:u.has("debug","pong",!1),snapshot:u.has("debug","snapshot",!1),session:u.has("debug","session",!1),initsnapshot:u.has("debug","initsnapshot",!0),reflector:u.has("debug","reflector",t),offline:u.has("debug","offline",!1)},Dl.offline&&ze.showMessage(`${ze.libName}: offline mode enabled, no multiuser`,{level:"warning"}),u.box){let e=new URL(u.box,window.location).href;e.endsWith("/")||(e+="/"),u.reflector=e+"reflector",u.files=e+"files"}}function Bl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Dl||Ol(),"string"==typeof e&&(e=Object.fromEntries(e.split(",").map((t=>[t.replace(/^no/,""),!e.startsWith("no")]))));for(const[t,s]of Object.entries(e))t in Dl?Dl[t]=s:ze.showMessage(`${ze.libName}: unknown debug option "${t}"`,{level:"warning",only:"once"});return Dl}const Al="wss://api.multisynq.io/depin",$l=Al;let ql,ec,tc="reflector";const sc=u.nocheat,nc=200,ic=[0],oc=4096;let rc;const ac=new Fl;ac.onerror=e=>console.error(`UploadWorker error: ${e.message}`);let lc=0;const cc=new Set;function dc(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=null;for(const s of cc)if(t||(t=s),s.id===e){t=s;break}if(t){const{appId:e,persistentId:s}=t.sessionSpec;return{appId:e,persistentId:s,key:t.key,uploadEncrypted:e=>t.uploadEncrypted(e),downloadEncrypted:e=>t.downloadEncrypted(e)}}return{}}Object.defineProperty(Ee,"controller",{get(){return this.controllers.values().next().value}}),Ee.controllers=cc;class hc{constructor(){Dl||Ol(),this.reset()}reset(){globalThis.CROQUETVM===this.vm&&delete globalThis.CROQUETVM,this.vm=null,this.session=null,this.connection=this.connection||new uc(this),this.networkQueue=[],this.reflectorTime=0,this.msPerTick=this.msPerTick||0,this.tickMultiplier=this.tickMultiplier||1,this.extrapolatedTimeBase=Date.now(),this.key=this.key||null,this.tove=this.tove||null,this.viewId=this.viewId||Math.floor(Math.random()*36**10).toString(36),this.viewDataEncrypted=this.viewDataEncrypted||null,this.timeline="",this.rejoinTimeout&&clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0,this.sendBuffer=[],this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.lastSnapshotRequest=0,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(globalThis.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(globalThis.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],this.auditStats={lastUsers:-1,minUsers:-1,maxUsers:-1,payloadTally:0},this.lastAnimationEnd=0,this.animationGapCheck=[],this.rateLimitedSendTimes=[],this.rateLimitBuffer=[],this.rateLimitSoftWarned=!1,this.rateLimitBufferWarned=!1,this.rateLimitLastLogged=0,this.payloadSizeWarned=!1,Ee.removeAllSubscriptionsFor(this.viewId),Ee.addSubscription(this.viewId,"__views__",this.viewId,(e=>Le(`users now ${e}`)),"oncePerFrameWhileSynced"),this.leaving||ze.showSyncWait(!0)}get id(){return this.vm?this.vm.id:this.sessionSpec.id}get persistentId(){return this.sessionSpec.persistentId}get versionId(){return this.sessionSpec.codeHash}get extrapolatedTime(){return Date.now()-this.extrapolatedTimeBase}get viewOnly(){return this.sessionSpec.viewOnly}get backlog(){return this.vm?this.reflectorTime-this.vm.time:0}get starvation(){return Date.now()-this.lastReceived}get lag(){return this.vm?Math.max(0,this.extrapolatedTime-this.vm.time-this.msPerTick):0}get activity(){return Date.now()-this.lastSent}get viewed(){return!(!this.session||!this.session.view)}get connected(){return this.connection.connected}get shouldLeaveWhenDisconnected(){return this.leaving||!this.canRejoinSeamlessly||0===this.sessionSpec.rejoinLimit}get canRejoinSeamlessly(){return!!this.timeline}get migratingOldSnapshot(){if(!this.sessionSpec)return!1;const{codeHash:e,computedCodeHash:t}=this.sessionSpec;return e!==t}checkForConnection(e){this.connection.checkForConnection(e)}dormantDisconnect(){this.connected&&this.connection.dormantDisconnect()}async initFromSessionSpec(e){const{name:s,optionsFromUrl:n,persistentIdOptions:i,password:o,appId:r,apiKey:a,viewData:l,viewIdDebugSuffix:c,location:d}=e,h=r?`${r}/${s}`:s;this.key=$i(o,"",{keySize:8,hasher:_i.algo.SHA1,iterations:1}),c&&(this.viewId=this.viewId.replace(/_.*$/,"")+"_"+encodeURIComponent((""+c).slice(0,16)).replace(/[^a-z0-9]/gi,(e=>`_${"%"===e?"":e.charCodeAt(0).toString(16).toUpperCase()}`)));const m={...e.options};if(n)for(const e of n)e in u&&(m[e]=u[e]);const p={},f={};for(const[e,t]of Object.entries(m))i?.includes(e)?p[e]=t:f[e]=t;const b=Dl.events||Dl.publish;b&&(f.__debugEvents=!0),d&&(f.__location=!0);const y=u.hashOverride||e.hashOverride,g=await async function(e,s){return z(e+t(s))}(h,p),{developerId:w,token:Z}=await this.verifyApiKey(a,r,g),{id:v,codeHash:X,computedCodeHash:x}=await async function(e,s,n,i,o){let r,a;const l=F[e];let c="";l?(r=l.codeHashes,a=l.computedCodeHash,c=" (code hashing from cache)"):(r=await Promise.all(_),a=await z([o,...r].join("|")),F[e]={codeHashes:r,computedCodeHash:a});const d=i||a,h=await z(e+"|"+s+t(n)+d);if(H()&&!E.has(h)){(R?"utf-8":[...document.getElementsByTagName("meta")].find((e=>e.getAttribute("charset"))))||console.warn(`${ze.libName}: Missing <meta charset="..."> declaration. ${ze.libName} model code hashing might differ between browsers.`),K[a].what="Version ID",K[e].what="Persistent ID",K[h].what="Session ID",d!==a&&(r.push(a),K[a].what="Computed Version ID (replaced by overrideHash)",K[d]={what:"Version ID (as specified by overrideHash)"});const t=[...r,d,e,h].map((e=>({hash:e,...K[e]})));console.log(`${ze.libName}: Debug Hashing for session ${h}${c}`,t),E.add(h)}return H()||(K={}),{id:h,persistentId:e,codeHash:d,computedCodeHash:a}}(g,w,f,y,El);this.tove||(this.tove=await this.encrypt(v)),l&&!this.viewDataEncrypted&&(this.viewDataEncrypted=await this.encryptPayload(l)),Dl.session&&console.log(`${ze.libName} session "${h}":\n        sessionId=${v}${r?`\n        persistentId=${g}`:""}\n        versionId=${X===x?X:`${X} (specified in hashOverride)\n        versionId=${x} (computed)`}\n        viewId=${this.viewId}`),this.eventRateLimit=e.eventRateLimit,this.eventHistoryLimit=this.eventRateLimit,this.eventMaxBundles=this.eventRateLimit,this.sessionSpec={...e,options:m,name:h,id:v,persistentId:g,developerId:w,token:Z,codeHash:X,computedCodeHash:x,debugEvents:b};const{msPerTick:L,multiplier:S}=this.getTickAndMultiplier();this.msPerTick=L,this.tickMultiplier=S,this.setUpActivityChecks()}async establishSession(){const{id:e,persistentId:t,codeHash:s}=this.sessionSpec;this.sessionSpec.snapshot={id:e,time:0,meta:{id:e,persistentId:t,codeHash:s,created:(new Date).toISOString()}};const n=new Promise((e=>{this.sessionSpec.sessionJoined=e}));this.checkForConnection(!1),Dl.session&&console.log(e,"waiting for join and SYNC"),await n,this.sessionSpec.sessionJoined=()=>{},this.syncCompleted=!0}getBackend(e){if(Dl.offline)return{apiKey:"none",signServer:"none",reflector:"none"};if(u.box||u.reflector)return{apiKey:"none",signServer:"none",reflector:u.reflector};const t={};for(const s of e.split(",")){const e=s.lastIndexOf(":"),n=s[-1===e?0:e+1];if(!n?.match(/^[12]$/))throw Error("Invalid API key: "+s);if(n in t)throw Error("Duplicate API key versions");t[n]={key:-1===e?s:s.slice(e+1),backend:-1===e?"":s.slice(0,e)}}let s=!t[1];s&&t[2].backend&&(s=t[2].backend),function(e){void 0===ql&&(ql="depin"in u?u.depin:e,ql&&!Dl.offline?(ec=!0===ql?$l:"prod"===ql?Al:"dev"===ql?"wss://api.multisynq.dev/depin":"local"===ql?"ws://localhost:8787":ql,ec.endsWith("/")&&(ec=ec.slice(0,-1)),ec=ec.replace(/^http(s):/,"ws$1:"),ec.startsWith("ws")||(ec=(Jl||"https:"!==window.location.protocol?"ws://":"wss://")+ec),tc="synchronizer",Dl.session&&console.log(`DEPIN_API=${ec}`)):ql=!1)}(s);const n=t[ql?2:1];if(!n)throw Error(`No ${ql?"Multisynq":"Croquet"} API key provided`);const i=n.key,o=u.backend||n.backend,r=u.reflector?.includes("/");if("none"===o)return{apiKey:i,signServer:"none",reflector:"overridden"};if(ql)return{apiKey:i,signServer:`${ec.replace(/^ws/,"http")}/clients`,reflector:"depin"};return{apiKey:i,signServer:"https://api.croquet.io/sign",reflector:r?"overridden":"wss://api.croquet.io/reflector/v1"}}async verifyApiKey(e,t,s){const{signServer:n,apiKey:i}=this.getBackend(e);if("none"===n)return{developerId:"unknown_dev_id"};try{const e=2,o=await this.fetchWithRetries("verifying API key",[403],e,(()=>fetch(`${n}/join?meta=login`,{method:"GET",mode:"cors",headers:{"X-Croquet-Auth":i,"X-Croquet-App":t,"X-Croquet-Id":s,"X-Croquet-Version":El,"X-Croquet-Path":new URL(ze.referrerURL()).pathname},referrer:ze.referrerURL(),referrerPolicy:"no-referrer-when-downgrade"}))),r=await o.json(),{developerId:a,error:l}=r;if(l)throw Error(l);return Dl.session&&console.log(`${ql?"Multisynq":"Croquet"}: verified API key for developer ${a}`),r}catch(e){throw Error(`${ql?"Multisynq":"Croquet"} API key validation failed for "${i}": ${e.message}`)}}async fetchWithRetries(e,t,s,n){const i=1+s;let o,r=0;for(;;){let s,a;try{if(s=await n(),s.ok)return s}catch(e){a=e}r++;let l="";const c=s&&t.includes(s.status);if(c?l="fatal ":r===i&&(l="final "),o=s?`${l}status ${s.status} ${s.statusText} - "${await s.text()}"`:`${l}error "${a?.message}"`,r===i||c)break;const d=1===r?100:2===r?1e3:5e3;console.warn(`${o} while ${e}; retrying in ${d}ms`),await new Promise((e=>{setTimeout(e,d)}))}throw console.warn(`${o} while ${e}; giving up`),Error(o)}lastKnownTime(e){return Math.max(e.time,e.externalTime)}takeSnapshot(){const e=this.vm.snapshot(),t=this.lastKnownTime(e),s=e.externalSeq;return e.meta={...this.sessionSpec.snapshot.meta,options:this.sessionSpec.options,time:t,seq:s,date:(new globalThis.CroquetViewDate).toISOString(),host:Jl?"localhost":window.location.hostname,sdk:El},delete e.meta.hash,e}takeSnapshotHandleErrors(){let e,t,s;try{e=pe.begin("snapshot"),s=this.takeSnapshot()}catch(e){return Se("snapshot",e),null}finally{t=pe.end("snapshot")-e}return Dl.snapshot&&console.log(this.id,`snapshot taken in ${Math.ceil(t)}ms`),s}setDebug(e){return Bl(e)}requestDebugSnapshot(){Bl("snapshot"),this.triggeringCpuTime=1e-10,this.scheduleSnapshot(this.viewId)}scheduleSnapshot(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.connected||!this.vm||this.viewOnly)return;const t=this.vm.time,s=t-this.vm.lastSnapshotPoll;if(s<5e3&&!e)return void(Dl.snapshot&&console.log(`not requesting snapshot poll (${s}ms since poll scheduled)`));if(this.migratingOldSnapshot)return void alert("Snapshot is due but hashOverride is set. Ignoring.");if(e){const t=Object.keys(this.vm.views);if(t.sort(),e!==this.viewId&&t[0]!==this.viewId&&t[1]!==this.viewId&&t[2]!==this.viewId)return void(Dl.snapshot&&console.log("not forcing snapshot poll (not one of the three)"));Dl.snapshot&&console.log("forcing snapshot poll")}const n=new nd(t,0,"_","handlePollForSnapshot",[]);this.sendTagged(n,{debounce:5e3,msgID:"pollForSnapshot"}),Dl.snapshot&&console.log(this.id,`requesting snapshot poll via ${tc}`)}handlePollForSnapshot(e){if(!0!==this.synced||this.viewOnly)return void(this.triggeringCpuTime=null);const t=this.triggeringCpuTime||this.cpuTime;let s,n,i;this.triggeringCpuTime=null,this.cpuTime=0;try{s=pe.begin("snapshot"),n={cpuTime:t,hash:this.vm.getSummaryHash(),viewId:this.viewId}}catch(e){return void Se("snapshot",e)}finally{i=pe.end("snapshot")-s,this.cpuTime-=i}Dl.snapshot&&console.log(this.id,`Summary hashing took ${Math.ceil(i)}ms`),queueMicrotask((()=>this.pollForSnapshot(e,n)))}pollForSnapshot(e,t){t.cpuTime+=Math.random(),Dl.snapshot&&console.log(this.id,"sending snapshot vote",t),this.sendTutti({time:e,topic:"snapshot",data:t,tallyTarget:["handleSnapshotVote"]})}handleSnapshotVote(e){const{tally:t}=e;Dl.snapshot&&console.log(this.id,"received snapshot votes",t);const{numberOfGroups:s,shouldUpload:n,dissidentFlag:i}=this.analyzeTally(t,"cpuTime");if(s>1){this.diverged=!0;const e=this.vm.diverged?this.vm.diverged.size:0;console.error(this.id,`Session diverged (#${e})! Snapshots fall into ${s} groups`)}if(!0!==this.synced)Dl.snapshot&&console.log(this.id,"Ignoring snapshot vote during sync");else if(n){const e={...this.auditStats},t=this.takeSnapshotHandleErrors();t&&queueMicrotask((()=>this.uploadSnapshot(t,e,i)))}}analyzeTally(e,t){let s=!1,n=null;const i=[],o={};let r=null;Object.keys(e).forEach(((e,t)=>{const s=JSON.parse(e);i.push(s);const{hash:n,viewId:a}=s;a===this.viewId&&(r=t),o[n]||(o[n]=[]),o[n].push(t)}));const a=Object.keys(o),l=a.length;let c=0;l>1&&(a.sort(((e,t)=>o[t].length-o[e].length)),o[a[0]].length===o[a[1]].length&&(Dl.snapshot&&console.log(this.id,"Deciding consensus by tie-break"),a[1]<a[0]&&(c=1)));const d=a[c];if(null!==r){const e=i[r].hash,a=o[e];a.length>1&&a.sort(((e,s)=>i[e][t]-i[s][t])),a[0]===r&&(s=!0,e!==d&&(n={groupVotes:a.length,allVotes:i.length}))}return{numberOfGroups:l,shouldUpload:s,dissidentFlag:n}}snapshotPath(e,t,s){const n=Math.ceil(e).toString().padStart(10,"0"),{appId:i,persistentId:o,codeHash:r,apiKey:a}=this.sessionSpec;return a?`apps/${i}/snap/${r}/${o}.${this.id}/${n}_${t}.${s}`:`snapshots/${this.id}/${n}_${t}-${s}.snap`}hashSnapshot(e){return e.meta.hash?e.meta.hash:(e.meta.hashPromise||(e.meta.hashPromise=new Promise((t=>{const s={...e};delete s.meta,z(JSON.stringify(s)).then((s=>{e.meta.hash=s,delete e.meta.hashPromise,t(s)}))}))),e.meta.hashPromise)}uploadServer(e){if("string"==typeof u.files){let e=new URL(u.files,window.location).href;return e.endsWith("/")&&(e=e.slice(0,-1)),{url:e,apiKey:null}}const{apiKey:t,signServer:s}=this.getBackend(e);if("none"===s&&!Dl.offline)throw Error("no file server configured");return{url:s,apiKey:t}}async uploadSnapshot(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;await this.hashSnapshot(e);const n=pe.begin("snapshot"),i=JSON.stringify(e),o=pe.end("snapshot")-n;Dl.snapshot&&console.log(this.id,`snapshot stringified (${i.length} bytes) in ${Math.ceil(o)}ms`);const{time:r,seq:a,hash:l}=e.meta,c=this.connection.socket;try{const e=await this.uploadEncrypted({content:i,path:this.snapshotPath(r,a,l),key:this.key,gzip:!0,debug:Dl.snapshot,what:"snapshot"});return this.connection.socket!==c?(console.warn(this.id,"Controller was reset while trying to upload snapshot"),!1):(this.announceSnapshotUrl(r,a,l,e,t,s),!0)}catch(e){return console.error(this.id,"Failed to upload snapshot"),!1}}announceSnapshotUrl(e,t,s,n,i,o){if(Dl.snapshot){let i=`time: ${e}, seq: ${t}, hash: ${s}`;o&&(i+=", as dissident; "+JSON.stringify(o)),console.log(this.id,`sending snapshot url to ${tc} (${i}): ${n}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SNAP",args:{time:e,seq:t,hash:s,url:n,auditStats:i,dissident:o}}))}catch(e){console.error("ERROR while sending",e)}this.diverged&&this.vm.publishFromView("__VM__","__diverged__",{key:`@${e}#${t}`,url:n,dissident:o})}async diffDivergedSnapshots(e){const t=await Promise.all(e.map((e=>this.downloadEncrypted({url:e,gzip:!0,key:this.key,debug:Dl.snapshot,json:!0,what:"diverged snapshot"}))));for(const e of t)delete e.meta;let s=0;!function e(t,n,i){if(typeof t!=typeof n)console.log(`${i} diverged (${typeof t} vs ${typeof n}):`,t,n),s++;else if(Array.isArray(t)!==Array.isArray(n))console.log(`${i} diverged (array vs object):`,t,n),s++;else if("object"==typeof t){const o=t?Object.keys(t):[],r=n?Object.keys(n):[],a=o.filter((e=>!r.includes(e))),l=r.filter((e=>!o.includes(e)));(a.length||l.length)&&(console.log(`${i} diverged (keys mismatch):`,a,l),s++);for(const s of o)r.includes(s)&&e(t[s],n[s],`${i}${Cc(t,s)}`)}else t!==n&&(console.log(`${i} diverged (value mismatch):`,t,n),s++)}(t[0],t[1],"CROQUETVM"),s?console.log(`Total ${s} differences between diverged snapshots:`,t.slice(0,2)):console.log("... but diverged snapshots are identical?!")}async downloadEncrypted(e){let{url:t,gzip:s,key:n,debug:i,json:o,what:r}=e;t.startsWith(jl)&&(t=t.replace(jl,Ql));const a=t.startsWith("offline:"),l=a?1:3;let c=Date.now();const d=await this.fetchWithRetries(`fetching ${r}`,[],l,(()=>a?this.fetchOffline(t,r,i):fetch(t,{method:"GET",mode:"cors",referrer:ze.referrerURL()}))),h=await d.arrayBuffer();i&&console.log(this.id,`${r} fetched (${h.byteLength} bytes) in ${-c+(c=Date.now())}ms`),pe.addNetworkTraffic(`${r}_in`,h.byteLength);const u=this.decryptBinary(h,n);i&&console.log(this.id,`${r} decrypted (${u.length} bytes) in ${-c+(c=Date.now())}ms`);const m=s?Vl.inflate(u):u;return i&&s&&console.log(this.id,`${r} inflated (${m.length} bytes) in ${-c+(c=Date.now())}ms`),o?JSON.parse((new TextDecoder).decode(m)):m}async fetchOffline(e,t,s){const n=++lc;return new Promise(((i,o)=>{const r=Jl?"addListener":"addEventListener",a=Jl?"removeListener":"removeEventListener";ac.postMessage({job:n,cmd:"getOfflineFile",url:e,id:this.id,what:t,debug:s,offline:Dl.offline});const l=e=>{if(n!==e.data.job)return;const{ok:s,status:r,statusText:c,body:d,bytes:h}=e.data;pe.addNetworkTraffic(`${t}_out`,h),ac[a]("message",l),s?i({arrayBuffer:()=>d}):o(Error(`${r}: ${c}`))};try{ac[r]("message",l)}catch(e){console.log("failed to add listener",e)}}))}async uploadEncrypted(e){let{content:t,path:s,key:n,gzip:i,keep:o,debug:r,what:a}=e;const l="string"==typeof t?(new TextEncoder).encode(t).buffer:t,c=o?void 0:[l],d="string"==typeof n?n:zi.stringify(n),{apiKey:h,appId:u,persistentId:m}=this.sessionSpec,p=++lc;return new Promise(((e,t)=>{const n=Jl?"addListener":"addEventListener",o=Jl?"removeListener":"removeEventListener";ac.postMessage({job:p,cmd:"uploadEncrypted",server:this.uploadServer(h),path:s,buffer:l,keyBase64:d,gzip:i,referrer:ze.referrerURL(),id:this.id,appId:u,persistentId:m,CROQUET_VERSION:El,debug:r,what:a,offline:Dl.offline},c);const f=s=>{if(p!==s.data.job)return;const{url:n,ok:i,status:r,statusText:l,bytes:c}=s.data;pe.addNetworkTraffic(`${a}_out`,c),ac[o]("message",f),i?e(n):t(Error(`${r}: ${l}`))};try{ac[n]("message",f)}catch(e){console.log("failed to add listener",e)}}))}persistentPath(e){const{appId:t,persistentId:s}=this.sessionSpec;return`apps/${t}/${s}/save/${e}`}pollForPersist(e,t,s,n,i){if(!this.synced)return;if(!this.sessionSpec.appId)throw Error("Persistence API requires appId");if(Dl.offline)return;const o={viewId:this.viewId,hash:n,ms:i+.001*Math.random()},r={persistTime:t,persistentHash:n,persistentString:s};Dl.snapshot&&console.log(this.id,`sending persistence vote for time @${t}`,o),this.sendTutti({time:e,topic:"persist",data:o,localContext:r,tallyTarget:["handlePersistVote"]})}async handlePersistVote(e){const{tally:t,localContext:s}=e;if(Dl.snapshot){const e=!!s?`for time @${s.persistTime}`:"that we didn't participate in";console.log(this.id,`received persistence vote ${e}`,t)}const{numberOfGroups:n,shouldUpload:i,dissidentFlag:o}=this.analyzeTally(t,"ms");if(n>1&&console.warn(this.id,`Persistence records fall into ${n} groups`),!i||!s)return;const{persistTime:r,persistentHash:a,persistentString:l}=s;this.doPersist(r,l,a,o)}async doPersist(e,t,s,n){const i=await this.uploadEncrypted({path:this.persistentPath(s),content:t,key:this.key,gzip:!0,debug:Dl.snapshot,what:"persistence"});if(Dl.snapshot){const e=n?` (as dissident; ${JSON.stringify(n)})`:"";console.log(this.id,`sending persistent data url to ${tc}${e}: ${i}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SAVE",args:{persistTime:e,url:i,dissident:n}}))}catch(e){console.error("ERROR while sending",e)}}async forcePersist(e,t,s){this.didForcePersist?console.warn(this.id,"forcePersist called more than once, ignoring"):(console.warn(this.id,`forcePersist, will upload ${t.length} bytes`),"alert"===u.forcePersist&&confirm("forcePersist triggered. Do it?"),await this.doPersist(e,t,s),console.warn(this.id,"forcePersist completed"),this.didForcePersist=!0)}convertReflectorMessage(e){let t="noop",s=[];switch(e[2].what){case"users":{const{joined:n,left:i,active:o,total:r}=e[2];this.users=o,this.usersTotal=r;const a="__VM__",l="__peers__",c={entered:n||[],exited:i||[],count:o,total:r};for(const e of c.entered.concat(c.exited))e.data&&(e.data=this.decryptPayload(e.data));t="publishFromModelOnly",s=[a,l,c],Ee.handleEvent(this.viewId+":__views__",c.count);break}case"tally":{const{tuttiSeq:n,tuttiKey:i,tally:o,tallyTarget:r,missingClients:a}=e[2];(Dl.messages||Dl.snapshot)&&a&&console.log(`${a} ${1===a?"client":"clients"} failed to participate in tally ${i||n}`),t="handleTuttiResult",s=[{tuttiSeq:n,tuttiKey:i,tally:o,tallyTarget:r}];break}case"audit":{const n=e[0];Dl.messages&&console.log(`audit request at time ${n}`),t="handleAuditRequest",s=[{time:n}];break}}const n=new nd(0,0,"_",t,s);e[2]=n.asState()[2]}handleTuttiResult(e){const{tuttiSeq:t,tuttiKey:s,tally:n,tallyTarget:i}=e,o=s?e=>e.tuttiKey===s:e=>e.dummyTuttiSeq===t,r=this.tuttiHistory.findIndex(o),a=-1!==r&&this.tuttiHistory.splice(r,1)[0];let l=null,c=null;if(a&&(l=a.payload,c=a.localContext),i){const[e,...t]=i,s=[...t,{tally:n,localPayload:l,localContext:c}],o=new nd(0,0,"_",e,s);this.vm.verifyExternal(o),o.executeOn(this.vm,!0)}}handleAuditRequest(e){const{time:t}=e;this.vm.time!==t&&console.error(`time ${this.vm.time} cf audit time ${t}`);const{auditStats:s}=this,{lastUsers:n,minUsers:i,maxUsers:o,payloadTally:r,sessionTimeAtDispatch:a}=s;if(s.payloadTally=0,this.vm.time>a&&(s.minUsers=s.maxUsers=n),!this.fastForwardHandler){const e=pe.networkTraffic.audit_reflector_in||0,s=pe.networkTraffic.audit_reflector_out||0;pe.resetAuditStats();const{clientId:a}=this.connection.socket;queueMicrotask((()=>{Dl.session&&console.log(this.id,`handling audit request at ${t} after ${e} bytes in, ${s} out`);const l=encodeURIComponent(JSON.stringify({time:t,clientId:a,lastUsers:n,minUsers:i,maxUsers:o,payloadTally:r,bytesIn:e,bytesOut:s})),c=`${ec}/clients/report?session=${this.id}&stats=${l}`.replace("ws","http");fetch(c,{mode:"no-cors"})}))}}handleUserTotalForAccounting(e){if(ql){const{auditStats:t}=this;if(t.lastUsers=e,this.vm.time<=t.sessionTimeAtDispatch)return;(-1===t.minUsers||e<t.minUsers)&&(t.minUsers=e),e>t.maxUsers&&(t.maxUsers=e)}}messageSizeForAccounting(e){let t="string"==typeof e[2]?e[2].length:e[2]._size||0;return t+=16,t}async receive(e,t){const s=this.lastReceived;switch(this.lastReceived=this.connection.lastReceived,e){case"SYNC":{this.syncReceived=!0,this.clearSyncReceiptTimeout(),cc.add(this);const{progressReporter:e}=this.sessionSpec,s=e||(()=>{}),{messages:n,url:i,persisted:o,time:r,seq:a,snapshotSeq:l,tove:c,reflector:d,flags:h,auditStatsInitializer:u}=t;if(c&&c!==this.tove)try{if(this.decrypt(c)!==this.id)throw Error("wrong sessionId in tove?!")}catch(e){return this.connection.closeConnectionWithError("SYNC",Error(`session password check: ${e.message}`),4200),void s(-1)}const m=t.timeline;this.flags=h||{};const p=o?"persistence":"snapshot";Dl.session&&console.log(this.id,`received SYNC from ${d} ${tc}: time ${r}, ${n.length} messages, ${p} ${i||"<none>"}`);let f=!!this.vm;if(f){this.networkQueue.length=0;const e=!!m&&m===this.timeline,t=n[0],s=a,i=void 0!==l?l:t?t[1]:s;Dl.messages&&console.log(this.id,`rejoin: we have #${this.vm.seq} SYNC has #${i}-#${s}`);let o=e&&sd(i,this.vm.seq)&&sd(this.vm.seq,s)&&r>=this.reflectorTime;if(o){let e=0;t&&sd(t[1],this.vm.seq)&&(e=this.vm.seq-t[1]+1>>>0);for(let t=e;o&&t<n.length;t++){const e=n[t][2];"string"!=typeof e&&"users"===e.what&&e.left&&e.left.includes(this.viewId)&&(Dl.session&&console.log(this.id,`${tc} reports that this view has left`),o=!1)}o&&e&&(Dl.messages&&console.log(this.id,`rejoin: discarding ${e} messages #${t[1]}-#${this.vm.seq}`),n.splice(0,e))}if(o){if(this.sendBuffer.length>0){const e=this.sendBuffer;this.sendBuffer=[],Dl.session&&console.log(this.id,`rejoin: sending ${e.length} messages buffered while disconnected`);for(const t of e)t()}}else Dl.session&&console.log(this.id,"cannot rejoin seamlessly; rebooting model/view"),this.leave(!0),f=!1}const b=this.networkQueue;this.networkQueue=[];for(const e of n){const t=this.messageSizeForAccounting(e);if("string"!=typeof e[2])this.convertReflectorMessage(e);else try{e[2]=this.decryptPayload(e[2])[0]}catch(e){return this.connection.closeConnectionWithError("SYNC",Error(`session password decrypt: ${e.message}`),4200),void s(-1)}Dl.messages&&console.log(this.id,"received in SYNC "+JSON.stringify(e)),this.networkQueue.push([e,t])}if(this.networkQueue.push(...b),r>this.reflectorTime&&this.timeFromReflector(r,"reflector"),f)return Dl.session&&console.log(this.id,"seamless rejoin successful"),void(this.syncCompleted=!0);let y;if(this.timeline=m||"",Dl.snapshot&&i&&console.log(this.id,`fetching ${p} ${i}`),i)try{y=await this.downloadEncrypted({url:i,gzip:!0,key:this.key,debug:Dl.snapshot,json:!0,what:p})}catch(e){return this.connection.closeConnectionWithError("SYNC",Error(`failed to fetch ${p}: ${e.message}`),4200),void s(-1)}if(!this.connected)return console.log(this.id,"disconnected during SYNC"),void s(-1);if(o){if(this.migratingOldSnapshot)throw Error("hashOverride is enabled but got persisted data instead of snapshot");this.install(y)}else y&&(this.sessionSpec.snapshot=y),this.install();u&&(Dl.session&&console.log(this.id,`installing audit stats: ${JSON.stringify(u)}`),this.auditStats=u),Dl.session&&console.log(this.id,`fast-forwarding from ${Math.round(this.vm.time)} to at least ${r}`);const g=this.vm.time,w=await new Promise((e=>{const{port1:t,port2:n}=new MessageChannel;t.onmessage=()=>{let t=!0;if(this.vm)if(this.vm.time===this.reflectorTime)this.viewId in this.vm.views&&(s(1),e(!0),t=!1);else{const e=(this.vm.time-g)/(this.reflectorTime-g);s(e)}else Dl.session&&console.log(this.id,"disconnected during SYNC fast-forwarding"),s(-1),e(!1),t=!1;t&&this.stepSession("fastForward",{budget:nc})};this.fastForwardHandler=t=>{this.connected&&this.vm?"error"===t?(s(-1),e(!1)):n.postMessage("tick"):(console.log(this.id,"disconnected during SYNC fast-forwarding"),s(-1),e(!1))},queueMicrotask((()=>this.stepSession("fastForward",{budget:nc})))}));return delete this.fastForwardHandler,void(w&&(Dl.session&&console.log(this.id,`fast-forwarded to ${Math.round(this.vm.time)}`),this.vm.diverged&&ze.showMessage(`${ze.libName}: session had diverged. Try CROQUETVM.debugDiverged()`,{level:"warning",only:"once"}),this.sessionSpec.sessionJoined()))}case"RECV":{const e=t;e[1]>>>=0;const s=this.messageSizeForAccounting(e);if("string"!=typeof e[2])Dl.messages&&console.log(this.id,"received META "+JSON.stringify(e)),this.convertReflectorMessage(e),Dl.messages&&console.log(this.id,"converted to "+JSON.stringify(e));else try{const[t,s,n]=this.decryptPayload(e[2]);e[2]=t,s===this.viewId&&this.addToStatistics(n,this.lastReceived),Dl.messages&&console.log(this.id,"received "+JSON.stringify(e))}catch(e){return void this.connection.closeConnectionWithError("RECV",Error(`session password decrypt: ${e.message}`),4200)}let n;return this.networkQueue.push([e,s]),this.flags.rawtime&&(n=e[e.length-1]),this.timeFromReflector(e[0],"reflector",n),void(this.simulateIfNeeded&&queueMicrotask((()=>this.simulateIfNeeded())))}case"TICK":{if(!this.vm)return;const e="number"==typeof t?t:t.time;if(Dl.ticks){const t=s&&this.lastReceived-s-this.msPerTick*this.tickMultiplier|0,n=e-this.vm.time;console.log(this.id,`received TICK ${e} ${Math.abs(t)<5?"on time":t<0?"early":"late"} (${n} ms, jitter ${t>0?"+":""}${t} ms)`)}return this.timeFromReflector(e,"reflector"),this.tickMultiplier>1&&this.multiplyTick(e),void(this.simulateIfNeeded&&queueMicrotask((()=>this.simulateIfNeeded())))}case"INFO":{const{msg:e,options:s}=t,n=ql?"Multisynq Synchronizer":"Croquet Reflector";return void ze.showMessage(`${n}: ${e}`,s)}case"REQU":return Dl.snapshot&&console.log(`received REQU (snapshot request) from ${tc}`),void(this.reflectorNeedsSnapshot=!0);case"RECONNECT":this.connection.socket?.synchronizerDisconnected(4003,"told to reconnect");break;default:console.warn("Unknown action:",e,t)}}install(e){const t=Date.now(),{snapshot:s,initFn:n,options:i,debugEvents:o}=this.sessionSpec,[r,a]=s.models?["deserializ","snapshot"]:["initializ","root model"];Dl.session&&console.log(this.id,`${r}ing ${a}`);let l=new ed(s,o,(()=>{try{return n(i,e)}catch(e){throw Se("init",e,"fatal"),e}}),this.migratingOldSnapshot);if((Dl.session||Dl.snapshot&&s.models)&&console.log(this.id,`${a} ${r}ed in ${Date.now()-t}ms`),Dl.initsnapshot&&!s.models){Dl.snapshot&&console.log(this.id,"exercising snapshot and restore after init()");let e=null;try{e=JSON.stringify(l.snapshot())}catch(e){throw Se("initial snapshot",e,"fatal"),e}try{l=new ed(JSON.parse(e),o,(()=>n(i)))}catch(e){throw Se("initial snapshot resume",e,"fatal"),e}}const c=this.lastKnownTime(l);this.reflectorTime=Math.max(this.reflectorTime,c),this.setVM(l)}setVM(e){this.vm=e,this.vm.controller=this}sendJoin(){this.syncReceived=!1,this.syncCompleted=!1,delete this.fastForwardHandler,this.rejoinTimeout&&(clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0),Dl.session&&console.log(this.id,"Controller sending JOIN");const{tick:e,delay:t}=this.getTickAndMultiplier(),{name:s,codeHash:n,appId:i,apiKey:o,persistentId:r,developerId:a,heraldUrl:l,rejoinLimit:c,autoSleep:d,computedCodeHash:h,location:u,flags:m}=this.sessionSpec,p=ql?"hiddenName":s,f=ql?"hiddenApiKey":this.getBackend(o).apiKey,b=ql?"hiddenAppId":i,y=ql?"hiddenUrl":ze.referrerURL(),g=this.viewDataEncrypted?{id:this.viewId,data:this.viewDataEncrypted}:u?[this.viewId]:this.viewId,w={name:p,apiKey:f,appId:b,url:y,persistentId:r,sdk:El,developerId:a,version:1,user:g,location:u,ticks:{tick:e,delay:t},dormantDelay:d,tove:this.tove,codeHash:n};l&&Object.assign(w,{heraldUrl:l}),c&&Object.assign(w,{leaveDelay:c+250}),h!==n&&Object.assign(w,{computedCodeHash:h}),m&&Object.assign(w,{flags:m}),this.connection.send(JSON.stringify({id:this.id,action:"JOIN",args:w})),this.syncReceiptTimeout=setTimeout((()=>{delete this.syncReceiptTimeout,this.syncReceived||this.connection.closeConnectionWithError("JOIN",Error("Initial reflector connection timed out"))}),5e3)}clearSyncReceiptTimeout(){this.syncReceiptTimeout&&(clearTimeout(this.syncReceiptTimeout),delete this.syncReceiptTimeout)}connectionInterrupted(){this.syncReceived&&(this.shouldLeaveWhenDisconnected?this.leave():this.rejoinTimeout||(this.rejoinTimeout=setTimeout((()=>{this.leaving?Dl.session&&console.log(this.id,"abandoning rejoin; session is defunct"):(Dl.session&&console.log(this.id,"rejoin timed out"),this.rejoinTimeout=0,this.leave())}),this.sessionSpec.rejoinLimit)))}leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{rebootModelView:t}=this.sessionSpec;if(this.reset(),Dl.session&&console.log(this.id,`resetting ${e?"(but keeping)":"and discarding"} controller`),e||cc.delete(this),!this.sessionSpec)throw Error("do not discard sessionSpec!");t()}async encrypt(e){const t=T.random(16),s=po.encrypt(e,this.key,{iv:t}),n=yo(e,this.key);return`${zi.stringify(t)}${zi.stringify(n)}${s}`}get deprecatedDefaultKey(){return rc||(rc=$i("THIS SHOULDN'T BE IN LOGS","",{keySize:8,hasher:_i.algo.SHA1,iterations:1})),rc}decrypt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.key;const s=zi.parse(e.slice(0,24)),n=zi.parse(e.slice(24,68)),i=e.slice(68),o=po.decrypt(i,t,{iv:s});let r="";try{r=ji.stringify(o)}catch(e){}const a=yo(r,this.key);if(this.compareHmacs(n.words,a.words))return r;if(t!==this.deprecatedDefaultKey)return this.decrypt(e,this.deprecatedDefaultKey);throw Error("Decryption error")}decryptBinary(e,t){const s=(new TextDecoder).decode(new Uint8Array(e,0,4));let n,i,o,r,a;switch("string"==typeof t&&(t=zi.parse(t)),s){case"CRQ0":n=(new TextDecoder).decode(e),i=zi.parse(n.slice(4,28)),o=zi.parse(n.slice(28,72)),r=n.slice(72),a=po.decrypt(r,t,{iv:i});break;case"CRQ1":n=new Uint8Array(e),i=T.create(n.subarray(4,20)),o=T.create(n.subarray(20,52)),r=T.create(n.subarray(52)),a=po.decrypt({ciphertext:r},t,{iv:i});break;default:throw Error(`${this.id} unknown encryption version ${s}`)}a.clamp();const l=yo(a,t);if(this.compareHmacs(o.words,l.words))return M(a);if(t!==this.deprecatedDefaultKey)return this.decryptBinary(e,this.deprecatedDefaultKey);throw Error("Decryption error")}async encryptMessage(e,t,s){const[n,i,o]=e.asState();return[n,i,await this.encryptPayload([o,t,s])]}async encryptPayload(e){return this.encrypt(JSON.stringify(e))}decryptPayload(e){return JSON.parse(this.decrypt(e))}compareHmacs(e,t){let s=e.length===t.length;for(let n=0;n<e.length;n++)e[n]!==t[n]&&(s=!1);return s}sendMessage(e){if(this.viewOnly||!this.vm)return;const t=e.asState()[2].length;if(t>16384)return void console.warn(this.id,`Message with payload of ${t} bytes exceeds maximum 16384 and will not be sent to ${tc}.`);!this.payloadSizeWarned&&t>oc&&(console.log(this.id,`Message with payload of ${t} bytes being sent to ${tc}. Maximum recommended is 4096.`),this.payloadSizeWarned=!0);const s=Date.now(),n=this.rateLimitedSendTimes,i=this.rateLimitBuffer;if(pe.perSecondTally({requestedMessages:1}),i.length)return void this.addToRateLimitBuffer(e);let o=0;if(n.length&&this.synced){const e=n[n.length-1],t=1e3/this.eventRateLimit-(s-e);t>1&&(o=Math.ceil(t))}o?(this.addToRateLimitBuffer(e),setTimeout((()=>this.serviceRateLimitBuffer()),o)):(this.recordRateLimitedSend(s),this.socketSendMessage(e),pe.perSecondTally({sentSingleMessages:1,sentMessagesTotal:1,sentPayloadTotal:t}))}recordRateLimitedSend(e){const t=this.rateLimitedSendTimes;!this.synced&&t.length&&t[t.length-1]===e||(t.push(e),t.length>this.eventHistoryLimit&&t.shift()),!this.rateLimitSoftWarned&&t.length===this.eventHistoryLimit&&e-t[0]<1010&&(console.warn(this.id,`Sends to ${tc} are at or above recommended limit of ${this.eventHistoryLimit} within one second. Events will be bundled as necessary to keep to the limit.`),this.rateLimitSoftWarned=!0)}addToRateLimitBuffer(e){pe.perSecondTally({bundledMessages:1});const t=Date.now(),s=e.asState(),n=s[2].length,i=this.rateLimitBuffer;if(i.length){const e=i[i.length-1],{msgStates:o,totalPayload:r}=e;if(r<oc)return o.push({msgState:s,bufferTime:t}),void(e.totalPayload+=n)}pe.perSecondTally({newBundles:1}),i.push({msgStates:[{msgState:s,bufferTime:t}],totalPayload:n});const o=i.length;Dl.session&&o%5==0&&o!==this.rateLimitLastLogged&&(console.log(this.id,`SEND rate-limit buffer grew to ${o} event bundles (max ${this.eventMaxBundles})`),this.rateLimitLastLogged=o),o>this.eventMaxBundles?(console.error(this.id,"Disconnecting after overflow of SEND rate-limit buffer."),this.connection.closeConnectionWithError("SEND",Error("Send rate exceeded"),4200)):!this.rateLimitBufferWarned&&o>this.eventMaxBundles/2&&(console.warn(this.id,"SEND rate-limit buffer is 50% full. If send rate does not drop, the app will be disconnected."),this.rateLimitBufferWarned=!0)}serviceRateLimitBuffer(){if(!this.connected)return;const e=this.rateLimitBuffer;if(!e.length)return;const t=Date.now(),s=1e3/this.eventRateLimit,n=this.rateLimitedSendTimes;if(n.length){const e=n[n.length-1];if(s-(t-e)>0)return}const i=e.shift(),{msgStates:o,totalPayload:r}=i,a=[];let l=0;if(o.forEach((e=>{a.push(e.msgState),l+=t-e.bufferTime})),1===a.length){const e=nd.fromState(a[0],this.vm);this.socketSendMessage(e)}else{const e=new nd(this.vm.time,0,"_","handleBundledEvents",[a]);this.socketSendMessage(e)}if(this.recordRateLimitedSend(t),pe.perSecondTally({sentBundles:1,sentMessagesTotal:o.length,sendDelay:l,sentBundlePayload:r,sentPayloadTotal:r}),Dl.session&&this.connected){const t=e.length;t&&t%5==0&&t!==this.rateLimitLastLogged&&(console.log(this.id,`SEND rate-limit buffer dropped to ${t} event bundles`),this.rateLimitLastLogged=t)}e.length&&setTimeout((()=>this.serviceRateLimitBuffer()),s)}async socketSendMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=await this.encryptMessage(e,this.viewId,Date.now()),n=Dl.sends&&(t?`tagged SEND ${e.asState()} with tags ${JSON.stringify(t)}`:`SEND ${e.asState()}`);if(!this.connected||!this.syncCompleted)return void(this.vm&&(Dl.sends&&console.log(this.id,`buffering ${n}`),this.sendBuffer.push((()=>this.socketSendMessage(e,t)))));Dl.sends&&console.log(this.id,`sending ${n}`);const i={id:this.id,action:"SEND",args:[...s,this.latency]};t&&(i.tags=t),this.lastSent=Date.now(),this.connection.send(JSON.stringify(i))}async sendTagged(e,t){this.viewOnly||this.socketSendMessage(e,t)}async sendTutti(e){let{time:s,topic:n,data:i,localContext:o=null,firstMessage:r=null,wantsVote:a=!0,tallyTarget:l=null}=e;if(this.viewOnly)return;const c=r&&await this.encryptMessage(r,this.viewId,Date.now()),d=t(i);if(!this.connected||!this.syncCompleted)return void(this.vm&&(Dl.sends&&console.log(this.id,`buffering "${n}" TUTTI ${d} ${r&&r.asState()}`),this.sendBuffer.push((()=>this.sendTutti({time:s,topic:n,data:i,localContext:o,firstMessage:r,wantsVote:a,tallyTarget:l})))));Dl.sends&&console.log(this.id,`sending "${n}" TUTTI ${d} ${r&&r.asState()}`),this.lastSent=Date.now();const h=`${n}@${s}`;this.connection.send(JSON.stringify({id:this.id,action:"TUTTI",args:[s,0,d,c,a,l,h]})),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.tuttiHistory.push({time:s,tuttiKey:h,dummyTuttiSeq:0,payload:d,localContext:o})}sendLog(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.connected&&this.syncCompleted?(Dl.sends&&console.log(this.id,"sending LOG"),t.length<2&&(t=t[0]),this.connection.send(JSON.stringify({action:"LOG",args:t}))):this.vm&&(Dl.sends&&console.log(this.id,"buffering LOG"),this.sendBuffer.push((()=>this.sendLog(...t))))}addToStatistics(e,t){this.latency=t-e,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:t,ms:this.latency}))}get latencies(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}getTickAndMultiplier(){const e=this.sessionSpec.options,t=["number","string"].includes(typeof e.tps)?e.tps:["number","string"].includes(typeof this.sessionSpec.tps)?this.sessionSpec.tps:20,[s,n]=(t+"x").split("x").map((e=>Number.parseFloat("0"+e))),i=1e3/Math.max(1/30,Math.min(60,s)),o=Math.max(1,n);let r=i,a=0;return o>1&&!sc&&(r=i/o,a=Math.ceil(r*(o-1))),{msPerTick:r,multiplier:o,tick:i,delay:a}}simulate(e){if(!this.vm)return!0;try{let t=!0;if(this.networkQueue.length+this.vm.messages.size===0)t=this.vm.advanceTo(this.reflectorTime,e);else{const s=pe.begin("simulate");for(;t;){const s=this.networkQueue[0];if(!s)break;const[n,i]=s;if(t=this.vm.advanceTo(n[0],e),!t)break;this.networkQueue.shift(),ql&&(this.auditStats.payloadTally+=i);const o=this.vm.scheduleExternalMessage(n);t=this.vm.advanceTo(o.time,e),this.cpuTime+=5}t&&(t=this.vm.advanceTo(this.reflectorTime,e)),this.cpuTime+=Math.max(.01,pe.end("simulate")-s)}pe.backlog(this.backlog);const s=this.lag,n=Math.max(200,.1*this.msPerTick),i=Math.max(2e3,.2*this.msPerTick);if("boolean"==typeof this.synced&&this.viewed&&(this.synced&&s>i||!this.synced&&s<n)){!this.synced?this.syncTimer||(this.syncTimer=setTimeout((()=>{delete this.syncTimer,this.connected&&this.lag<n&&this.applySyncChange(!0)}),200)):this.applySyncChange(!1)}if(!Dl.offline)if(this.synced&&t&&this.vm.time-this.lastSnapshotRequest>5e3){let e=!1;this.cpuTime>5e3?(Dl.snapshot&&console.log(this.id,`due for snapshot: cpuTime is ${Math.round(this.cpuTime)}ms`),e=!0):ql&&this.vm.time-this.vm.lastSnapshotPoll>3e5&&(Dl.snapshot&&console.log(this.id,`due for snapshot: time since last is ${this.vm.time-this.vm.lastSnapshotPoll}ms`),e=!0),e&&(this.lastSnapshotRequest=this.vm.time,this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,this.isBeingAnimated()?setTimeout((()=>this.scheduleSnapshot()),Math.floor(2e3*Math.random())):this.scheduleSnapshot())}else this.reflectorNeedsSnapshot&&(this.triggeringCpuTime=this.synced?this.cpuTime:12345,this.scheduleSnapshot(!0),this.reflectorNeedsSnapshot=!1);return t}catch(e){return Se("simulate",e),this.connection.closeConnectionWithError("simulate",e),"error"}}stepSession(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=pe.stepSession(t.frameTime,!0);s&&console.log(s);const{backlog:n,latency:i,starvation:o,activity:r}=this;if("animation"===e){pe.animationFrame(t.frameTime,{backlog:n,starvation:o,latency:i,activity:r,users:this.users});const e=Date.now();if(this.lastAnimationEnd){const t=e-this.lastAnimationEnd;if(!0===this.animationGapCheck&&t>200&&(this.animationGapCheck=[],Dl.session&&console.log(this.id,"animation has stopped (too long between steps)")),!0!==this.animationGapCheck){const e=this.animationGapCheck;e.push(t),e.length>4&&e.shift(),4===e.length&&e.reduce(((e,t)=>e+t),0)<=400&&(this.animationGapCheck=!0,Dl.session&&console.log(this.id,"animation has started"))}}this.lastAnimationEnd=e}if(!this.connected)return void(this.isInBackground()||this.checkForConnection(!0));if(!this.vm)return;let a;switch(e){case"animation":{const e=t.expectedSimFPS,s=Date.now(),n=ic.reduce(((e,t)=>e+t),0)/ic.length;if(a=this.simulate(s+Math.min(n,nc)),!1===a){const t=0===e?0:1e3/e*4;this.backlog>t&&(a=this.simulate(s+nc-n))}"error"!==a&&(ic.push(Date.now()-s),ic.length>4&&ic.shift());break}case"fastForward":case"background":a=this.simulate(Date.now()+t.budget);break;default:console.warn(e)}this.fastForwardHandler&&this.fastForwardHandler(a),"error"!==a&&(pe.begin("update"),this.processModelViewEvents("animation"===e),pe.end("update"),this.vm&&(this.serviceRateLimitBuffer(),"animation"===e&&(t.view&&(pe.begin("render"),this.inViewRealm((()=>t.view.update(t.frameTime))),pe.end("render")),this.lastAnimationEnd=Date.now())))}applySyncChange(e){Dl.session&&console.log(this.id,`synced=${e}`),this.synced=e,ze.showSyncWait(!e),this.vm.publishFromView(this.viewId,"synced",e)}inViewRealm(e){return Be(this.vm,(()=>e(this.vm)))}processModelViewEvents(e){return this.vm?this.vm.processModelViewEvents(e):0}timeFromReflector(e,t,s){e<this.reflectorTime?("controller"!==t||Dl.ticks)&&console.warn(`time is ${this.reflectorTime}, ignoring time ${e} from ${t}`):("boolean"!=typeof this.synced&&(this.synced=!1),this.reflectorTime=e,this.extrapolatedTimeBase=Date.now()-e,this.vm&&pe.backlog(this.backlog),this.tickHook&&this.tickHook(e,s))}multiplyTick(e){this.localTicker&&globalThis.clearInterval(this.localTicker);const t=this.msPerTick,s=this.tickMultiplier;let n=1;this.localTicker=globalThis.setInterval((()=>{this.timeFromReflector(Math.round(e+n*t),"controller"),Dl.ticks&&console.log(this.id,"Controller generate TICK "+this.reflectorTime,n),++n>=s&&(globalThis.clearInterval(this.localTicker),this.localTicker=0)}),t)}startStepping(e){const t=s=>{this.leaving||(this.isOutOfSight()||e(s),window.requestAnimationFrame(t))};window.requestAnimationFrame(t)}setUpActivityChecks(){let e=null;if(this.isOutOfSight=()=>!(Jl||"hidden"!==document.visibilityState&&e),this.isBeingAnimated=()=>{const e=!0===this.animationGapCheck,t=Date.now()-this.lastAnimationEnd<200;return e&&!t&&(this.animationGapCheck=[],Dl.session&&console.log(this.id,"animation has stopped (too long since last step)")),e&&t},this.isInBackground=()=>this.isOutOfSight()||!this.isBeingAnimated(),!Jl){new IntersectionObserver(((t,s)=>e=t[0].isIntersecting)).observe(document.body)}const t=this.sessionSpec.autoSleep;let s;if(t){const e=1e3*t;let n=0,i=0;s=()=>{const t=Date.now();t-n<980||(n=t,this.isOutOfSight()?i?t-i>e&&(this.dormantDisconnect(),i=0):i=t:i=0)}}const n=()=>{this.leaving?i&&(clearInterval(i),i=null):this.connected&&this.vm&&(s&&s(),this.isBeingAnimated()||this.connection.keepAlive(Date.now()))};let i=setInterval(n,1e3);this.simulateIfNeeded=()=>{if(!this.isBeingAnimated()&&(n(),!this.fastForwardHandler&&this.connected)){let e=.9*this.msPerTick;t&&(e=Math.min(e,nc));const s=this.synced?"background":"fastForward";this.stepSession(s,{budget:e})}}}toString(){return`Controller[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}}class uc{constructor(e){this.controller=e,this.socketLastSent=0,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.reconnectDelay=0,this.missingTickThreshold=1/0}get id(){return this.controller.id}setTick(e){this.missingTickThreshold=Math.min(3*e,45e3)}get connected(){return!(!this.socket||!this.socket.isConnected())}checkForConnection(e){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!e||this.connectToReflector()}connectToReflector(){if(this.socket||this.connectHasBeenCalled)return;let e;this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1;const t=()=>{Dl.session&&console.log(this.id,this.socket.constructor.name,"connected to",this.socket.url),this.reconnectDelay=0,pe.connected(!0),this.controller.sendJoin()};if(Dl.offline)e=new Yl,e.isConnected=()=>e.readyState===WebSocket.OPEN;else if(ql){const{synchSpec:s,developSpec:n}=u;if(s&&n)throw Error("Cannot handle both synchSpec and developSpec options");let i="";const o=s||n;o&&(i+=`&synch=${encodeURIComponent(o)}`);const r=this.id,{persistentId:a,appId:l,developerId:c}=this.controller.sessionSpec;e=new Nl(`${ec}/clients/connect?session=${r}&persist=${a}&app=${encodeURIComponent(l)}&developer=${c}${i}`),e.isConnected=()=>"open"===e.dataChannel?.readyState,e.onconnected=t}else{let t=this.controller.getBackend(this.controller.sessionSpec.apiKey).reflector;const s=Jl?void 0:window.location.href,n={},i=this.controller.sessionSpec.token;if(i&&(n.token=i),u.reflector){const e=u.reflector.toUpperCase();"CF"===e||e.match(/^[A-Z]{3}$/)?(t=Dl.reflector?"wss://croquet.network/reflector/dev/":"wss://croquet.network/reflector/",3===e.length&&(n.colo=e)):u.reflector.match(/^[-a-z0-9]+$/i)?n.region=u.reflector:t=new URL(u.reflector,s).href.replace(/^http/,"ws")}if(!t.match(/^wss?:/))throw Error("Cannot interpret reflector address "+t);t.endsWith("/")||(t+="/");const o=new URL(t+this.id,s);for(const[e,t]of Object.entries(n))o.searchParams.append(e,t);e=new WebSocket(o),e.isConnected=()=>e.readyState===WebSocket.OPEN}e.onopen=s=>{const n=this.socket;n&&(n.onopen=n.onmessage=n.onerror=n.onclose=null),this.socket=e,this.connectHasBeenCalled=!1,e.twoStageConnection||t()},e.onmessage=t=>{if(e!==this.socket)return;const{data:s}=t,n="_CHUNK";if(s.startsWith(n)){const t="1"===s.charAt(6),n="1"===s.charAt(7),i=s.slice(8);if(t&&(e.chunkCollector=[]),e.chunkCollector.push(i),n){const t="".concat(...e.chunkCollector);e.chunkCollector=[],pe.addNetworkTraffic("reflector_in",t.length,!!ql),this.receive(t)}}else pe.addNetworkTraffic("reflector_in",s.length,!!ql),this.receive(s)},e.onerror=t=>{Dl.session&&console.log(this.id,e.constructor.name,"connection error"),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout()},e.onclose=t=>{this.socket&&e!==this.socket||this.socketClosed(t.code,t.reason)}}socketClosed(e,t){Dl.session&&console.log(this.id,`socketClosed with code=${e} message="${t}"`),e>=4100&&4110!==e&&(Dl.session&&console.warn("resuming this session will require a new Session.join()"),this.controller.leaving||(this.controller.leaving=()=>{}),this.reconnectDelay=0);const s=!!!this.controller.leaving&&1e3!==e&&e<4100,n=4110===e;n||1e3===e||this.reconnectDelay||setTimeout((()=>{if(this.connected||this.socket?.isConnecting?.())return;const n=s?"Reconnecting":"Connection closed";ze.showMessage(`${n}: ${e} ${t}`,{level:s?"warning":"fatal"})}),500),Dl.session&&console.log(this.id,`${this.socket?this.socket.constructor.name+" closed":"closed before opening,"} with code: ${e} ${t}`),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout(),pe.connected(!1),pe.resetAuditStats(),n?this.connectRestricted=!0:this.connectBlocked=!0,this.disconnected(),s&&(Dl.session&&console.log(this.id,`reconnecting in ${this.reconnectDelay} ms`),this.reconnectTimeout=globalThis.setTimeout((()=>{delete this.reconnectTimeout,this.connectToReflector()}),this.reconnectDelay),this.reconnectDelay=Math.min(3e4,Math.round((this.reconnectDelay+100)*(1+Math.random()))))}disconnected(){this.socket&&(this.socket=null,this.lastReceived=0,this.socketLastSent=0,this.stalledSince=0,this.connectHasBeenCalled=!1,this.controller.connectionInterrupted())}send(e){this.socketLastSent=Date.now(),this.socket.send(e),pe.addNetworkTraffic("reflector_out",e.length,!!ql)}receive(e){this.lastReceived=Date.now();const{id:t,action:s,args:n}=JSON.parse(e);if(t)try{this.controller.receive(s,n)}catch(e){this.closeConnectionWithError("receive",e)}else if("PONG"===s){if(Dl.pong&&console.log("PONG after",Date.now()-n,"ms"),this.pongHook)try{this.pongHook(n)}catch(e){console.error(e)}}else console.warn("Unknown action",s)}dormantDisconnect(){this.connected&&(Dl.session&&console.log(this.id,`dormant; disconnecting from ${tc}`),this.closeConnection(4110,"Going dormant"))}closeConnectionWithError(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;console.error(s,t),this.closeConnection(s,`Error in ${e}: ${t.message||t}`)}closeConnection(e,t){if(this.socket){this.socket.onclose=null;try{this.socket.close(e,t)}catch(s){console.error(`Error in socket.close(${e}, ${JSON.stringify(t)}):`,s)}}this.socketClosed(e,t)}PULSE(e){this.connected&&(0===this.socket.bufferedAmount?(this.send(JSON.stringify({action:"PULSE"})),this.stalledSince=0):this.stalledSince&&e-this.stalledSince>500?console.log(this.id,`Reflector connection stalled: ${this.socket.bufferedAmount} bytes unsent for ${e-this.stalledSince} ms`):this.stalledSince=Date.now())}keepAlive(e){0!==this.lastReceived&&(e-this.socketLastSent>25e3?this.PULSE(e):e-this.lastReceived>5e4?this.closeConnectionWithError("connection",Error((ql?"Synchronizer":"Reflector")+" has gone away")):e-this.lastReceived>this.missingTickThreshold&&this.PULSE(e))}PING(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();this.connected&&this.send(JSON.stringify({action:"PING",args:e}))}}globalThis.setInterval((()=>{for(const e of cc)e.connected&&e.vm&&e.connection.keepAlive(Date.now())}),100);const mc=Symbol("hash"),pc=Symbol("key"),fc=Symbol("url"),bc=new Map;let yc=0;function gc(e){return u.has("debug",e,!1)}function wc(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Zc(e){return e.replace(/-/g,"+").replace(/_/g,"/").padEnd(e.length+3&-4,"=")}function vc(e,t){return e||(e="*"),t.replace(/[\s\S]/g,(t=>String.fromCharCode(t.charCodeAt(0)^e.charCodeAt(0))))}class Xc{async store(){throw Error("Data.store() needs to be called from session.data")}async fetch(){throw Error("Data.fetch() needs to be called from session.data")}static async store(e,t,s){if(ed.hasCurrent())throw Error(`${ze.libName}.Data.store() called from Model code`);let n,i,o;if("string"==typeof e?(n=e,e=t,i=!0,o=s):(n=t&&t.sessionId,i=t&&t.shareable,o=t&&t.keep),!(e instanceof ArrayBuffer))throw Error(`${ze.libName}.Data.store() called with non-ArrayBuffer data`);const{appId:r,persistentId:a,key:l,uploadEncrypted:c}=dc(n),d=i?T.random(32).toString(zi):zi.stringify(l),h=`apps/${r}/${a}/data/%HASH%`,u="data#"+ ++yc;gc("data")&&console.log(`${ze.libName}.Data: storing ${u} ${e.byteLength} bytes`);const m=await c({path:h,content:e,key:d,keep:o,debug:gc("data"),what:u}),p=function(e){return e.replace(/.*\//,"")}(m),f=new xc(p,i&&d,m);return gc("data")&&console.log(`${ze.libName}.Data: stored ${u} as ${this.toId(f)}`),f}static async fetch(e,t){let s;if(t&&t[fc]?(s=e,e=t):s=t&&t.sessionId,ed.hasCurrent())throw Error(`${ze.libName}.Data.fetch() called from Model code`);const{downloadEncrypted:n,key:i}=dc(s),o=e&&e[mc],r=e&&e[pc]||zi.stringify(i),a=e&&e[fc];if("string"!=typeof o||"string"!=typeof r||"string"!=typeof a)throw Error(`${ze.libName}.Data.fetch() called with invalid handle`);const l="data#"+ ++yc;return gc("data")&&console.log(`${ze.libName}.Data: fetching ${l} ${this.toId(e)}`),n({url:a,key:r,debug:gc("data"),what:l})}static hash(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"base64url";"function"==typeof e&&(e=Function.prototype.toString.call(e)),"string"==typeof e?e=(new TextEncoder).encode(e):e&&e.constructor===DataView?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e&&e.constructor===ArrayBuffer?e=new Uint8Array(e):ArrayBuffer.isView(e)||(e=(new TextEncoder).encode(t(e)));const n=P(T.create(e));switch(s){case"hex":return n.toString();case"base64":return n.toString(zi);case"base64url":return wc(n.toString(zi));default:throw Error(`${ze.libName}.Data: unknown hash output "${s}", expected "hex"/"base64"/"base64url"`)}}static fromId(e){const t=e.slice(0,1);let s,n,i,o;switch(t){case"0":s=e.slice(1,44),n=e.slice(44),i=`${Ul}/sessiondata/${s}`;break;case"1":s=e.slice(1,44),n=e.slice(44,87)+"=",o=e.slice(87),i=`${Ul}/apps/${o}/data/${s}`;break;case"2":s=e.slice(1,44),n=Zc(e.slice(44,87)),o=vc(n,atob(Zc(e.slice(87)))),i=`${Ul}/apps/${o}/data/${s}`;break;case"3":n=Zc(e.slice(1,44)),i=vc(n,atob(Zc(e.slice(44)))),s=i.slice(-43);break;case"4":n=null,i=vc(n,atob(Zc(e.slice(1)))),s=i.slice(-43);break;default:throw Error(`${ze.libName}.Data expected handle v0-v4 got v${t}`)}return new this(s,n,i)}static toId(e){if(!e)return"";const t=e[mc],s=e[pc],n=e[fc];if(n.slice(-43)!==t)throw Error(`${ze.libName} Data: malformed URL`);const i=s&&wc(s),o=wc(btoa(vc(s,n)));return s?`3${i}${o}`:`4${o}`}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;const n=bc.get(e);if(n)return n;if(s.slice(-43)!==e)throw Error(`${ze.libName} Data: malformed URL`);Object.defineProperty(this,mc,{value:e}),t&&Object.defineProperty(this,pc,{value:t}),Object.defineProperty(this,fc,{value:s}),bc.set(e,this)}}class xc extends Xc{}const Lc={cls:xc,write:e=>xc.toId(e),read:e=>xc.fromId(e)};let Sc=null,Gc=null;const Wc=Symbol("DEBUG_WRITE_TARGET");let Tc=null;function Cc(e,t){return Array.isArray(e)||"string"!=typeof t?`[${t}]`:t.match(/^[a-z_$][a-z0-9_$]*$/i)?`.${t}`:`["${t}"]`}class kc extends Error{}function Pc(){if(!globalThis.CroquetViewMath){globalThis.CroquetMath.random=()=>Sc.random(),globalThis.CroquetViewMath={};for(const[e,t]of Object.entries(Object.getOwnPropertyDescriptors(Math)))globalThis.CroquetViewMath[e]=t.value;for(const[s,n]of Object.entries(globalThis.CroquetMath)){const i=Math[s];Math[s]=1===n.length?e=>Sc?n(e):i(e):(e,t)=>Sc?n(e,t):i(e,t)}}if(!globalThis.CroquetViewDate){const o=globalThis.Date;let r=!1;function a(e,t){return r||(r=!0,console.warn(new kc(`${e} used in Model code`))),t}function l(e,t,s,n,i,r,c){const d=this instanceof l,h=[e,t,s,n,i,r,c];if(h.length=arguments.length,Sc)switch(a(d?"new Date()":"Date()"),arguments.length){case 0:h.push(Sc.time);break;case 1:break;default:h[0]=o.UTC(...h),h.length=1}const u=new o(...h);return d?u:""+u}l.prototype=o.prototype,l.UTC=o.UTC,l.now=()=>Sc?a("Date.now()",Sc.time):o.now(),l.parse=function(){return Sc?a("Date.parse()",0):o.parse(...arguments)},globalThis.CroquetViewDate=o,globalThis.Date=l}}Object.defineProperty(kc.prototype,"name",{value:`${ze.libName}Warning`});const Rc=Symbol("QFUNC");function Ic(e,t,s,n){const i=new Vc(e,t,s,n),o=i.compile();return o[Rc]=i,o}function Mc(e,t,s,n){const i=[],o=[];let r,a,l,c;if(s){if("this"in s){for(t=s.this,r="_this";r in s;)r="_"+r;delete(s={...s,[r]:t}).this}if(l=[...Object.keys(s).sort()],c=[...l.map((e=>s[e]))],l.length){for(a="env";a in s||a===n;)a="_"+a;i.push(a),o.push(c)}}e.match(/\bCroquet\b/)&&!l?.includes("Croquet")&&(i.push("Croquet"),o.push(gd.Croquet)),e.match(/\bMultisynq\b/)&&!l?.includes("Multisynq")&&(i.push("Multisynq"),o.push(gd.Croquet));let d=n||"qFunc";for(;l?.includes(d);)d="_"+d;let h='"use strict"\n\n';h+="// Croquet QFunc Compiler by Codefrau\n\n",h+="//////////////// Start Compiler /////////////////\n",h+="try { const ",l?.length&&(h+=`[${l.join(", ")}] = ${a}, `);let u=e.split("\n");const m=u.slice(1),p=Math.min(...m.map((e=>e.match(/^\s*/)[0].length)));if(p>0){u.some((e=>(e.match(/`/g)||[]).length%2==1))||(u=[u[0],...m.map((e=>e.slice(p)))],e=u.join("\n"))}const f=u[u.length-1].match(/^\s*/)[0];f&&(e=f+e),h+=`${d} =\n`,h+="//////////////// Start User Code ////////////////\n\n",h+=e,h+="\n\n///////////////// End User Code /////////////////\n",h+=`return ${d}`,r&&(h+=`.bind(${r})`),h+=" } catch (compileError) { return compileError; }\n",h+="///////////////// End Compiler //////////////////";try{const e=new Function(...i,h).call(t,...o);if(e instanceof Error)throw console.warn("rethrowing error",e),e;return e}catch(t){throw console.warn(`createQFunc compiling:\n\n${e}`),Error(`createQFunc(): ${t.message}`)}}class Vc{constructor(e,t,s,n){if(this.thisVal=e,this.env=t,this.selfRef=n,this.source=s,void 0===n){this.selfRef="","function"==typeof s&&(this.source=s.toString());const e=Object.keys(t);for(const n of e)if(s===t[n]){if(this.selfRef)throw Error(`createQFunc: env.${this.selfRef} and env.${n} cannot both reference the function`);this.selfRef=n}this.selfRef&&(this.env={...t},delete this.env[this.selfRef])}Object.freeze(this.env)}compile(){return Mc(this.source,this.thisVal,this.env,this.selfRef)}}const Yc={cls:Rc,write:e=>{let{[Rc]:{thisVal:t,env:s,source:n,selfRef:i}}=e;return[t,n,i,...Object.entries(s).flat()]},read:e=>{let[t,s,n,...i]=e;const o={};for(let e=0;e<i.length;e+=2)o[i[e]]=i[e+1];return Ic(t,o,s,n)}},Hc="future message",Kc="message in cancelFuture",Nc="subscription handler";function zc(e){return`qFunc~${e.split(" ")[0]}~`}const _c=zc(Hc),Fc=zc(Nc);function Ec(e){return e===Hc||e===Nc}function Jc(e){return e.startsWith(_c)}function jc(e){return`${Fc}${e}`}function Qc(e,t){return!!e.startsWith(Fc)&&e.slice(Fc.length)===t}function Uc(e,t){if(Sc)throw Error("VirtualMachine confusion");if(!(e instanceof ed))throw Error("not a VM: "+e);const s=Sc;try{Sc=e,globalThis.CROQUETVM=e,t()}finally{Sc=s}}const Dc="#reflected",Oc=["handleModelEventInModel","handleBundledEvents","publishFromModelOnly","handlePollForSnapshot","handleTuttiResult","handleTuttiDivergence","handleSnapshotVote","handlePersistVote","handleModelEventInView","noop","handleAuditRequest"],Bc={};for(let e=0;e<Oc.length;e++)Bc[Oc[e]]=e;const Ac=new WeakMap;function $c(e){Ac.set(e,null)}class qc{random(){throw Error("Math.random() cannot be used in Model.evaluate()")}}class ed{static current(){return Sc||console.warn("VirtualMachine.current() called from outside the vm!"),Sc}static hasCurrent(){return!!Sc}static evaluate(e){if(Sc)return e();Pc();const t=Sc;try{return Sc=new qc,e()}finally{Sc=t}}constructor(e,t,s,n){Pc(),Gc={snapshot:u.has("debug","snapshot",!1),session:u.has("debug","session",!1),write:u.has("debug","write",!1)},$c(this),Uc(this,(()=>{Oe(this,(()=>{if(this.models={},this.namedModels={},this.messages=new Vi(((e,t)=>e.before(t))),this.subscriptions={},this.subscribers=new Map,this.genericSubscriptions=[],this.currentEvent="",this.currentEventFromModel=!1,this.debugEvents=t,this.views={},this._random=()=>{throw Error("You must not use random when applying state!")},this.id=e.id,this.time=0,this.seq=4294967280,this.externalTime=0,this.externalSeq=this.seq,this.futureSeq=0,this.lastSnapshotPoll=0,this.lastPersistencePoll=0,this.inPersistenceCoolOff=!1,this.persisted="",this.modelsId=0,this.diverged=null,this.controller=null,e.models){const t=ld.newOrRecycled(this).readVM(e,"VM",n);let s=[],i=[];for(const e of Object.keys(t))"meta"!==e&&("staticInitializers"===e?s=t[e]:e in this?"_random"===e?this[e]=new g(null,{state:t[e]}):"messages"===e?i=t.messages:this[e]=t[e]:console.warn(`Ignoring property snapshot.${e}`));for(const e of s)e();for(const e of i)this.messages.add(e);for(const[e,t]of Object.entries(this.subscriptions))for(const s of t){const[t]=s.split(".");let n=this.subscribers.get(t);n||this.subscribers.set(t,n=new Set),n.add(e)}}else this._random=new g(e.id,{state:!0}),this.addSubscription(this,"__VM__","__peers__",this.generateJoinExit),this.addSubscription(this,"__VM__","__diverged__",this.handleSessionDiverged),s(this)}))}))}registerModel(e,t){if(Sc!==this)throw Error("You can only create models from model code!");return t||(t="M"+ ++this.modelsId),this.models[t]=e,t}deregisterModel(e){if(Sc!==this)throw Error("You can only destroy models from model code!");const t=this.models;delete this.models[e];for(const[e,s]of Object.entries(this.namedModels))t===s&&delete this.namedModels[e];this.messages.removeMany((t=>t.hasReceiver(e)))}lookUpModel(e){if("_"===e)return this;let t=this.models[e];if(t)return t;const[s,n,i]=e.match(/^([^#]+)#(.*)$/)||[];return t=this.models[n],t&&t.lookUp(i)}get(e){const t=this.namedModels[e];return Sc!==this&&Gc.write&&t?this.debugWriteProxy(this,t,t.id):t}set(e,t){if(Sc!==this)throw Error("You can only make a model well-known from model code!");this.namedModels[e]=t}debugWriteProxy(e,t,s){if("object"!=typeof t||null===t||t[Wc])return t;if(t instanceof gd&&(s=t.id),!this.$debugWriteProxyHandler){function i(e,t,s){s&&(e+=` ${s} of`);const n=Tc.get(t).path;if(console.warn(`write-debug: non-model code is ${e} ${n}:`,t),s&&"$"!==s[0])throw Error(`write-debug: Attempt to modify ${ze.libName} model state from outside!`)}Tc||(Tc=new WeakMap),this.$debugWriteProxyHandler={set(t,s,n){Sc!==e?i("assigning",t,s):console.warn(`${ze.libName} debug write protection inside model - this should not happen!`),t[s]=n},deleteProperty(t,s){Sc!==e?i("deleting",t,s):console.warn(`${ze.libName} debug write protection inside model - this should not happen!`),delete t[s]},get(t,s){if(s===Wc)return t;const n=t[s];if(n&&n[Wc])return n;if(Sc!==e){if("object"==typeof n&&null!==n){const o=Tc.get(t).path;if(n instanceof Map){const t=new Map([...n.entries()].map(((t,s)=>{let[n,i]=t;return[e.debugWriteProxy(e,n,`${o}.key#${s}`),e.debugWriteProxy(e,i,`${o}.value#${s}`)]})));return t[Wc]=n,t.set=()=>i("setting an item in",n),t.delete=()=>i("deleting from",n),t.clear=()=>i("clearing",n),Tc.set(n,{proxy:t,path:o+Cc(n,s)}),t}if(n instanceof Set){const t=new Set([...n.values()].map(((t,s)=>e.debugWriteProxy(e,t,`${o}.item#${s}`))));return t[Wc]=n,t.add=()=>i("adding to",n),t.delete=()=>i("deleting from",n),t.clear=()=>i("clearing",n),Tc.set(n,{proxy:t,path:o+Cc(n,s)}),t}return e.debugWriteProxy(e,n,o+Cc(n,s))}}else console.warn(`${ze.libName} debug write protection inside model - this should not happen!`);return n}}}let n=Tc.get(t);return n||(n={proxy:new Proxy(t,this.$debugWriteProxyHandler),path:s},Tc.set(t,n)),n.proxy}noop(){}generateJoinExit(e){let{entered:t,exited:s,count:n,total:i}=e;this.controller.handleUserTotalForAccounting(i);const o={};for(const e of t){if("string"==typeof e)continue;let t,s,n;Array.isArray(e)?[t,s]=e:(t=e.id,n=e.data,s=e.location),o[t]={},n&&(o[t].data=n),s&&(s.region&&(s.country=s.region.slice(0,2),s.region=s.region.slice(2)),o[t].loc=s)}if(t=t.map((e=>"string"==typeof e?e:Array.isArray(e)?e[0]:e.id)),s=s.map((e=>"string"==typeof e?e:Array.isArray(e)?e[0]:e.id)),t.length===n){s=Object.keys(this.views);for(const e of s)this.views[e].extraConnections=0}if(t.length>0&&s.length>0&&t.some((e=>s.includes(e)))){for(let e=0;e<t.length;e++){const n=t[e],i=s.indexOf(n);i>=0&&(t.splice(e,1),s.splice(i,1),e--)}if(t.length+s.length===0)return}const r=e=>{const{data:t,loc:s}=this.views[e];if(!t)return e;const n={viewId:e,viewData:t};return s&&(n.location=s),n};for(const e of s)if(this.views[e]){if(this.views[e].extraConnections){this.views[e].extraConnections--,Gc.session&&console.log(this.id,`@${this.time}#${this.seq} view ${e} closed extra connection`);continue}const t=r(e);delete this.views[e],this.publishFromModelOnly(this.id,"view-exit",t)}else{const{time:t,seq:s}=this;console.error(`${this.id} @${t}#${s} view ${e} exited without being present - this should not happen`),Promise.resolve().then((()=>{this.controller.sendLog(`view-exit-mismatch @${t}#${s} ${e} left without being present`)}))}for(const e of t)if(this.views[e])Gc.session&&console.log(this.id,`@${this.time}#${this.seq} view ${e} opened another connection`),this.views[e].extraConnections=(this.views[e].extraConnections||0)+1;else{this.views[e]=o[e]||{};const t=r(e);this.publishFromModelOnly(this.id,"view-join",t)}const a=Object.values(this.views).reduce(((e,t)=>e+1+(t.extraConnections||0)),0);if(n!==a){const{time:e,seq:t}=this;console.error(`@${e}#${t} view count mismatch (model: ${a}, reflector: ${n}) - this should not happen`),Promise.resolve().then((()=>{this.controller.sendLog(`view-exit-mismatch @${e}#${t} connections model: ${a} reflector: ${n}`)}))}}scheduleExternalMessage(e){const t=nd.fromState(e,this);if(t.time<this.time)throw Error("past message from reflector "+e);const s=this.externalSeq+1>>>0;if(t.seq!==s)throw Error(`External message error. Expected message #${s} got #${t.seq}`);return this.externalTime=t.time,this.externalSeq=t.seq,t.seq=2*t.seq+1,this.verifyExternal(t),this.messages.add(t),t}verifyExternal(e){if("_"!==e.receiver)throw Error(`invalid receiver in external message: ${e}`);if(!(e.selector in Bc))throw Error(`unexpected external message: ${e.selector}`)}futureSend(e,t,s,n){if(e.every)return this.futureRepeat(e.every,t,s,n);if(e<0)throw Error("attempt to send future message into the past");this.futureSeq=this.futureSeq+1>>>0;const i=new nd(this.time+e,2*this.futureSeq,t,s,n);return this.messages.add(i),{time:i.time,seq:i.seq}}cancelFuture(e,t){const s=this.messages;let n;if("number"==typeof t.time){const{time:e,seq:i}=t;n=s.removeOne((t=>t.time===e&&t.seq===i))}else{if("*"===t)return n=s.removeMany((t=>t.receiver===e.id)),n.length>0;{const i=this.asMethodName(e,t,Kc),o=e.id;n=s.removeOne((e=>e.receiver===o&&e.selector===i||"_"===e.receiver&&"futureExecAndRepeat"===e.selector&&e.args[1]===o&&e.args[2]===i)),Jc(i)&&delete e[i]}}return void 0!==n}futureRepeat(e,t,s,n){this.futureSend(e,"_","futureExecAndRepeat",[e,t,s,n])}futureExecAndRepeat(e,t,s,n){const i=this.lookUpModel(t);if(i){if("function"==typeof i[s])try{i[s](...n)}catch(e){Se(`future message ${i}.${s}`,e)}else{const e=this.compileFuncString(s,i);try{e(...n)}catch(t){Se(`future message ${i} ${e}`,t)}}this.futureRepeat(e,t,s,n)}}future(e,t,s,n){if(!this.lookUpModel(e.id))throw Error(`future send to unregistered model ${e}`);if(void 0===s){const s=this;return new Proxy(e,{get:(n,i)=>function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return s.future(e,t,i,o)}})}const i=this.asMethodName(e,s,Hc);if("string"!=typeof i)throw Error(`future message to ${e} ${i} is not a string`);if("function"!=typeof e[i]&&i.indexOf(".")<0&&"{"!==i[0])throw Error(`future send to ${e} with unknown method ${i}()`);return this.futureSend(t,e.id,i,n)}advanceTo(e,t){if(Sc)throw Error("cannot advance time from model code");let s;for(;(s=this.messages.peek())&&s.time<=e;){const{time:e,seq:n}=s;if(e<this.time)throw Error("past message encountered: "+s);if(1&n&&(this.seq=this.seq+1>>>0,n/2>>>0!==this.seq))throw Error(`Sequence error: expected ${this.seq} got ${n/2>>>0} in ${s}`);if(this.messages.poll(),this.time=s.time,s.executeOn(this),globalThis.CroquetViewDate.now()>=t)return!1}return this.time=e,!0}asMethodName(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if("string"==typeof t)return t;if("function"==typeof t){if(e[t.name]===t)return t.name;if(t[Rc]&&n){const s=jc(n);if(e[s]===t)return s}let o=e;for(;null!==o;){for(const[e,n]of Object.entries(Object.getOwnPropertyDescriptors(o)))if(n.value===t){if(t[Rc]&&((i=s)!==Hc&&i!==Kc||!Jc(e)))continue;return e}if(o===e&&t[Rc]){if(!Ec(s))return xe(`${s} is not a registered QFunc: ${t}`,{only:"once"}),null;let i;if(n)i=jc(n);else{const t=_c;let s=0;do{i=`${t}${s++}`}while(e[i])}return e[i]=t,i}o=Object.getPrototypeOf(o)}xe(`${s} is not a method of ${e} and not a QFunc: ${t}\n`,{only:"once"});const r=/^\(?([a-z][a-z0-9]*)?\)? *=> *this\.([a-z][a-z0-9]*) *\( *([a-z][a-z0-9]*)? *\) *$/i,a=t.toString().match(r);return!a||a[3]&&a[3]!==a[1]?this.asFuncString(t):a[2]}var i;return null}asFuncString(e){const t=e.toString();return`{${btoa(JSON.stringify(t))}}`}compileFuncString(e,t){this.$compiledFuncs||(this.$compiledFuncs={});const s=t.id+":"+e;let n=this.$compiledFuncs[s];if(!n){const i=JSON.parse(atob(e.slice(1,-1)));n=Mc(i,t),i.startsWith("function")&&(n=n.bind(t)),this.$compiledFuncs[s]=n}return n}addSubscription(e,t,s,n){if(Sc!==this)throw Error("Cannot add a model subscription from outside model code");if(t.includes(":"))throw Error(`Invalid subscription scope "${t}" (must not contain ':')`);const i=t+":"+s,o=this.asMethodName(e,n,Nc,i);if("string"!=typeof o)throw Error(`Subscription handler for "${s}" must be a method name`);if(o.indexOf(".")<0&&"function"!=typeof e[o]&&"{"!==o[0])throw Error(`Subscriber method for "${s}" not found: ${e}.${o}()`);const r=e===this?"_":e.id,a=r+"."+o;if("*"===t||"*"===s)return void this.addGenericSubscription(i,a);if(this.subscriptions[i]){if(-1!==this.subscriptions[i].indexOf(a))throw Error(`${e}.${o} already subscribed to ${s}`)}else this.subscriptions[i]=[];this.subscriptions[i].push(a);let l=this.subscribers.get(r);l||this.subscribers.set(r,l=new Set),l.add(i)}removeSubscription(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"*";if(Sc!==this)throw Error("Cannot remove a model subscription from outside model code");if("*"===t||"*"===s)return void this.removeGenericSubscription(e,t,s,n);const i=t+":"+s,o=this.subscriptions[i];if(o){const t=e.id+".";if("*"===n){for(let s=o.length-1;s>=0;s--)if(o[s].startsWith(t)){const n=o[s].slice(t.length);Qc(n,i)&&delete e[n],o.splice(s,1)}0===o.length&&delete this.subscriptions[i]}else{const r=this.asMethodName(e,n,"unsubscribe argument",i);if("string"!=typeof r)throw Error(`Invalid unsubscribe args for "${s}" in ${e}: ${n}`);const a=t+r,l=o.indexOf(a);if(-1!==l&&(o.splice(l,1),0===o.length&&delete this.subscriptions[i],Qc(r,i)&&delete e[r]),o.find((e=>e.startsWith(t))))return}const r=this.subscribers.get(e.id);r.delete(i),0===r.size&&this.subscribers.delete(e.id)}}addGenericSubscription(e,t){this.genericSubscriptions.push({topic:e,handler:t})}removeGenericSubscription(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"*";const i=t+":"+s,o=e.id+".";for(let t=this.genericSubscriptions.length-1;t>=0;t--){const s=this.genericSubscriptions[t];s.topic===i&&s.handler.startsWith(o)&&("*"!==n&&s.handler!==o+n||(this.genericSubscriptions.splice(t,1),Qc(n,i)&&delete e[n]))}}removeAllSubscriptionsFor(e){const t=this.subscribers.get(e.id);if(t){const s=e.id+".";for(const n of t){const t=this.subscriptions[n];for(let i=t.length-1;i>=0;i--)if(t[i].startsWith(s)){const o=t[i].slice(s.length);Qc(o,n)&&delete e[o],t.splice(i,1)}0===t.length&&delete this.subscriptions[n]}this.subscribers.delete(e.id)}}publishFromModel(e,t,s){if(Sc!==this)throw Error("Cannot publish a model event from outside model code");if(e.includes(":"))throw Error(`Invalid publish scope "${e}" (must not contain ':')`);const n=t.endsWith(Dc);n&&(t=t.slice(0,t.length-10));const i=this.currentEventFromModel;this.currentEventFromModel=!0;const o=e+":"+t;this.handleModelEventInModel(o,s,n),this.handleModelEventInView(o,s),this.currentEventFromModel=i}publishFromModelOnly(e,t,s){if(Sc!==this)throw Error("Cannot publish a model event from outside model code");const n=e+":"+t;this.handleModelEventInModel(n,s)}publishFromView(e,t,s){if(Sc)throw Error("Cannot publish a view event from model code");if(e.includes(":"))throw Error(`Invalid publish scope "${e}" (must not contain ':')`);const n=e+":"+t;this.handleViewEventInModel(n,s),this.handleViewEventInView(n,s)}handleBundledEvents(e){for(const t of e){const e=nd.fromState(t,this);this.verifyExternal(e),e.executeOn(this,!0)}}handleModelEventInModel(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Sc!==this)throw Error("handleModelEventInModel called from outside model code");if(s){if(!0!==this.controller.synced)return;const s=e+"#__vote",n=e+"#divergence",i=!!Ee.subscriptions[s],o=!!this.subscriptions[e],r=!!this.subscriptions[n];i&&r&&console.log(`divergence subscription for ${e} overridden by vote subscription`);const a=o?new nd(this.time,0,"_","handleModelEventInModel",[e,t]):null;let l;l=i?["handleModelEventInView",s]:["handleTuttiDivergence",n],Promise.resolve().then((()=>this.controller.sendTutti({time:this.time,topic:e,data:t,firstMessage:a,wantsVote:i,tallyTarget:l})))}else this.genericSubscriptions.length>0&&this.invokeGenericHandlers(e,t),this.subscriptions[e]&&this.invokeHandlers(this.subscriptions[e],e,t)}invokeHandlers(e,t,s){const n=e.slice();for(let i=0;i<n.length;i++){const o=n[i];(o===e[i]||e.includes(o))&&this.invokeHandler(o,t,s)}}invokeGenericHandlers(e,t){const[s,n]=e.split(":");if(!(s.startsWith("__")&&s.endsWith("__")||n.startsWith("__")&&n.endsWith("__")))for(const i of this.genericSubscriptions){const[o,r]=i.topic.split(":");("*"===o&&r===n||o===s&&"*"===r||"*"===o&&"*"===r)&&this.invokeHandler(i.handler,e,t)}}invokeHandler(e,t,s){const n=this.currentEvent;this.currentEvent=t;try{const[n,...i]=e.split("."),o=i.join("."),r=this.lookUpModel(n);if(!r)return void xe(`event ${t} .${o}(): subscriber not found`);if("{"===o[0]){const e=this.compileFuncString(o,r);try{e(s)}catch(s){Se(`event ${t} ${r} ${e}`,s)}return}if(o.indexOf(".")>=0){const e=o.indexOf("."),n=o.slice(0,e),i=o.slice(e+1);try{r.call(n,i,s)}catch(e){Se(`event ${t} ${r}.call(${JSON.stringify(n)}, ${JSON.stringify(i)})`,e)}return}if("function"!=typeof r[o])return void Se(`event ${t} ${r}.${o}(): method not found`);try{r[o](s)}catch(e){Se(`event ${t} ${r}.${o}()`,e)}}finally{this.currentEvent=n}}handleViewEventInModel(e,t){if(this.subscriptions[e]){const s=[e];void 0!==t&&s.push(t);const n=new nd(this.time,0,"_","handleModelEventInModel",s);this.controller.sendMessage(n)}}handleModelEventInView(e,t){Gc.write&&(t=this.debugWriteProxy(this,t,`event ${e} arg`)),Ee.handleEvent(e,t,(e=>function(e){if(!Sc)throw Error("VirtualMachine confusion");const t=Sc;try{Sc=null,e()}finally{Sc=t}}((()=>Be(this,e,!0)))))}handleViewEventInView(e,t){Ee.handleEvent(e,t)}handleTuttiDivergence(e,t){if(this.subscriptions[e])this.handleModelEventInModel(e,t);else{const s=e.split(":").slice(-1)[0];console.warn(`uncaptured divergence in ${s}:`,t)}}handleSessionDiverged(e){const{key:t,url:s}=e;this.diverged||(this.diverged=new Map);let n=this.diverged.get(t);n||this.diverged.set(t,n=[]),n.push(s),2===n.length&&this.controller&&!this.controller.fastForwardHandler&&this.debugDiverged(t)}debugDiverged(e){e||(e=this.diverged.keys().next().value);const t=this.diverged.get(e);if(!t||t.length<2)throw Error(`no diverged urls for snapshot ${e}`);Promise.resolve().then((()=>this.controller.diffDivergedSnapshots(t)))}processModelViewEvents(e){if(Sc)throw Error("cannot process view events in model code");return Be(this,(()=>Ee.processFrameEvents(e,!!this.controller.synced)))}handlePollForSnapshot(){const e=this.time,t=e-this.lastSnapshotPoll;t<5e3?console.log(`rejecting snapshot poll ${t}ms after previous`):(this.lastSnapshotPoll=e,this.controller.handlePollForSnapshot(e))}handleTuttiResult(e){this.controller.handleTuttiResult(e)}handleSnapshotVote(e){this.controller.handleSnapshotVote(e)}handlePersistVote(e){this.controller.handlePersistVote(e)}handleAuditRequest(e){this.controller.handleAuditRequest(e)}snapshot(){return rd.newOrRecycled(this).snapshot(this,"VM")}getSummaryHash(){return t((new od).getHash(this))}debug(e){return this.controller.setDebug(e)}forceSnapshot(){this.controller.requestDebugSnapshot()}persist(e,s){this.controller&&"no.appId"===this.controller.sessionSpec.appId&&console.warn(`${ze.libName}: appId should be provided in Session.join() to not overwrite another apps's persistent data`);const n=pe.begin("snapshot"),i="function"==typeof s?s.call(e):s;if("object"!=typeof i)throw Error(`${ze.libName}: persistSession() can only persist objects (got ${typeof i})`);const o=t(i),r=xc.hash(o),a=pe.end("snapshot")-n,l=this.persisted===r,c=this.time;var d,h;if(Gc.snapshot&&console.log(this.id,`persistent data @${c} collected, stringified and hashed in ${Math.ceil(a)}ms${l?" (unchanged, ignoring)":""}`),u.forcePersist&&queueMicrotask((()=>this.controller.forcePersist(c,o,r))),!l)if(d=this,h={persistTime:c,persistentString:o,persistentHash:r,ms:a},Ac.set(d,h),this.persisted=r,this.inPersistenceCoolOff)Gc.snapshot&&console.log(this.id,"persistence poll postponed by cooloff");else{const e=this.lastPersistencePoll?this.lastPersistencePoll+25e3-this.time:0;e>0?(Gc.snapshot&&console.log(this.id,`postponing persistence poll by ${e}ms`),this.futureSend(e,"_","triggerPersistencePoll",[]),this.inPersistenceCoolOff=!0):this.triggerPersistencePoll()}}triggerPersistencePoll(){this.inPersistenceCoolOff=!1,this.lastPersistencePoll=this.controller?this.time:0;const e=(t=this,Ac.get(t));var t;if(!e)return;const{persistTime:s,persistentString:n,persistentHash:i,ms:o}=e;if($c(this),this.controller&&this.controller.synced){Gc.snapshot&&console.log(this.id,`asking controller to poll for persistence @${s}`);const e=this.time;Promise.resolve().then((()=>this.controller.pollForPersist(e,s,n,i,o)))}}random(){if(Sc!==this)throw Error("synchronized random accessed from outside the model");return this._random()}randomID(){if(Sc!==this)throw Error("synchronized random accessed from outside the model");let e="";for(let t=0;t<4;t++)e+=(this._random.int32()>>>0).toString(16).padStart(8,"0");return e}toString(){return`VirtualMachine[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}}function td(e,t,s){let n;if("_"===e){const e=Bc[t];"number"==typeof e&&(n=e.toString(36))}if(void 0===n&&(n=`${e}>${t}`),s.length>0){const e=cd.newOrRecycled();n+=JSON.stringify(e.encode(s))}return n}function sd(e,t){return(t-e|0)>=0}class nd{constructor(e,t,s,n,i){this.time=e,this.seq=t,this.receiver=s,this.selector=n,this.args=i}before(e){return this.time!==e.time?this.time<e.time:this.isExternal()!==e.isExternal()?e.isExternal():this.isExternal()?sd(this.externalSeq,e.externalSeq):sd(this.internalSeq,e.internalSeq)}hasReceiver(e){return this.receiver===e}isExternal(){return 1&this.seq}get externalSeq(){return this.seq/2>>>0}set externalSeq(e){this.seq=2*e+1}get internalSeq(){return this.seq/2>>>0}set internalSeq(e){this.seq=2*e}asState(){return[this.time,this.seq,td(this.receiver,this.selector,this.args)]}static fromState(e,t){const[s,n,i]=e,{receiver:o,selector:r,args:a}=function(e,t){let s,n,i;if(1===e.length||"["===e[1]){const t=parseInt(e[0],36);s="_",n=Oc[t],i=e.slice(1)}else{const t=e.indexOf(">");let o=e.indexOf("[");-1===o&&(o=e.length),s=e.slice(0,t),n=e.slice(t+1,o),i=e.slice(o)}let o=[];i&&(o=dd.newOrRecycled(t).decode(JSON.parse(i)));return{receiver:s,selector:n,args:o}}(i,t);return new nd(s,n,o,r,a)}executeOn(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.currentEventFromModel=!this.isExternal();const s=t?e=>e():t=>Uc(e,(()=>Oe(e,t))),{receiver:n,selector:i,args:o}=this,r=e.lookUpModel(n);if(r)if("{"===i[0]){const t=e.compileFuncString(i,r);s((()=>{try{t(...o)}catch(e){Se(`${this.shortString()} ${t}`,e)}}))}else i.indexOf(".")>=0?s((()=>{const e=i.indexOf("."),t=i.slice(0,e),s=i.slice(e+1);try{r.call(t,s,...o)}catch(e){Se(`${this.shortString()} ${r}.call(${JSON.stringify(t)}, ${JSON.stringify(s)})`,e)}})):"function"!=typeof r[i]?xe(`${this.shortString()} ${r}.${i}(): method not found`):s((()=>{try{if(Jc(i)){const e=r[i];delete r[i],e(...o)}else r[i](...o)}catch(e){Se(`${this.shortString()} ${r}.${i}()`,e)}}));else xe(`${this.shortString()} ${i}(): receiver not found`)}shortString(){return(this.isExternal()?"External":"Future")+"Message"}toString(){const{receiver:e,selector:t,args:s}=this,n=this.isExternal(),i=n?this.externalSeq:this.internalSeq;return`${n?"External":"Future"}Message[${this.time}${":#"[+n]}${i} ${e}.${t}(${s.map(JSON.stringify).join(", ")})]`}[Symbol.toPrimitive](){return this.toString()}}const id=(()=>{const e=new ArrayBuffer(8),t=new DataView(e);return e=>(t.setFloat64(0,e,!0),t.getInt32(0,!0)+t.getInt32(4,!0))})();class od{constructor(){this.done=new Set,this.todo=[],this.hashers=new Map,this.addHasher("Teatime:Message",nd),this.addHasher("Teatime:Data",Lc),this.addHasher("Teatime:QFunc",Yc);for(const[e,t]of gd.allClassTypes())this.addHasher(e,t)}addHasher(e,t){const{cls:s,write:n}=Object.getPrototypeOf(t)===Object.prototype?t:{cls:t,write:e=>({...e})};n&&this.hashers.set(s,(e=>this.hashStructure(e,n(e))))}getHash(e){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(const[t,s]of Object.entries(e))if("controller"!==t&&"meta"!==t)if("_random"===t)this.hash(s.state(),!1);else if("messages"===t){const e=s.asArray();(this.hashState.fC=e.length)&&this.hash(e,!1)}else this.hashEntry(t,s);return this.hashDeferred(),this.hashState}hashDeferred(){let e=0;for(;e<this.todo.length;){const{key:t,value:s}=this.todo[e++];this.hashEntry(t,s,!1)}this.todo.length=0}hash(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(typeof e){case"number":return void(Number.isNaN(e)?this.hashState.nanC++:Number.isFinite(e)?0===e?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=id(e)):this.hashState.infC++);case"string":return this.hashState.sC++,void(this.hashState.sL+=e.length);case"boolean":case"undefined":return;case"bigint":if(0n===e)this.hashState.zC++;else{this.hashState.nC++;const t=e<0?-1n:0n;for(;e!==t;)this.hashState.nH+=Number(0xFFFFFFFFn&e),e>>=32n}return;default:{if(this.done.has(e))return;if(null===e)return;if(this.hashers.has(e.constructor))return void this.hashers.get(e.constructor)(e);const s=Object.prototype.toString.call(e).slice(8,-1);if(this.hashers.has(s))return void this.hashers.get(s)(e);switch(s){case"Array":return void this.hashArray(e,t);case"ArrayBuffer":return void this.hashIntArray(new Uint8Array(e));case"Set":return void this.hashStructure(e,[...e]);case"Map":return void this.hashStructure(e,[...e],!1);case"DataView":return void this.hashIntArray(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":return void this.hashIntArray(e);case"Float32Array":case"Float64Array":return void this.hashArray(e,!1);case"Object":e instanceof gd?this.hashModel(e):e.constructor===Object&&this.hashObject(e,t)}}}}hashModel(e){this.hashState.mC++,this.done.add(e);for(const[t,s]of Object.entries(e))"__realm"!==t&&void 0!==s&&this.hashEntry(t,s)}hashObject(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.hashState.oC++,this.done.add(e);for(const[s,n]of Object.entries(e))void 0!==n&&this.hashEntry(s,n,t)}hashArray(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.done.add(e);for(let s=0;s<e.length;s++)this.hashEntry(s,e[s],t)}hashIntArray(e){this.done.add(e);for(let t=0;t<e.length;t++){const s=e[t];0===s?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=s)}}hashStructure(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];void 0!==t&&(this.done.add(e),this.hash(t,s))}hashEntry(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"$"!==e[0]&&(s&&"object"==typeof t?this.todo.push({key:e,value:t}):this.hash(t,s))}}class rd{static newOrRecycled(e){let t=this.reusableInstance;return t?(t.vm=e,t.nextRef=1,t.refs=new Map,t.todo=[]):t=this.reusableInstance=new this(e),t}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(e){this[this.name+"-instance"]=e}static resetInstance(){this.reusableInstance=null}constructor(e){this.vm=e,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter("Teatime:Message",nd),this.addWriter("Teatime:Data",Lc),this.addWriter("Teatime:QFunc",Yc);for(const[e,t]of gd.allClassTypes())this.addWriter(e,t);this.okayToIgnore={$debugWriteProxyHandler:!0};for(const e of gd.allClasses())if(Object.prototype.hasOwnProperty.call(e,"okayToIgnore")){const t=e.okayToIgnore();if(!Array.isArray(t))throw new Error("okayToIgnore() must return an array");for(const e of t){if("$"!==e[0])throw Error(`okayToIgnore: ignored prop "${e}" must start with '$'`);this.okayToIgnore[e]=!0}}}addWriter(e,t){const s=Object.getPrototypeOf(t)===Object.prototype,{cls:n,write:i}=s?t:{cls:t,write:e=>({...e})};if(n===Object)throw Error(`${ze.libName} types: '${e}' is the Object class itself, must be a user class`);if(n===Array)throw Error(`${ze.libName} types: '${e}' is the Array class, must be a user class`);i?this.writers.set(n,((t,o)=>this.writeAs(e,t,i(t),s?`${o}.write(${n.name})`:o))):t.writeStatic||console.warn(`${ze.libName} types: ${e} does not implement write() or writeStatic()`)}snapshot(e,t){const s={_random:e._random.state(),messages:this.write(e.messages.asArray(),"FutureMessages"),subscribers:void 0,controller:void 0,$compiledFuncs:void 0};this.writeAllStaticInto(s);for(const[n,i]of Object.entries(e))n in s||this.writeInto(s,n,i,t);return this.writeDeferred(),delete s.controller,delete s.subscribers,delete s.$compiledFuncs,s}writeAllStaticInto(e){for(const t of gd.allClasses())if(t!==gd)for(const[s,n]of Object.entries(t)){if("$"===s[0])continue;const i=gd.classToID(t);e.staticModelProps||(e.staticModelProps={}),i in e.staticModelProps||(e.staticModelProps[i]={}),this.writeInto(e.staticModelProps[i],s,n,`Model(${i}).static`),md("Model",i)}for(const[t,s]of gd.allClassTypes())if("object"==typeof s){const{writeStatic:n}=s;if(n){const s=n();s&&(e.staticTypeProps||(e.staticTypeProps={}),e.staticTypeProps[t]=this.write(s,`Type(${t}).writeStatic()`),md("Type",t))}}}writeDeferred(){let e=0;for(;e<this.todo.length;){const{state:t,key:s,value:n,path:i}=this.todo[e++];this.writeInto(t,s,n,i,!1)}this.todo.length=0}write(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(typeof e){case"number":return Object.is(e,-0)?{$class:"NegZero"}:Number.isFinite(e)?e:Number.isNaN(e)?{$class:"NaN"}:{$class:"Infinity",$value:Math.sign(e)};case"string":case"boolean":return e;case"undefined":return{$class:"Undefined"};case"bigint":return{$class:"BigInt",$value:e.toString()};default:{if(this.refs.has(e))return this.writeRef(e);if(null===e)return e;if(this.writers.has(e.constructor))return this.writers.get(e.constructor)(e,t);const n=Object.prototype.toString.call(e).slice(8,-1);if(this.writers.has(n))return this.writers.get(n)(e,t);switch(n){case"Array":return this.writeArray(e,t,s);case"ArrayBuffer":return this.writeArrayBuffer(e);case"Set":return this.writeAs(n,e,[...e],t);case"Map":return this.writeAs(n,e,[...e].flat(),t);case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":return this.writeTypedArray(n,e);case"Object":if(e instanceof gd)return this.writeModel(e,t);if(e.constructor===Object||"function"!=typeof e.constructor)return this.writeObject(e,t,s);throw console.warn(`${ze.libName}: unknown class at ${t}:`,e),Error(`${ze.libName}: class not registered in Model.types(): ${e.constructor.name}`);case"Function":if(e[Rc])return this.writers.get(Rc)(e,t);throw console.warn(`${ze.libName}: found function at ${t}:`,e),Error(`${ze.libName}: cannot serialize functions except for QFuncs`);default:throw console.warn(`${ze.libName}: unsupported property at ${t}:`,e),Error(`${ze.libName}: serialization of ${n}s is not supported`)}}}}writeModel(e,t){const s={};this.refs.set(e,s);try{s.$model=gd.classToID(e.constructor)}catch(s){throw console.error(`unregistered model class at ${t}:`,e),s}for(const t of Object.keys(e).sort()){if("__realm"===t)continue;const n=e[t];("number"==typeof n&&Number.isFinite(n)&&!Object.is(n,-0)||"string"==typeof n||"boolean"==typeof n)&&"$"!==t[0]?s[t]=n:this.writeInto(s,t,n,`${e}`,!0)}return s}writeObject(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n={};this.refs.set(e,n);for(const i of Object.keys(e).sort()){const o=e[i];("number"==typeof o&&Number.isFinite(o)&&!Object.is(o,-0)||"string"==typeof o||"boolean"==typeof o)&&"$"!==i[0]?n[i]=o:this.writeInto(n,i,o,t,s)}return n}writeArray(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=[];this.refs.set(e,n);for(let i=0;i<e.length;i++){const o=e[i];"number"==typeof o&&Number.isFinite(o)&&!Object.is(o,-0)||"string"==typeof o||"boolean"==typeof o?n[i]=o:this.writeInto(n,i,o,t,s)}return n}writeArrayBuffer(e){const t={$class:"ArrayBuffer",$value:pd(e)};return this.refs.set(e,t),t}writeTypedArray(e,t){const s={$class:e,$value:[this.write(t.buffer),t.byteOffset,"DataView"===e?t.byteLength:t.length]};return this.refs.set(t,s),s}writeAs(e,t,s,n){const i={$class:e};this.refs.set(t,i);const o=this.write(s,n,!1);return"object"!=typeof o||null===o||o.$class||Array.isArray(o)?i.$value=o:Object.assign(i,o),i}writeRef(e){const t=this.refs.get(e);if("object"!=typeof t)throw Error("Non-object in refs: "+e);Array.isArray(t)&&(t.toJSON=function(){return{$id:this.$id,$class:"Array",$value:[...this]}});return{$ref:t.$id||(t.$id=this.nextRef++)}}writeInto(e,t,s,n){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if("$"===t[0])return void(this.okayToIgnore[t]||(xe(`snapshot: ignoring property ${t} (declare as okayToIgnore to suppress warning)`,{only:"once"}),this.okayToIgnore[t]=!0));if(i&&"object"==typeof s)return void this.todo.push({state:e,key:t,value:s,path:n});const o=this.write(s,n+Cc(e,t));e[t]=o}}const ad=Symbol("croquet:unresolved");class ld{static newOrRecycled(e){let t=this.reusableInstance;return t?(t.vm=e,t.refs=new Map,t.todo=[],t.unresolved=[],t.postprocess=[]):t=this.reusableInstance=new this(e),t}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(e){this[this.name+"-instance"]=e}static resetInstance(){this.reusableInstance=null}constructor(e){this.vm=e,this.refs=new Map,this.todo=[],this.unresolved=[],this.postprocess=[],this.readers=new Map,this.addReader("Teatime:Message",nd),this.addReader("Teatime:Data",Lc),this.addReader("Teatime:QFunc",Yc),this.readers.set("Undefined",(()=>{})),this.readers.set("NaN",(()=>NaN)),this.readers.set("Infinity",(e=>e*(1/0))),this.readers.set("NegZero",(()=>-0)),this.readers.set("BigInt",(e=>BigInt(e))),this.readers.set("ArrayBuffer",(e=>function(e){const t=globalThis.atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return n.buffer}(e))),this.readers.set("DataView",(e=>new DataView(...e))),this.readers.set("Int8Array",(e=>new Int8Array(...e))),this.readers.set("Uint8Array",(e=>new Uint8Array(...e))),this.readers.set("Uint8ClampedArray",(e=>new Uint8ClampedArray(...e))),this.readers.set("Int16Array",(e=>new Int16Array(...e))),this.readers.set("Uint16Array",(e=>new Uint16Array(...e))),this.readers.set("Int32Array",(e=>new Int32Array(...e))),this.readers.set("Uint32Array",(e=>new Uint32Array(...e))),this.readers.set("Float32Array",(e=>new Float32Array(...e))),this.readers.set("Float64Array",(e=>new Float64Array(...e)));for(const[e,t]of gd.allClassTypes())this.addReader(e,t)}addReader(e,t){let s=e=>Object.assign(Object.create(t.prototype),e);"object"==typeof t&&(s=t.read),this.readers.set(e,s)}enableBackwardCompatibility(e){const t=e?.meta?.sdk;if(!t)return;const[s,n,i,o]=t.split(/[-.+]/).map((e=>+e));let r=`${s}.${n}`;i&&(r+=`.${i}`),o&&(r+=`-${o}`),console.warn(`${ze.libName}: reading snapshot version ${r}`),this.compatMaps=s<1||1===s&&(n<1||1===n&&i<7)}readVM(e,t,s){if("VM"!==t)throw Error("VirtualMachine must be root object");s&&this.enableBackwardCompatibility(e);const n=this.read(e,t,!1);return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),this.readAllStatic(n),n}readDeferred(){let e=0;for(;e<this.todo.length;){const{object:t,key:s,value:n,path:i}=this.todo[e++];this.readInto(t,s,n,i,!1)}this.todo.length=0}resolveRefs(){for(const{object:e,key:t,ref:s,path:n}of this.unresolved){if(!this.refs.has(s))throw Error(`Unresolved ref: ${s} at ${n}[${JSON.stringify(t)}]`);e[t]=this.refs.get(s)}this.unresolved.length=0,this.refs.clear()}doPostprocess(){for(const e of this.postprocess)e();this.postprocess.length=0}readAllStatic(e){const{staticModelProps:t,staticTypeProps:s}=e,n=[];if(t){for(const[e,s]of Object.entries(t)){const t=gd.classFromID(e);n.push((()=>Object.assign(t,s))),md("Model",e)}delete e.staticModelProps}if(s){const t=Object.fromEntries(gd.allClassTypes());for(const[e,i]of Object.entries(s)){const s=t[e];if("object"==typeof s){const e=s;n.push((()=>e.readStatic(i)))}else{const e=s;n.push((()=>Object.assign(e,i)))}md("Type",e)}delete e.staticTypeProps}n.length&&(e.staticInitializers=n)}read(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(typeof e){case"number":case"string":case"boolean":return e;default:{const n=Object.prototype.toString.call(e).slice(8,-1);switch(n){case"Array":return this.readArray(e,t,s);case"Null":return null;case"Object":{const{$class:n,$model:i,$ref:o}=e;if(o)throw Error("refs should have been handled in readInto()");return i?this.readModel(e,t):n?this.readAs(n,e,t):this.readObject(Object,e,t,s)}default:throw Error(`Don't know how to deserialize ${n} at ${t}`)}}}}readModel(e,t){const s=gd.instantiateClassID(e.$model,e.id);e.$id&&this.refs.set(e.$id,s);for(const[n,i]of Object.entries(e))"id"!==n&&"$"!==n[0]&&this.readInto(s,n,i,t);return s}readObject(e,t,s){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=new e;t.$id&&this.refs.set(t.$id,i);for(const[e,o]of Object.entries(t))"$"!==e[0]&&this.readInto(i,e,o,s,n);return i}readArray(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=[];e.$id&&this.refs.set(e.$id,n);for(let i=0;i<e.length;i++)void 0!==e[i]&&this.readInto(n,i,e[i],t,s);return n}readAsArray(e,t){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=e.$value;return e.$id&&(n.$id=e.$id),this.readArray(n,t,s)}readAsSet(e,t){const s=new Set;e.$id&&this.refs.set(e.$id,s);const n=this.unresolved.length,i=this.read(e.$value,t,!1),o=()=>{for(const e of i)s.add(e)};return this.unresolved.length===n?o():this.postprocess.push(o),s}readAsMap(e,t){const s=new Map;e.$id&&this.refs.set(e.$id,s);const n=this.unresolved.length,i=this.read(e.$value,t,!1),o=this.compatMaps?()=>{if(i.some((e=>2!==e.length)))console.warn("Deferring map resolution at",t),this.postprocess.push(o);else for(const[e,t]of i)s.set(e,t)}:()=>{for(let e=0;e<i.length;e+=2)s.set(i[e],i[e+1])};return this.unresolved.length===n?o():this.postprocess.push(o),s}readAsClass(e,t,s){let n={};const i=new Map;if("$value"in t)n=this.read(t.$value,s,!1);else for(const[e,o]of Object.entries(t)){if("$"===e[0])continue;const t=o&&o.$ref;t?this.refs.has(t)?n[e]=this.refs.get(t):(n[e]=ad,i.set(t,e)):this.readInto(n,e,o,s,!1)}const o=this.readers.get(e)(n,s);o||"Undefined"===e||"BigInt"===e||"NaN"===e||"NegZero"===e||console.warn(`Reading "${e}" returned ${o} at ${s}`),t.$id&&this.refs.set(t.$id,o);for(const[e,t]of i.entries())this.unresolved.push({object:o,key:t,ref:e,path:s});return o}readAs(e,t,s){switch(e){case"Array":return this.readAsArray(t,s);case"Set":return this.readAsSet(t,s);case"Map":return this.readAsMap(t,s);default:return this.readAsClass(e,t,s)}}readRef(e,t,s,n){if(!s||!s.$ref)return!1;const i=s.$ref;return this.refs.has(i)?e[t]=this.refs.get(i):(e[t]=ad,this.unresolved.push({object:e,key:t,ref:i,path:n})),!0}readInto(e,t,s,n){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.readRef(e,t,s,n)||(i&&"object"==typeof s?this.todo.push({object:e,key:t,value:s,path:n}):e[t]=this.read(s,n+Cc(e,t)))}}class cd extends rd{encode(e){const t=this.writeArray(e,"args");return this.writeDeferred(),t}writeModel(e){return{$ref:e.id}}}class dd extends ld{decode(e){const t=this.readArray(e,"args");return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),t}resolveRefs(){for(const{object:e,key:t,ref:s,path:n}of this.unresolved)if(this.refs.has(s))e[t]=this.refs.get(s);else{const i=this.vm.lookUpModel(s);if(!i)throw Error(`Unresolved ref: ${s} at ${n}[${JSON.stringify(t)}]`);e[t]=i}}}const hd=[Object,Array,Map,Set,BigInt,ArrayBuffer,DataView,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];function ud(e,t,s,n){const i=Array.isArray(e)?e:e.constructor===Set?e.values():e.constructor===Map?e.entries():Object.values(e),o=[];for(const e of i)"object"!=typeof e||null===e||n.has(e)||(n.add(e),o.push(e));for(const e of o){if(hd.includes(e.constructor))continue;const n=t+"."+e.constructor.name;if(s[n]){if(s[n]!==e.constructor)throw new Error("Class with name "+n+" already gathered, but new one has different identity")}else s[n]=e.constructor}for(const e of o)ud(e,t,s,n)}function md(e,t){const s=Ee.controllers.size;s>1&&xe(`Static properties in shared ${e} ${t} can lead to divergence because ${s} ${ze.libName} sessions are running simultaneaously. Consider using wellKnownModel() instead.`,{only:"once"})}function pd(e){const t=new Uint8Array(e),s=[];for(let e=0;e<t.byteLength;e+=4096){const n=t.subarray(e,e+4096);s.push(String.fromCharCode.apply(null,n))}return globalThis.btoa(s.join(""))}const fd={classes:u.has("debug","classes")};let bd=Symbol("SECRET");const yd=new WeakSet;class gd{static create(){if(!Xd(this))throw Error(`Model class "${this.name}" not registered`);const e=this,t=this.createNoInit();return!this.wellKnownModel("modelRoot")&&(t.beWellKnownAs("modelRoot"),t.__realm.vm.debugEvents&&this.eventDebugInit(t)),yd.add(t),t.init(...arguments),yd.has(t)&&(yd.delete(t),Object.getPrototypeOf(e)!==gd&&console.warn(`${t} did not call super.init(options)`)),t}static createNoInit(e){const t=De(),s=new this(bd);return e||(e=t.register(s)),void 0===fd.write&&(fd.write=u.has("debug","write"),fd.publish=u.has("debug","publish"),fd.events=u.has("debug","events")),Object.defineProperty(s,"__realm",{value:t,writable:fd.write}),Object.defineProperty(s,"id",{value:e,enumerable:!0}),s}static allowConstructors(){bd=void 0,console.warn("disabling error reporting for Model constructors")}static register(e){return e||(e=this.name,console.warn(`Deprecation warning: ${this.name}.register(classId) called without classId. See https://croquet.io/docs/croquet/Model.html#.register`)),ld.resetInstance(),rd.resetInstance(),cd.resetInstance(),dd.resetInstance(),function(e,t){const s=V(e),n=z(`${t}:${s}`);_.push(n),n.then((e=>K[e].what=`Class ${t}`))}(this,e),function(e,t){const s=wd[t];if(s&&s!==e)throw Error(`Registering model class ${e.name} failed, id "${t}" already used by ${s.name}`);Xd(e)?fd.classes&&!s&&console.warn(`ignoring re-exported model class ${t}`):(fd.classes&&console.log(`registering model class ${t}`),e[Zd]=t);wd[t]=e}(this,e),gd.lastRegistered=this,this}static wellKnownModel(e){if(!ed.hasCurrent())throw Error("static Model.wellKnownModel() called from outside model");return ed.current().get(e)}static evaluate(e){return ed.evaluate(e)}static isExecuting(){return ed.hasCurrent()}static types(){return{}}static gatherClassTypes(e,t){const s={};return ud({root:e},t,s,new Set),s}static eventDebugOptions(){return fd}static eventDebugInit(e){e.subscribe("*","*",e.createQFunc('\n        function logEvents(data) {\n            // do this now to have no side effects below\n            const { scope, event, source } = this.activeSubscription;\n            // below stuff is outside the model. Must not have any side effects!\n            const debug = this.constructor.eventDebugOptions();\n            if (!debug.events && !debug.publish) return;\n            const action = source === "model" ? "publish" : "receive";\n            const emoji = source === "model" ? "🔮" : "📬";\n            console.log(`${emoji} @${this.now()} Model ${action} ${scope}:${event}`, data);\n        }\n        '))}static okayToIgnore(){return[]}static classToID(e){return function(e){if(Xd(e))return e[Zd];const t=e.name||"ClassName";throw Error(`Model class not registered, did you call ${t}.register("${t}")?`)}(e)}static classFromID(e){return xd(e)}static allClasses(){return vd()}static allClassTypes(){return function(){const e={};for(const t of vd())Object.assign(e,t.types());return Object.entries(e)}()}static instantiateClassID(e,t){return xd(e).createNoInit(t)}constructor(e){if(e!==bd)throw Error(`You must create ${App.libName} Models using create() not "new"!`)}init(e,t){yd.delete(this)}destroy(){De().unsubscribeAll(this),De().deregister(this)}publish(e,t,s){this.__realm||this.__realmError(),this.__realm.publish(t,s,e)}subscribe(e,t,s){return this.__realm||this.__realmError(),this.__realm.subscribe(this,e,t,s)}unsubscribe(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"*";this.__realm||this.__realmError(),this.__realm.unsubscribe(this,e,t,s)}unsubscribeAll(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}get activeSubscription(){if(!ed.hasCurrent())return;const{currentEvent:e,currentEventFromModel:t}=ed.current();if(!e)return;const[s,n]=e.split(":");return{scope:s,event:n,source:t?"model":"view"}}__realmError(){if(!this.id)throw Error(`${this} has no ID, did you call super.init(options)?`)}future(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.__realm||this.__realmError();for(var s=arguments.length,n=new Array(s>2?s-2:0),i=2;i<s;i++)n[i-2]=arguments[i];return this.__realm.future(this,e,t,n)}cancelFuture(e){return this.__realm||this.__realmError(),this.__realm.cancelFuture(this,e)}random(){return De().random()}now(){return De().now()}beWellKnownAs(e){De().vm.set(e,this)}getModel(e){return this.__realm.vm.lookUpModel(e)}wellKnownModel(e){return this.__realm.vm.get(e)}modelOnly(e){if(ed.current()===this.__realm.vm)return!0;const t=Error(e||`${this}.modelOnly() called from outside a model!`);throw Se("view code",t),t}get sessionId(){return this.__realm.vm.id}get viewCount(){return Object.keys(this.__realm.vm.views).length}createQFunc(e,t){return void 0===t&&(t=e,e={}),Ic(this,e,t)}persistSession(e){if(this!==this.wellKnownModel("modelRoot"))throw Error("persistSession() must only be called on the root model");this.__realm.vm.persist(this,e)}[Symbol.toPrimitive](){return`${this.constructor[Zd]||this.constructor.name}#${this.id}`}}const wd={},Zd=Symbol("CLASS_ID");function vd(){return Object.values(wd)}function Xd(e){return Object.prototype.hasOwnProperty.call(e,Zd)}function xd(e){if(wd[e])return wd[e];throw Error(`Model class "${e}" in snapshot, but not registered?`)}const Ld="Croquet.Model";let Sd;gd[Zd]=Ld,wd[Ld]=gd;class Gd{static displayStatus(e,t){return Le(e,t)}static displayWarning(e,t){return xe(e,t)}static displayError(e,t){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e&&ze.showMessage(e,{...t,level:"error"})}(e,t)}constructor(e){"object"==typeof e&&"__realm"in e||console.warn(`${ze.libName}: argument to View constructor needs to be a Model`);let t=De("");t&&t.isViewRealm()||(t=Be(e.__realm.vm,(()=>De()),!0)),Object.defineProperty(this,"realm",{value:t}),Object.defineProperty(this,"id",{value:t.register(this),configurable:!0});const s=t.controller.session;if(s.view||(s.view=this),Sd||(Sd={events:u.has("debug","events"),publish:u.has("debug","publish")}),s.view===this&&(Sd.events||Sd.publish)){const e=e=>{if(!t.vm.debugEvents)return;const{scope:s,event:n,source:i,subscribed:o}=this.activeSubscription;if(!o&&!Sd.publish)return;const r="view"===i?"publish":"receive",a="view"===i?"📮":"👁️",l=o||"publish"===r?"":" (no subscribers)";console.log(`${a} View ${r} ${s}:${n}${l}`,e)},s=t=>"view"===this.activeSubscription.source&&e(t),n=t=>"model"===this.activeSubscription.source&&e(t);s.__CROQUET__=!0,n.__CROQUET__=!0,this.subscribe("*",{event:"*",handling:"queued"},n),this.subscribe("*",{event:"*",handling:"immediate"},s)}}detach(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,"id",{value:""})}reattach(){Object.defineProperty(this,"id",{value:this.realm.register(this)})}publish(e,t,s){this.realm.publish(t,s,e)}subscribe(e,t,s){if("string"==typeof s&&(s=this[s]),"function"!=typeof s)throw Error(`${ze.libName}: subscribe() handler is not a function`);const n=s;(s=n.bind(this)).unbound=n;const{event:i,handling:o}=t.event?t:{event:t};this.realm.subscribe(i,this.id,s,e,o)}unsubscribe(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;"string"==typeof s&&(s=this[s]),this.realm.unsubscribe(t,this.id,s,e)}unsubscribeAll(){this.realm.unsubscribeAll(this.id)}get activeSubscription(){const{currentEvent:e,currentEventFromModel:t,currentEventOnlyGeneric:s}=Ee;if(!e)return;const[n,i]=e.split(":");return{scope:n,event:i,source:t?"model":"view",subscribed:!s}}future(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.realm.future(this,e)}random(){return De().random()}now(){return this.realm.now()}externalNow(){return this.realm.externalNow()}extrapolatedNow(){return this.realm.extrapolatedNow()}update(e){}wellKnownModel(e){return this.realm.vm.get(e)}get sessionId(){return this.realm.controller.sessionSpec.id}get session(){if(this.id&&this.realm.valid())return this.realm.controller.session}get viewId(){return this.realm.controller.viewId}[Symbol.toPrimitive](){const e=this.constructor.name;return e.includes("View")?e:`${e}[View]`}}const Wd=new class{constructor(){this.ready=!1,this.isInIframe=window.top!==window,this.subscriptions={},this.enumerator=null}setReceiver(e){this.receiver=e,this.ready=!0}setIframeEnumerator(e){this.enumerator=e}on(e,t){if(!this.receiver)throw Error("setReceiver() has not been called");if("string"==typeof t&&(t=this.receiver[t]),!t)throw Error("Messenger.on: the second argument must be a method name or a function");if(this.subscriptions[e]){if(this.findIndex(this.subscriptions[e],t)>=0)throw Error(`${t} is already subscribed`)}else this.subscriptions[e]=[];this.subscriptions[e].push(t),this.listener||(this.listener=e=>this.receive(e),window.addEventListener("message",this.listener))}detach(){this.listener&&(window.removeEventListener("message",this.listener),this.listener=null),this.stopPublishingPointerMove(),this.receiver=null,this.subscriptions={},this.enumerator=null,this.ready=!1}removeSubscription(e,t){"string"==typeof t&&(t=this.receiver[t]);const s=this.subscriptions[e];if(s){const n=this.findIndex(s,t);s.splice(n,1),0===s.length&&delete this.subscriptions[e]}}removeAllSubscriptions(){this.subscriptions={}}receive(e){const{event:t,data:s}=e.data,n=e.source;this.handleEvent(t,s,n)}handleEvent(e,t,s){const n=this.subscriptions[e];n&&n.forEach((e=>{e.call(this.receiver,t,s)}))}send(e,t,s){if(this.isInIframe)return void window.top.postMessage({event:e,data:t},"*");if(s)return void s.postMessage({event:e,data:t},"*");if(!this.enumerator)return;this.enumerator().forEach((s=>{s.contentWindow.postMessage({event:e,data:t},"*")}))}findIndex(e,t){const s=t.name;return e.findIndex((e=>{const n=e.name;return s||n?s===n:t===e}))}startPublishingPointerMove(){this._moveHandler||(this._moveHandler=e=>this.send("pointerPosition",{x:e.clientX,y:e.clientY,type:e.type}),window.document.addEventListener("pointermove",this._moveHandler,!0))}stopPublishingPointerMove(){this._moveHandler&&(window.document.removeEventListener("pointermove",this._moveHandler,!0),this._moveHandler=null)}},Td="node"===a.CROQUET_PLATFORM;let Cd=60;class kd{static async join(e){try{return await this.join_impl(e)}catch(e){throw ze.showMessage(e.message||e,{level:"fatal"}),e}}static async join_impl(e){e.appId||(e.appId="no.appId"),e.name||(e.name=ze.autoSession(),e.password||(e.password=ze.autoPassword())),e.model||(e.model=gd.lastRegistered),e.view||(e.view=Gd);const s=[];for(const[p,f]of Object.entries(e))f instanceof Promise&&s.push(f.then((t=>e[p]=t)));function n(e,t){return e===t||e.prototype instanceof t}if(await Promise.all(s),e.box){if("string"!=typeof e.box)throw Error(`${ze.libName}: box must be a string in Session.join()!`);if(!e.box.includes("/"))throw Error(`${ze.libName}: box must be a (partial) URL in Session.join()!`)}else if(!e.reflector||!e.files){if("string"!=typeof e.apiKey)throw Error(`${ze.libName}: no apiKey provided in Session.join()!`);if(e.apiKey.length>128)throw Error(`${ze.libName}: apiKey > 128 characters in Session.join()!`)}if("string"!=typeof e.name)throw Error(`${ze.libName}: no session name provided in Session.join()!`);if(e.name.length>128)throw Error(`${ze.libName}: session name > 128 characters in Session.join()!`);const i=e.model;if("function"!=typeof i||!n(i,gd))throw Error(`${ze.libName}: bad model class in Session.join()`);const o=e.view||Gd;if("function"!=typeof o||!n(o,Gd))throw Error(`${ze.libName}: bad view class in Session.join()`);if("string"!=typeof e.appId)throw Error(`${ze.libName}: no appId provided in Session.join()`);if(!e.appId.length>128)throw Error(`${ze.libName}: appId > 128 characters in Session.join()`);if(!e.appId.match(/^[a-z](-?[a-z0-9_])*(\.[a-z0-9_](-?[a-z0-9_])*)+$/i))throw Error(`${ze.libName}: malformed appId in Session.join()`);if("string"!=typeof e.password||!e.password)throw Error(`${ze.libName}: no password provided in Session.join()`);for(const b of["reflector","synchronizer","files","backend","box"]){const y=u[b]||e[b];void 0!==y&&(u[b]=y)}if(Td&&"manual"!==e.step)throw Error("stepping must be manual in a Node.js app");if("rejoinLimit"in e){if("number"!=typeof e.rejoinLimit||e.rejoinLimit<0||e.rejoinLimit>6e4)throw Error("rejoinLimit range: 0-60000")}else e.rejoinLimit=1e3;if("eventRateLimit"in e){if("number"!=typeof e.eventRateLimit||e.eventRateLimit<1||e.eventRateLimit>60)throw Error("eventRateLimit range: 1-60")}else e.eventRateLimit=20;if(e.heraldUrl){if(e.heraldUrl.length>256)throw Error("heraldUrl can only be 256 characters");if(!e.heraldUrl.startsWith("https://"))throw Error("heraldUrl needs to be https")}if(e.hashOverride){if(43!==e.hashOverride.length)throw Error("hashOverride must be 43 characters");if(-1!==e.hashOverride.search(/[^-_a-zA-Z0-9]/))throw Error("hashOverride must be base64url encoded")}if(e.debug){function g(e){return"string"==typeof e&&(e=e.split(",")),e?Array.isArray(e)?e:[e]:[]}u.debug=[...g(e.debug),...g(u.debug)].join(",")}if("autoSleep"in e){const w=e.autoSleep,Z=typeof w;if("number"===Z){if(w<0)throw Error("an autoSleep value must be >= 0")}else{if("boolean"!==Z)throw Error("autoSleep must be numeric or boolean");e.autoSleep=w?10:0}}else e.autoSleep=10;if(e.flags){let v=e.flags;"string"==typeof v&&(v=v.split(",")),v=v?Array.isArray(v)?v:[v]:[],v=v.filter((e=>"object"!=typeof e)),v.length?(e.flags={},v.forEach((t=>e.flags[t]=!0))):e.flags=null}"expectedSimFPS"in e&&(Cd=Math.min(e.expectedSimFPS,120));const r=["name","password","apiKey","appId","tps","autoSleep","heraldUrl","rejoinLimit","eventRateLimit","optionsFromUrl","persistentIdOptions","viewOptions","viewData","viewIdDebugSuffix","hashOverride","location","flags","progressReporter"];!function(){if(Object.isFrozen(Pd))return;Rd(Pd),function(e){const s=JSON.stringify(e,((e,t)=>"function"==typeof t?V(t):t));if("{}"===s)return;const n=JSON.parse(s),i=z(t(n));_.push(i),i.then((e=>K[e].what=`${ze.libName} Constants`))}(Pd)}();const a=new hc,l=JSON.parse(JSON.stringify({...e.options}));if(e.persistentIdOptions){if(!Array.isArray(e.persistentIdOptions))throw Error("persistentIdOptions must be an array");for(const X of e.persistentIdOptions)if(!(X in l))throw Error(`persistentIdOptions key "${X}" not found in options`)}const c={id:"",persistentId:"",versionId:"",name:e.name,model:null,view:null,step(e){a.stepSession("animation",{frameTime:e,view:c.view,expectedSimFPS:Cd})},leave:()=>kd.leave(c.id),data:{store:(e,t)=>xc.store(e,{...t,sessionId:c.id}),fetch:(e,t)=>xc.fetch(e,{...t,sessionId:c.id}),hash:e=>xc.hash(e),toId:e=>xc.toId(e),fromId:e=>xc.fromId(e)},get latency(){return a.latency},get latencies(){return a.latencies}};"undefined"!=typeof __CROQUET_DEVTOOLS__&&__CROQUET_DEVTOOLS__.dispatchEvent(new CustomEvent("session",{detail:{session:c,controller:a}}));const d={options:l,initFn:(e,t)=>i.create(e,t),rebootModelView:m};for(const[x,L]of Object.entries(e))r.includes(x)&&(d[x]=L);await a.initFromSessionSpec(d);let h=!1;return await m(),"manual"!==e.step&&a.startStepping(c.step),c;async function m(){!function(){c.model=null,c.view&&(u.has("debug","session",!1)&&console.log(c.id,"detaching root view"),c.view.detach(),""!==c.view.id&&console.warn(`${ze.libName}: ${c.view} did not call super.detach()`),c.view=null);ze.clearSessionMoniker(),Wd.ready&&Wd.detach()}(),a.leaving?a.leaving(!0):h||(h=!0,await a.establishSession(d),h=!1,c.model=a.vm.get("modelRoot"),c.id=a.id,c.persistentId=a.persistentId,c.versionId=a.versionId,a.session=c,ze.makeSessionWidgets(c.id),a.inViewRealm((()=>{u.has("debug","session",!1)&&console.log(c.id,"creating root view"),new o(c.model,d.viewOptions)})))}}static async leave(e){const t=function(e){for(const t of cc)if(t.id===e)return t;return null}(e);if(!t)return!1;t.reconnectTimeout&&(clearTimeout(t.reconnectTimeout),delete t.reconnectTimeout);const s=new Promise((e=>t.leaving=e)),n=t.connection;return!!n.connected&&(n.closeConnection(1e3),s)}static thisSession(){const e=ed.current();return e?e.id:""}get id(){return""}get persistentId(){return""}get versionId(){return""}get name(){return""}get data(){return{}}step(e){}leave(){}}const Pd={};function Rd(e){if(!Object.isFrozen(e)){Object.freeze(e);for(const t of Object.values(e))!t||"object"!=typeof t&&"function"!=typeof t||Rd(t)}}const Id={Model:gd,View:Gd,Session:kd,Data:xc,Constants:Pd,App:ze,Messenger:Wd,VERSION:El};gd.Croquet=Id,Gd.Croquet=Id,"undefined"!=typeof __CROQUET_DEVTOOLS__&&__CROQUET_DEVTOOLS__.dispatchEvent(new CustomEvent("load",{detail:{version:El}})),"undefined"!=typeof globalThis&&(globalThis.__CROQUET__?console.warn("WARNING: Multiple instances of Croquet being imported."):globalThis.__CROQUET__=El),exports.App=ze,exports.Constants=Pd,exports.Data=xc,exports.Messenger=Wd,exports.Model=gd,exports.Session=kd,exports.VERSION=El,exports.View=Gd;


/***/ }),

/***/ "./node_modules/fast-json-stable-stringify/index.js":
/*!**********************************************************!*\
  !*** ./node_modules/fast-json-stable-stringify/index.js ***!
  \**********************************************************/
/***/ ((module) => {

"use strict";


module.exports = function (data, opts) {
    if (!opts) opts = {};
    if (typeof opts === 'function') opts = { cmp: opts };
    var cycles = (typeof opts.cycles === 'boolean') ? opts.cycles : false;

    var cmp = opts.cmp && (function (f) {
        return function (node) {
            return function (a, b) {
                var aobj = { key: a, value: node[a] };
                var bobj = { key: b, value: node[b] };
                return f(aobj, bobj);
            };
        };
    })(opts.cmp);

    var seen = [];
    return (function stringify (node) {
        if (node && node.toJSON && typeof node.toJSON === 'function') {
            node = node.toJSON();
        }

        if (node === undefined) return;
        if (typeof node == 'number') return isFinite(node) ? '' + node : 'null';
        if (typeof node !== 'object') return JSON.stringify(node);

        var i, out;
        if (Array.isArray(node)) {
            out = '[';
            for (i = 0; i < node.length; i++) {
                if (i) out += ',';
                out += stringify(node[i]) || 'null';
            }
            return out + ']';
        }

        if (node === null) return 'null';

        if (seen.indexOf(node) !== -1) {
            if (cycles) return JSON.stringify('__cycle__');
            throw new TypeError('Converting circular structure to JSON');
        }

        var seenIndex = seen.push(node) - 1;
        var keys = Object.keys(node).sort(cmp && cmp(node));
        out = '';
        for (i = 0; i < keys.length; i++) {
            var key = keys[i];
            var value = stringify(node[key]);

            if (!value) continue;
            if (out) out += ',';
            out += JSON.stringify(key) + ':' + value;
        }
        seen.splice(seenIndex, 1);
        return '{' + out + '}';
    })(data);
};


/***/ }),

/***/ "./node_modules/fastpriorityqueue/FastPriorityQueue.js":
/*!*************************************************************!*\
  !*** ./node_modules/fastpriorityqueue/FastPriorityQueue.js ***!
  \*************************************************************/
/***/ ((module) => {

"use strict";
/**
 * FastPriorityQueue.js : a fast heap-based priority queue  in JavaScript.
 * (c) the authors
 * Licensed under the Apache License, Version 2.0.
 *
 * Speed-optimized heap-based priority queue for modern browsers and JavaScript engines.
 *
 * Usage :
         Installation (in shell, if you use node):
         $ npm install fastpriorityqueue

         Running test program (in JavaScript):

         // var FastPriorityQueue = require("fastpriorityqueue");// in node
         var x = new FastPriorityQueue();
         x.add(1);
         x.add(0);
         x.add(5);
         x.add(4);
         x.add(3);
         x.peek(); // should return 0, leaves x unchanged
         x.size; // should return 5, leaves x unchanged
         while(!x.isEmpty()) {
           console.log(x.poll());
         } // will print 0 1 3 4 5
         x.trim(); // (optional) optimizes memory usage
 */


var defaultcomparator = function(a, b) {
  return a < b;
};


// construct a new priority queue
// the provided comparator function should take a, b and return *true* when a < b
function FastPriorityQueue(comparator) {
  if (!(this instanceof FastPriorityQueue)) return new FastPriorityQueue(comparator);
  this.array = [];
  this.size = 0;
  this.compare = comparator || defaultcomparator;
}

// copy the priority queue into another, and return it. Queue items are shallow-copied.
// Runs in `O(n)` time.
FastPriorityQueue.prototype.clone = function() {
  var fpq = new FastPriorityQueue(this.compare);
  fpq.size = this.size;
  fpq.array = this.array.slice(0, this.size);
  return fpq;
};

// add an element into the queue
// runs in `O(log n)` time
FastPriorityQueue.prototype.add = function(myval) {
  var i = this.size;
  this.array[this.size] = myval;
  this.size += 1;
  var p;
  var ap;
  while (i > 0) {
    p = (i - 1) >> 1;
    ap = this.array[p];
    if (!this.compare(myval, ap)) {
      break;
    }
    this.array[i] = ap;
    i = p;
  }
  this.array[i] = myval;
};

// replace the content of the heap by provided array and "heapify it"
FastPriorityQueue.prototype.heapify = function(arr) {
  this.array = arr;
  this.size = arr.length;
  var i;
  for (i = this.size >> 1; i >= 0; i--) {
    this._percolateDown(i);
  }
};

// for internal use
FastPriorityQueue.prototype._percolateUp = function(i, force) {
  var myval = this.array[i];
  var p;
  var ap;
  while (i > 0) {
    p = (i - 1) >> 1;
    ap = this.array[p];
    // force will skip the compare
    if (!force && !this.compare(myval, ap)) {
      break;
    }
    this.array[i] = ap;
    i = p;
  }
  this.array[i] = myval;
};

// for internal use
FastPriorityQueue.prototype._percolateDown = function(i) {
  var size = this.size;
  var hsize = this.size >>> 1;
  var ai = this.array[i];
  var l;
  var r;
  var bestc;
  while (i < hsize) {
    l = (i << 1) + 1;
    r = l + 1;
    bestc = this.array[l];
    if (r < size) {
      if (this.compare(this.array[r], bestc)) {
        l = r;
        bestc = this.array[r];
      }
    }
    if (!this.compare(bestc, ai)) {
      break;
    }
    this.array[i] = bestc;
    i = l;
  }
  this.array[i] = ai;
};

// internal
// _removeAt(index) will remove the item at the given index from the queue,
// retaining balance. returns the removed item, or undefined if nothing is removed.
FastPriorityQueue.prototype._removeAt = function(index) {
  if (index > this.size - 1 || index < 0) return undefined;

  // impl1:
  //this.array.splice(index, 1);
  //this.heapify(this.array);
  // impl2:
  this._percolateUp(index, true);
  return this.poll();
};

// remove(myval) will remove an item matching the provided value from the
// queue, checked for equality by using the queue's comparator.
// return true if removed, false otherwise.
FastPriorityQueue.prototype.remove = function(myval) {
  for (var i = 0; i < this.size; i++) {
    if (!this.compare(this.array[i], myval) && !this.compare(myval, this.array[i])) {
      // items match, comparator returns false both ways, remove item
      this._removeAt(i);
      return true;
    }
  }
  return false;
};

// removeOne(callback) will execute the callback function for each item of the queue
// and will remove the first item for which the callback will return true.
// return the removed item, or undefined if nothing is removed.
FastPriorityQueue.prototype.removeOne = function(callback) {
  if (typeof callback !== "function") {
    return undefined;
  }
  for (var i = 0; i < this.size; i++) {
    if (callback(this.array[i])) {
      return this._removeAt(i);
    }
  }
};

// remove(callback[, limit]) will execute the callback function for each item of
// the queue and will remove each item for which the callback returns true, up to
// a max limit of removed items if specified or no limit if unspecified.
// return an array containing the removed items.
// The callback function should be a pure function.
FastPriorityQueue.prototype.removeMany = function(callback, limit) {
  // Skip unnecessary processing for edge cases
  if (typeof callback !== "function" || this.size < 1) {
    return [];
  }
  limit = limit ? Math.min(limit, this.size) : this.size;

  // Prepare the results container to hold up to the results limit
  var resultSize = 0;
  var result = new Array(limit);

  // Prepare a temporary array to hold items we'll traverse through and need to keep
  var tmpSize = 0;
  var tmp = new Array(this.size);

  while (resultSize < limit && !this.isEmpty()) {
    // Dequeue items into either the results or our temporary array
    var item = this.poll();
    if (callback(item)) {
      result[resultSize++] = item;
    } else {
      tmp[tmpSize++] = item;
    }
  }
  // Update the result array with the exact number of results
  result.length = resultSize;

  // Re-add all the items we can keep
  var i = 0;
  while (i < tmpSize) {
    this.add(tmp[i++]);
  }

  return result;
};

// Look at the top of the queue (one of the smallest elements) without removing it
// executes in constant time
//
// Calling peek on an empty priority queue returns
// the "undefined" value.
// https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/undefined
//
FastPriorityQueue.prototype.peek = function() {
  if (this.size == 0) return undefined;
  return this.array[0];
};

// remove the element on top of the heap (one of the smallest elements)
// runs in logarithmic time
//
// If the priority queue is empty, the function returns the
// "undefined" value.
// https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/undefined
//
// For long-running and large priority queues, or priority queues
// storing large objects, you may  want to call the trim function
// at strategic times to recover allocated memory.
FastPriorityQueue.prototype.poll = function() {
  if (this.size == 0) return undefined;
  var ans = this.array[0];
  if (this.size > 1) {
    this.array[0] = this.array[--this.size];
    this._percolateDown(0);
  } else {
    this.size -= 1;
  }
  return ans;
};

// This function adds the provided value to the heap, while removing
// and returning one of the smallest elements (like poll). The size of the queue
// thus remains unchanged.
FastPriorityQueue.prototype.replaceTop = function(myval) {
  if (this.size == 0) return undefined;
  var ans = this.array[0];
  this.array[0] = myval;
  this._percolateDown(0);
  return ans;
};

// recover unused memory (for long-running priority queues)
FastPriorityQueue.prototype.trim = function() {
  this.array = this.array.slice(0, this.size);
};

// Check whether the heap is empty
FastPriorityQueue.prototype.isEmpty = function() {
  return this.size === 0;
};

// iterate over the items in order, pass a callback that receives (item, index) as args.
// TODO once we transpile, uncomment
// if (Symbol && Symbol.iterator) {
//   FastPriorityQueue.prototype[Symbol.iterator] = function*() {
//     if (this.isEmpty()) return;
//     var fpq = this.clone();
//     while (!fpq.isEmpty()) {
//       yield fpq.poll();
//     }
//   };
// }
FastPriorityQueue.prototype.forEach = function(callback) {
  if (this.isEmpty() || typeof callback != 'function') return;
  var i = 0;
  var fpq = this.clone();
  while (!fpq.isEmpty()) {
    callback(fpq.poll(), i++);
  }
};

// return the k 'smallest' elements of the queue as an array,
// runs in O(k log k) time, the elements are not removed
// from the priority queue.
FastPriorityQueue.prototype.kSmallest = function(k) {
  if ((this.size == 0) || (k<=0)) return [];
  k = Math.min(this.size, k);
  const newSize = Math.min(this.size, (2 ** (k - 1)) + 1);
  if (newSize < 2) { return [this.peek()] }

  const fpq = new FastPriorityQueue(this.compare);
  fpq.size = newSize;
  fpq.array = this.array.slice(0, newSize);

  const smallest = new Array(k);
  for (let i = 0; i < k; i++) {
    smallest[i] = fpq.poll();
  }
  return smallest;
}

module.exports = FastPriorityQueue;


/***/ }),

/***/ "./node_modules/toastify-js/src/toastify.js":
/*!**************************************************!*\
  !*** ./node_modules/toastify-js/src/toastify.js ***!
  \**************************************************/
/***/ (function(module) {

/*!
 * Toastify js 1.12.0
 * https://github.com/apvarun/toastify-js
 * @license MIT licensed
 *
 * Copyright (C) 2018 Varun A P
 */
(function(root, factory) {
  if ( true && module.exports) {
    module.exports = factory();
  } else {
    root.Toastify = factory();
  }
})(this, function(global) {
  // Object initialization
  var Toastify = function(options) {
      // Returning a new init object
      return new Toastify.lib.init(options);
    },
    // Library version
    version = "1.12.0";

  // Set the default global options
  Toastify.defaults = {
    oldestFirst: true,
    text: "Toastify is awesome!",
    node: undefined,
    duration: 3000,
    selector: undefined,
    callback: function () {
    },
    destination: undefined,
    newWindow: false,
    close: false,
    gravity: "toastify-top",
    positionLeft: false,
    position: '',
    backgroundColor: '',
    avatar: "",
    className: "",
    stopOnFocus: true,
    onClick: function () {
    },
    offset: {x: 0, y: 0},
    escapeMarkup: true,
    ariaLive: 'polite',
    style: {background: ''}
  };

  // Defining the prototype of the object
  Toastify.lib = Toastify.prototype = {
    toastify: version,

    constructor: Toastify,

    // Initializing the object with required parameters
    init: function(options) {
      // Verifying and validating the input object
      if (!options) {
        options = {};
      }

      // Creating the options object
      this.options = {};

      this.toastElement = null;

      // Validating the options
      this.options.text = options.text || Toastify.defaults.text; // Display message
      this.options.node = options.node || Toastify.defaults.node;  // Display content as node
      this.options.duration = options.duration === 0 ? 0 : options.duration || Toastify.defaults.duration; // Display duration
      this.options.selector = options.selector || Toastify.defaults.selector; // Parent selector
      this.options.callback = options.callback || Toastify.defaults.callback; // Callback after display
      this.options.destination = options.destination || Toastify.defaults.destination; // On-click destination
      this.options.newWindow = options.newWindow || Toastify.defaults.newWindow; // Open destination in new window
      this.options.close = options.close || Toastify.defaults.close; // Show toast close icon
      this.options.gravity = options.gravity === "bottom" ? "toastify-bottom" : Toastify.defaults.gravity; // toast position - top or bottom
      this.options.positionLeft = options.positionLeft || Toastify.defaults.positionLeft; // toast position - left or right
      this.options.position = options.position || Toastify.defaults.position; // toast position - left or right
      this.options.backgroundColor = options.backgroundColor || Toastify.defaults.backgroundColor; // toast background color
      this.options.avatar = options.avatar || Toastify.defaults.avatar; // img element src - url or a path
      this.options.className = options.className || Toastify.defaults.className; // additional class names for the toast
      this.options.stopOnFocus = options.stopOnFocus === undefined ? Toastify.defaults.stopOnFocus : options.stopOnFocus; // stop timeout on focus
      this.options.onClick = options.onClick || Toastify.defaults.onClick; // Callback after click
      this.options.offset = options.offset || Toastify.defaults.offset; // toast offset
      this.options.escapeMarkup = options.escapeMarkup !== undefined ? options.escapeMarkup : Toastify.defaults.escapeMarkup;
      this.options.ariaLive = options.ariaLive || Toastify.defaults.ariaLive;
      this.options.style = options.style || Toastify.defaults.style;
      if(options.backgroundColor) {
        this.options.style.background = options.backgroundColor;
      }

      // Returning the current object for chaining functions
      return this;
    },

    // Building the DOM element
    buildToast: function() {
      // Validating if the options are defined
      if (!this.options) {
        throw "Toastify is not initialized";
      }

      // Creating the DOM object
      var divElement = document.createElement("div");
      divElement.className = "toastify on " + this.options.className;

      // Positioning toast to left or right or center
      if (!!this.options.position) {
        divElement.className += " toastify-" + this.options.position;
      } else {
        // To be depreciated in further versions
        if (this.options.positionLeft === true) {
          divElement.className += " toastify-left";
          console.warn('Property `positionLeft` will be depreciated in further versions. Please use `position` instead.')
        } else {
          // Default position
          divElement.className += " toastify-right";
        }
      }

      // Assigning gravity of element
      divElement.className += " " + this.options.gravity;

      if (this.options.backgroundColor) {
        // This is being deprecated in favor of using the style HTML DOM property
        console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');
      }

      // Loop through our style object and apply styles to divElement
      for (var property in this.options.style) {
        divElement.style[property] = this.options.style[property];
      }

      // Announce the toast to screen readers
      if (this.options.ariaLive) {
        divElement.setAttribute('aria-live', this.options.ariaLive)
      }

      // Adding the toast message/node
      if (this.options.node && this.options.node.nodeType === Node.ELEMENT_NODE) {
        // If we have a valid node, we insert it
        divElement.appendChild(this.options.node)
      } else {
        if (this.options.escapeMarkup) {
          divElement.innerText = this.options.text;
        } else {
          divElement.innerHTML = this.options.text;
        }

        if (this.options.avatar !== "") {
          var avatarElement = document.createElement("img");
          avatarElement.src = this.options.avatar;

          avatarElement.className = "toastify-avatar";

          if (this.options.position == "left" || this.options.positionLeft === true) {
            // Adding close icon on the left of content
            divElement.appendChild(avatarElement);
          } else {
            // Adding close icon on the right of content
            divElement.insertAdjacentElement("afterbegin", avatarElement);
          }
        }
      }

      // Adding a close icon to the toast
      if (this.options.close === true) {
        // Create a span for close element
        var closeElement = document.createElement("button");
        closeElement.type = "button";
        closeElement.setAttribute("aria-label", "Close");
        closeElement.className = "toast-close";
        closeElement.innerHTML = "&#10006;";

        // Triggering the removal of toast from DOM on close click
        closeElement.addEventListener(
          "click",
          function(event) {
            event.stopPropagation();
            this.removeElement(this.toastElement);
            window.clearTimeout(this.toastElement.timeOutValue);
          }.bind(this)
        );

        //Calculating screen width
        var width = window.innerWidth > 0 ? window.innerWidth : screen.width;

        // Adding the close icon to the toast element
        // Display on the right if screen width is less than or equal to 360px
        if ((this.options.position == "left" || this.options.positionLeft === true) && width > 360) {
          // Adding close icon on the left of content
          divElement.insertAdjacentElement("afterbegin", closeElement);
        } else {
          // Adding close icon on the right of content
          divElement.appendChild(closeElement);
        }
      }

      // Clear timeout while toast is focused
      if (this.options.stopOnFocus && this.options.duration > 0) {
        var self = this;
        // stop countdown
        divElement.addEventListener(
          "mouseover",
          function(event) {
            window.clearTimeout(divElement.timeOutValue);
          }
        )
        // add back the timeout
        divElement.addEventListener(
          "mouseleave",
          function() {
            divElement.timeOutValue = window.setTimeout(
              function() {
                // Remove the toast from DOM
                self.removeElement(divElement);
              },
              self.options.duration
            )
          }
        )
      }

      // Adding an on-click destination path
      if (typeof this.options.destination !== "undefined") {
        divElement.addEventListener(
          "click",
          function(event) {
            event.stopPropagation();
            if (this.options.newWindow === true) {
              window.open(this.options.destination, "_blank");
            } else {
              window.location = this.options.destination;
            }
          }.bind(this)
        );
      }

      if (typeof this.options.onClick === "function" && typeof this.options.destination === "undefined") {
        divElement.addEventListener(
          "click",
          function(event) {
            event.stopPropagation();
            this.options.onClick();
          }.bind(this)
        );
      }

      // Adding offset
      if(typeof this.options.offset === "object") {

        var x = getAxisOffsetAValue("x", this.options);
        var y = getAxisOffsetAValue("y", this.options);

        var xOffset = this.options.position == "left" ? x : "-" + x;
        var yOffset = this.options.gravity == "toastify-top" ? y : "-" + y;

        divElement.style.transform = "translate(" + xOffset + "," + yOffset + ")";

      }

      // Returning the generated element
      return divElement;
    },

    // Displaying the toast
    showToast: function() {
      // Creating the DOM object for the toast
      this.toastElement = this.buildToast();

      // Getting the root element to with the toast needs to be added
      var rootElement;
      if (typeof this.options.selector === "string") {
        rootElement = document.getElementById(this.options.selector);
      } else if (this.options.selector instanceof HTMLElement || (typeof ShadowRoot !== 'undefined' && this.options.selector instanceof ShadowRoot)) {
        rootElement = this.options.selector;
      } else {
        rootElement = document.body;
      }

      // Validating if root element is present in DOM
      if (!rootElement) {
        throw "Root element is not defined";
      }

      // Adding the DOM element
      var elementToInsert = Toastify.defaults.oldestFirst ? rootElement.firstChild : rootElement.lastChild;
      rootElement.insertBefore(this.toastElement, elementToInsert);

      // Repositioning the toasts in case multiple toasts are present
      Toastify.reposition();

      if (this.options.duration > 0) {
        this.toastElement.timeOutValue = window.setTimeout(
          function() {
            // Remove the toast from DOM
            this.removeElement(this.toastElement);
          }.bind(this),
          this.options.duration
        ); // Binding `this` for function invocation
      }

      // Supporting function chaining
      return this;
    },

    hideToast: function() {
      if (this.toastElement.timeOutValue) {
        clearTimeout(this.toastElement.timeOutValue);
      }
      this.removeElement(this.toastElement);
    },

    // Removing the element from the DOM
    removeElement: function(toastElement) {
      // Hiding the element
      // toastElement.classList.remove("on");
      toastElement.className = toastElement.className.replace(" on", "");

      // Removing the element from DOM after transition end
      window.setTimeout(
        function() {
          // remove options node if any
          if (this.options.node && this.options.node.parentNode) {
            this.options.node.parentNode.removeChild(this.options.node);
          }

          // Remove the element from the DOM, only when the parent node was not removed before.
          if (toastElement.parentNode) {
            toastElement.parentNode.removeChild(toastElement);
          }

          // Calling the callback function
          this.options.callback.call(toastElement);

          // Repositioning the toasts again
          Toastify.reposition();
        }.bind(this),
        400
      ); // Binding `this` for function invocation
    },
  };

  // Positioning the toasts on the DOM
  Toastify.reposition = function() {

    // Top margins with gravity
    var topLeftOffsetSize = {
      top: 15,
      bottom: 15,
    };
    var topRightOffsetSize = {
      top: 15,
      bottom: 15,
    };
    var offsetSize = {
      top: 15,
      bottom: 15,
    };

    // Get all toast messages on the DOM
    var allToasts = document.getElementsByClassName("toastify");

    var classUsed;

    // Modifying the position of each toast element
    for (var i = 0; i < allToasts.length; i++) {
      // Getting the applied gravity
      if (containsClass(allToasts[i], "toastify-top") === true) {
        classUsed = "toastify-top";
      } else {
        classUsed = "toastify-bottom";
      }

      var height = allToasts[i].offsetHeight;
      classUsed = classUsed.substr(9, classUsed.length-1)
      // Spacing between toasts
      var offset = 15;

      var width = window.innerWidth > 0 ? window.innerWidth : screen.width;

      // Show toast in center if screen with less than or equal to 360px
      if (width <= 360) {
        // Setting the position
        allToasts[i].style[classUsed] = offsetSize[classUsed] + "px";

        offsetSize[classUsed] += height + offset;
      } else {
        if (containsClass(allToasts[i], "toastify-left") === true) {
          // Setting the position
          allToasts[i].style[classUsed] = topLeftOffsetSize[classUsed] + "px";

          topLeftOffsetSize[classUsed] += height + offset;
        } else {
          // Setting the position
          allToasts[i].style[classUsed] = topRightOffsetSize[classUsed] + "px";

          topRightOffsetSize[classUsed] += height + offset;
        }
      }
    }

    // Supporting function chaining
    return this;
  };

  // Helper function to get offset.
  function getAxisOffsetAValue(axis, options) {

    if(options.offset[axis]) {
      if(isNaN(options.offset[axis])) {
        return options.offset[axis];
      }
      else {
        return options.offset[axis] + 'px';
      }
    }

    return '0px';

  }

  function containsClass(elem, yourClass) {
    if (!elem || typeof yourClass !== "string") {
      return false;
    } else if (
      elem.className &&
      elem.className
        .trim()
        .split(/\s+/gi)
        .indexOf(yourClass) > -1
    ) {
      return true;
    } else {
      return false;
    }
  }

  // Setting up the prototype for the init object
  Toastify.lib.init.prototype = Toastify.lib;

  // Returning the Toastify function to be assigned to the window object/module
  return Toastify;
});


/***/ })

}]);